'use strict';var debugappui=!1,welcomebginterval,apptimeoutduration=1E4,sessionid,vaultkey="",userkey,otherkeys=[],valmap="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789_-+\x3d",publickeyb64="",privatekeyb64="",encprivkey="",loggedinuserflake,flakejsonobj,fullname,genericcounter=0,collageimagesloaded=0,flakegeneratorintid=0,currentavatar="",avatarcountDownDate,sseeventsource,headerflakebuttonhandler=!1,createuserdomainverkey,verifiedbranddomainname,postcontenthome,lastpostseq=0,newauthurl,
newauthcontactflake,lotimer,callservertimer,lasttime,delay,appcalltimeoutid,initialized=!1,allowedlapses=0,interactduration=3E5,lapses=0,settimeoutid,listoftopics={},listofflakes={},topicname,topicautocompleteregistered=!1,topicmaxdepth,topicstorage,flakeautocompleteregistered=!1,postimagesinterval,flakegiveoutmap={},postlocationmap,stripe=null,nastripekey=null,imgcheckinterval;const isJSON=a=>{try{return JSON.parse(a),!0}catch(b){return!1}};
document.addEventListener("DOMContentLoaded",updatescreenandwindowdims,!1);function getPositionOfanElement(a){for(var b=0,c=0;a;){if("BODY"==a.tagName){var e=a.scrollTop||document.documentElement.scrollTop;b+=a.offsetLeft-(a.scrollLeft||document.documentElement.scrollLeft)+a.clientLeft;c+=a.offsetTop-e+a.clientTop}else b+=a.offsetLeft-a.scrollLeft+a.clientLeft,c+=a.offsetTop-a.scrollTop+a.clientTop;a=a.offsetParent}return{x:b,y:c}}
function stopDefaultBackspaceBehaviour(a){a=a||window.event;if(8==a.keyCode){var b=a.srcElement||a.target,c=new RegExp(b.tagName.toUpperCase());"true"!=b.contentEditable&&c.test("HTML, BODY, TABLE, TBODY, TR, TD, DIV")&&(a.preventDefault?a.preventDefault():a.returnValue=!1)}}
function updatescreenandwindowdims(){for(var a=document.getElementsByTagName("form"),b=0;b<a.length;b++)for(var c=a[b].getElementsByTagName("input"),e=0;e<c.length;e++)if("screenwidth"===c[e].name){a[b].screenwidth.value=window.screen.availWidth;a[b].screenheight.value=window.screen.availHeight;a[b].windowwidth.value=window.innerWidth;a[b].windowheight.value=document.getElementById("app").clientHeight;break}}
function attachactivitylisteners(){debugappui&&console.log("attaching eventlisteners");window.addEventListener("load",resetSessionTimer);document.addEventListener("mousemove",resetSessionTimer);document.addEventListener("load",resetSessionTimer);document.addEventListener("mousedown",resetSessionTimer);document.addEventListener("touchstart",resetSessionTimer);document.addEventListener("click",resetSessionTimer);document.addEventListener("scroll",resetSessionTimer);document.addEventListener("keypress",
resetSessionTimer)}
function removeactivitylisteners(){debugappui&&console.log("removing eventlisteners");window.removeEventListener("load",resetSessionTimer);document.removeEventListener("mousemove",resetSessionTimer);document.removeEventListener("load",resetSessionTimer);document.removeEventListener("mousedown",resetSessionTimer);document.removeEventListener("touchstart",resetSessionTimer);document.removeEventListener("click",resetSessionTimer);document.removeEventListener("scroll",resetSessionTimer);document.removeEventListener("keypress",
resetSessionTimer);initialized=!1}function resetSessionTimer(){lasttime=new Date;lotimer&&clearTimeout(lotimer);lotimer=setTimeout(reenter_auth,delay);initialized||(setcallservertimer(),initialized=!0)}
function attachcatalogimagefilechangeeventhandler(){var a=document.getElementById("files-input");null!=a&&(debugappui&&console.log("attaching eventlistener for change on files-input"),a.addEventListener("change",function(a){handleImageUploadFileSelect(a,afterfilescheck);debugappui&&console.log("changed again")},!1))}
function handleImageUploadFileSelect(a,b){var c=a.target.files;a.target.imgcount=0;var e=[];debugappui&&console.log("onchange event fired for files-input");for(var d=0;d<c.length;d++){var f=new FileReader;f.onload=function(b){imageExists(b.target.result,function(b){b&&(a.target.imgcount++,e.push(c[d]),document.getElementById("file-select-feedback").value=c.length+" files selected. "+a.target.imgcount+" images.")})};f.readAsDataURL(c[d])}b(a.target.imgcount,e)}
function afterfilescheck(a,b){0<a&&(debugappui&&console.log("imgcount greater than zero..."+a),document.forms[0].files.value=b,document.getElementById("img-files-upload-btn").style.display="block")}function imageExists(a,b){var c=new Image;c.onload=function(){b(!0)};c.onerror=function(){b(!1)};c.src=a}
function videoExists(a,b){const c=document.createElement("video");c.src=a;c.currentTime=3;c.onloadedmetadata=b=>{window.URL.revokeObjectURL(c.src);console.log("Filename:"+a.name+" - Type:"+a.type+" - Size: "+c.videoWidth+"x"+c.videoHeight);console.log("canplay videomp4 "+c.canPlayType("video/mp4"))};c.ontimeupdate=function(){var a=document.querySelector("#post-video-preview-canvas");a.width=c.videoWidth;a.height=c.videoHeight;a.getContext("2d").drawImage(c,0,0,c.videoWidth,c.videoHeight);console.log("image saved on canvas now passing to callback");
b(!0)};c.onerror=()=>{console.log("File "+a+" not a video file");b(!1)}}function uploadimages(a){document.getElementById("img-files-upload-btn").classList.add("disabled");a&&0<a.length?(debugappui&&console.log("found formname : "+a+".. will submit to singleupload"),submitFormAjax("/singleUpload",a)):(debugappui&&console.log("found no formname : "+a),submitFormAjax("/singleUpload"));return!1}
function overloadimage(a,b){document.getElementById("img-files-upload-btn-overwrite").classList.add("disabled");a&&0<a.length?(console.log("found formname : "+a+".. will submit to singleupload"),submitFormAjax("/singleUpload/"+b,a)):(console.log("found no formname : "+a),submitFormAjax("/singleUpload/"+b));return!1}
function setcallservertimer(){callservertimer&&clearTimeout(callservertimer);debugappui&&console.log("setting timer for addsessiontime");callservertimer=setTimeout(addsessiontime,interactduration)}
function addsessiontime(){var a=new Date,b=(interactduration-(a-lasttime))/1E3;if(4<b){lapses=0;debugappui&&console.log("adding: "+b+" s to session."+a.toString().substring(16,24)+" "+lasttime.toString().substring(16,24)+" lapses: "+lapses+" of "+allowedlapses);var c=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");c.onreadystatechange=function(){4==c.readyState&&200==c.status&&0<c.getResponseHeader("SESSION_EXTENDED_TILL").length&&(avatarcountDownDate=c.getResponseHeader("SESSION_EXTENDED_TILL"))};
c.open("POST","/addsessionduration",!1);c.withCredentials=!0;c.setRequestHeader("Content-Type","application/json");c.send(JSON.stringify({data:interactduration,createdate:a}))}else lapses++,debugappui&&console.log("not enough duration to add: "+b+" s "+a.toString().substring(16,24)+" "+lasttime.toString().substring(16,24)+" lapses: "+lapses+" of "+allowedlapses);lasttime=new Date;setcallservertimer()}
function reenter_auth(){if(lapses>=allowedlapses){debugappui&&console.log("calling reenter_auth.. lapses: "+lapses+" .. also displaying login image");var a=document.getElementById("re-auth-overlay");null==a&&(a=document.createElement("div"),a.setAttribute("id","re-auth-overlay"),document.body.appendChild(a));var b=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");b.onreadystatechange=function(){4==b.readyState&&200==b.status&&(document.getElementById("re-auth-overlay").innerHTML=
b.responseText,document.getElementById("re-auth-overlay").style.display="block",debugappui&&console.log("clearing reenter_auth timer"),clearTimeout(lotimer),debugappui&&console.log("clearing addsessiontime timer"),clearTimeout(callservertimer),lapses=0,removeactivitylisteners(),document.querySelector(".auth-image-main-container")?afterauthscreenload(!0):(clearoverlay("re-auth-overlay"),document.getElementById("app").innerHTML='\x3cdiv style\x3d"display: block; position: relative; fontSize:15px; top: 50%;  text-align: center;"Your session has expired. Please login again.\x3c/div\x3e',
afterWelcomePageLoad()))};b.open("POST","/newauth/api/authenticate/reenter",!1);b.withCredentials=!0;b.setRequestHeader("Content-Type","application/json");b.send(JSON.stringify({userflake:loggedinuserflake,screenwidth:window.screen.availWidth,screenheight:window.screen.availHeight,winwidth:a.style.width,winheight:a.style.height,reenter:!0}))}else clearTimeout(lotimer),debugappui&&console.log("setting reenter_auth timer"),lotimer=setTimeout(reenter_auth,delay)}
function trackinactivityTime(a,b){attachactivitylisteners();interactduration=b;delay=a;allowedlapses=36E5/interactduration}String.prototype.startsWith||(String.prototype.startsWith=function(a,b){b=b||0;return this.indexOf(a,b)===b});function fadeOut(a){a.style.opacity=1;(function c(){0>(a.style.opacity-=.1)?a.style.display="none":requestAnimationFrame(c)})()}
function restoreheaderandfooter(){null!=document.getElementById("app-header").getAttribute("data-display")&&(document.getElementById("app-header").style.display=document.getElementById("app-header").getAttribute("data-display"),document.getElementById("app-header").style.height=document.getElementById("app-header").getAttribute("data-height"),document.getElementById("app-footer").style.display=document.getElementById("app-footer").getAttribute("data-display"),document.getElementById("app-footer").style.height=
document.getElementById("app-footer").getAttribute("data-height"),document.getElementById("app").style.height=document.getElementById("app").getAttribute("data-height"),document.getElementById("app").style.overflowY=document.getElementById("app").getAttribute("data-overflow"),document.getElementById("app").style.paddingTop=document.getElementById("app").getAttribute("data-paddingtop"),document.getElementById("app").style.paddingBottom=document.getElementById("app").getAttribute("data-paddingBottom"))}
function removeheaderandfooter(){document.getElementById("app-header").setAttribute("data-display",document.getElementById("app-header").style.display);document.getElementById("app-header").style.display="none";document.getElementById("app-header").setAttribute("data-height",document.getElementById("app-header").style.height);document.getElementById("app-header").style.height="0";document.getElementById("app-footer").setAttribute("data-display",document.getElementById("app-footer").style.display);
document.getElementById("app-footer").style.display="none";document.getElementById("app-footer").setAttribute("data-height",document.getElementById("app-footer").style.height);document.getElementById("app-footer").style.height="0";document.getElementById("app").setAttribute("data-height",document.getElementById("app").style.height);document.getElementById("app").style.height="100%";document.getElementById("app").setAttribute("data-overflow",document.getElementById("app").style.overflowY);document.getElementById("app").style.overflowY=
"hidden";document.getElementById("app").setAttribute("data-paddingtop",document.getElementById("app").style.paddingTop);document.getElementById("app").style.paddingTop="0";document.getElementById("app").setAttribute("data-paddingbottom",document.getElementById("app").style.paddingBottom);document.getElementById("app").style.paddingBottom="0"}function removealldots(){var a=document.getElementsByClassName("circle");if(null!=a)for(var b=0;b<a.length;b++)a[b].style.display="none"}
function submitFormAjax(a,b){var c=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");c.onreadystatechange=function(){4==c.readyState&&2==Math.trunc(c.status/100)&&("/newauth/authenticate"==a&&(null!=document.getElementById("app-header")&&(removeheaderandfooter(),removealldots()),document.getElementById("app").innerHTML=c.responseText,null!=document.getElementById("auth-image-main-container-id")&&(document.getElementById("auth-image-main-container-id").style.top="0"),
fadeinelement("app"),document.querySelector(".auth-image-main-container")?afterauthscreenload(!1):document.getElementById("setup-page-id")?(loadUrlAjax("/newauth/header?page\x3dsetupUser\x26pendSetup\x3dtrue","app-header"),afteranyscreenload()):document.getElementById("app-flk")?(loadUrlAjax("/newauth/header?page\x3dflake-page","app-header"),afteranyscreenload(),null!=document.getElementById("flake-page-id")&&(document.getElementById("flake-page-id").style.top="65px")):document.getElementById("create-page-id")?
(loadUrlAjax("/newauth/header?page\x3dcreateuser","app-header"),loadPageScripts("app"),afterCreateUserPageLoad(),removealldots()):afteranyscreenload()),"/newauth/postAuthClickData"==a&&(null!=document.getElementById("re-auth-overlay")?"FAIL"==c.getResponseHeader("AUTH_RESULT")?(document.getElementById("re-auth-overlay").innerHTML=c.responseText,afterauthscreenload(!0)):clearoverlay("re-auth-overlay"):(document.getElementById("app").innerHTML=c.responseText,document.querySelector(".auth-image-main-container")?
("FAIL"==c.getResponseHeader("AUTH_RESULT")?(hideloadingicon(),showAuthFailureDialog(),settimeoutid=setTimeout(function(){clearAuthFailureDialog()},1E3)):hideloadingicon(),afterauthscreenload(!1)):(document.getElementById("home-page-id")?(restoreheaderandfooter(),loadUrlAjax("/newauth/header?page\x3dhome","app-header")):document.getElementById("secure-page-id")?(restoreheaderandfooter(),loadUrlAjax("/newauth/header?page\x3dsecurePage","app-header")):document.getElementById("app-flk")&&(loadUrlAjax("/newauth/header?page\x3dflake-page",
"app-header"),null!=document.getElementById("flake-page-id")&&(document.getElementById("flake-page-id").style.top="65px")),afteranyscreenload()))),"/createUser"==a&&(document.getElementById("app").innerHTML=c.responseText,afteranyscreenload(),document.getElementById("setuppasswordcollapse")&&(loadUrlAjax("/newauth/header?page\x3dsetupUser\x26pendSetup\x3dtrue","app-header"),afterusersetupscreenload())),"/singleUpload"==a&&(document.getElementById("img-files-upload-btn").classList.add("active"),null!=
document.getElementById("adminImages")&&(document.getElementById("adminImages").innerHTML=c.responseText),null!=document.getElementById("initimageuploadresult")&&(document.getElementById("initimageuploadresult").innerHTML=c.responseText)))};c.open("POST",a,!0);updatescreenandwindowdims();b=new FormData(b&&0<b.length?document.forms[b]:document.forms[0]);c.withCredentials=!0;debugappui&&console.log("Posting form data");c.send(b)}
function showAuthFailureDialog(){hideAuthImage();var a=document.getElementById("app-notify-dialog");if(null==a){a=document.createElement("div");a.setAttribute("id","app-notify-dialog");document.body.appendChild(a);var b=document.createElement("div");b.classList.add("container");b.classList.add("v-center");var c=document.createElement("div");c.classList.add("row");var e=document.createElement("div");e.classList.add("col-md-8");e.classList.add("col-md-offset-2");var d=document.createElement("div");
d.classList.add("panel");d.classList.add("panel-default");var f=document.createElement("h3");f.appendChild(document.createTextNode("Could not authenticate"));f.style.color="#737373";f.style.fontWeight=600>window.innerWidth?"140":"400";d.appendChild(f);f=document.createElement("p");f.classList.add("lead");f.setAttribute("id","createuser-flake-text-header");f.appendChild(document.createTextNode("Please try again."));f.style.color="#737373";f.style.fontWeight=600>window.innerWidth?"60":"150";d.appendChild(f);
e.appendChild(d);c.appendChild(e);b.appendChild(c);a.appendChild(b)}settimeoutid=setTimeout(function(){$("#app-notify-dialog").fadeIn("fast")},100)}
function showAppTimeoutDialog(){null!=appcalltimeoutid&&clearTimeout(appcalltimeoutid);appcalltimeoutid=null;var a=document.getElementById("app-timeout-notify-dialog");if(null==a){a=document.createElement("div");a.setAttribute("id","app-timeout-notify-dialog");document.body.appendChild(a);var b=document.createElement("div");b.classList.add("container");b.classList.add("v-center");var c=document.createElement("div");c.classList.add("row");var e=document.createElement("div");e.classList.add("col-md-8");
e.classList.add("col-md-offset-2");var d=document.createElement("span");d.innerHTML="\x26times;";d.style.float="right";d.style.padding="2px 7px";d.style.fontSize="3em";d.style.top="0px";d.style.display="inline-block";d.style.color="#a2a2a2";d.style.cursor="default";d.addEventListener("mouseover",function(a){a.target.style.color="#d3d3d3"});d.addEventListener("mouseout",function(a){a.target.style.color="#a2a2a2"});d.addEventListener("click",function(){$("#createuser-flake-overlay").fadeOut(500);removediv(document.getElementById("app-timeout-notify-dialog"));
hideloadingicon()});e.appendChild(d);d=document.createElement("div");d.classList.add("panel");d.classList.add("panel-default");var f=document.createElement("h3");f.appendChild(document.createTextNode("Request did not complete in time"));f.style.color="#737373";f.style.fontWeight="150";d.appendChild(f);f=document.createElement("p");f.classList.add("lead");f.setAttribute("id","createuser-flake-text-header");f.appendChild(document.createTextNode("Please try again."));f.style.color="#737373";f.style.fontWeight=
"50";d.appendChild(f);f=document.createElement("input");f.setAttribute("id","cde-send-button");f.classList.add("btn");f.classList.add("btn-primary");f.classList.add("btn-sm");f.type="button";f.value="Try Again";f.addEventListener("click",function(){$("#app-timeout-notify-dialog").hide();removediv(a);loadWelcome()},!1);d.appendChild(f);d.appendChild(document.createElement("p"));e.appendChild(d);c.appendChild(e);b.appendChild(c);a.appendChild(b)}settimeoutid=setTimeout(function(){$("#app-timeout-notify-dialog").fadeIn("fast")},
100)}
function showImageLoadErrorDialog(){null!=appcalltimeoutid&&(console.log("clearing  appcalltimeoutid in showImageLoadErrorDialog "+appcalltimeoutid),clearTimeout(appcalltimeoutid));appcalltimeoutid=null;var a=document.getElementById("app-timeout-notify-dialog");if(null==a){a=document.createElement("div");a.setAttribute("id","app-timeout-notify-dialog");document.body.appendChild(a);var b=document.createElement("div");b.classList.add("container");b.classList.add("v-center");var c=document.createElement("div");c.classList.add("row");
var e=document.createElement("div");e.classList.add("col-md-8");e.classList.add("col-md-offset-2");var d=document.createElement("span");d.innerHTML="\x26times;";d.style.float="right";d.style.padding="2px 7px";d.style.fontSize="3em";d.style.top="0px";d.style.display="inline-block";d.style.color="#a2a2a2";d.style.cursor="default";d.addEventListener("mouseover",function(a){a.target.style.color="#d3d3d3"});d.addEventListener("mouseout",function(a){a.target.style.color="#a2a2a2"});d.addEventListener("click",
function(){$("#createuser-flake-overlay").fadeOut(500);removediv(document.getElementById("app-timeout-notify-dialog"))});e.appendChild(d);d=document.createElement("div");d.classList.add("panel");d.classList.add("panel-default");var f=document.createElement("h3");f.appendChild(document.createTextNode("Temporary error loading image"));f.style.color="#737373";f.style.fontWeight="150";d.appendChild(f);f=document.createElement("p");f.classList.add("lead");f.setAttribute("id","createuser-flake-text-header");
f.appendChild(document.createTextNode("Please try again."));f.style.color="#737373";f.style.fontWeight="50";d.appendChild(f);f=document.createElement("input");f.setAttribute("id","cde-send-button");f.classList.add("btn");f.classList.add("btn-primary");f.classList.add("btn-sm");f.type="button";f.value="Try Again";f.addEventListener("click",function(){$("#app-timeout-notify-dialog").hide();removediv(a);loadWelcome()},!1);d.appendChild(f);d.appendChild(document.createElement("p"));e.appendChild(d);c.appendChild(e);
b.appendChild(c);a.appendChild(b)}settimeoutid=setTimeout(function(){$("#app-timeout-notify-dialog").fadeIn("fast")},100)}function clearAuthFailureDialog(){showAuthImage();$("#app-notify-dialog").fadeOut("fast");clearTimeout(settimeoutid);removediv(document.getElementById("app-notify-dialog"))}function clearoverlay(a){document.getElementById(a).style.display="none";a=document.getElementById(a);removediv(a)}
function removediv(a){if(null!=a){for(;a.hasChildNodes();)a.removeChild(a.firstChild);null!=a.parentNode&&a.parentNode.removeChild(a)}}function cleardiv(a){if(null!=a)for(;a.hasChildNodes();)a.removeChild(a.firstChild)}
function loadUrlAjax(a,b){var c=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");c.onreadystatechange=function(){if(4==c.readyState&&2==Math.trunc(c.status/100)){document.getElementById(b).innerHTML="";document.getElementById(b).innerHTML=c.responseText;fadeinelement(b);"/newauth/welcome"==a&&(loadUrlAjax("/newauth/header","app-header"),afterWelcomePageLoad());a.startsWith("/newauth/orgPage")&&afteranyscreenload();"/newauth/home"==a&&(loadUrlAjax("/newauth/header?page\x3dhome",
"app-header"),afteranyscreenload(),stopSSEPolling());a.startsWith("/createUser")&&(loadUrlAjax("/newauth/header?page\x3dcreateuser","app-header"),loadPageScripts("app"),afterCreateUserPageLoad(),removealldots());a.startsWith("/newauth/authenticate")&&(null!=document.getElementById("app-header")&&(removeheaderandfooter(),removealldots()),document.querySelector(".auth-image-main-container")?(loadUrlAjax("/newauth/header?page\x3dauthenticate\x26authMessage\x3dIf%20you%20do%20not%20recognize%20the%20images,%20check%20the%20username%20you%20entered.",
"app-header"),afterauthscreenload(!1)):document.getElementById("setuppasswordcollapse")?(loadUrlAjax("/newauth/header?page\x3dsetupUser\x26pendSetup\x3dtrue","app-header"),afterusersetupscreenload()):document.getElementById("home-page-id")?(loadUrlAjax("/newauth/header?page\x3dhome","app-header"),document.getElementById("app-header").style.display="block",afteranyscreenload()):document.getElementById("secure-page-id")?(loadUrlAjax("/newauth/header?page\x3dsecurePage","app-header"),afteranyscreenload()):
document.getElementById("topic-page-id")?(loadUrlAjax("/newauth/header?page\x3dbrandPage","topic-app-header"),afteranyscreenload()):document.getElementById("app-flk")?(loadUrlAjax("/newauth/header?page\x3dflake-page","app-header"),null!=document.getElementById("flake-page-id")&&(document.getElementById("flake-page-id").style.top="65px"),afteranyscreenload()):(loadUrlAjax("/newauth/header?page\x3dpublicPage","app-header"),afterPublicPageScreenLoad()));a.startsWith("/newauth/postAuthColClickData")&&
(document.querySelector(".auth-image-main-container")&&(loadUrlAjax("/newauth/header?page\x3dauthenticate","app-header"),afterauthscreenload(!1)),document.getElementById("setuppasswordcollapse")&&(loadUrlAjax("/newauth/header?page\x3dsetupUser\x26pendSetup\x3dtrue","app-header"),afterusersetupscreenload()));"/newauth/setupUser"==a&&(loadUrlAjax("/newauth/header?page\x3dsetupUser","app-header"),afterusersetupscreenload());if(a.startsWith("/newauth/setimgpwd/")){var e=a.split("/"),d="";6<e.length&&
(d="/"+e[3]+"/"+e[4]+"/"+e[5]+"/"+e[6]+"/"+e[7]);loadUrlAjax("/newauth/imgpwdheader"+d,"app-header");afterBoxImageScreenLoad()}a.startsWith("/newauth/securePage")&&(loadUrlAjax("/newauth/header?page\x3dsecurePage","app-header"),afterSecurePageScreenLoad());a.startsWith("/newauth/publicPage")&&(loadUrlAjax("/newauth/header?page\x3dpublicPage","app-header"),afterPublicPageScreenLoad());if(a.startsWith("/newauth/header")){generateFlakeOnCanvas("hdr-flake-display-btn",flakejsonobj,60,40,"tiny",!1);var f=
document.getElementById("hdr-flake-display-btn");"undefined"!==typeof f&&null!==f&&("undefined"!=typeof flakejsonobj&&f.setAttribute("title",flakejsonobj.flake),f.addEventListener("click",function(a){var b=document.createElement("input");document.body.appendChild(b);b.setAttribute("value",loggedinuserflake);b.select();document.execCommand("copy");document.body.removeChild(b);displaybuttonbehavior(a,"Flake copied");displayflakeinmodal(f.innerHTML)},!1))}}};c.open("GET",a,!0);c.send();return!1}
function displaybuttonbehavior(a,b){var c=document.getElementById("identity-display");var e=null!=c?c.cloneNode(!0):document.createElement("div");e.setAttribute("id","buttonbehavior");e.style.position="absolute";null!=a?(e.style.top=a.target.getBoundingClientRect().top,e.style.left=a.target.getBoundingClientRect().left):(e.style.bottom=10,e.style.right=50);e.style.opacity="0.4";e.style.fontSize="14";e.style.backgroundColor="#fefefe";e.style.boxShadow="2px 3px 2px #ededed";e.style.color="#636363";
e.style.zIndex=9999;e.innerText=b;e.style.display="block";setTimeout(function(a){e.style.opacity="0.4";setTimeout(function(){removediv(e)},300)},2E3);document.body.appendChild(e);e.style.opacity=window.getComputedStyle(e).getPropertyValue("opacity");attachtransitionstyles(e);e.style.opacity="0.9";return e}
function displaypageloadingdiv(a){var b=0,c=0;a&&(c=getPositionOfanElement(a),b=c.x,c=c.y,0==b&&(b=40),0==c&&(c=40));a=document.getElementById("loading-box");if(null==a){a=document.createElement("div");a.setAttribute("id","loading-box");a.classList.add("text-center");var e=document.createElement("div");e.classList.add("text");e.classList.add("animated");e.classList.add("infinite");e.classList.add("pulse");e.appendChild(document.createTextNode("Loading"));a.appendChild(e);a.style.display="block";a.style.left=
b+"px";a.style.top=c+"px";document.body.appendChild(a)}}function removepageloadingdiv(){var a=document.getElementById("loading-box");null!=a&&removediv(a)}function afterWelcomePageLoad(){loadPageScripts("app");document.title="Newauth Welcome";stopSSEPolling()}
function afterauthscreenload(a){imagecounter=0;0==a?loadPageScripts("app"):loadPageScripts("re-auth-overlay");authimagecontainerdivelem=document.querySelector(".auth-image-main-container");authimagecontainerdivelem.style.display="table-cell";authimagecontainerdivelem.style.verticalAlign="middle";authimagecontainerdivelem.style.textAlign="center";imgs=document.querySelectorAll("img");if(null!=imgs&&0<imgs.length){for(a=0;a<imgs.length;a++)imgs[a].addEventListener("error",function(){showImageLoadErrorDialog()},
!1);for(a=0;a<imgs.length;a++)imgs[a].addEventListener("load",function(){collageimagesloaded++;collageimagesloaded==imgs.length&&(null!=appcalltimeoutid&&clearTimeout(appcalltimeoutid),appcalltimeoutid=null,removepageloadingdiv(),8<imgs.length?displayFirstImage():displayfirstimageoncanvas())},!1)}}
function afteranyscreenload(){null!=appcalltimeoutid&&clearTimeout(appcalltimeoutid);appcalltimeoutid=null;removepageloadingdiv();loadPageScripts("app");document.body.removeEventListener("click",topicdocumentclick)}function afterBoxImageScreenLoad(){restartTimer();afteranyscreenload()}function afterSecurePageScreenLoad(){afteranyscreenload();stopSSEPolling()}function afterPublicPageScreenLoad(){afteranyscreenload();document.title="Newauth - Live";publicpagelinkclicked=!1}
function loadPageScripts(a){a=document.getElementById(a).getElementsByTagName("script");for(var b=0;b<a.length;b++)eval(a[b].innerHTML)}function afterusersetupscreenload(){afteranyscreenload();stopSSEPolling()}function analyzeauthimage(a){var b=document.createElement("img");b.addEventListener("load",function(){displayauthimageanalyzer(b,a)});b.src="/image/"+a;document.getElementById("app").appendChild(b)}
function displayremoteuseronpage(a){var b=document.createElement("div");b.classList.add("circle-remote");var c=a.gridlocation.split(",")[0],e=a.gridlocation.split(",")[1];if(2<c.length){var d=c.length-2;c=parseInt(c)/Math.pow(10,d);c=parseInt(window.innerWidth*c/100)}2<e.length&&(d=e.length-2,e=parseInt(e)/Math.pow(10,d),d=document.getElementById("app").clientHeight,e=parseInt(d*e/100)+50);b.style.position="absolute";b.style.left=c+"px";b.style.top=e+"px";b.style.backgroundColor=a.color;b.style.zIndex=
"70";d=3*a.giveOut.length;var f=document.createElement("div");f.setAttribute("id",a.flake+"-circle-info");f.style.position="absolute";f.style.left=c-parseInt(d)+"px";f.style.height="20px";f.style.top=e+10+"px";f.style.opacity="0.6";f.style.color="#eaeaea";f.style.zIndex="80";f.style.display="none";f.appendChild(document.createTextNode(a.giveOut+"["+a.flake.substring(0,4)+"...]"));b.addEventListener("mouseover",function(){fadeinviajquery(a.flake+"-circle-info","fast")});b.addEventListener("mouseout",
function(){fadeoutviajquery(a.flake+"-circle-info","fast")});b.addEventListener("click",function(){showflakepageinapp(a.flake)});document.getElementById("app").appendChild(b);document.getElementById("app").appendChild(f);fadeinviajquery(a.flake+"-circle-info","fast");setTimeout(function(){fadeoutviajquery(a.flake+"-circle-info","slow")},2E3)}function fadeinviajquery(a,b){b=b||"fast";document.getElementById(a).display="block";$("#"+a).fadeIn(b)}
function fadeoutviajquery(a,b){b=b||"slow";$("#"+a).fadeOut(b)}function fadeincircleinfo(a,b){a=a.getElementsByClassName("circle-info")[0].id;document.getElementById(a).style.display="block"}function fadeoutcircleinfo(a,b){a=a.getElementsByClassName("circle-info")[0].id;document.getElementById(a).style.display="none"}
function displayauthimageanalyzer(a,b){var c=document.createElement("div");c.classList.add("modal");c.setAttribute("id","createuser-flake-overlay");c.style.backgroundColor="#ffffff";var e=document.createElement("span");e.innerHTML="\x26times;";e.style.float="right";e.style.padding="2px 7px";e.style.fontSize="3em";e.style.top="0px";e.style.display="inline-block";e.style.color="#a2a2a2";e.style.cursor="default";e.addEventListener("mouseover",function(a){a.target.style.color="#d3d3d3"});e.addEventListener("mouseout",
function(a){a.target.style.color="#a2a2a2"});e.addEventListener("click",function(){$("#createuser-flake-overlay").fadeOut(500);removediv(document.getElementById("createuser-flake-overlay"))});c.appendChild(e);e=document.createElement("div");var d=document.createElement("div"),f=document.createElement("div");f.classList.add("panel");f.style.margin="0 auto";var g=document.createElement("div");g.setAttribute("id","imganalyzercanvasdiv");var k=getnewimagesize(a);g.style.maxHeight="inherit";g.style.maxWidth=
"inherit";var h=document.createElement("canvas");k=getnewimagesize(a);h.width=k.width;h.height=k.height;g.addEventListener("click",function(c){analyzeauthimageclick(b,a,h,k,c)},!1);h.getContext("2d").drawImage(a,0,0,h.width,h.height);g.appendChild(h);f.appendChild(g);g=document.createElement("div");g.classList.add("panel");var m=document.createElement("p");m.setAttribute("id","authimganalysisclick");g.appendChild(m);m=document.createElement("p");m.setAttribute("id","authimganalysisoutput");m.classList.add("lead");
var l=document.createElement("INPUT");l.setAttribute("type","checkbox");l.setAttribute("id","plot-click-map-check");g.appendChild(l);g.appendChild(document.createTextNode(" Plot click spatter"));g.appendChild(document.createElement("br"));g.appendChild(m);d.appendChild(f);d.appendChild(g);e.appendChild(d);c.appendChild(e);document.getElementById("app").appendChild(c);$("#createuser-flake-overlay").show()}
function analyzeauthimageclick(a,b,c,e,d){e=getMousePos2(c,d);x=e.x;y=e.y;e=parseInt(Math.sqrt(100)/2);d=0;getandplotclickdatafromdb(x,y,a,c,!0,b);if(1==document.getElementById("plot-click-map-check").checked)for(b=0;b<e;b++)for(var f=0;f<e;f++){var g=x-10*b,k=x+10*b,h=y-10*f,m=y+10*f;0<=g&&g<=c.width&&0<=h&&h<=c.height&&getandplotclickdatafromdb(g,h,a,c);if(0!=b||0!=f)0<=k&&k<=c.width&&0<=m&&m<=c.height&&getandplotclickdatafromdb(k,m,a,c),0!=b&&0!=f&&(0<=g&&g<=c.width&&0<=m&&m<=c.height&&getandplotclickdatafromdb(g,
m,a,c),0<=k&&k<=c.width&&0<=h&&h<=c.height&&getandplotclickdatafromdb(k,h,a,c),d++)}}
function getandplotclickdatafromdb(a,b,c,e,d,f){c=JSON.stringify({imgID:c,delay:0,clickX:parseInt(a),clickY:parseInt(b),imgWidth:e.width,imgHeight:e.height});"undefined"!=typeof d&&1==d&&(document.getElementById("authimganalysisclick").innerText=parseInt(a)+","+parseInt(b));var g=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");g.open("POST","/newauth/api/analyzeauthimageclick",!1);g.setRequestHeader("Content-Type","application/json");g.onreadystatechange=function(){if(4==
g.readyState&&200==g.status){var c=g.responseText.split(" ")[0];drawcircleoverimage(e,a,b,4,c);if("undefined"!=typeof d&&1==d){c=g.responseText;document.getElementById("authimganalysisoutput").innerHTML="";document.getElementById("authimganalysisoutput").appendChild(document.createTextNode(c.split(" ")[0]+" "));document.getElementById("authimganalysisoutput").appendChild(document.createTextNode(c.split(" ")[1]+" "));document.getElementById("authimganalysisoutput").appendChild(document.createTextNode(c.split(" ")[2]+
" "));document.getElementById("authimganalysisoutput").appendChild(document.createTextNode(c.split(" ")[3]+" "));for(var h=c.split(" ")[4],m=c.split(" ")[7],l=0;l<h.length;l++){var n=document.createElement("a");n.addEventListener("mouseover",displayhashportiononimage.bind(this,f,e,h,l));n.appendChild(document.createTextNode(h.charAt(l)));document.getElementById("authimganalysisoutput").appendChild(n)}document.getElementById("authimganalysisoutput").appendChild(document.createTextNode(" "+c.split(" ")[5]+
" "));document.getElementById("authimganalysisoutput").appendChild(document.createTextNode(c.split(" ")[6]+" "));for(l=0;l<m.length;l++)n=document.createElement("a"),n.addEventListener("mouseover",displayhashportiononimage.bind(this,f,e,m,l)),n.appendChild(document.createTextNode(m.charAt(l))),document.getElementById("authimganalysisoutput").appendChild(n)}}};0<=parseInt(a)&&0<=parseInt(b)&&parseInt(a)<=e.width&&parseInt(b)<=e.height?g.send(c):document.getElementById("authimganalysisoutput").innerText=
""}function displayhashportiononimage(a,b,c,e){c+="";for(var d=b.width/Math.pow(2,e+1),f=b.height/Math.pow(2,e+1),g=0,k=0,h=0;h<=e;h++){if(2==c.charAt(parseInt(h))||4==c.charAt(parseInt(h)))g+=b.width/Math.pow(2,h+1);if(3==c.charAt(parseInt(h))||4==c.charAt(parseInt(h)))k+=b.height/Math.pow(2,h+1)}drawrectangleoverimage(a,b,parseInt(g),parseInt(k),parseInt(d),parseInt(f));return!1}
function displayflakeinmodal(a){var b=document.getElementById("flake-display-modal");if(null==b){b=document.createElement("div");b.classList.add("modal");b.classList.add("fade");b.setAttribute("id","flake-display-modal");var c=document.createElement("div");c.classList.add("modal-dialog");c.classList.add("modal-md");var e=document.createElement("div");e.classList.add("modal-content");var d=document.createElement("div");d.classList.add("panel");d.classList.add("text-center");var f=document.createElement("p");
f.style.color="#121212";f.classList.add("lead");f.appendChild(document.createTextNode(fullname));d.appendChild(f);var g=document.createElement("IMG");g.src="/static/icons/new-page.png";g.width="24";g.title="Display flake page";g.onclick=function(){showflakepageinapp(flakejsonobj.flake)};g.onmouseenter=function(){g.style.border="2px solid gray"};g.onmouseout=function(){g.style.border="none"};d=document.createElement("div");d.classList.add("panel");d.classList.add("text-center");d.setAttribute("id",
"flake-modal-flake-text-container");f=document.createElement("p");f.style.color="#626262";f.style.maxWidth="50%";f.style.textAlign="center";f.style.margin="0 auto";f.style.border="1px solid darkgrey";f.appendChild(document.createTextNode(loggedinuserflake));f.setAttribute("id","flake-select-text");f.addEventListener("click",flakeclickhandler);d.appendChild(f);e.appendChild(d);f=document.createElement("div");f.classList.add("panel");f.classList.add("text-center");d=document.createElement("div");d.setAttribute("id",
"flakecanvasdivmodal");f.appendChild(d);e.appendChild(f);c.appendChild(e);b.appendChild(c);document.getElementById("app").appendChild(b);null!=flakejsonobj?generateFlakeOnCanvas("flakecanvasdivmodal",flakejsonobj,300,300,"medium","false"):null!=a&&generateFlakeOnCanvas("flakecanvasdivmodal",a,300,300,"medium","false")}$("#flake-display-modal").modal("show")}
function flakeclickhandler(a){if(40<a.target.textContent.length)document.getElementById("flakecanvasdivmodal").innerHTML="",generateFlakeOnCanvas("flakecanvasdivmodal",flakejsonobj,300,300,"medium",!1);else{var b=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");b.onreadystatechange=function(){if(4==b.readyState&&200==b.status)if(null!=b.responseText&&0<b.responseText.length){flakejsonobj.fullflake=b.responseText;if(1==document.getElementById("flake-modal-flake-text-container").children.length){var a=
document.createElement("p");a.style.color="#626262";a.style.maxWidth="60%";a.style.textAlign="center";a.style.margin="0 auto";a.style.border="1px solid darkgrey";a.appendChild(document.createTextNode(flakejsonobj.fullflake));a.setAttribute("id","full-flake-select-text");a.addEventListener("click",flakeclickhandler);document.getElementById("flake-modal-flake-text-container").appendChild(document.createElement("br"));document.getElementById("flake-modal-flake-text-container").appendChild(a)}document.getElementById("flakecanvasdivmodal").innerHTML=
"";flakegeneratorintid=setInterval(function(){null!=flakejsonobj.fullflake&&genericcounter<flakejsonobj.fullflake.length-15?(document.getElementById("flakecanvasdivmodal").innerHTML="",flakejsonobj.flake=flakejsonobj.fullflake.substring(0,16+genericcounter),generateBottomPartOfFlakeOnCanvas("flakecanvasdivmodal",flakejsonobj,300,300,"medium",!1),genericcounter++):(genericcounter=0,null!=flakejsonobj.fullflake&&(flakejsonobj.flake=flakejsonobj.fullflake.substring(0,16)),clearInterval(flakegeneratorintid))},
1/(1+genericcounter)*75)}else console.log("No full flake returned by server")};b.open("POST","/newauth/api/fullflakeforuser",!1);b.withCredentials=!0;b.setRequestHeader("Content-Type","application/json");var c=JSON.stringify({flake:loggedinuserflake});b.send(c)}document.selection?(c=document.body.createTextRange(),c.moveToElementText(a.target),c.select(),a.target.style.backgroundColor="#cecece"):window.getSelection&&(c=document.createRange(),c.selectNodeContents(a.target),window.getSelection().removeAllRanges(),
window.getSelection().addRange(c),a.target.style.backgroundColor="#cecece");try{var e=document.execCommand("copy")?"successful":"unsuccessful";debugappui&&console.log("Copying text command was "+e);window.getSelection?window.getSelection().removeAllRanges():document.selection&&document.selection.empty()}catch(d){debugappui&&console.log("Oops, unable to copy")}"full-flake-select-text"==a.target.id&&(document.getElementById("flake-select-text").style.backgroundColor="#ffffff");"flake-select-text"==
a.target.id&&null!=document.getElementById("full-flake-select-text")&&(document.getElementById("full-flake-select-text").style.backgroundColor="#ffffff")}function loadCreateUserPage(a){removehighlights();fadeoutelement("app");"undefined"!=typeof a?loadUrlAjax("/createUser?ref\x3d"+a,"app"):loadUrlAjax("/createUser","app");document.title="Newauth - Create User";return!1}
function fadeoutelement(a){document.getElementById(a).classList.toggle("show-na",!1);document.getElementById(a).classList.toggle("hide-na",!0);displayloadingicon()}function fadeinelement(a){null!=document.getElementById(a)&&("none"==document.getElementById(a).style.display&&(document.getElementById(a).style.display="block"),document.getElementById(a).classList.toggle("hide-na",!1),document.getElementById(a).classList.toggle("show-na",!0))}
function announceapptimeouterror(){showAppTimeoutDialog()}function displayloadingicon(){var a=document.getElementById("displayloadingcontainer");null!=a&&(a.style.display="inline-block",a.style.opacity="1",null==appcalltimeoutid&&(appcalltimeoutid=setTimeout(announceapptimeouterror,apptimeoutduration)),console.log("setting  appcalltimeoutid in displayloadingicon "+appcalltimeoutid))}
function hideloadingicon(){var a=document.getElementById("displayloadingcontainer");null!=a&&(a.style.display="none",fadeinelement("app"),null!=appcalltimeoutid&&(console.log("clearing  appcalltimeoutid in hideloadingicon "+appcalltimeoutid),clearTimeout(appcalltimeoutid)),appcalltimeoutid=null)}function loaddisabledcreatemessage(a){mobileusercreate(a);return!1}
function fadeIn(a,b){a.style.opacity=0;a.style.display=b||"block";(function e(){var b=parseFloat(a.style.opacity);1<(b+=.1)||(a.style.opacity=b,requestAnimationFrame(e))})()}var waitForFinalResizeEvent=function(){var a={};return function(b,c,e){e||(e="Don't call this twice without a uniqueId");a[e]&&clearTimeout(a[e]);a[e]=setTimeout(b,c)}}();
function authenticate(a,b){removehighlights();fadeoutelement("app");loadUrlAjax("/newauth/authenticate/"+a+"/"+window.screen.availWidth+"/"+window.screen.availHeight+"/"+window.innerWidth+"/"+window.innerHeight,"app");return!1}
function showwelcomepage(){fadeoutelement("app");removeactivitylisteners();for(var a=document.getElementById("re-auth-overlay");a.hasChildNodes();)a.removeChild(a.firstChild);a.style.display="none";loadUrlAjax("/newauth/welcome","app");document.title="Newauth Home";return!1}function setupUser(a){fadeoutelement("app");loadUrlAjax("/newauth/setupUser","app");document.title="Newauth - Setup User";return!1}
function showPrivateDataPage(a){document.getElementById("securePage").classList.contains("disabled")||(fadeoutelement("app"),loadUrlAjax("/newauth/securePage","app"),fadeinelement("app"),document.title="Newauth - Vault");return!1}function showOrgPage(a,b){fadeoutelement("app");loadOrgPage(a,b);document.title="Newauth - Org";return!1}
function showPublicPage(a){document.getElementById("publicPage").classList.contains("disabled")||(fadeoutelement("app"),loadUrlAjax("/newauth/publicPage","app"),document.title="Newauth - Live");return!1}function showBrandPage(a,b){document.getElementById("brandPage").classList.contains("disabled")||(fadeoutelement("app"),showurloverapp("/t/"+b),document.title=b+" At Newauth");return!1}
function logOut(){fadeoutelement("app");var a=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");a.onreadystatechange=function(){4==a.readyState&&200==a.status&&loadWelcome()};a.open("POST","/newauth/logout",!0);a.withCredentials=!0;a.setRequestHeader("Content-Type","application/json");var b=JSON.stringify({flake:loggedinuserflake});a.send(b);return!1}
function burnFlake(){var a=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");removeInfoFromClipboard();a.onreadystatechange=function(){4==a.readyState&&200==a.status&&loadWelcome()};a.open("POST","/newauth/burnflake",!1);a.withCredentials=!0;a.setRequestHeader("Content-Type","application/json");var b=JSON.stringify({flake:loggedinuserflake});a.send(b);return!1}
function removeInfoFromClipboard(){var a=document.createElement("input");document.body.appendChild(a);a.setAttribute("value","NOPASSWORDSHERE");a.select();document.execCommand("copy");document.body.removeChild(a);console.log("Cleared data from Clipboard")}function copytexttocbandhighlight(a,b,c){var e=document.createElement("input");document.body.appendChild(e);e.setAttribute("value",a);e.select();document.execCommand("copy");document.body.removeChild(e);displaybuttonbehavior(c,b)}
function loadHome(){document.getElementById("home").classList.contains("disabled")||(fadeoutelement("app"),loadUrlAjax("/newauth/home","app"),document.title="Newauth - Home");return!1}function loadWelcome(){fadeoutelement("app");window.location.assign("/");document.title="Newauth";return!1}
function convertusernametohash(){var a=document.forms[0].username.value,b=hashUserForAuthentication(a);vaultkey=a;null!=document.forms[0].elements.namedItem("usernameclear")&&(document.forms[0].usernameclear.value=a);document.forms[0].username.value=b}
function submitcreatewithuserhash(){if((null==document.getElementById("usernameprovided").value||0==document.getElementById("usernameprovided").value.length)&&!confirm('Please confirm the username  "'+document.getElementById("usernameinput").value+'"  . Newauth Username is supposed to be only known to you. Newauth does not store it in clear.  If you need to make a note of your username, do so now. Click OK to continue.'))return!1;console.log("updating screen dims");updatescreenandwindowdims();document.getElementById("createuserbtn").disabled=
!0;document.title="Newauth - Create User";submitFormAjax("/createUser","create-user-form");return!1}function populateUserKeyPair(){var a=sjcl.ecc.elGamal.generateKeys(384),b=a.pub.get();a=a.sec.get();publickeyb64=b=sjcl.codec.base64.fromBits(b.x.concat(b.y));document.forms["create-user-form"].publicKey.value=publickeyb64;privatekeyb64=a=sjcl.codec.base64.fromBits(a);document.forms[0]&&document.forms[0].publicKey&&(document.forms[0].publicKey.value=b,document.forms[0].encprivatekey.value="")}
function getEncMessageUsingPublickey(a,b){b=new sjcl.ecc.elGamal.publicKey(sjcl.ecc.curves.c384,sjcl.codec.base64.toBits(b));return sjcl.encrypt(b,a)}function getDecMessageUsingPrivateKey(a,b,c){b=sjcl.decrypt(c,b);b=new sjcl.ecc.elGamal.secretKey(sjcl.ecc.curves.c384,sjcl.ecc.curves.c384.field.fromBits(sjcl.codec.base64.toBits(b)));return sjcl.decrypt(b,a)}function loadExtUrl(a,b,c){a.startsWith("http")||(a="http://"+a);var e=window.open(a,"_blank");e.onload=function(){e.focus()}}
function submitwithuserhash(){clearInterval(imgcheckinterval);if(6>document.forms[0].username.value.length){var a=document.getElementById("username");a.placeholder="Enter Username (min 6 letters)";a.style.border="2px solid red";setTimeout(function(){a.placeholder="User name";a.style.border="1px solid #aeaeae"},3E3);return!1}a=document.getElementById("login-button");null!=a&&(a.style.transform="scale(1.3)",a.style.opacity=1);fadeoutelement("app");convertusernametohash();document.title="Newauth - Authenticate";
submitFormAjax("/newauth/authenticate");return!1}function removehighlights(){for(var a=document.getElementsByClassName("highlight-text"),b=0;b<a.length;b++)a[b].style.display="none"}
function afterCreateUserPageLoad(){null!=appcalltimeoutid&&clearTimeout(appcalltimeoutid);appcalltimeoutid=null;$('input[name\x3d"usertypeinputradio"]').change(function(){$(this).is(":checked")&&1==$(this).val()&&$("#brandModal").modal("show")});document.getElementById("na-item-amount").innerText="$"+computeSubPrice(1);document.getElementById("bus-subs-user-count-input").addEventListener("input",function(){if(0==document.getElementById("bus-subs-user-count-input").value.length)document.getElementById("bus-user-count").innerText=
1,document.getElementById("bus-sub-chg-amt").innerText=computeSubPrice(1);else try{var a=parseInt(document.getElementById("bus-subs-user-count-input").value);document.getElementById("bus-user-count").innerText=a;document.getElementById("bus-sub-chg-amt").innerText=computeSubPrice(a)}catch(b){document.getElementById("bus-subs-user-count-input").style.border="2px solid red",setTimeout(function(){document.getElementById("bus-subs-user-count-input").style.border="2px solid gray"},3E3)}});document.getElementById("bus-vault-chk").addEventListener("change",
function(){document.getElementById("bus-vault-chk").checked="true";return!1});document.getElementById("app-topic-page-chk").addEventListener("change",function(){if(0==document.getElementById("bus-subs-user-count-input").value.length)document.getElementById("bus-user-count").innerText=1,document.getElementById("bus-sub-chg-amt").innerText=computeSubPrice(1);else{var a=parseInt(document.getElementById("bus-subs-user-count-input").value);document.getElementById("bus-user-count").innerText=a;document.getElementById("bus-sub-chg-amt").innerText=
computeSubPrice(a)}});document.getElementById("bus-newauth-identity-chk").addEventListener("change",function(){if(0==document.getElementById("bus-subs-user-count-input").value.length)document.getElementById("bus-user-count").innerText=1,document.getElementById("bus-sub-chg-amt").innerText=computeSubPrice(1);else{var a=parseInt(document.getElementById("bus-subs-user-count-input").value);document.getElementById("bus-user-count").innerText=a;document.getElementById("bus-sub-chg-amt").innerText=computeSubPrice(a)}});
document.getElementById("bus-newauth-pers-img-chk").addEventListener("change",function(){if(0==document.getElementById("bus-subs-user-count-input").value.length)document.getElementById("bus-user-count").innerText=1,document.getElementById("bus-sub-chg-amt").innerText=computeSubPrice(1);else{var a=parseInt(document.getElementById("bus-subs-user-count-input").value);document.getElementById("bus-user-count").innerText=a;document.getElementById("bus-sub-chg-amt").innerText=computeSubPrice(a)}});document.getElementById("bus-newauth-brand-img-chk").addEventListener("change",
function(){if(0==document.getElementById("bus-subs-user-count-input").value.length)document.getElementById("bus-user-count").innerText=1,document.getElementById("bus-sub-chg-amt").innerText=computeSubPrice(1);else{var a=parseInt(document.getElementById("bus-subs-user-count-input").value);document.getElementById("bus-user-count").innerText=a;document.getElementById("bus-sub-chg-amt").innerText=computeSubPrice(a)}});document.getElementById("bus-newauth-export-data-chk").addEventListener("change",function(){if(0==
document.getElementById("bus-subs-user-count-input").value.length)document.getElementById("bus-user-count").innerText=1,document.getElementById("bus-sub-chg-amt").innerText=computeSubPrice(1);else{var a=parseInt(document.getElementById("bus-subs-user-count-input").value);document.getElementById("bus-user-count").innerText=a;document.getElementById("bus-sub-chg-amt").innerText=computeSubPrice(a)}})}
function computeSubPrice(a){var b=document.getElementById("bus-newauth-identity-chk").checked,c=document.getElementById("app-topic-page-chk").checked,e=document.getElementById("bus-newauth-pers-img-chk").checked,d=document.getElementById("bus-newauth-brand-img-chk").checked,f=document.getElementById("bus-newauth-export-data-chk").checked,g=0,k=0,h=0,m=0,l=0;b&&(g=100+36*a);e&&(h=20*a);c&&(k=10*a);d&&(m=1E3);f&&(l=100);console.log("apptopic "+c+"naidentity "+b+" napersimage "+e+" nabrandimage "+d+
" nadataexport "+f);a=parseInt(79*a+k+g+h+m+l);document.getElementById("na-item-amount").innerText="$"+a;return a}
function createUserFlakeOverlay(a){var b=document.getElementById("createuser-flake-overlay");if(null==b){b=document.createElement("div");b.setAttribute("id","createuser-flake-overlay");document.body.appendChild(b);var c=document.createElement("div");c.classList.add("container");c.classList.add("v-center");var e=document.createElement("div");e.classList.add("row");var d=document.createElement("div");d.classList.add("col-md-8");d.classList.add("col-md-offset-2");var f=document.createElement("div");
f.classList.add("panel");f.classList.add("panel-default");f.setAttribute("id","createuser-overlay-content");var g=document.createElement("h3");g.appendChild(document.createTextNode(""));g.style.color="#737373";g.style.fontWeight="900";f.appendChild(g);g=document.createElement("span");g.innerHTML="\x26times;";g.style.float="right";g.style.padding="2px 7px";g.style.fontSize="3em";g.style.top="0px";g.style.display="inline-block";g.style.color="#a2a2a2";g.style.cursor="default";g.addEventListener("mouseover",
function(a){a.target.style.color="#d3d3d3"});g.addEventListener("mouseout",function(a){a.target.style.color="#a2a2a2"});g.addEventListener("click",function(){$("#createuser-flake-overlay").fadeOut(500);removediv(document.getElementById("createuser-flake-overlay"));loadWelcome()});d.appendChild(g);g=document.createElement("p");g.classList.add("lead");g.setAttribute("id","createuser-flake-text-header");g.appendChild(document.createTextNode("Please enter the Flake you received in your invitation."));
g.style.color="#737373";g.style.fontWeight="700";f.appendChild(g);g=document.createElement("div");g.classList.add("row");var k=document.createElement("div");k.classList.add("col-sm-8");k.classList.add("col-sm-offset-2");var h=document.createElement("p");h.classList.add("text-muted");h.setAttribute("id","createuser-flake-text");h.appendChild(document.createTextNode("Currently, Newauth membership is by invitation only. Your invitation contains a token called flake. Please enter it below. A flake can also be found on the Welcome page after the web extension install."));
h.style.color="#878787";h.style.fontWeight="600";var m=document.createElement("p");m.classList.add("text-muted");m.setAttribute("id","createuser-flake-text");m.appendChild(document.createTextNode("If you do not have a flake, please enter your email address to be added to the wait list."));m.style.color="#878787";m.style.fontWeight="500";k.appendChild(h);0<a.length&&"true"==a&&k.appendChild(m);g.appendChild(k);f.appendChild(g);a=document.createElement("div");a.classList.add("row");a.classList.add("text-center");
g=document.createElement("div");g.setAttribute("id","cu-flake-can");a.appendChild(g);f.appendChild(a);a=document.createElement("div");a.classList.add("panel-body");a.classList.add("panel-word-wrap");g=document.createElement("div");g.classList.add("row");k=document.createElement("div");k.classList.add("col-sm-8");k.classList.add("col-sm-offset-2");k.setAttribute("id","create-flk-input-holder");g.appendChild(k);a.appendChild(g);h=document.createElement("input");h.setAttribute("type","text");h.setAttribute("id",
"cu-flake-input");h.setAttribute("autofocus","true");h.classList.add("form-control");h.classList.add("input-md");h.addEventListener("input",function(){var a=document.getElementById("cu-flake-can");cleardiv(a);a=document.getElementById("cu-flake-input").value;generateFlakeOnCanvas("cu-flake-can",a,64,64,"tiny");8==a.length||16==a.length||17==a.length?$("#flk-send-button").fadeIn("slow"):document.getElementById("flk-send-button").style.display="none";0<a.indexOf("@")&&(document.getElementById("flk-send-button").value=
"Get Invite",document.getElementById("cu-flake-can").style.display="none",$("#flk-send-button").fadeIn("slow"))},!1);h.style.color="#646464";m=document.createElement("input");m.setAttribute("id","flk-send-button");m.classList.add("btn");m.classList.add("btn-primary");m.classList.add("btn-md");m.conversationID="";m.changestarttime="";m.type="button";m.value="Validate";m.style.display="none";m.addEventListener("click",validatecreateuserflake,!1);var l=document.createElement("div");l.classList.add("col-sm-2");
g.appendChild(l);k.appendChild(h);l.appendChild(m);a.appendChild(g);f.appendChild(a);d.appendChild(f);e.appendChild(d);c.appendChild(e);b.appendChild(c);generateFlakeOnCanvas("cu-flake-can",null,64,64,"tiny");$("#cu-flake-input").focus()}settimeoutid=setTimeout(function(){$("#createuser-flake-overlay").fadeIn("slow")},500)}
function validatecreateuserflake(){document.getElementById("cu-flake-input").style.borderColor="default";var a=document.getElementById("cu-flake-input").value;if(null==a||0==a.length)return!1;var b=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");b.onreadystatechange=function(){if(4==b.readyState&&200==b.status){var c=JSON.parse(b.responseText);if("VALID"==c.status.statuscode)document.forms["create-user-form"].refflake.value=document.getElementById("cu-flake-input").value,
$("#createuser-flake-overlay").fadeOut(500),removediv(document.getElementById("createuser-flake-overlay"));else if("EMAIL-SENT"==c.status.statuscode){c=document.getElementById("createuser-overlay-content");cleardiv(c);var d=document.createElement("h4");d.appendChild(document.createTextNode("An invite has been sent to "+a+". Please check and follow the instructions there."));d.style.color="#737373";d.style.fontWeight="200";c.appendChild(d);d=document.createElement("h5");d.appendChild(document.createTextNode("If you do not find an email from Newauth in your Inbox, please check your Spam folder."));
d.style.color="#929292";d.style.fontWeight="120";c.appendChild(d)}else document.getElementById("cu-flake-input").style.borderWidth="2px",document.getElementById("cu-flake-input").style.borderColor="red"}};b.open("POST","/newauth/api/validateFlake",!1);b.withCredentials=!0;b.setRequestHeader("Content-Type","application/json");var c=JSON.stringify({flake:a});b.send(c)}
function hashUserForAuthentication(a){var b=sjcl.codec.base64.toBits("sugar"),c=sjcl.misc.pbkdf2(a,b,1E3,256);c=sjcl.codec.base64.fromBits(c);sjcl.codec.base64.fromBits(b);debugappui&&console.log(a+" "+c);return c}function displayImage(a){location.href="/newauth/display/image/"+a+"/"+window.screen.availWidth+"/"+window.screen.availHeight+"/"+window.innerWidth+"/"+window.innerHeight;return!1}
function displayImageStat(a,b){var c=document.getElementById("img-stat-overlay");console.log("in displayImageStat overlay is null  -- id seq"+a+" "+b);c=document.createElement("div");c.setAttribute("id","img-stat-overlay");document.getElementById("app").appendChild(c);a=document.createElement("div");a.classList.add("container");var e=document.createElement("div");e.classList.add("row");var d=document.createElement("div");d.classList.add("col-md-6");d.classList.add("col-md-offset-3");var f=document.createElement("span");
f.innerHTML="\x26times;";f.style.float="right";f.style.padding="2px 7px";f.style.fontSize="3em";f.style.top="0px";f.style.display="inline-block";f.style.color="#a2a2a2";f.style.cursor="default";f.addEventListener("mouseover",function(a){a.target.style.color="#d3d3d3"});f.addEventListener("mouseout",function(a){a.target.style.color="#a2a2a2"});f.addEventListener("click",function(){$("#img-stat-overlay").fadeOut(500);removediv(document.getElementById("img-stat-overlay"))});d.appendChild(f);f=document.createElement("div");
f.classList.add("panel");f.classList.add("panel-default");var g=document.createElement("p");g.classList.add("lead");g.setAttribute("id","createuser-flake-text-header");g.appendChild(document.createTextNode("Image "+b));g.style.color="#737373";g.style.fontWeight="50";f.appendChild(g);g=document.createElement("p");g.classList.add("lead");g.setAttribute("id","image-user-count");g.appendChild(document.createTextNode("---"));g.style.color="#737373";g.style.fontWeight="60";f.appendChild(g);g=document.createElement("p");
g.setAttribute("id","image-sizes");g.appendChild(document.createTextNode("---"));g.style.color="#737373";g.style.fontWeight="60";f.appendChild(g);g=document.createElement("div");g.classList.add("row");var k=document.createElement("div");k.classList.add("col-md-12");g.appendChild(k);var h=document.createElement("div");k.appendChild(h);f.appendChild(g);h.innerHTML='\x3cform method\x3d"POST" enctype\x3d"multipart/form-data" name\x3d"admimagesoverwriteform" class\x3d"form-horizontal"\x3e\t\t\t\t\t           \x3cdiv class\x3d"form-group"\x3e\t\t\t           \t\t\x3cdiv class\x3d"col-md-12"\x3e\t\t\t\t\t            \x3cdiv class\x3d"input-group"\x3e\t\t\t\t\t                \x3clabel class\x3d"input-group-btn"\x3e\t\t\t\t\t                    \x3cspan class\x3d"btn btn-primary"\x3e\t\t\t\t\t                        Browse\x26hellip; \x3cinput type\x3d"file" name\x3d"files" id\x3d"files-input-overwrite" accept\x3d"image/*" style\x3d"display: none;"\x3e\t\t\t\t\t                    \x3c/span\x3e\t\t\t\t\t                \x3c/label\x3e\t\t\t\t\t                \x3cinput type\x3d"text" class\x3d"form-control" id\x3d"file-select-feedback-overwrite" readonly\x3e\t\t\t\t\t            \x3c/div\x3e\t\t\t\t            \x3c/div\x3e\t\t\t            \x3c/div\x3e\t\t\t            \x3cdiv class\x3d"form-group"\x3e\t                        \x3cdiv class\x3d"has-error"\x3e\t                            \x3cform:errors path\x3d"url" class\x3d"help-inline"/\x3e\t                        \x3c/div\x3e\t\t\t\t\t   \x3c/div\x3e\t\t\t           \x3cdiv class\x3d"row"\x3e\t\t\t            \t\x3cdiv class\x3d"col-md-12"\x3e\t\t\t\t                \x3cdiv class\x3d"floatRight"\x3e\t\t\t\t                    \x3cinput type\x3d"submit" value\x3d"Change"   class\x3d"btn btn-primary btn-sm" disabled id\x3d"img-files-upload-btn-overwrite"\x3e\t\t\t\t                \x3c/div\x3e\t\t\t                \x3c/div\x3e\t\t\t            \x3c/div\x3e\t\t\t        \x3c/form\x3e';
d.appendChild(f);e.appendChild(d);a.appendChild(e);c.appendChild(a);document.getElementById("files-input-overwrite").addEventListener("change",function(a){document.getElementById("img-files-upload-btn-overwrite").disabled=!1},!1);document.getElementById("img-files-upload-btn-overwrite").onclick=function(){return overloadimage("admimagesoverwriteform",b)};loadimageusercount(b,"image-user-count");loadimagesizes(b,"image-sizes");setTimeout(function(){$("#img-stat-overlay").fadeIn("slow")},200);return!1}
function loadimageusercount(a,b){var c=new XMLHttpRequest;c.open("GET","/newauth/api/getimageuserscount/"+a,!1);c.setRequestHeader("Content-Type","application/json");c.onreadystatechange=function(){if(4==c.readyState&&200==c.status){var a=c.responseText;document.getElementById(b).innerHTML=a+" users"}};c.send(null)}
function loadimagesizes(a,b){var c=new XMLHttpRequest;c.open("GET","/newauth/api/getimagesizes/"+a,!1);c.setRequestHeader("Content-Type","application/json");c.onreadystatechange=function(){if(4==c.readyState&&200==c.status){var a=c.responseText;document.getElementById(b).innerHTML=a}};c.send(null)}
function selectSegmentOnImage(a){a="/newauth/setimgpwd/"+window.screen.availWidth+"/"+window.screen.availHeight+"/"+window.innerWidth+"/"+document.getElementById("app").clientHeight+"/"+a;document.title="Newauth - Box Images";loadUrlAjax(a,"app");return!1}
function boxNextImage(a){clearAllBoxImageCanvas();a="/newauth/setimgpwd/"+window.screen.availWidth+"/"+window.screen.availHeight+"/"+window.innerWidth+"/"+document.getElementById("app").clientHeight+"/"+a;document.title="Newauth - Box Images";loadUrlAjax(a,"app");return!1}function debounce(a,b,c){var e;console.log("in debounce");return function(){var d=this,f=arguments,g=c&&!e;clearTimeout(e);e=setTimeout(function(){e=null;c||a.apply(d,f)},b);g&&a.apply(d,f)}}var stompClient=null;
function setConnected(a){$("#connect").prop("disabled",a);$("#disconnect").prop("disabled",!a);a?$("#conversation").show():$("#conversation").hide();$("#greetings").html("")}
function checkUserName(){debugappui&&console.log("In checkUserName");document.getElementById("usernamedisplay").innerHTML="";document.getElementById("privkey").innerHTML="";document.getElementById("privkeycheck").style.display="none";var a=document.getElementById("usernameinput").value;if(6>a.length)return document.getElementsByClassName("has-error")[0].innerHTML="The username  has to be atleast 6 characters long.",document.getElementById("usernameinput").focus(),setTimeout(clearUserNameErrorDiv,
4E3),$("#usernamecollapse").on("hidden.bs.collapse",allowusernamedivtocollapse),$("#usernamecollapse").on("shown.bs.collapse",allowusernamedivtocollapse),!1;var b=new XMLHttpRequest;b.open("POST","/newauth/api/oktocreateusername",!1);b.setRequestHeader("Content-Type","application/json");b.onreadystatechange=function(){if(4==b.readyState&&200==b.status){var a=b.responseText;null!=a&&0<a.length&&handleUsernamecheck(a)}};b.send(JSON.stringify({username:hashUserForAuthentication(a),clientip:""}))}
function allowusernamedivtocollapse(){username=document.getElementById("usernameinput").value;6>username.length&&$("#usernamecollapse").collapse("show");6<username.length&&(debugappui&&console.log("in condition \x3e 6"),$("#usernamecollapse").collapse("hide"),$("#usernamecollapse").off("shown.bs.collapse",allowusernamedivtocollapse),$("#usernamecollapse").off("hidden.bs.collapse",allowusernamedivtocollapse))}
function closePrivacySettingsBeforeSetup(){6>document.getElementById("numboxed").value?$("#privacysettingcollapse").collapse("hide"):(debugappui&&console.log("in condition \x3e 6"),$("#privacysettingcollapse").collapse("show"),$("#privacysettingcollapse").off("shown.bs.collapse",closePrivacySettingsBeforeSetup),$("#privacysettingcollapse").off("hidden.bs.collapse",closePrivacySettingsBeforeSetup))}function clearUserNameErrorDiv(){document.getElementsByClassName("has-error")[0].innerHTML=""}
function clearAliasErrorDiv(){document.getElementsByClassName("has-error")[1].innerHTML=""}function clearErrorDiv(a){document.getElementById(a).innerHTML=""}
function handleusertypedone(a){document.getElementById("usertypecheck").style.display="inline";a=document.getElementsByName("usertypeinputradio");for(var b,c=0;c<a.length;c++)"radio"==a[c].type&&a[c].checked&&(b=a[c].value);document.forms["create-user-form"].type.value=b;if("1"==b){b=document.getElementById("brandsignedup").value;console.log("signedup "+b);if("0"==b)return alert("Please Complete Subscription or Select Personal Account"),a[0].checked="checked",!1;document.getElementById("brandnamefielddisclosure").classList.remove("hidden");
a=document.getElementsByName("giveoutinputradio");a[0].disabled=!0;a[1].checked="checked";a[2].disabled=!0}document.getElementById("giveoutdiv").style.visibility="visible"}function showtopicsetupmodal(){$("#topic-setup-modal").modal("show")}
function processTopicSettingsChange(a){var b=!1;var c=document.getElementById("commentsettingsselect").value;var e=document.getElementById("storagesettingsselect").value;var d=document.getElementById("postsettingsselect").value;document.getElementById("topicprivatecheckbox").checked&&(b=!0);var f=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");f.onreadystatechange=function(){4==f.readyState&&200==f.status&&$("#topic-setup-modal").modal("hide")};f.open("POST","/newauth/api/updatetopicsetting",
!1);f.withCredentials=!0;f.setRequestHeader("Content-Type","application/json");a=JSON.stringify({topic:a,comments:c,posts:d,storage:e,maxdepth:document.getElementById("topicmaxdepthinput").value,topicprivate:b});f.send(a)}
function processFlakeSettingsChange(a){for(var b,c=!1,e=document.getElementsByName("flakemessageinputradio"),d=0;d<e.length;d++)"radio"==e[d].type&&e[d].checked&&(b=e[d].value);"quiet"==b&&(c=!0);b=document.getElementById("chatgroupsize").value;e=document.getElementById("flakelife").value;"Until compromised"==e&&(e=-1);var f=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");f.onreadystatechange=function(){4==f.readyState&&200==f.status&&$("#flake-setup-modal").modal("hide")};
f.open("POST","/newauth/api/updateflakesetting",!1);f.withCredentials=!0;f.setRequestHeader("Content-Type","application/json");a=JSON.stringify({flake:a,chatgroupsize:b,flakelife:e,qiet:c});f.send(a)}
function handlegiveoutdone(){document.getElementById("giveoutcheck").style.display="inline";for(var a=document.getElementsByName("giveoutinputradio"),b,c=0;c<a.length;c++)"radio"==a[c].type&&a[c].checked&&(b=a[c].value);document.forms["create-user-form"].giveOut.value=b;null==document.getElementById("usernameprovided").value||0==document.getElementById("usernameprovided").value.length?showusernamecaveatscreen():(document.getElementById("createuserbtn").value="Update newauth Account",document.getElementById("msgbeforesubmit").innerText=
"You are nearly done",document.getElementById("usernameinput").style.display="none",document.getElementById("usernamediv").style.visibility="visible",null!=document.getElementById("usernamepaneltitle")&&(document.getElementById("usernamepaneltitle").innerText+=" - selected"),document.forms["create-user-form"].username.value=document.getElementById("usernameprovided").value,document.getElementById("usernamedisplay").innerHTML="\x3cp\x3eYou have already selected a username. It is the same one you typed in the username box earlier.\x3c/p\x3e\x3cp\x3eNewauth stores your username as: \x3c/p\x3e\x3cp\x3e"+
document.getElementById("usernameprovided").value+"\x3c/p\x3e",populateUserKeyPair(),document.getElementById("usernamecheck").style.display="inline",document.getElementById("checkusernamebutton").style.display="none",$("#usernamecollapse").collapse("show"),$("#usernamecollapse").off("shown.bs.collapse",allowusernamedivtocollapse),$("#usernamecollapse").off("hidden.bs.collapse",allowusernamedivtocollapse),setTimeout(function(){$("#usernamecollapse").collapse("hide");document.getElementById("other-identification").style.visibility=
"visible"},4E3))}
function showusernamecaveatscreen(){var a=document.getElementById("createuser-flake-overlay");if(null==a){a=document.createElement("div");a.setAttribute("id","createuser-flake-overlay");document.body.appendChild(a);var b=document.createElement("div");b.classList.add("container");b.classList.add("v-center");var c=document.createElement("div");c.classList.add("row");var e=document.createElement("div");e.classList.add("col-md-8");e.classList.add("col-md-offset-2");var d=document.createElement("div");d.classList.add("panel");
d.classList.add("panel-default");d.setAttribute("id","createuser-overlay-content");var f=document.createElement("h3");f.appendChild(document.createTextNode(""));f.style.color="#737373";f.style.fontWeight="900";d.appendChild(f);f=document.createElement("span");f.innerHTML="\x26times;";f.style.float="right";f.style.padding="2px 7px";f.style.fontSize="3em";f.style.top="0px";f.style.display="inline-block";f.style.color="#a2a2a2";f.style.cursor="default";f.addEventListener("mouseover",function(a){a.target.style.color=
"#d3d3d3"});f.addEventListener("mouseout",function(a){a.target.style.color="#a2a2a2"});f.addEventListener("click",function(){$("#createuser-flake-overlay").fadeOut(500);removediv(document.getElementById("createuser-flake-overlay"))});e.appendChild(f);f=document.createElement("p");f.classList.add("lead");f.setAttribute("id","createuser-flake-text-header");f.appendChild(document.createTextNode("Important: Your username in Newauth is secret."));f.style.color="#737373";f.style.fontWeight="700";d.appendChild(f);
f=document.createElement("div");f.classList.add("row");var g=document.createElement("div");g.classList.add("col-sm-8");g.classList.add("col-sm-offset-2");var k=document.createElement("p");k.classList.add("text-muted");k.setAttribute("id","createuser-flake-text");k.appendChild(document.createTextNode("Treat this username as you would treat a password in another system. Do NOT use one of your common usernames here."));k.style.color="#878787";k.style.fontWeight="600";var h=document.createElement("p");
h.classList.add("text-muted");h.setAttribute("id","createuser-flake-text");h.appendChild(document.createTextNode("You will use this username to access Newauth. It is also used as a key to your vault. You can change your vault key later. If you choose your username carefully here, you can avoid having to remember two secrets."));h.style.color="#878787";h.style.fontWeight="500";g.appendChild(k);g.appendChild(h);f.appendChild(g);d.appendChild(f);f=document.createElement("div");f.classList.add("row");
f.classList.add("text-center");g=document.createElement("div");g.setAttribute("id","cu-flake-can");f.appendChild(g);d.appendChild(f);f=document.createElement("div");f.classList.add("panel-body");f.classList.add("panel-word-wrap");g=document.createElement("div");g.classList.add("row");k=document.createElement("div");k.classList.add("col-sm-8");k.classList.add("col-sm-offset-2");k.setAttribute("id","create-flk-input-holder");g.appendChild(k);f.appendChild(g);k=document.createElement("input");k.setAttribute("id",
"flk-send-button");k.classList.add("btn");k.classList.add("btn-primary");k.classList.add("btn-md");k.conversationID="";k.changestarttime="";k.type="button";k.value="Got it";k.style.display="block";k.addEventListener("click",function(){$("#createuser-flake-overlay").fadeOut(500);removediv(document.getElementById("createuser-flake-overlay"));document.getElementById("usernamediv").style.visibility="visible"},!1);h=document.createElement("div");h.classList.add("col-sm-2");g.appendChild(h);h.appendChild(k);
f.appendChild(g);d.appendChild(f);e.appendChild(d);c.appendChild(e);b.appendChild(c);a.appendChild(b)}settimeoutid=setTimeout(function(){$("#createuser-flake-overlay").fadeIn("slow")},500)}
function handleUsernamecheck(a){if("DONOTCREATE"==a)return document.getElementById("create-username-has-error").innerHTML="The username  "+document.getElementById("usernameinput").value+"  is already taken. Please select another username.",document.getElementById("usernameinput").value="",document.getElementById("usernameinput").focus(),$("#usernamecollapse").on("hidden.bs.collapse",allowusernamedivtocollapse),$("#usernamecollapse").on("shown.bs.collapse",allowusernamedivtocollapse),setTimeout("clearUserNameErrorDiv()",
4E3),!1;populateUserKeyPair();document.getElementById("pubkey").innerHTML=publickeyb64;a=document.getElementById("usernameinput").value;encprivkey=encryptdatawithstretchedkey(privatekeyb64,a,"",0);document.getElementById("privkey").innerHTML="Original Value: "+privatekeyb64+"\x3cbr\x3e\x3cbr\x3eEncrypted Value: "+JSON.parse(encprivkey).ct;document.getElementById("privkeycheck").style.display="inline";document.forms["create-user-form"].encprivatekey.value=encprivkey;a=hashUserForAuthentication(document.getElementById("usernameinput").value);
document.forms["create-user-form"].username.value=a;document.getElementById("usernamedisplay").innerHTML="Newauth stores this as: \x3cp\x3e"+a+"\x3c/p\x3e";document.getElementById("usernamecheck").style.display="inline";document.getElementById("other-identification").style.visibility="visible"}
function handleOtherIdInput(){var a=otherIDErrorMessage();if(0<a.length)return document.getElementById("other-id-has-error").innerHTML=a,setTimeout(function(){clearErrorDiv("other-id-has-error")},4E3),$("#otheridcollapse").on("hidden.bs.collapse",allowotheriddivtocollapse),$("#otheridcollapse").on("shown.bs.collapse",allowotheriddivtocollapse),!1;document.forms["create-user-form"].firstname.value=document.getElementById("firstnameinput").value;document.forms["create-user-form"].lastname.value=document.getElementById("lastnameinput").value;
a=document.forms["create-user-form"].type.value;var b=document.getElementById("aliasinput").value;checkAlias(b,a);return!0}
function checkAlias(a,b){debugappui&&console.log("In checkAlias");if(0==a.length&&"1"==b)return document.getElementsByClassName("has-error")[1].innerHTML="Alias can not be empty for a brand user",document.getElementById("aliasinput").focus(),setTimeout(clearAliasErrorDiv,4E3),$("#otheridcollapse").on("hidden.bs.collapse",allowotheriddivtocollapse),$("#otheridcollapse").on("shown.bs.collapse",allowotheriddivtocollapse),!1;if(0==a.length)return!0;var c=new XMLHttpRequest;c.open("POST","/newauth/api/oktocreatealias",
!1);c.setRequestHeader("Content-Type","application/json");c.onreadystatechange=function(){if(4==c.readyState&&200==c.status){var a=c.responseText;null!=a&&0<a.length&&handleAliascheck(a)}};c.send(JSON.stringify({alias:a}))}
function handleAliascheck(a){if("DONOTCREATE"==a)return document.getElementById("other-id-has-error").innerHTML="The alias  "+document.getElementById("aliasinput").value+"  is already taken. Please enter another alias.",document.getElementById("aliasinput").value="",document.getElementById("aliasinput").focus(),$("#otheridcollapse").on("hidden.bs.collapse",allowotheriddivtocollapse),$("#otheridcollapse").on("shown.bs.collapse",allowotheriddivtocollapse),setTimeout("clearAliasErrorDiv()",4E3),!1;document.forms["create-user-form"].alias.value=
document.getElementById("aliasinput").value;document.getElementById("otheridcheck").style.display="inline";document.getElementById("contact-info-div").style.visibility="visible"}
function handleContactInfoInput(){var a=contactInfoErrorMessage();if(0<a.length)return document.getElementById("contact-info-has-error").innerHTML=a,setTimeout(function(){clearErrorDiv("contact-info-has-error")},4E3),$("#contactcollapse").on("hidden.bs.collapse",allowotheriddivtocollapse),$("#contactcollapse").on("shown.bs.collapse",allowotheriddivtocollapse),!1;document.getElementById("contactcheck").style.display="inline";document.getElementById("password-notice-div").style.visibility="visible";
return!0}function contactInfoErrorMessage(){return""}function parseJsonWithFallback(a){try{return JSON.parse(a)}catch(b){a=a.replace(/\\"/g,'"');try{return JSON.parse(a)}catch(c){return console.error("Error parsing JSON:",c),null}}}
function otherIDErrorMessage(){var a=document.forms["create-user-form"].type.value,b=document.getElementById("usernameinput").value,c=document.getElementById("firstnameinput").value,e=document.getElementById("lastnameinput").value,d=document.getElementById("aliasinput").value;return 0==d.length&&1==a?"Alias needs to contain the Brand name that you want to reserve as a brand user.":0==c.length&&0==e.length&&0==d.length?"Please enter at least one of firstname, lastname and Screen name":0<b.length&&
(c==b||e==b||d==b)?"Username can not be same as firstname, lastname or alias":""}function allowotheriddivtocollapse(){0<otherIDErrorMessage().length?$("#otheridcollapse").collapse("show"):($("#otheridcollapse").collapse("hide"),$("#otheridcollapse").off("shown.bs.collapse",allowotheriddivtocollapse),$("#otheridcollapse").off("hidden.bs.collapse",allowotheriddivtocollapse))}function encryptdatausingpassword(a,b){var c=sjcl.random.randomWords(1,7);return sjcl.encrypt(b,a,{ks:256,salt:c,iter:1E4})}
function encryptdatawithstretchedkey(a,b,c,e){0==c.length&&(c=getrandomsalt(6));0==e&&(e=1E4);sjcl.misc.pbkdf2(b,c,e,256);c=sjcl.codec.hex.toBits(c);return sjcl.encrypt(b,a,{ks:256,salt:sjcl.codec.hex.fromBits(c),iter:e})}function getrandomsalt(a){for(var b="";b.length<a;){var c=sjcl.random.randomWords(1,10)[0];b+=btoa(c)}return b=b.substr(0,a)}var starttime=Date.now();function restartTimer(){starttime=Date.now()}function gettimetoclick(){return Date.now()-starttime}
function animateClick(a){a.classList.add("animated");a.classList.add("flash")}
function avatarclock(){var a=setInterval(function(){var b=(new Date).getTime();b=avatarcountDownDate-b;var c=Math.floor(b/864E5),e=Math.floor(b%864E5/36E5),d=Math.floor(b%36E5/6E4),f=Math.floor(b%6E4/1E3);null!=document.getElementById("avatar-timer-display")?0<c?document.getElementById("avatar-timer-display").innerHTML=c+"d ":0<e?document.getElementById("avatar-timer-display").innerHTML=e+"h ":0<d?document.getElementById("avatar-timer-display").innerHTML=d+"m "+f+"s ":0<f&&(document.getElementById("avatar-timer-display").innerHTML=
f+"s "):clearInterval(a);0>b&&(clearInterval(a),document.getElementById("avatar-timer-display").innerHTML="EXPIRED")},1E3)}function getReadableFileSizeString(a){var b=-1;do a/=1024,b++;while(1024<a);return Math.max(a,.1).toFixed(1)+" kB; MB; GB; TB;PB;EB;ZB;YB".split(";")[b]}function ValidateEmail(a){if(/^\w+([\.-]?\w+)*@\w+([\.-]?\w+)*(\.\w{2,3})+$/.test(a))return!0;document.getElementById("emailinputerror").innerHTML="Please check the email address!";return!1}
function ValidatePhone(a){a=a.replace(/\s/g,"");return isNaN(a)?!1:!0}function stopSSEPolling(){null!=sseeventsource&&(sseeventsource.close(),sseeventsource=null)}function joinconversation(a){null==sseeventsource?establishnewSSEConnection(a):sseeventsource.url.endsWith(a)||(stopSSEPolling(),establishnewSSEConnection(a))}
function establishnewSSEConnection(a){if("undefined"!==typeof EventSource)sseeventsource=new EventSource("/newauth/api/joinConversation/"+a),sseeventsource.addEventListener("message",function(b){var c=0;b=JSON.parse(b.data);b.author!=fullname&&(c=1);"SYSTEM"==b.author&&(c=1E3);if(null!=b.participants&&0<b.participants.length){c=new Date;debugappui&&console.log("Received participants list [ "+b.participants+"] "+c.toTimeString());var d=document.getElementById("conv-header-"+b.conversationID);if(null!=
d){var f=document.createElement("img");f.classList.add("user-icon");for(var g=d.getElementsByClassName("user-icon");0<g.length;)g[0].parentNode.removeChild(g[0]);void 0!==convparticipants[a]&&1==convparticipants[a].length&&(1==b.participants.length&&(f.src="/static/icons/one-user-green-16.png"),0==b.participants.length&&(f.src="/static/icons/one-user-grey-16.png"));void 0!==convparticipants[a]&&1<convparticipants[a].length&&(1<b.participants.length&&(f.src="/static/icons/multiple-users-green-16.png"),
0==b.participants.length&&(f.src="/static/icons/multiple-users-grey-16.png"));d.appendChild(f)}}else{null==b.message&&"true"==b.typing&&(debugappui&&console.log("Received typing event"),d=document.getElementById("conv-header-"+b.conversationID),f=document.createElement("img"),f.classList.add("typing-icon"),f.src="/static/icons/pencil-16.png",d.appendChild(f));if(null==b.message&&"false"==b.typing)for(debugappui&&console.log("Received stopped typing event"),d=document.getElementById("conv-header-"+
b.conversationID),g=d.getElementsByClassName("typing-icon");0<g.length;)g[0].parentNode.removeChild(g[0]);if(null!=b.message)if(debugappui&&console.log("Received message "+b.message),void 0!==convmsgtimemap[b.conversationID])if(-1==convmsgtimemap[b.conversationID].indexOf(b.messagecreatetime)){convmsgtimemap[b.conversationID].push(b.messagecreatetime);d=document.getElementById("conv-header-"+b.conversationID);for(g=d.getElementsByTagName("img");0<g.length;)g[0].parentNode.removeChild(g[0]);d=document.getElementById("conv-data-"+
b.conversationID);addconversationmessagetopanel(d,atob(b.message),c,b.messagecreatetime,b.author)}else debugappui&&console.log("ignoring message. createtime exists at position? "+convmsgtimemap[b.conversationID].indexOf(b.messagecreatetime));else d=[],d.push(b.messagecreatetime),convmsgtimemap[b.conversationID]=d,debugappui&&console.log("Adding message to panel . Created at: "+b.messagecreatetime),d=document.getElementById("conv-data-"+b.conversationID),addconversationmessagetopanel(d,atob(b.message),
c,b.messagecreatetime,b.author)}});else{var b=document.getElementById("conv-data-"+a);addconversationmessagetopanel(b,"This browser does not support server-sent-events. Instant messsaging will not work.",1E3)}}
function loadconversation(a,b,c,e,d){var f=new XMLHttpRequest;f.onreadystatechange=function(){if(4==f.readyState&&200==f.status){var b=JSON.parse(f.responseText);if(0<b.length)for(var c=0;c<b.length;c++){var e=0;b[c].author!=fullname&&(e=1);"SYSTEM"==b[c].author&&(e=1E3);var m=document.getElementById("conv-data-"+b[c].conversationID);addconversationmessagetopanel(m,b[c].message,e,b[c].messagecreatetime,b[c].author,d)}else m=document.getElementById("conv-data-"+a),addconversationmessagetopanel(m,"No messages found.",
null,null,null,d)}};f.open("POST","/newauth/api/getconversation",!1);f.withCredentials=!0;f.setRequestHeader("Content-Type","application/json");b=JSON.stringify({messagecreatetime:b,conversationID:a,topicname:c,postcrtime:e});f.send(b)}
function loadconversationsbyparticipant(a,b,c){var e=new XMLHttpRequest;e.onreadystatechange=function(){if(4==e.readyState&&200==e.status){var a=JSON.parse(e.responseText),b=document.getElementsByClassName("conv-modal-title")[0];if(null!=b){var c=document.createElement("h4");c.appendChild(document.createTextNode("Conversations"));var d=document.createElement("a");d.style.cursor="pointer";d.addEventListener("click",function(){var a=document.createElement("h4");a.appendChild(document.createTextNode("Conversations"));
b.innerHTML="";b.appendChild(a);displayconvosondiv(JSON.parse(document.getElementById("allconv").value),"conv-trans-in-modal")});d.appendChild(document.createTextNode("\x3e All"));b.innerHTML="";b.appendChild(c);b.appendChild(d)}displayconvosondiv(a,"conv-trans-in-modal",!0)}};e.open("POST","/newauth/api/getconversationsbyparticipant",!1);e.withCredentials=!0;e.setRequestHeader("Content-Type","application/json");var d=[];"undefined"!=typeof c&&null!=c&&d.push(c);a=JSON.stringify({messagecreatetime:b,
conversationID:a,participants:d});e.send(a)}
function loadconversationmesagesbyparticipant(a,b,c){var e=new XMLHttpRequest;e.onreadystatechange=function(){if(4==e.readyState&&200==e.status){var b=JSON.parse(e.responseText),c=document.getElementById("conv-data-"+a);c.innerHTML="";if(0<b.length)for(var d=0;d<b.length;d++){var h=0;b[d].author!=fullname&&(h=1);"SYSTEM"==b[d].author&&(h=1E3);document.getElementById("conv-data-"+a).parentNode.classList.remove("hidden");document.getElementById("conv-data-"+a).parentNode.classList.remove("visuallyhidden");
addconversationmessagetopanel(c,b[d].message,h,b[d].messagecreatetime,b[d].author)}else document.getElementById("conv-data-"+a).parentNode.classList.remove("hidden"),document.getElementById("conv-data-"+a).parentNode.classList.remove("visuallyhidden"),addconversationmessagetopanel(c,"NO messages found",27,null,"")}};e.open("POST","/newauth/api/getconversationmessagesbyparticipant",!1);e.withCredentials=!0;e.setRequestHeader("Content-Type","application/json");var d=[];"undefined"!=typeof c&&null!=
c&&d.push(c);b=JSON.stringify({messagecreatetime:b,conversationID:a,participants:d});e.send(b)}
function addconversationmessagetopanel(a,b,c,e,d,f){if(null!=a){var g=document.createElement("div");g.classList.add("row");g.style.border="1px solid #b9b9b9";var k=document.createElement("div");k.classList.add("col-sm-12");var h=document.createElement("div");h.classList.add("col-sm-4");var m=document.createElement("p");m.appendChild(document.createTextNode(d));m.style.color="#747474";d=document.createElement("p");null!=e&&0<e.length&&d.appendChild(document.createTextNode(gettimedifference(e)));d.style.color=
"#747474";e=document.createElement("p");e.appendChild(document.createTextNode(b));e.style.color="#fefefe";0==c&&(e.style.backgroundColor="#00a2a2");1==c&&(e.style.backgroundColor="#a2a2a2");1E3==c&&(e.style.backgroundColor="#a200a2");27==c&&(e.style.backgroundColor="#fb8e8e");b=document.createElement("div");b.classList.add("row");var l=document.createElement("div");l.classList.add("col-sm-6");b.appendChild(l);m.classList.add("pull-left");l.appendChild(m);k.appendChild(l);l=document.createElement("div");
l.classList.add("col-sm-6");d.classList.add("pull-right");l.appendChild(d);b.appendChild(l);b=document.createElement("div");b.classList.add("row");l=document.createElement("div");l.classList.add("col-sm-12");l.appendChild(m);l.appendChild(d);l.appendChild(document.createElement("br"));l.appendChild(e);b.appendChild(l);k.appendChild(b);1==c&&g.appendChild(h);g.appendChild(k);0==c&&g.appendChild(h);c=document.createElement("div");c.classList.add("row");e=document.createElement("div");e.classList.add("col-sm-6");
h=document.createElement("div");h.classList.add("col-sm-6");m=document.createElement("a");m.classList.add("pull-right");m.appendChild(document.createTextNode("Unread"));m.style.border="1px solid #c2c2c2";m.style.color="#878787";m.style.padding="1px";m.style.margin="2px";m.style.cursor="pointer";d=document.createElement("a");d.classList.add("pull-right");d.appendChild(document.createTextNode("Save"));d.style.border="1px solid #c2c2c2";d.style.color="#878787";d.style.padding="1px";d.style.margin="2px";
d.style.cursor="pointer";if("undefined"==typeof f||1==f)h.appendChild(d),h.appendChild(m);c.appendChild(e);c.appendChild(h);f=document.createElement("div");f.classList.add("row");h=document.createElement("div");h.classList.add("col-sm-8");e=document.createElement("p");e.appendChild(document.createTextNode(""));h.appendChild(e);f.appendChild(h);a.appendChild(g);a.appendChild(f);k.appendChild(c);a.scrollTop=a.scrollHeight}}
function createMessagePanel(a){if(null==document.getElementById("conversation-"+a)){var b=document.createElement("div");b.classList.add("panel");b.classList.add("panel-default");b.setAttribute("id","conversation-"+a);var c=document.createElement("div");c.classList.add("panel-heading");var e=document.createElement("h5");e.classList.add("panel-title");e.appendChild(document.createTextNode("Messages"));e.setAttribute("id","conv-header-"+a);c.appendChild(e);b.appendChild(c);c=document.createElement("div");
c.classList.add("panel-body");c.classList.add("panel-word-wrap");c.classList.add("pre-scrollable");c.setAttribute("id","conv-data-"+a);c.style.backgroundColor="#cacaca";b.appendChild(c);document.getElementById("conversations-panel-body").appendChild(b);joinconversation(a);loadconversation(a);c.scrollTop=c.scrollHeight}}
function drawPoint(a,b,c,e,d,f,g,k,h){var m=e/2;b+=.35;var l=e+m*Math.cos(-a*Math.PI/180)*b,n=d+m*Math.sin(-a*Math.PI/180)*b;debugappui&&console.log("drawing point "+a+" "+b+" "+c+" "+e+" "+d);"undefined"!==typeof h&&null!=h&&h.startsWith("#")?(f.fillStyle=h,f.strokeStyle=h,f.globalAlpha=.7):(f.fillStyle="#43464b",f.strokeStyle="silver");180<a&&(f.strokeStyle="#FAA0A0",f.fillStyle="#FAA0A0");"tiny"!=g?("large"==g?(g=3,f.lineWidth=1):g=2,f.moveTo(e+m*Math.cos(-a*Math.PI/180)*.09,d+m*Math.sin(-a*Math.PI/
180)*.09),f.lineTo(l,n),f.stroke(),null!=k&&"true"==k&&(f.font="8px",f.fillText(c,e+m*Math.cos(-a*Math.PI/180)*(b+.08),d+m*Math.sin(-a*Math.PI/180)*(b+.08)))):g=1;f.beginPath();f.arc(l,n,g,0,2*Math.PI);f.fill()}function drawDash(a,b,c,e,d,f,g,k,h){f.fillText("-",e+e/2*Math.cos(-a*Math.PI/180)*(b+.35),d+8)}
function drawborderllines(a){var b=a.getContext("2d");b.strokeStyle="#343434";b.beginPath();b.moveTo(0,a.height/10);b.lineTo(0,0);b.stroke();b.beginPath();b.moveTo(0,0);b.lineTo(a.width/5,0);b.stroke();b.beginPath();b.moveTo(a.width,4*a.height/5);b.lineTo(a.width,a.height);b.stroke();b.beginPath();b.moveTo(a.width,a.height);b.lineTo(9*a.width/10,a.height);b.stroke()}
function generateFlakeOnCanvas(a,b,c,e,d,f,g){a=document.getElementById(a);var k=!1;if(null==a)return!1;c=createHiDPICanvas(c,e);a.appendChild(c);if(null!=b){e="test".constructor;if(b.constructor===e)var h=b;else null!=b.flake&&(h=b.flake);var m=h.length,l=c.width/2,n=c.height/2;"tiny"==d&&(n=5*c.height/8);var p=c.getContext("2d");p.clearRect(0,0,c.width,c.height);if(25>h.length){k=!0;for(var r=h.length,q=0;q<r;q++)h+="z"}for(q=0;16>q;q++){r=1/valmap.length*valmap.indexOf(h.charAt(q));var t=12*q;
180>=t&&drawPoint(t,r,h.charAt(q),l,n,p,d,f,g)}for(q=16;q<h.length;q++)r=1/valmap.length*valmap.indexOf(h.charAt(q)),t=180+180/(m-15)*(q-15),180<t&&k?drawDash(t,r,h.charAt(q),l,n,p,d,f,g):drawPoint(t,r,h.charAt(q),l,n,p,d,f,g);b.constructor!==e&&null!=b.crtime&&(p.fillStyle="black",p.strokeStyle="black","tiny"==d?(b=document.createElement("div"),b.style.position="absolute",b.style.top="2px",b.style.left="10px",b.style.textAlign="center",f=document.createElement("h4"),f.style.color="#599aab",f.appendChild(document.createTextNode(h.substring(0,
4))),b.appendChild(f),a.appendChild(b)):p.fillText(b.crtime,2,c.height-2))}"tiny"!=d&&drawborderllines(c);return c}
function generateBottomPartOfFlakeOnCanvas(a,b,c,e,d,f){var g=document.getElementById(a);if(null==g)return!1;a=createHiDPICanvas(c,e);a.width=c;a.height=e;g.appendChild(a);if(null!=b){c="test".constructor;if(b.constructor===c)return!1;if(null!=b.flake)var k=b.flake;e=b.fullflake.length;g=a.width/2;var h=a.height/2,m=a.getContext("2d");if(17>k.length)for(var l=k.length,n=0;n<l;n++)k+="z";for(n=0;16>n;n++){l=.015625*"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-+".indexOf(k.charAt(n));
var p=12*n;180>=p&&drawPoint(p,l,k.charAt(n),g,h,m,d,f)}for(n=16;n<k.length;n++)l=.015625*"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-+".indexOf(k.charAt(n)),p=180+180/(e-15)*(n-15),drawPoint(p,l,k.charAt(n),g,h,m,d,f);b.constructor!==c&&null!=b.crtime&&("tiny"==d?m.fillText(gettimedifference(b.crtime),2,a.height-2):m.fillText(b.crtime,2,a.height-2))}drawborderllines(a)}
function PIXEL_RATIO(){var a=document.createElement("canvas").getContext("2d");return(window.devicePixelRatio||1)/(a.webkitBackingStorePixelRatio||a.mozBackingStorePixelRatio||a.msBackingStorePixelRatio||a.oBackingStorePixelRatio||a.backingStorePixelRatio||1)}
function createHiDPICanvas(a,b,c){c||(c=PIXEL_RATIO());var e=document.createElement("canvas");e.width=a*c;e.height=b*c;e.style.width=a+"px";e.style.height=b+"px";e.getContext("2d").setTransform(c,0,0,c,0,0);e.getContext("2d").imageSmoothingEnabled=!1;e.getContext("2d").scale(1/c,1/c);return e}function getdatefromdatetime(a){a=Date.parse(a);a=new Date(a);return a.getMonth()+1+"/"+a.getDate()+"/"+a.getFullYear()}
function gettimedifferenceinsec(a){var b=Date.now();a="number"!=typeof a?Date.parse(a):new Date(a);return Math.floor((b-a)/1E3)}function gettimedifference(a,b){var c=Date.now();a="number"!=typeof a?Date.parse(a):new Date(a);return converttimediffmstocalendar(Math.abs(c-a),b)}
function converttimediffmstocalendar(a,b){var c=Math.floor(a/864E5),e=Math.floor(a%864E5/36E5),d=Math.floor(a%864E5%36E5/6E4),f=Math.floor(a%864E5%36E5%6E4/1E3);return 7<c?"undefined"!=typeof b?1==b?Math.floor(c/7)+" w ":a:Math.floor(c/7)+" w ":1<=c?c+" d":1<=e?e+" h":1<=d?d+" m":f+" s"}
function validateDomain(){var a=document.getElementById("domainbrandname").value;if(/^[a-zA-Z0-9][a-zA-Z0-9-]{1,61}[a-zA-Z0-9](?:\.[a-zA-Z]{2,})+$/.test(a)){document.getElementById("domainbrandname").style.borderColor="";for(var b=document.getElementsByName("domainchoiceinputradio"),c,e=0;e<b.length;e++)"radio"==b[e].type&&b[e].checked&&(c=b[e].value);if(0==c){var d=new XMLHttpRequest;d.onreadystatechange=function(){if(4==d.readyState&&200==d.status){createuserdomainverkey=JSON.parse(d.responseText).domainkey;
var b="Please create a TXT record in the DNS entry of domain "+a+" containing this value";b+="\x3cbr\x3e\x3cbr\x3e\x3cb\x3enewauth-domain-verify:"+flakejsonobj.flake+"\x3c/b\x3e\x3cbr\x3e\x3cbr\x3e";b+="Name of the TXT record could be @ or remain blank\x3cbr\x3e\x3cbr\x3eTime to live (TTL) of the TXT record could be 86400 or default\x3cbr\x3e\x3cbr\x3eClick Verify when you have added the TXT record.";document.getElementById("domainveroptions").style.display="none";document.getElementById("adddomainfeedback").innerHTML=
b;document.getElementById("domainverifybtn").value="Verify";document.getElementById("domainbrandname").style.display="none";document.getElementById("domainbrandname").value=a;document.getElementById("domainverifybtn").onclick=validateDomainTxt}else document.getElementById("adddomainfeedback").innerHTML='\x3cfont color\x3d"red"\x3e'+d.responseText+"\x3c/font\x3e"};d.open("POST","/newauth/api/adddomain/TXT/"+a+"/",!1);d.setRequestHeader("Content-Type","application/json");b=JSON.stringify({domainname:a});
void 0!==document.forms["create-user-form"]&&(document.forms["create-user-form"].domains.value=a);document.getElementById("domainbrandname").value="";d.send(b)}if(1==c)return confirm("We are sending a code to the emails associated with the domain "+a+". You will need to verify the code to prove your ownership. Are you ready?")?(d=new XMLHttpRequest,d.onreadystatechange=function(){if(4==d.readyState&&200==d.status){var a=JSON.parse(d.responseText);createuserdomainverkey=a.domainkey;a=a.emails;for(var b=
"A code has been sent to these emails \x3cul\x3e",c=0;c<a.length;c++)b+="\x3cli\x3e"+a[c]+"\x3c/li\x3e";b+="\x3c/ul\x3e\x3cbr\x3eplease enter the code below.\x3cbr\x3e";document.getElementById("adddomainfeedback").innerHTML=b;document.getElementById("domainverifybtn").value="Verify";document.getElementById("domainbrandname").placeholder="Provide code here";document.getElementById("domainverifybtn").onclick=validateDomainEmail}else document.getElementById("adddomainfeedback").innerHTML='\x3cfont color\x3d"red"\x3e'+
d.responseText+"\x3c/font\x3e"},d.open("POST","/newauth/api/adddomain/EMAIL/"+a+"/",!1),d.setRequestHeader("Content-Type","application/json"),b=JSON.stringify({domainname:a}),void 0!==document.forms["create-user-form"]&&(document.forms["create-user-form"].domains.value=a),document.getElementById("domainbrandname").value="",d.send(b),!0):!1}else document.getElementById("domainbrandname").style.borderColor="red"}
function validateDomainEmail(){var a=document.forms[0].domains.value,b=document.getElementById("domainbrandname").value;if(null!=b&&0<b.length){var c=new XMLHttpRequest;c.open("POST","/newauth/api/verifycode",!1);c.setRequestHeader("Content-Type","application/json");c.onreadystatechange=function(){4==c.readyState&&200==c.status&&("VERIFIED"===JSON.parse(c.responseText).status.statuscode?($("#brandModal").modal("hide"),verifiedbranddomainname=a,document.getElementById("brandwebsitenamedisplay").innerHTML=
a,document.getElementById("brandwebsiterow").classList.remove("hidden")):document.getElementById("adddomainfeedback").innerHTML='\x3cfont color\x3d"red"\x3eInvalid code. Please check \x3c/font\x3e')};b=JSON.stringify({domain:a,verificationKeyCode:createuserdomainverkey,verificationKeyInput:b});document.forms["create-user-form"].domains.value=a;document.getElementById("domainbrandname").value="Provide code here";c.send(b)}}
function validateDomainTxt(){var a=document.getElementById("domainbrandname").value,b="newauth-domain-verify:"+flakejsonobj.flake;if(null!=b&&0<b.length){var c=new XMLHttpRequest;c.open("POST","/newauth/api/verifycode",!1);c.setRequestHeader("Content-Type","application/json");c.onreadystatechange=function(){4==c.readyState&&200==c.status&&("VERIFIED"===JSON.parse(c.responseText).status.statuscode?($("#brandModal").modal("hide"),verifiedbranddomainname=a,document.getElementById("brandwebsitenamedisplay").innerHTML=
a,document.getElementById("brandwebsiterow").classList.remove("hidden")):document.getElementById("adddomainfeedback").innerHTML='\x3cfont color\x3d"red"\x3eWe could not verify the code. Please try again later. Do not log out before verifying again. \x3c/font\x3e')};b=JSON.stringify({domain:a,verificationKeyCode:createuserdomainverkey,verificationKeyInput:b});c.send(b)}}
function loadSystemCacheInfo(a){var b=new XMLHttpRequest;b.open("GET","/newauth/api/getSystemCacheInfo",!1);b.setRequestHeader("Content-Type","application/json");b.onreadystatechange=function(){if(4==b.readyState&&200==b.status){removepageloadingdiv();var a=JSON.parse(b.responseText);populateCacheDisplay(a)}};b.send(null)}
function loadSystemImages(a){displaypageloadingdiv(a);var b=new XMLHttpRequest;b.open("GET","/getSystemImages",!1);b.setRequestHeader("Content-Type","application/json");b.onreadystatechange=function(){4==b.readyState&&200==b.status&&(removepageloadingdiv(),document.getElementById("adminImages").innerHTML=b.responseText,$("#adminimagescollapse").collapse("show"))};b.send(null)}
function loadSystemUsersInfo(a){var b=new XMLHttpRequest;b.open("GET","/newauth/api/getSystemUsersInfo",!1);b.setRequestHeader("Content-Type","application/json");b.onreadystatechange=function(){if(4==b.readyState&&200==b.status){removepageloadingdiv();var a=JSON.parse(b.responseText);populateUsersDisplay(a)}};b.send(null)}
function loadSystemDBInfo(a){var b=new XMLHttpRequest;b.open("GET","/newauth/api/getSystemDBInfo",!1);b.setRequestHeader("Content-Type","application/json");b.onreadystatechange=function(){if(4==b.readyState&&200==b.status){removepageloadingdiv();var a=JSON.parse(b.responseText);populateDBDisplay(a)}};b.send(null)}
function populateCacheDisplay(a){document.getElementById("cachedisplay").innerHTML="";var b=document.createElement("div");b.classList.add("row");var c=document.createElement("div");c.classList.add("col-xs-12");for(var e=0;e<a.length;e++){var d=document.createElement("div");d.classList.add("row");for(var f=0;4>f;f++){var g=document.createElement("p"),k=document.createElement("div");k.classList.add("col-xs-3");0==f&&g.appendChild(document.createTextNode(a[e].cachename));1==f&&g.appendChild(document.createTextNode(a[e].localentries));
2==f&&g.appendChild(document.createTextNode(a[e].entries));k.appendChild(g);d.appendChild(k)}c.appendChild(d)}b.appendChild(c);document.getElementById("cachedisplay").appendChild(b)}
function populateUsersDisplay(a){document.getElementById("usersdisplay").innerHTML="";var b=document.createElement("div");b.classList.add("row");var c=document.createElement("div");c.classList.add("col-xs-12");var e=document.createElement("div");e.classList.add("row");for(var d=0;3>d;d++){var f=document.createElement("p"),g=document.createElement("div");g.classList.add("col-xs-4");0==d&&f.appendChild(document.createTextNode("Users: "+a.activeusers+"/"+a.usercount));1==d&&f.appendChild(document.createTextNode("Brands: "+
a.brandusercount));2==d&&f.appendChild(document.createTextNode("Admins: "+a.admincount));g.appendChild(f);e.appendChild(g)}c.appendChild(e);b.appendChild(c);document.getElementById("usersdisplay").appendChild(b)}
function populateDBDisplay(a){document.getElementById("dbdisplay").innerHTML="";var b=document.createElement("div");b.classList.add("row");var c=document.createElement("div");c.classList.add("col-xs-12");var e=document.createElement("div");e.classList.add("row");var d=document.createElement("div");d.classList.add("col-xs-12");var f=document.createElement("p");f.appendChild(document.createTextNode(a.clustername+"["+a.nodes+"]"));d.appendChild(f);e.appendChild(d);c.appendChild(e);for(e=0;e<a.nodelist.length;e++){d=
document.createElement("div");d.classList.add("row");for(var g=0;4>g;g++){f=document.createElement("p");var k=document.createElement("div");0==g&&(k.classList.add("col-xs-4"),f.appendChild(document.createTextNode(a.nodelist[e].broadcastAddress+"("+a.nodelist[e].address+")")));1==g&&(k.classList.add("col-xs-2"),f.appendChild(document.createTextNode(a.nodelist[e].datacenter)));2==g&&(k.classList.add("col-xs-2"),f.appendChild(document.createTextNode(a.nodelist[e].rack)));3==g&&(k.classList.add("col-xs-4"),
f.appendChild(document.createTextNode(a.nodelist[e].cassandraVersion.major+"."+a.nodelist[e].cassandraVersion.minor+"."+a.nodelist[e].cassandraVersion.patch)));k.appendChild(f);d.appendChild(k)}c.appendChild(d)}b.appendChild(c);document.getElementById("dbdisplay").appendChild(b)}
function convertDivToInput(a,b,c){var e=document.getElementById(a),d=e.textContent;e.innerHTML="";var f=document.createElement("INPUT");f.setAttribute("type","text");f.setAttribute("name",a+"-INPUT");f.setAttribute("value",d);f.setAttribute("size","30");f.style.color="#888888";f.style.padding="4px";f.style.border="none";f.style.borderBottom="2px solid grey";var g=function(a){var d=a.target.name.replace("-INPUT",""),e=document.getElementById(d),f=e.children[0];f.innerHTML="";f.appendChild(document.createTextNode(a.target.value));
e.appendChild(f);updatenewdataindb(a.target.value,d,b,c)};f.addEventListener("blur",g,!1);f.addEventListener("keyup",function(a){13!==a.keyCode&&9!==a.keyCode||g(a)});e.appendChild(f);f.focus()}function loadhomepage(){document.title="Newauth - Home";loadhomepagesection("homepage-location-display");loadhomepagesection("homepage-occupation-display");loadhomepagesection("homepage-headline-display")}
function loadorgpagedata(){loadhomepagesection("org-location-display",orgownerflake,orgID);loadhomepagesection("org-purpose-display",orgownerflake,orgID);loadhomepagesection("org-headline-display",orgownerflake,orgID)}
function loadhomepagesection(a){var b=new XMLHttpRequest,c="/newauth/api/gethomepagedata/"+a;c=null!=orgownerflake&&0<orgownerflake.length?c+("/"+orgownerflake+"/"+orgID):c+"/0/0";b.open("GET",c,!1);b.setRequestHeader("Content-Type","application/json");b.onreadystatechange=function(){if(4==b.readyState&&200==b.status){var c=b.responseText;if(null!=c&&0<c.length&&(c=JSON.parse(c),null!=c.data&&0<c.data.length)){var d=document.createElement("DIV");d.innerHTML=c.data;c=d.textContent||d.innerText||"";
0<c.length&&populatehomepagedatainsection(c,a)}}};b.send(null)}function updatenewdataindb(a,b,c,e){var d=new XMLHttpRequest;d.open("POST","/newauth/api/updatehomepagedata",!1);d.setRequestHeader("Content-Type","application/json");d.onreadystatechange=function(){4==d.readyState&&200==d.status&&populatehomepagedatainsection(a,b)};"undefined"==typeof c&&(c=null);"undefined"==typeof e&&(e=null);c=JSON.stringify({section:b,data:a,ownerflake:c,orgid:e});d.send(c)}
function populatehomepagedatainsection(a,b){var c=document.getElementById(b);if(null!=c){c.innerHTML="";var e=document.createElement("p");b.includes("occupation")&&e.classList.add("text-muted");b.includes("headline")&&e.classList.add("lead");e.style.color="#323232";e.style.backgroundColor="white";e.appendChild(document.createTextNode(a));c.appendChild(e)}}
function loadOrgPage(a,b){a="/newauth/orgPage/"+a+"/"+b;fadeoutelement("app");loadUrlAjax("/newauth/header?page\x3d"+b,"app-header");loadUrlAjax(a,"app");document.title="Newauth - Org";return!1}
function displayvideolink(a,b){document.getElementById(a).innerHTML="";var c=document.createElement("iframe");c.setAttribute("src","https://www.youtube.com/embed/"+b+"?rel\x3d0\x26autoplay\x3d0\x26autohide\x3d1\x26border\x3d0\x26wmode\x3dopaque\x26enablejsapi\x3d1\x26modestbranding\x3d1\x26showinfo\x3d0\x26controls\x3d0");c.setAttribute("frameborder","0");document.getElementById(a).appendChild(c);document.getElementById(a).style.display="block";return!1}
function removevideo(a){null!=document.getElementById(a)&&(document.getElementById(a).innerHTML="")}
function flakecheck(a,b){b.preventDefault();b.stopPropagation();var c=document.createElement("div");c.setAttribute("id","flakecheckinputdiv");c.style.position="absolute";c.style.bottom=window.getComputedStyle(document.getElementById("username")).getPropertyValue("bottom");c.style.right=window.getComputedStyle(document.getElementById("username")).getPropertyValue("left");c.style.zIndex="100";c.style.display="block";var e=document.createElement("input");e.setAttribute("id","flakecheckinput");e.setAttribute("type",
"text");e.setAttribute("placeholder","Search flake");e.style.width="150px";e.style.height="26px";e.style.color="#434343";e.style.fontSize="15px";e.style.border="2px solid grey";e.addEventListener("input",function(a){a=document.getElementById("flakecheckinput").value;0>valmap.indexOf(a[a.length-1])&&(document.getElementById("flakecheckinput").value="",document.getElementById("flakecheckinput").style.border="1px solid red");if(16==a.length)e.style.border="2px solid grey",displayThirdPartyFlakeDetails(a,
10,20,"app"),$("#flakecheckinputdiv").fadeOut("fast");else return handleflakesearch()});document.getElementById("app").addEventListener("click",function(a){"flakecheckinputdiv"!==a.target.id&&"flakecheckinput"!==a.target.id&&removediv(c)});c.appendChild(e);document.getElementById("app").appendChild(c);document.getElementById("flakecheckinput").value="";$("#flakecheckinputdiv").fadeIn("fast");document.getElementById("flakecheckinput").focus();return!1}
function showcontactmodal(a){generateFlakeOnCanvas("tinymessageflakeholder",newauthcontactflake,50,50,"tiny");document.getElementById("tinymessageflakeholder").addEventListener("click",function(){showflakepageinapp(newauthcontactflake);$("#contactmodal").modal("hide")});$("#contactmodal").modal("show")}
function manageDisplay(a,b,c){var e=0;$("#"+a).mouseenter(function(){e=setTimeout(function(){$(".extra-elements-in-answer").not("#"+b).hide();$("#"+b).show("fast")},250)}).mouseleave(function(){"undefined"!=typeof c&&0!=c||$("#"+b).hide();clearTimeout(e)})}function autoGrow(a){a.scrollHeight>a.clientHeight&&(a.style.height=a.scrollHeight+"px")}
function loadtopicimage(a,b){var c=new XMLHttpRequest;c.open("GET","/newauth/api/gettopicimage/"+a,!0);c.setRequestHeader("Content-Type","application/json");c.onreadystatechange=function(){if(4==c.readyState&&200==c.status){var a=c.responseText;null!=a&&0<a.length&&(document.getElementById(b).src=a)}};c.send(null)}
function topicautocomplete(a,b){function c(a){var b=a.target.value;if(0<b.replace("#","").length)if(null!=listoftopics[b])e(a),document.getElementById("post-global-url").innerHTML=newauthurl+"/t/"+b.replace("#","");else{var c=new XMLHttpRequest,d="/newauth/api/gettopics/"+b.replace("#","");c.open("GET",d,!1);c.setRequestHeader("Content-Type","application/json");c.onreadystatechange=function(){if(4==c.readyState&&200==c.status){var d=c.responseText;null!=d&&0<d.length&&(listoftopics[b]=JSON.parse(d),
e(a))}};c.send(null)}}function e(b){var c,d=b.target.value;f();if(!d)return!1;g=-1;var e=document.createElement("DIV");e.setAttribute("id",b.target.id+"autocomplete-list");e.setAttribute("class","autocomplete-items");b.target.parentNode.appendChild(e);for(c=0;c<listoftopics[d].length;c++)listoftopics[d][c].substr(1,d.length).toUpperCase()==d.toUpperCase()&&(b=document.createElement("DIV"),b.innerHTML="\x3cstrong\x3e"+listoftopics[d][c].substr(1,d.length-1)+"\x3cinput type\x3d'hidden' value\x3d'"+
listoftopics[d][c]+"'\x3e\x3c/strong\x3e",b.innerHTML+=listoftopics[d][c].substr(d.length),b.addEventListener("click",function(b){a.value=b.target.getElementsByTagName("input")[0].value.replace("#","");a.existingTopic="true";document.getElementById("post-global-url").innerHTML=newauthurl+"/t/"+b.target.getElementsByTagName("input")[0].value.replace("#","");f()}),e.appendChild(b))}function d(a){if(!a)return!1;for(var b=0;b<a.length;b++)a[b].classList.remove("autocomplete-active");g>=a.length&&(g=0);
0>g&&(g=a.length-1);a[g].classList.add("autocomplete-active")}function f(b){for(var c=document.getElementsByClassName("autocomplete-items"),d=0;d<c.length;d++)b!=c[d]&&b!=a&&c[d].parentNode.removeChild(c[d])}var g;a.addEventListener("input",function(a){null!=settimeoutid&&clearTimeout(settimeoutid);settimeoutid=setTimeout(function(){c(a)},300);document.getElementById("post-global-url").innerHTML="";var b=a.target.value;0<b.length?document.getElementById("post-global-url").innerHTML=newauthurl+"/t/"+
b.replace("#",""):document.getElementById("post-global-url").innerHTML=newauthurl+"/f/"+loggedinuserflake});a.addEventListener("keydown",function(a){var b=document.getElementById(this.id+"autocomplete-list");b&&(b=b.getElementsByTagName("div"));40==a.keyCode?(g++,d(b)):38==a.keyCode?(g--,d(b)):13==a.keyCode&&(a.preventDefault(),-1<g&&b&&b[g].click())});document.addEventListener("click",function(a){f(a.target)})}
function flakeautocomplete(a,b){function c(a){var b=a.target.value;if(3<b.length)if(null!=listofflakes[b])e(a);else{var c=new XMLHttpRequest;c.open("GET","/newauth/api/searchflakesstartingwith/"+b,!1);c.setRequestHeader("Content-Type","application/json");c.onreadystatechange=function(){if(4==c.readyState&&200==c.status){var d=c.responseText;null!=d&&0<d.length&&(listofflakes[b]=JSON.parse(d),16==b.length?displayThirdPartyFlakeDetails(b,10,20,"app"):e(a))}};console.log("Calling searchflakesstartingwith.."+
b);c.send(null)}}function e(b){var c,d=b.target.value;f();if(!d)return!1;g=-1;var e=document.createElement("DIV");e.setAttribute("id",b.target.id+"autocomplete-list");e.setAttribute("class","autocomplete-items");b.target.parentNode.appendChild(e);0==listofflakes[d].length&&(b=document.createElement("DIV"),b.innerHTML="No results found",e.appendChild(b));for(c=0;c<listofflakes[d].length;c++)if(listofflakes[d][c].flake.substr(0,d.length).toUpperCase()==d.toUpperCase()){b=document.createElement("DIV");
var k="";null!=listofflakes[d][c].giveOut&&listofflakes[d][c].giveOut!=listofflakes[d][c].flake&&(k=" ["+listofflakes[d][c].giveOut+"]");b.innerHTML="\x3cstrong\x3e"+listofflakes[d][c].flake.substr(0,d.length)+"\x3cinput type\x3d'hidden' value\x3d'"+listofflakes[d][c].flake+"'\x3e\x3c/strong\x3e";b.innerHTML+=listofflakes[d][c].flake.substr(d.length)+k;b.addEventListener("click",function(b){a.value=b.target.getElementsByTagName("input")[0].value;displayThirdPartyFlakeDetails(b.target.getElementsByTagName("input")[0].value,
10,20,"app");$("#flakecheckinputdiv").fadeOut("fast");f()});e.appendChild(b)}}function d(a){if(!a)return!1;for(var b=0;b<a.length;b++)a[b].classList.remove("autocomplete-active");g>=a.length&&(g=0);0>g&&(g=a.length-1);a[g].classList.add("autocomplete-active")}function f(b){for(var c=document.getElementsByClassName("autocomplete-items"),d=0;d<c.length;d++)b!=c[d]&&b!=a&&c[d].parentNode.removeChild(c[d])}var g;a.addEventListener("input",function(a){null!=settimeoutid&&clearTimeout(settimeoutid);settimeoutid=
setTimeout(function(){c(a)},300)});a.addEventListener("keydown",function(a){var b=document.getElementById(this.id+"autocomplete-list");b&&(b=b.getElementsByTagName("div"));40==a.keyCode?(g++,d(b)):38==a.keyCode?(g--,d(b)):13==a.keyCode&&(a.preventDefault(),-1<g&&b&&b[g].click())});document.addEventListener("click",function(a){f(a.target)})}
function genericinputautocomplete(a,b){function c(a){var b=a.target.value;if(3<b.length)if(null!=listofflakes[b])e(a);else{var c=new XMLHttpRequest;c.open("GET","/newauth/api/searchuserbyflakeortag/"+b,!1);c.setRequestHeader("Content-Type","application/json");c.onreadystatechange=function(){if(4==c.readyState&&200==c.status){var d=c.responseText;null!=d&&0<d.length&&(listofflakes[b]=JSON.parse(d),e(a))}};console.log("Calling searchuserbyflakeortag.."+b);c.send(null)}}function e(b){var c,d=b.target.value;
f();if(!d)return!1;g=-1;var e=document.createElement("DIV");e.setAttribute("id",b.target.id+"autocomplete-list");e.setAttribute("class","autocomplete-items");b.target.parentNode.appendChild(e);0==listofflakes[d].length&&(b=document.createElement("DIV"),b.innerHTML="No results found",e.appendChild(b));for(c=0;c<listofflakes[d].length;c++)if(listofflakes[d][c].flake.substr(0,d.length).toUpperCase()==d.toUpperCase()||listofflakes[d][c].giveOut.substr(0,d.length).toUpperCase()==d.toUpperCase()){b=document.createElement("DIV");
var k="";null!=listofflakes[d][c].giveOut&&listofflakes[d][c].giveOut!=listofflakes[d][c].flake&&(k=" ["+listofflakes[d][c].giveOut+"]");b.innerHTML="\x3cstrong\x3e"+listofflakes[d][c].giveOut.substr(0,d.length)+"\x3cinput type\x3d'hidden' value\x3d'"+listofflakes[d][c].flake+k+"'\x3e\x3c/strong\x3e";b.innerHTML+=listofflakes[d][c].giveOut.substr(d.length);b.addEventListener("click",function(b,c){return function(b){a.value=b.target.getElementsByTagName("input")[0].value;document.getElementById("orgmemberflake").value=
c;f()}}(event,listofflakes[d][c].flake));e.appendChild(b)}}function d(a){if(!a)return!1;for(var b=0;b<a.length;b++)a[b].classList.remove("autocomplete-active");g>=a.length&&(g=0);0>g&&(g=a.length-1);a[g].classList.add("autocomplete-active")}function f(b){for(var c=document.getElementsByClassName("autocomplete-items"),d=0;d<c.length;d++)b!=c[d]&&b!=a&&c[d].parentNode.removeChild(c[d])}var g;a.addEventListener("input",function(a){null!=settimeoutid&&clearTimeout(settimeoutid);settimeoutid=setTimeout(function(){c(a)},
300)});a.addEventListener("keydown",function(a){var b=document.getElementById(this.id+"autocomplete-list");b&&(b=b.getElementsByTagName("div"));40==a.keyCode?(g++,d(b)):38==a.keyCode?(g--,d(b)):13==a.keyCode&&(a.preventDefault(),-1<g&&b&&b[g].click())});document.addEventListener("click",function(a){f(a.target)})}
function postcontenttohome(){null==postcontenthome&&(postcontenthome={files:[]});var a=document.getElementById("indiv-post-text-input").value;postcontenthome.text=a;if(0==postcontenthome.text.length&&(!postcontenthome.files||0==postcontenthome.files.length))return console.log("nothing to post"),!1;var b=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");b.onreadystatechange=function(){if(4==b.readyState&&200==b.status){var a=JSON.parse(b.responseText);1==parseInt(a.lastseq)?
loadHome():refreshposts(a)}};b.open("POST","/newauth/api/postcontenttohomepage",!1);b.withCredentials=!0;b.setRequestHeader("Content-Type","application/json");a=JSON.stringify({text:postcontenthome.text,files:postcontenthome.files});a=1E3<a.length?sjcl.hash.sha256.hash(a.substring(0,1E3)):sjcl.hash.sha256.hash(a);a=sjcl.codec.hex.fromBits(a);b.send(JSON.stringify({text:postcontenthome.text,files:postcontenthome.files,hash:a}));postcontenthome=null;document.getElementById("indiv-post-text-input").value=
"";document.getElementById("indiv-post-text-input").style.height="";document.getElementById("attached-file-preview").innerHTML=""}function bannerimgfilechangeeventhandler(a){var b=document.getElementById("bannerimgfile");null!=b&&(debugappui&&console.log("attaching eventlistener for change on bannerimgfile"),b.addEventListener("change",function(b){readbannerimage(b,a);debugappui&&console.log("changed again")},!1))}
function attachedfilechangeeventhandler(){var a=document.getElementById("attachedfiles");null!=a&&(debugappui&&console.log("attaching eventlistener for change on attachedfiles"),a.addEventListener("change",function(a){displaypreview(a);debugappui&&console.log("changed again")},!1))}
function readbannerimage(a,b,c){var e=a.target.files;debugappui&&console.log("onchange event fired for banner img files");for(var d=0;d<e.length;d++){var f=new FileReader;f.onload=function(a){return function(c){updatebannerimage(c,a,b)}}(e[d]);f.readAsDataURL(e[d])}c&&c(a.target.imgcount,postcontenthome.files)}
function displaypreview(a,b){var c=a.target.files;null==postcontenthome&&(postcontenthome={files:[]});postcontenthome.files||(postcontenthome.files=[]);debugappui&&console.log("onchange event fired for attachedfiles");for(var e=0;e<c.length;e++){var d=new FileReader;d.onload=function(a){return function(b){processloadedattachedfile(b,a)}}(c[e]);d.readAsDataURL(c[e])}b&&b(a.target.imgcount,postcontenthome.files)}
function updatebannerimage(a,b,c){imageExists(a.target.result,function(e){var d=document.getElementById(c);if(e){e=document.createElement("img");e.src=a.target.result;var f=window.screen.availWidth/2,g=window.screen.availWidth/4;800>f&&(f=800);600>g&&(g=600);e=getresizedimage(e,b.type,f,g);d.src=e;d=new XMLHttpRequest;d.open("POST","/newauth/api/updatehomepagedata",!1);d.setRequestHeader("Content-Type","application/json");f=JSON.stringify({section:"home-banner-image",data:e});0<=c.indexOf("org")&&
(f=JSON.stringify({section:"org-banner-image",data:e,ownerflake:orgownerflake,orgid:orgID}));d.send(f)}else alert("Not an image file")})}
function processloadedattachedfile(a,b){imageExists(a.target.result,function(c){var e=document.getElementById("attached-file-preview");if(c){c=document.createElement("img");c.src=a.target.result;var d=window.screen.availWidth,f=window.screen.availHeight;800>d&&(d=800);600>f&&(f=600);d=getresizedimage(c,b.type,d,f);e.innerHTML="";f=document.createElement("IMG");f.classList.add("fade-in");f.style.objectFit="cover";f.width="64";f.height="64";f.src=d;e.style.backgroundColor="#ffffff";e.appendChild(f);
postcontenthome.files.push({name:b.name,size:b.size,type:b.type,content:d,thumbnail:getresizedimage(c,b.type,200,200)})}else e.style.backgroundColor="#989898",e.innerHTML="\x3ch5\x3eFile\x3c/h5\x3e",postcontenthome.files.push({name:b.name,size:b.size,type:b.type,content:a.target.result});1<postcontenthome.files.length&&(c=document.createElement("div"),c.classList.add("fade-in"),c.style.width="64",c.style.height="64",c.style.opacity="0.6",d=document.createElement("h4"),d.style.background="#515151",
d.classList.add("text-center"),d.appendChild(document.createTextNode("+"+(postcontenthome.files.length-1))),c.appendChild(d),e.appendChild(c))})}function getresizedimage(a,b,c,e){b=document.createElement("canvas");var d=a.width,f=a.height;d>f?d>c&&(f*=c/d,d=c):f>e&&(d*=e/f,f=e);b.width=d;b.height=f;b.getContext("2d").drawImage(a,0,0,d,f);return b.toDataURL("image/jpeg")}
function displaynopostmessageondiv(a){a=document.getElementById(a);var b=document.createElement("div");b.classList.add("panel-body");b.classList.add("panel-word-wrap");var c=document.createElement("div");c.classList.add("col-12");c.classList.add("text-center");var e=document.createElement("p");e.classList.add("lead");e.appendChild(document.createTextNode("This topic does not have any posts currently. "));var d=document.createElement("p");d.appendChild(document.createTextNode("If you would like to post something to this topic, please log in and post your content here"));
c.appendChild(e);c.appendChild(d);b.appendChild(c);a.appendChild(b)}
function displaypostsondiv(a,b,c){b=document.getElementById(b);if(null!=a){var e=document.createElement("div");e.classList.add("panel-body");e.classList.add("panel-word-wrap");var d=document.createElement("div");d.classList.add("col-xs-12");var f=document.createElement("div");f.classList.add("row");f.style.margin="5px auto 30px auto";f.style.backgroundColor="white";f.setAttribute("id","post-content-row");d.appendChild(f);for(var g=0;g<a.length;g++){var k=JSON.parse(a[g].data);0==g&&(lastpostseq=a[g].lastseq);
var h=a[g].ownerflake;null!=a[g].giveout&&0<a[g].giveout.length&&(h=a[g].giveout);k="undefined"===typeof k.files||null==k.files||0==k.files.length?createTextOnlyPostDisplay(k,f,a[g].lastseq,a[g].ownerflake,c,a[g].convid):null==k.text||0==k.text.length?createFileOnlyPostDisplay(k,f,a[g].lastseq,a[g].ownerflake,c,a[g].convid):createTextandFilePostDisplay(k,f,a[g].lastseq,a[g].ownerflake,c,a[g].convid);"undefined"!=typeof c&&1==c&&addauthorinfobelowpost(k,a[g].createdate,a[g].ownerflake,a[g].lastseq,
h,a[g].tags,a[g].topic,a[g].convid)}e.appendChild(d);b.appendChild(e)}}
function displayconvosondiv(a,b,c){console.log("Starting displayconvosondiv");b=document.getElementById(b);b.innerHTML="";b.style.height="70%";b.style.overflowY="scroll";for(var e=0;e<a.length;e++){var d=document.createElement("div");d.classList.add("panel");d.classList.add("panel-default");var f=document.createElement("div");f.classList.add("panel-heading");d.appendChild(f);var g=document.createElement("div");g.classList.add("row");"undefined"!=typeof c&&0!=c||g.addEventListener("click",function(a){return function(){for(var b=
document.getElementsByClassName("conv-details"),c=0;c<b.length;c++)b[c].innerHTML="",b[c].parentNode.classList.add("hidden"),b[c].parentNode.classList.add("visuallyhidden");loadconversation(a);document.getElementById("conv-data-"+a).parentNode.classList.remove("hidden");document.getElementById("conv-data-"+a).parentNode.classList.remove("visuallyhidden")}}(a[e].convid));var k=document.createElement("div");k.classList.add("col-xs-4");k.style.cursor="pointer";var h=a[e].flake.substring(0,4)+"... ";
h+=gettimedifference(a[e].flakecreatetime,!0);k.appendChild(document.createTextNode(h));h=document.createElement("div");h.classList.add("col-xs-4");var m=document.createElement("div");m.classList.add("col-xs-4");if("undefined"!=typeof a[e].tags)for(var l=a[e].tags.toString().split(","),n=0;n<l.length;n++){var p=document.createElement("a");p.style.paddingRight="5px";p.style.cursor="pointer";p.addEventListener("click",function(a,b,d){return function(a){a.stopPropagation();null!=document.getElementById("msg-flake-recipient-input")&&
(document.getElementById("msg-flake-recipient-input").value=b);if("undefined"!=typeof c&&1==c){a=document.getElementsByClassName("conv-details");for(var e=0;e<a.length;e++)a[e].innerHTML="",a[e].parentNode.classList.add("hidden"),a[e].parentNode.classList.add("visuallyhidden");loadconversationmesagesbyparticipant(d,null,b)}else loadconversationsbyparticipant(null,null,b)}}(event,l[n],a[e].convid));p.appendChild(document.createTextNode(l[n]));p.classList.add("pull-right");m.appendChild(p)}g.appendChild(k);
g.appendChild(h);g.appendChild(m);k=document.createElement("div");k.classList.add("panel-body");k.classList.add("hidden");k.classList.add("visuallyhidden");k.style.transition="all 3s ease-in-out";k.style.display="block";h=document.createElement("div");h.classList.add("col-xs-12");h.classList.add("conv-details");h.setAttribute("id","conv-data-"+a[e].convid);k.appendChild(h);f.appendChild(g);d.appendChild(f);d.appendChild(k);b.appendChild(d)}console.log("about to end .. showing displayconvosondiv");
$("#convertransmodal").modal("show")}
function displaynewpost(a,b){b=document.getElementById(b);if(null!=a){if(null==document.getElementById("post-content-row")){var c=document.createElement("div");c.classList.add("panel-body");c.classList.add("panel-word-wrap");var e=document.createElement("div");e.classList.add("col-12");e.classList.add("text-center");var d=document.createElement("div");d.classList.add("row");d.style.margin="5px";d.setAttribute("id","post-content-row");e.appendChild(d);c.appendChild(e);b.appendChild(c)}b=document.getElementById("post-content-row");
c=JSON.parse(a.data);"undefined"===typeof c.files||null==c.files||0==c.files.length?createTextOnlyPostDisplay(c,b,a.lastseq):null==c.text||0==c.text.length?createFileOnlyPostDisplay(c,b,a.lastseq):createTextandFilePostDisplay(c,b,a.lastseq);lastpostseq=a.lastseq}}
function addauthorinfobelowpost(a,b,c,e,d,f,g,k){var h=document.createElement("div");h.classList.add("row");h.classList.add("text-center");h.style.color="#a3a3a3";var m=document.createElement("div");m.classList.add("col-md-4");m.classList.add("col-xs-6");m.style.left="3px";b=b.split(" ");var l=b[0].split("-");l=l[2]+"/"+l[0]+"/"+l[1]+" "+b[1].split(".")[0]+" MST";var n=document.createElement("div");n.classList.add("col-md-4");n.classList.add("col-xs-1");n.classList.add("text-center");b=document.createElement("div");
b.classList.add("col-md-4");b.classList.add("col-xs-5");b.classList.add("pull-right");var p=document.createElement("p");p.innerText=d;b.appendChild(document.createTextNode(gettimedifference(l,!0)+" ago"));m.appendChild(p);h.appendChild(m);h.appendChild(n);h.appendChild(b);"undefined"!==typeof f&&null!=f&&0<f.length&&(d=document.createElement("div"),d.style.display="none",d.innerText=f,d.setAttribute("name","post-tags"),h.appendChild(d));"undefined"!==typeof g&&null!=g&&0<g.length&&(f=document.createElement("div"),
f.classList.add("row"),d=document.createElement("div"),d.classList.add("col-xs-12"),d.innerHTML="\x3cp\x3ePosted to topic: "+g+"\x3c/p\x3e",d.setAttribute("name","post-topic"),f.appendChild(d),h.appendChild(f));"undefined"!==typeof k&&null!=k&&0<k.length&&(f=document.createElement("img"),f.classList.add("img-responsive"),f.classList.add("pull-right"),f.style.display="inline",f.style.float="left",f.style.opacity=".6",f.width="14",f.height="14",f.src="/static/icons/comment_64.png",f.onclick=function(){loadpostcommmentsontopicpage(k,
c,e,g)},b.appendChild(f));a.parentNode.appendChild(h)}
function loadpostcommmentsontopicpage(a,b,c,e){var d="post-comments";if(600>window.innerWidth||600>window.innerHeight)d="post-comments-mobile";document.getElementById(d).innerHTML="";var f=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");f.open("GET","/newauth/api/loadpostcomments/"+a+"/"+e,!1);f.setRequestHeader("Content-Type","application/json");f.onreadystatechange=function(){if(4==f.readyState&&200==f.status){var g=f.responseText;if(null!=g&&0<g.length){g=g.replace(/<\/?[^>]+>/gi,
"");g=JSON.parse(g);for(var k=0,h=0;h<g.length;h++)g[h].ok&&k++,displaycommentondiv(g[h],d);0==g.length?document.getElementById(d).innerHTML="\x3cp\x3e No comments to display\x3c/p\x3e":document.getElementById("cmt-count").innerText="["+k+"]";document.getElementById("full-post-display").appendChild(document.getElementById("display-post-comments-modal"));document.getElementById("flk-send-button").onclick=function(){addCommentToPost(a,e,b,c,crtime)};(600>window.innerWidth||600>window.innerHeight)&&
0<g.length&&(document.getElementById("topic-post-comment-button").src="/static/icons/comment-fill-64.png")}}};f.send(null)}function highlighttopic(a){document.getElementById("innerhex-"+a).style.cursor="pointer";$("#topicname-"+a).fadeIn(400)}function unhighlighttopic(a){document.getElementById("innerhex-"+a).style.cursor="default";$("#topicname-"+a).fadeOut(400)}
function showurlinapp(a){fadeoutelement("app");var b=document.createElement("div");b.setAttribute("id","displayloadingcontainer");b.style.position="absolute";b.style.margin="auto";b.style.top="0";b.style.left="0";b.style.right="0";b.style.bottom="0";b.style.width="200px";b.style.height="40px";var c=document.createElement("div");c.classList.add("loader");c.innerHTML="\x3ch4\x3eLoading...\x3c/h4\x3e";b.appendChild(c);b.style.zIndex="1000";b.style.opacity="1";document.getElementById("app").appendChild(b);
displayloadingicon();var e=document.getElementById("url-in-app-display");null!=e&&removediv(e);e=document.createElement("div");e.setAttribute("id","url-in-app-display");document.body.appendChild(e);var d=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");d.open("GET",a,!1);d.setRequestHeader("Content-Type","application/json");d.onreadystatechange=function(){if(4==d.readyState&&200==d.status){var a=d.responseText;null!=a&&0<a.length&&(removediv(document.getElementById("app")),
e.innerHTML=a,e.style.display="inline-block",loadPageScripts("url-in-app-display"),clearTimeout(appcalltimeoutid),fadeinelement("app"))}};d.send(null);return!1}
function showurloverapp(a){fadeoutelement("app");var b=document.createElement("div");b.setAttribute("id","displayloadingcontainer");b.style.position="absolute";b.style.margin="auto";b.style.top="0";b.style.left="0";b.style.right="0";b.style.bottom="0";b.style.width="200px";b.style.height="40px";var c=document.createElement("div");c.classList.add("loader");c.innerHTML="\x3ch4\x3eLoading...\x3c/h4\x3e";b.appendChild(c);b.style.zIndex="1000";b.style.opacity="1";document.getElementById("app").appendChild(b);
displayloadingicon();var e=document.getElementById("url-over-app-display");null!=e&&removediv(e);e=document.createElement("div");e.setAttribute("id","url-over-app-display");document.body.appendChild(e);let d=document.createElement("span");d.innerHTML="\x26times;";d.style.float="right";d.style.padding="5px";d.style.fontSize="4em";d.style.top="-0.4em";d.style.right="0px";d.style.zIndex="10000";d.style.position="absolute";d.style.display="inline-block";d.style.color="darkgray";d.style.cursor="default";
d.addEventListener("mouseover",function(a){a.target.style.color="#d3d3d3"});d.addEventListener("mouseout",function(a){a.target.style.color="#a2a2a2"});d.addEventListener("click",function(){hideloadingicon();$("#url-over-app-display").fadeOut(200);postimagesinterval&&clearInterval(postimagesinterval);settimeoutid&&clearTimeout(settimeoutid);document.body.removeEventListener("click",topicdocumentclick);document.title="newauth";fadeinelement("app")});var f=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");
f.open("GET",a,!1);f.setRequestHeader("Content-Type","application/json");f.onreadystatechange=function(){if(4==f.readyState&&200==f.status){var a=f.responseText;null!=a&&0<a.length&&(e.innerHTML=a,e.appendChild(d),e.style.display="inline-block",loadPageScripts("url-over-app-display"),clearTimeout(appcalltimeoutid))}};f.send(null);return!1}
function showflakepageinapp(a){fadeoutelement("app");var b=document.createElement("div");b.setAttribute("id","displayloadingcontainer");b.style.position="absolute";b.style.margin="auto";b.style.top="0";b.style.left="0";b.style.right="0";b.style.bottom="0";b.style.width="200px";b.style.height="40px";var c=document.createElement("div");c.classList.add("loader");c.innerHTML="\x3ch4\x3eLoading...\x3c/h4\x3e";b.appendChild(c);b.style.zIndex="1000";b.style.opacity="1";document.getElementById("app").appendChild(b);
displayloadingicon();var e=document.getElementById("topic-in-app-display");null!=e&&removediv(e);e=document.createElement("div");e.setAttribute("id","topic-in-app-display");document.body.appendChild(e);var d=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");d.open("GET","/f/"+a,!1);d.setRequestHeader("Content-Type","application/json");d.onreadystatechange=function(){if(4==d.readyState&&200==d.status){var a=d.responseText;null!=a&&0<a.length&&(e.innerHTML=a,e.style.display=
"inline-block",loadPageScripts("topic-in-app-display"),clearTimeout(appcalltimeoutid),a=document.createElement("span"),a.innerHTML="\x26times;",a.style.float="right",a.style.padding="2px 7px",a.style.fontSize="3em",a.style.top="0px",a.style.right="0px",a.style.zIndex="10000",a.style.position="absolute",a.style.display="inline-block",a.style.color="#a2a2a2",a.style.cursor="default",a.addEventListener("mouseover",function(a){a.target.style.color="#d3d3d3"}),a.addEventListener("mouseout",function(a){a.target.style.color=
"#a2a2a2"}),a.addEventListener("click",function(){hideloadingicon();document.body.removeEventListener("click",topicdocumentclick);$("#topic-in-app-display").fadeOut(200);postimagesinterval&&clearInterval(postimagesinterval);settimeoutid&&clearTimeout(settimeoutid);fadeinelement("app")}),e.appendChild(a))}};d.send(null)}
function displaycommentondiv(a,b){document.getElementById(b).style.height="50%";document.getElementById(b).style.overflowY="scroll";document.getElementById(b).style.backgroundColor="#fdfdfd";600<window.innerWidth&&600<window.innerHeight&&(document.getElementById(b).style.boxShadow="2px 2px 3px #9a9a9a");document.getElementById(b).style.opacity=.9;var c=document.createElement("div");c.classList.add("row");c.style.margin="5px";c.setAttribute("id","comment-row-"+a.conversationid+"-"+a.crtime);var e=
document.createElement("div");e.classList.add("col-12");var d=document.createElement("div");d.style.width="100%";d.style.padding="6px";d.style.borderBottom="1px solid black";if(!a.ok){var f=document.createElement("input");f.setAttribute("id","remove-"+a.conversationid+"-"+a.crtime);f.classList.add("btn");f.classList.add("btn-primary");f.classList.add("btn-xs");f.classList.add("pull-right");f.type="button";f.value="Remove";f.style.backgroundColor="tomato";var g=document.createElement("input");g.setAttribute("id",
"allow-"+a.conversationid+"-"+a.crtime);g.classList.add("btn");g.classList.add("btn-primary");g.classList.add("btn-xs");g.type="button";g.value="Allow";g.style.backgroundColor="green";g.addEventListener("click",function(){finalizecomment(a.conversationid,a.crtime,a.author,!0)});f.addEventListener("click",function(){finalizecomment(a.conversationid,a.crtime,a.author,!1)});d.appendChild(g);d.appendChild(f)}f=document.createElement("p");f.style.textAlign="left";f.appendChild(document.createTextNode(a.comment));
d.appendChild(f);f=document.createElement("div");f.classList.add("row");f.style.color="#898989";g=document.createElement("div");g.classList.add("col-xs-8");g.style.fontSize="8";g.appendChild(document.createTextNode(a.author));f.appendChild(g);document.createElement("div").classList.add("col-xs-4");g=document.createElement("div");g.classList.add("col-xs-4");g.style.fontSize="8";var k=gettimedifference(new Date(a.crtime),!0);g.appendChild(document.createTextNode(k));f.appendChild(g);d.appendChild(f);
e.appendChild(d);c.appendChild(e);document.getElementById(b).appendChild(c)}
function finalizecomment(a,b,c,e){var d=new XMLHttpRequest;d.open("POST","/newauth/api/finalizecomment",!1);d.setRequestHeader("Content-Type","application/json");d.onreadystatechange=function(){4==d.readyState&&200==d.status&&(e?(document.getElementById("allow-"+a+"-"+b).style.display="none",document.getElementById("remove-"+a+"-"+b).style.display="none"):cleardiv(document.getElementById("comment-row-"+a+"-"+b)))};c=JSON.stringify({conversationid:a,crtime:b,author:c,topic:topicname,ok:e});d.send(c)}
function createTextOnlyPostDisplay(a,b,c,e,d,f){var g=document.createElement("div");g.classList.add("col-xs-12");var k="";"undefined"==typeof e||null==e?k="post-seq-"+c:(k="post-seq-"+c+"-"+e,c+="-"+e);g.setAttribute("id",k);g.style.marginBottom="40px";g.style.boxShadow="3px 5px 7px #c9c9c9";k=document.createElement("div");k.classList.add("row");k.style.border="1px solid lightgrey";k.style.margin="10px";k.style.padding="0px";k.style.maxHeight="200px";k.style.backgroundColor="white";g.appendChild(k);
"undefined"!=typeof d&&0!=d||addpostheader(k,c);d=document.createElement("div");d.style.margin="10px";d.style.overflowY="hidden";d.style.overflowX="hidden";d.style.textAlign="left";d.style.padding="10px 10px 0px 5px";d.addEventListener("mouseover",function(a){g.style.opacity="0.8";highlightpostheader(c)});d.addEventListener("mouseout",function(a){g.style.opacity="1";unhighlightpostheader(c)});d.addEventListener("click",function(b){fadeoutelement("app");displayfulluserpost(a.text,e,f)});var h=document.createElement("p");
h.style.textOverflow="ellipsis";h.style.overflow="hidden";h.classList.add("first-line-bold");h.style.color="#848484";h.appendChild(document.createTextNode(a.text.substring(0,92)));if(92<a.text.length){var m=document.createElement("a");m.addEventListener("click",function(b){displayfulluserpost(a.text)});m.appendChild(document.createTextNode("   ...more"));h.appendChild(m)}d.appendChild(h);k.appendChild(d);parseInt(c)<lastpostseq?b.appendChild(g):(d=document.querySelectorAll('div[id^\x3d"post-seq-'+
lastpostseq+'"]')[0],b.insertBefore(g,d));return k}
function createTextandFilePostDisplay(a,b,c,e,d,f){var g=document.createElement("div");g.classList.add("col-xs-12");var k="";"undefined"==typeof e||null==e?k="post-seq-"+c:(k="post-seq-"+c+"-"+e,c+="-"+e);g.setAttribute("id",k);g.style.marginBottom="40px";g.style.boxShadow="3px 5px 7px #c9c9c9";k=document.createElement("div");k.classList.add("row");k.style.border="1px solid lightgrey";k.style.margin="10px";k.style.padding="0px";k.style.backgroundColor="white";k.style.maxHeight="200px";g.appendChild(k);
"undefined"!=typeof d&&0!=d||addpostheader(g,c);var h=!1,m=!1;a.files.forEach(function(a,b){0>a.type.indexOf("image")&&(h=!0)});h&&a.files.forEach(function(a,b){0<=a.type.indexOf("image")&&(m=!0)});if(h)if(m)n=document.createElement("div"),n.classList.add("col-xs-4"),n.classList.add("col-md-3"),n.style.height="70px",a.files.forEach(function(a,b){0<=a.type.indexOf("image")&&(b=document.createElement("img"),b.style.maxHeight="100%",b.classList.add("img-responsive"),b.classList.add("center-block"),b.src=
a.thumbnail,b.addEventListener("mouseenter",function(a){g.style.opacity="0.8";highlightpostheader(c)}),b.addEventListener("mouseleave",function(a){g.style.opacity="1";unhighlightpostheader(c)}),n.appendChild(b));0>a.type.indexOf("image")&&(b=document.createElement("div"),b.setAttribute("id","obj-heading-"+c),b.style.top="0px",b.style.maxWidth="90%",b.style.width="90%",b.style.color="#323232",b.style.textAlign="center",b.style.backgroundColor="#d2d2d2",b.style.opacity="0.8",b.style.position="absolute",
b.style.top="0px",b.style.margin="0 auto",b.style.display="none",b.appendChild(document.createTextNode(a.type.replace("application/",""))),n.appendChild(b),b=document.createElement("div"),b.setAttribute("id","obj-filename-"+c),b.style.color="#323232",b.style.margin="40px 0px 0px 10px",b.style.position="absolute",b.style.top="50px",b.style.backgroundColor="#d2d2d2",b.style.opacity="0.8",b.style.display="none",b.appendChild(document.createTextNode(a.name)),n.appendChild(b),n.addEventListener("mouseover",
function(a){$("#obj-heading-"+c).show();$("#obj-filename-"+c).show()}),n.addEventListener("mouseout",function(a){$("#obj-heading-"+c).hide();$("#obj-filename-"+c).hide()}))}),k.appendChild(n),n.addEventListener("click",function(b){fadeoutelement("app");getfullfilefrompost(c,a.text,e,f)}),parseInt(c)<lastpostseq?b.appendChild(g):(d=document.querySelectorAll('div[id^\x3d"post-seq-'+lastpostseq+'"]')[0],b.insertBefore(g,d));else{d=document.createElement("div");d.classList.add("col-xs-4");d.classList.add("col-md-3");
d.style.height="70px";d.style.backgroundColor="#c3c3c3";d.style.opacity="0.8";d.addEventListener("mouseenter",function(a){g.style.opacity="0.8";highlightpostheader(c)});d.addEventListener("mouseleave",function(a){g.style.opacity="1";unhighlightpostheader(c)});d.appendChild(document.createTextNode(a.files[0].type.replace("application/","")));var l=document.createElement("div");l.style.backgroundColor="#d2d2d2";l.style.opacity="0.8";l.appendChild(document.createTextNode(a.files[0].name));d.appendChild(l);
d.addEventListener("click",function(b){fadeoutelement("app");getfullfilefrompost(c,a.text,e)});k.appendChild(d)}else{var n=document.createElement("div");n.classList.add("col-xs-4");n.classList.add("col-md-3");a.files.forEach(function(a,b){var d=document.createElement("img");d.style.maxHeight="100%";d.classList.add("img-responsive");d.classList.add("center-block");d.src=a.thumbnail;d.addEventListener("mouseenter",function(a){g.style.opacity="0.8";highlightpostheader(c)});0<parseInt(b)?d.style.display=
"none":(d.classList.add("img-responsive"),d.classList.add("center-block"));d.addEventListener("mouseleave",function(a){g.style.opacity="1";unhighlightpostheader(c)});n.appendChild(d)});k.appendChild(n);n.addEventListener("click",function(b){fadeoutelement("app");getfullfilefrompost(c,a.text,e,f)});parseInt(c)<lastpostseq?b.appendChild(g):(d=document.querySelectorAll('div[id^\x3d"post-seq-'+lastpostseq+'"]')[0],b.insertBefore(g,d))}parseInt(c)<lastpostseq?b.appendChild(g):(d=document.querySelectorAll('div[id^\x3d"post-seq-'+
lastpostseq+'"]')[0],b.insertBefore(g,d));b=document.createElement("div");b.style.textAlign="left";b.style.position="relative";b.style.padding="10px 5px 0px 3px";b=document.createElement("div");b.classList.add("col-xs-8");b.classList.add("col-md-9");d=document.createElement("p");d.style.width="100%";d.style.position="relative";d.style.maxHeight="80px";d.style.overflow="hidden";d.style.color="#848484";d.classList.add("first-line-bold");d.appendChild(document.createTextNode(a.text.substring(0,92)));
92<a.text.length&&(l=document.createElement("a"),l.onclick=function(){loadfulluserpost(a,null)},l.appendChild(document.createTextNode("   ...more")),d.appendChild(l));b.appendChild(d);k.appendChild(b);return k}
function createFileOnlyPostDisplay(a,b,c,e,d,f){var g=document.createElement("div");g.classList.add("col-xs-12");g.classList.add("text-center");var k="";"undefined"==typeof e||null==e?k="post-seq-"+c:(k="post-seq-"+c+"-"+e,c+="-"+e);g.setAttribute("id",k);g.style.marginBottom="40px";g.style.boxShadow="3px 5px 7px #c9c9c9";k=document.createElement("div");k.classList.add("row");k.style.border="1px solid lightgrey";k.style.margin="10px";k.style.padding="0px";k.style.backgroundColor="white";k.style.maxHeight=
"200px";g.appendChild(k);"undefined"!=typeof d&&0!=d||addpostheader(k,c);var h=!1,m=!1;a.files.forEach(function(a,b){0>a.type.indexOf("image")&&(h=!0)});h&&a.files.forEach(function(a,b){0<=a.type.indexOf("image")&&(m=!0)});if(h){if(m)n=document.createElement("div"),n.style.padding="0px",n.style.position="relative",a.files.forEach(function(a,b){0<=a.type.indexOf("image")&&(b=document.createElement("img"),b.style.top="0",b.style.width="100%",b.style.maxHeight="100%",b.style.objectFit="cover",b.src=
a.thumbnail,b.addEventListener("mouseover",function(a){g.style.opacity="0.8";highlightpostheader(c)}),1==n.querySelectorAll("img").length?b.style.display="none":(b.classList.add("img-responsive"),b.classList.add("center-block")),b.addEventListener("mouseout",function(a){g.style.opacity="1";unhighlightpostheader(c)}),n.appendChild(b));0>a.type.indexOf("image")&&(b=document.createElement("div"),b.style.maxWidth="90%",b.style.width="90%",b.style.textAlign="center",b.style.top="0px",b.setAttribute("id",
"obj-heading-"+c),b.style.position="absolute",b.style.color="#323232",b.style.backgroundColor="#d2d2d2",b.style.opacity="0.8",b.style.display="none",b.appendChild(document.createTextNode(a.type.replace("application/",""))),n.appendChild(b),b=document.createElement("div"),b.setAttribute("id","obj-filename-"+c),b.style.color="#323232",b.style.margin="40px 0px 0px 10px",b.style.position="absolute",b.style.top="50px",b.style.backgroundColor="#d2d2d2",b.style.opacity="0.8",b.style.display="none",b.appendChild(document.createTextNode(a.name)),
n.appendChild(b),n.addEventListener("mouseover",function(a){$("#obj-heading-"+c).show();$("#obj-filename-"+c).show()}),n.addEventListener("mouseout",function(a){$("#obj-heading-"+c).hide();$("#obj-filename-"+c).hide()}))}),k.appendChild(n),n.addEventListener("click",function(b){fadeoutelement("app");getfullfilefrompost(c,a.text,e,f)});else{d=document.createElement("div");d.style.padding="0px";d.style.margin="0px";d.style.width="100%";d.style.top="0px";d.style.color="#323232";d.style.backgroundColor=
"#d2d2d2";d.addEventListener("mouseover",function(a){g.style.opacity="0.8";highlightpostheader(c)});d.addEventListener("mouseout",function(a){g.style.opacity="1";unhighlightpostheader(c)});d.appendChild(document.createTextNode(file.type.replace("application/","")));var l=document.createElement("div");l.style.margin="40px 0px 0px 10px";l.style.position="absolute";l.style.backgroundColor="#d2d2d2";l.style.color="#323232";l.style.opacity="0.8";l.appendChild(document.createTextNode(file.name));d.appendChild(l);
d.addEventListener("click",function(b){fadeoutelement("app");getfullfilefrompost(c,a.text,e,f)});k.appendChild(d)}parseInt(c)<lastpostseq?b.appendChild(g):(d=document.querySelectorAll('div[id^\x3d"post-seq-'+lastpostseq+'"]')[0],b.insertBefore(g,d))}else{var n=document.createElement("div");n.style.padding="0px";n.style.position="relative";a.files.forEach(function(a,b){var d=document.createElement("img");d.style.top="0";d.style.width="100%";d.style.maxHeight="100%";d.style.objectFit="cover";d.src=
a.thumbnail;d.addEventListener("mouseover",function(a){g.style.opacity="0.8";highlightpostheader(c)});0<parseInt(b)?d.style.display="none":(d.classList.add("img-responsive"),d.classList.add("center-block"));d.addEventListener("mouseout",function(a){g.style.opacity="1";unhighlightpostheader(c)});n.appendChild(d)});k.appendChild(n);n.addEventListener("click",function(b){fadeoutelement("app");getfullfilefrompost(c,a.text,e,f)});parseInt(c)<lastpostseq?b.appendChild(g):(d=document.querySelectorAll('div[id^\x3d"post-seq-'+
lastpostseq+'"]')[0],b.insertBefore(g,d))}return k}function highlightpostheader(a){null!=document.getElementById("post-header-"+a)&&(document.getElementById("post-header-"+a).style.opacity="0.8")}function unhighlightpostheader(a){null!=document.getElementById("post-header-"+a)&&(document.getElementById("post-header-"+a).style.opacity="0.1")}
function getfullfilefrompost(a,b,c,e){var d=new XMLHttpRequest,f=document.getElementById("post-seq-"+a),g=null;null!=f&&(f=f.querySelector('div[name\x3d"post-tags"]'),null!=f&&(g=f.innerText));a+="";0<=a.indexOf("-")&&(a=a.split("-")[0]);d.open("GET","/newauth/api/getpostfullimage/"+c+"/"+a,!1);d.setRequestHeader("Content-Type","application/json");d.onreadystatechange=function(){if(4==d.readyState&&200==d.status){var f=d.responseText;null!=f&&0<f.length&&loadfulluserpost(JSON.parse(f),b,g,e,c,a)}};
d.send(null)}
function loadfulluserpost(a,b,c,e,d,f){hideloadingicon();null!=appcalltimeoutid&&clearTimeout(appcalltimeoutid);appcalltimeoutid=null;var g=document.getElementById("full-post-display");null!=g&&removediv(g);g=document.createElement("div");g.setAttribute("id","full-post-display");g.classList.add("effect7");document.body.appendChild(g);var k=document.createElement("div");k.classList.add("container-fluid");var h=document.createElement("div");h.classList.add("row");h.style.zIndex=100;var m=document.createElement("div");
m.classList.add("col-xs-12");m.classList.add("col-md-12");m.classList.add("text-center");var l=document.createElement("p"),n=document.createElement("a");n.onclick=function(){displayThirdPartyFlakeDetails(a.ownerflake,x,y,"full-post-display")};"A"===a.giveouttype&&(n.innerHTML="\x3cem\x3e"+a.giveout+"\x3c/em\x3e");"N"===a.giveouttype&&(n.innerHTML="\x3cstrong\x3e"+a.giveout+"\x3c/strong\x3e");null!=a.giveouttype&&"F"!==a.giveouttype||n.setAttribute("id","tiny-flake-display");n.style.fontSize="15px";
var p=document.createElement("div"),r=document.createTextNode(getdatefromdatetime(a.createdate));l.style.color="#727272";l.style.maxWidth="100";l.appendChild(r);p.appendChild(l);l=document.createElement("div");l.classList.add("row");var q=document.createElement("div");q.classList.add("col-xs-4");q.classList.add("col-md-4");var t=document.createElement("div");t.classList.add("col-xs-4");t.classList.add("col-md-4");r=document.createElement("div");r.classList.add("col-xs-4");r.classList.add("col-md-4");
q.appendChild(n);t.appendChild(p);l.appendChild(q);l.appendChild(t);n=document.createElement("div");n.classList.add("row");n.classList.add("no-gutters");p=document.createElement("div");p.classList.add("col-xs-4");p.classList.add("col-md-4");q=document.createElement("div");q.classList.add("col-xs-4");q.classList.add("col-md-4");t=document.createElement("div");t.classList.add("col-xs-4");t.classList.add("col-md-4");n.appendChild(p);n.appendChild(q);n.appendChild(t);let v=document.createElement("div");
v.innerHTML='\x3cimg width\x3d"16" height\x3d"16" src\x3d"/static/icons/cross-sign.png"/\x3e';v.style.float="right";v.style.padding="8px";v.style.opacity=.5;v.style.top="0px";v.style.display="inline-block";v.style.cursor="default";v.addEventListener("mouseover",function(a){a.target.style.opacity=.8});v.addEventListener("mouseout",function(a){a.target.style.opacity=.5});v.addEventListener("click",function(a){a.stopPropagation();null!=document.getElementById("display-post-comments-modal")&&(document.getElementById("topic-page-id").appendChild(document.getElementById("display-post-comments-modal")),
$("#display-post-comments-modal").modal("hide"),document.body.addEventListener("click",topicdocumentclick));$("#full-post-display").fadeOut(200);postimagesinterval&&clearInterval(postimagesinterval);settimeoutid&&clearTimeout(settimeoutid);fadeinelement("app")});t.appendChild(v);t=document.createElement("img");t.src="/static/icons/link-50.png";t.width=24;t.height=24;if(600>window.innerWidth||600>window.innerHeight)t.width=16,t.height=16;t.style.display="inline-block";t.style.cursor="default";t.addEventListener("mouseover",
function(a){a.target.style.color="#d3d3d3"});t.addEventListener("mouseout",function(a){a.target.style.color="#a2a2a2"});t.addEventListener("click",function(){displaypublicrefsforpost(d,f)});q.appendChild(t);if("undefined"!==typeof e&&null!=e&&0<e.length){q=document.createElement("img");q.setAttribute("id","topic-post-comment-button");q.style.display="block";q.style.float="right";q.style.opacity=".7";q.width=24;q.height=24;if(600>window.innerWidth||600>window.innerHeight)q.width=18,q.height=18;q.src=
"/static/icons/comment_32.png";q.title="Leave a comment";q.onclick=function(){$("#display-post-comments-modal").modal("show");document.getElementById("flk-send-button").onclick=function(){addCommentToPost(e,a.topic,d,f,a.crtime)}};p.appendChild(q)}r.appendChild(n);l.appendChild(r);m.appendChild(l);h.appendChild(m);k.appendChild(h);h=document.createElement("div");h.classList.add("row");h.style.marginTop="50px";m=document.createElement("div");m.classList.add("col-md-12");m.classList.add("text-center");
m.style.float="none";m.style.margin="0 auto";var w=document.createElement("div");p=document.createElement("h3");p.appendChild(document.createTextNode(""));p.style.color="#737373";p.style.fontWeight="900";if("undefined"!==typeof a.data){l=JSON.parse(a.data);var z=!1;null!=l&&(l.forEach(function(a,b){0>a.type.indexOf("image")&&(z=!0)}),z&&l.forEach(function(a,b){a.type.indexOf("image")}));var u=null;z?null!=l&&l.forEach(function(a,b){if(0>a.type.indexOf("image"))if(window.navigator&&window.navigator.msSaveOrOpenBlob){var c=
a.content.replace(/^[^,]+,/,"");c=base64toBlob(c,a.type);window.navigator.msSaveOrOpenBlob(c,a.name)}else if(window.navigator.userAgent.match(/iPad/i)||window.navigator.userAgent.match(/iPhone/i))b=document.createElement("a"),b.setAttribute("href",a.content),b.setAttribute("download",a.name),b.appendChild(document.createTextNode(" Click to download the file")),w.appendChild(document.createTextNode("Document preview is not working. ")),w.appendChild(b);else{u=document.createElement("object");800<window.innerWidth&&
(u.style.width=parseInt(66*window.innerWidth/100)+"px",u.style.height=parseInt(70*window.innerHeight/100)+"px");u.setAttribute("data",a.content);u.setAttribute("id","createuser-flake-text-header");0==a.type.length?u.setAttribute("type","text/plain"):u.setAttribute("type",a.type);u.style.color="#737373";u.style.fontWeight="700";var d=document.createElement("embed");d.setAttribute("src",a.content);d.setAttribute("type",a.type);800<window.innerWidth&&(d.setAttribute("width",parseInt(66*window.innerWidth/
100)+"px"),d.setAttribute("height",parseInt(70*window.innerHeight/100)+"px"));b=document.createElement("a");c=a.content.replace(/^[^,]+,/,"");c=base64toBlob(c,a.type);b.setAttribute("href",a.content);b.setAttribute("download",a.name);setTimeout(function(){},100);d.appendChild(document.createTextNode("Document preview is not working."));b.appendChild(document.createTextNode("Click to download the file"));d.appendChild(b);w.appendChild(d)}}):null!=l&&l.forEach(function(b,c){if(0<=b.type.indexOf("image")){u=
document.createElement("img");u.style.maxWidth="100%";u.style.maxHeight="80%";u.style.top="0";u.style.zIndex="1";u.style.padding="0px";u.src=b.content;var d=JSON.parse(a.data);1<d.length?(b=document.createElement("div"),b.style.position="relative",b.addEventListener("mouseover",function(a){showadditionalcontentindicator(u);settimeoutid=setTimeout(function(){updateimagesonelement(d,u)},600)}),b.addEventListener("mouseout",function(a){clearInterval(postimagesinterval);clearTimeout(settimeoutid)}),b.appendChild(u),
w.appendChild(b)):w.appendChild(u)}})}l=document.createElement("div");l.classList.add("row");r=document.createElement("div");r.classList.add("col-sm-8");r.classList.add("col-sm-offset-2");n=document.createElement("div");n.style.wordWrap="break-word";n.style.padding="5px";n.style.height=70*window.innerHeight/100;n.style.overflowY="auto";n.setAttribute("id","createuser-flake-text");p=!1;if("undefined"!==typeof a.text){b=a.text.split(/\r\n|\n\r|\n|\r/);for(q=0;q<b.length;q++)p=document.createElement("p"),
0==q&&p.classList.add("first-line-bold"),p.classList.add("text-muted"),p.style.textAlign="left",p.appendChild(document.createTextNode(b[q])),n.appendChild(p);p=!0}else if(null!=b){b=b.split(/\r\n|\n\r|\n|\r/);for(q=0;q<b.length;q++)p=document.createElement("p"),0==q&&p.classList.add("first-line-bold"),p.classList.add("text-muted"),p.style.textAlign="left",p.appendChild(document.createTextNode(b[q])),n.appendChild(p);p=!0}n.style.color="#878787";1==p&&(r.appendChild(n),l.appendChild(r),w.appendChild(l));
m.appendChild(w);h.appendChild(m);k.appendChild(h);g.appendChild(k);if(null==a.giveouttype||"F"===a.giveouttype)document.getElementById("tiny-flake-display").width="50",document.getElementById("tiny-flake-display").height="50",generateFlakeOnCanvas("tiny-flake-display",a.giveout,50,50,"tiny");"undefined"!==typeof c&&null!=c&&splashTagsInbackground(g,c);settimeoutid=setTimeout(function(){$("#full-post-display").fadeIn("fast");document.getElementById("full-post-display").style.zIndex="10000"},100)}
function displaypublicrefsforpost(a,b){var c=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");c.onreadystatechange=function(){if(4==c.readyState&&200==c.status){var a=c.responseText;null!=a&&0<a.length?loadpublicrefsforpost(JSON.parse(a)):loadpublicrefsforpost(null)}};c.open("POST","/newauth/api/getpostrefs",!1);c.withCredentials=!0;c.setRequestHeader("Content-Type","application/json");c.send(JSON.stringify({flake:a,sequence:b}))}
function loadpublicrefsforpost(a){var b=document.getElementById("public-ref-display");if(null==b){b=document.createElement("div");b.setAttribute("id","public-ref-display");document.getElementById("full-post-display").appendChild(b);var c=document.createElement("div");c.classList.add("container-fluid");var e=document.createElement("div");e.classList.add("row");e.classList.add("no-gutters");var d=document.createElement("div");d.classList.add("col-md-4");d.classList.add("col-md-offset-8");d.classList.add("col-xs-12");
var f=document.createElement("div");f.classList.add("panel");f.classList.add("panel-default");f.style.boxShadow="3px 5px 4px #aeaeae";b.addEventListener("click",function(){$("#do-comment-overlay").fadeOut(400);removediv(document.getElementById("public-ref-display"))});f.addEventListener("click",function(a){a.stopPropagation()});f.setAttribute("id","public-ref-display-content");var g=document.createElement("h3");null!=a&&g.appendChild(document.createTextNode("This post has been shared as"));g.style.color=
"#737373";g.style.fontWeight="500";f.appendChild(g);g=document.createElement("span");g.innerHTML="\x26times;";g.style.float="right";g.style.padding="2px 7px";g.style.fontSize="3em";g.style.top="0px";g.style.display="inline-block";g.style.color="#a2a2a2";g.style.cursor="default";g.addEventListener("mouseover",function(a){a.target.style.color="#d3d3d3"});g.addEventListener("mouseout",function(a){a.target.style.color="#a2a2a2"});g.addEventListener("click",function(){$("#public-ref-display").fadeOut(200);
removediv(document.getElementById("public-ref-display"))});d.appendChild(g);g=document.createElement("div");g.classList.add("panel-body");g.classList.add("panel-word-wrap");var k=document.createElement("div");k.classList.add("row");var h=document.createElement("div");h.classList.add("col-xs-10");h.classList.add("col-xs-offset-1");h.setAttribute("id","create-flk-input-holder");if(null==a){var m=document.createElement("p");m.classList.add("text-left");m.appendChild(document.createTextNode("This post has not been shared on another topic or flake"));
h.appendChild(m)}else for(var l=0;l<a.length;l++){var n=document.createElement("div");n.classList.add("row");var p=document.createElement("div");p.classList.add("col-xs-9");var r=document.createElement("div");r.classList.add("col-xs-3");n.appendChild(p);n.appendChild(r);m=document.createElement("p");m.classList.add("text-left");m.classList.add("lead");m.appendChild(document.createTextNode(a[l]));var q=document.createElement("button");q.style.float="right";q.style.top="0";q.appendChild(document.createTextNode("Copy Link"));
q=document.createElement("input");q.setAttribute("id","copy-url-"+a[l]);q.classList.add("btn");q.classList.add("btn-xs");q.classList.add("pull-right");q.type="button";q.value="Copy Link";q.addEventListener("click",function(a){return function(){var b=document.createElement("input");document.body.appendChild(b);b.setAttribute("value",newauthurl+a);b.select();document.execCommand("copy");document.body.removeChild(b);removediv(document.getElementById("public-ref-display"))}}(a[l]));p.appendChild(m);r.appendChild(q);
h.appendChild(n)}k.appendChild(h);g.appendChild(k);f.appendChild(g);d.appendChild(f);e.appendChild(d);c.appendChild(e);b.appendChild(c);$("#comment-input").focus()}settimeoutid=setTimeout(function(){$("#public-ref-display").fadeIn("fast")},200)}
function displaycommmentsonpostpage(a,b,c,e,d){var f=document.getElementById("do-comment-overlay");if(null==f){f=document.createElement("div");f.setAttribute("id","do-comment-overlay");document.getElementById("full-post-display").appendChild(f);var g=document.createElement("div");g.classList.add("container-fluid");var k=document.createElement("div");k.classList.add("row");k.classList.add("no-gutters");var h=document.createElement("div");h.classList.add("col-md-4");h.classList.add("col-md-offset-8");
h.classList.add("col-xs-12");var m=document.createElement("div");m.classList.add("panel");m.classList.add("panel-default");f.addEventListener("click",function(){$("#do-comment-overlay").fadeOut(400);removediv(document.getElementById("do-comment-overlay"))});m.addEventListener("click",function(a){a.stopPropagation()});m.setAttribute("id","do-comment-overlay-content");var l=document.createElement("h3");l.appendChild(document.createTextNode(""));l.style.color="#737373";l.style.fontWeight="900";m.appendChild(l);
l=document.createElement("span");l.innerHTML="\x26times;";l.style.float="right";l.style.padding="2px 7px";l.style.fontSize="3em";l.style.top="0px";l.style.display="inline-block";l.style.color="#a2a2a2";l.style.cursor="default";l.addEventListener("mouseover",function(a){a.target.style.color="#d3d3d3"});l.addEventListener("mouseout",function(a){a.target.style.color="#a2a2a2"});l.addEventListener("click",function(){$("#do-comment-overlay").fadeOut(200);removediv(document.getElementById("do-comment-overlay"))});
h.appendChild(l);l=document.createElement("div");l.classList.add("panel-body");l.classList.add("panel-word-wrap");var n=document.createElement("div");n.classList.add("row");var p=document.createElement("div");p.classList.add("col-sm-8");p.classList.add("col-sm-offset-2");p.classList.add("col-xs-9");p.setAttribute("id","create-flk-input-holder");n.appendChild(p);l.appendChild(n);var r=document.createElement("textarea");r.setAttribute("type","text");r.style.fontSize="14px";r.style.color="#848484";r.setAttribute("placeholder",
"Add your comments");r.setAttribute("id","comment-input");r.setAttribute("autofocus","true");r.classList.add("form-control");r.classList.add("input-md");r.addEventListener("keydown",function(a){autoGrow(event.target)},!1);r.addEventListener("input",function(){$("#flk-send-button").fadeIn("slow")},!1);r.style.color="#646464";var q=document.createElement("input");q.setAttribute("id","flk-send-button");q.classList.add("btn");q.classList.add("btn-primary");q.classList.add("btn-md");q.conversationID="";
q.changestarttime="";q.type="button";q.value="Add";q.style.display="none";q.onclick=function(){addCommentToPost(a,b,c,e,d)};var t=document.createElement("div");t.classList.add("col-sm-2");t.classList.add("col-xs-3");n.appendChild(t);p.appendChild(r);t.appendChild(q);l.appendChild(n);l.appendChild(document.createElement("br"));p=document.createElement("div");p.classList.add("row");n=document.createElement("div");n.classList.add("col-sm-8");n.classList.add("col-sm-offset-2");n.classList.add("col-xs-9");
n.setAttribute("id","create-flk-input-holder");p.appendChild(n);l.appendChild(p);l.appendChild(document.createElement("br"));p=document.createElement("input");p.setAttribute("type","text");p.setAttribute("placeholder","Name (optional)");p.setAttribute("id","comment-author-input");p.classList.add("form-control");p.classList.add("input-md");n.appendChild(p);m.appendChild(l);h.appendChild(m);k.appendChild(h);h=document.createElement("div");h.style.display="none";h.setAttribute("id","add-comment-notify-div");
g.appendChild(k);m.appendChild(h);f.appendChild(g);$("#comment-input").focus()}settimeoutid=setTimeout(function(){$("#do-comment-overlay").fadeIn("fast")},200)}
function addCommentToPost(a,b,c,e,d){var f=document.getElementById("comment-input").value,g=document.getElementById("comment-author-input").value;if(0<f.length){var k=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");k.onreadystatechange=function(){4==k.readyState&&200==k.status&&(null!=document.getElementById("display-post-comments-modal")&&$("#display-post-comments-modal").modal("hide"),null!=document.getElementById("do-comment-overlay")&&($("#do-comment-overlay").fadeOut(400),
removediv(document.getElementById("do-comment-overlay"))))};k.open("POST","/newauth/api/addcommenttopost",!1);k.withCredentials=!0;k.setRequestHeader("Content-Type","application/json");k.send(JSON.stringify({comment:f,author:g,conversationid:a,topic:b,flake:c,seq:e,crtime:d}))}else a=document.getElementById("add-comment-notify-div"),a.style.display="inline",a.innerHTML='\x3cp color\x3d"red"\x3e You have not added any comment.\x3c/p\x3e'}
function sendmessagetoflake(a){var b=document.getElementById("msg-flake-input").value,c=document.getElementById("msg-flake-author-input").value,e=document.getElementById("msg-flake-recipient-input").value;if(("undefined"==typeof document.getElementById("msg-flake-author-input").readOnly||0==document.getElementById("msg-flake-author-input").readOnly)&&0==c.length)return document.getElementById("msg-flake-author-input").style.border="2px solid red",!1;var d=window.XMLHttpRequest?new XMLHttpRequest:
new ActiveXObject("Microsoft.XMLHTTP");d.onreadystatechange=function(){if(4==d.readyState&&200==d.status){var a=[];a.push(JSON.parse(d.responseText));populateflakeconversationindiv(a,"flake-messages");600>=window.innerWidth&&(document.getElementById("flake-msg-modal").classList.remove("modal-md"),document.getElementById("flake-msg-modal").classList.remove("modal-lg"));$("#display-flake-messages-modal").modal("show");document.getElementById("flake-messages").scrollTop=document.getElementById("flake-messages").scrollHeight;
$(".modal-backdrop").removeClass("modal-backdrop");document.getElementById("msg-flake-input").value="";document.getElementById("msg-flake-input").style.height=""}};d.open("POST","/newauth/api/messagetoflake",!1);d.withCredentials=!0;d.setRequestHeader("Content-Type","application/json");document.getElementById("msg-flake-author-input").style.border="";d.send(JSON.stringify({flake:a,comment:b,author:c,recipient:e}))}
function loadflakeconvinmodal(a){populateflakeconversationindiv(a,"flake-messages");$("#display-flake-messages-modal").modal("show");document.getElementById("flake-messages").scrollTop=document.getElementById("flake-messages").scrollHeight;$(".modal-backdrop").removeClass("modal-backdrop")}
function populateflakeconversationindiv(a,b){b=document.getElementById(b);if(null!=b&&null!=a&&0<a.length){var c=document.createElement("div");c.classList.add("row");c.setAttribute("id","flake-message-row");var e=document.createElement("div");e.classList.add("col-xs-12");for(var d=0;d<a.length;d++){var f=document.createElement("div");f.classList.add("row");var g=document.createElement("div");g.classList.add("col-xs-9");"undefined"!=typeof a[d].author&&fullname!=a[d].author&&g.classList.add("col-xs-offset-3");
var k=document.createElement("div");k.classList.add("row");var h=document.createElement("div");h.classList.add("row");"undefined"==typeof a[d].author||0==a[d].author.length||fullname==a[d].author?h.classList.add("message-by-self"):h.classList.add("message-by-other");var m=document.createElement("div");m.classList.add("col-xs-9");var l=document.createElement("div");l.classList.add("col-xs-3");var n=document.createElement("div");n.classList.add("col-xs-12");var p=document.createElement("p");p.classList.add("text-muted");
p.style.margin="5 0 0 0";p.style.textAlign="left";p.appendChild(document.createTextNode(a[d].author));n.appendChild(p);k.appendChild(n);n=document.createElement("p");n.style.overflowWrap="break-word";n.style.textAlign="left";n.style.margin="5 0 0 0";n.appendChild(document.createTextNode(a[d].comment));m.appendChild(n);n=document.createElement("span");p=document.createElement("p");p.style.textAlign="right";p.style.margin="5 0 0 0";var r=gettimedifference(a[d].crtime,!0).split(" ");p.appendChild(document.createTextNode(r[0]+
r[1].charAt(0)));l.appendChild(p);h.appendChild(m);h.appendChild(n);h.appendChild(l);g.appendChild(k);g.appendChild(h);"undefined"!=typeof a[d].author&&fullname!=a[d].author&&0<document.getElementById("manageflake").innerHTML.length&&g.addEventListener("mouseenter",function(a,b,c){return function(a){a=document.getElementsByClassName("tmp-reply-btn");if(null!=a)for(var d=0;d<a.length;d++)a[d].style.display="none";a=document.createElement("input");a.classList.add("btn");a.classList.add("btn-xs");a.classList.add("pull-right");
a.classList.add("tmp-reply-btn");a.type="button";a.value="Reply";a.addEventListener("click",function(){document.getElementById("msg-flake-recipient-input").value=b});""==c.getElementsByTagName("span")[0].innerHTML?c.getElementsByTagName("span")[0].appendChild(a):c.getElementsByTagName("span")[0].getElementsByClassName("tmp-reply-btn")[0].style.display="inline-block"}}(event,a[d].author,g));f.appendChild(g);e.appendChild(f)}c.appendChild(e);b.appendChild(c)}}
function displayThirdPartyFlakeDetails(a,b,c,e){var d=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");var f="undefined"===typeof e||null==e?document.documentElement:document.getElementById(e);f.style.transitionTimingFunction="ease";f.style.opacity=.2;f.style.transition="opacity 1s";d.onreadystatechange=function(){4==d.readyState&&200==d.status&&showFlakeDetail(JSON.parse(d.responseText),b,c,e)};d.open("POST","/fc/"+a,!1);d.withCredentials=!0;d.send(JSON.stringify({reset:"hello"}))}
function runAdHocFunction(){var a=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");a.onreadystatechange=function(){4==a.readyState&&200==a.status&&alert("done")};a.open("POST","/newauth/api/adhoc",!1);a.withCredentials=!0;a.send(JSON.stringify({adhoc:"adhoc"}));return!1}
function lockUserImages(){if(0==document.getElementById("img-lock-flake").value.length)return document.getElementById("img-lock-flake").style.border="1px solid red",!1;var a=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");a.onreadystatechange=function(){4==a.readyState&&200==a.status&&alert("User images locked now")};a.open("POST","/newauth/api/lockuserimages",!1);a.withCredentials=!0;a.setRequestHeader("Content-Type","application/json");var b=document.getElementById("img-lock-flake").value;
a.send(JSON.stringify({flake:b}));return!1}
function deleteUser(){if(0==document.getElementById("img-lock-flake").value.length)return document.getElementById("img-lock-flake").style.border="1px solid red",!1;var a=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");a.onreadystatechange=function(){4==a.readyState&&200==a.status&&alert("User deleted")};a.open("POST","/newauth/api/deleteuser",!1);a.withCredentials=!0;a.setRequestHeader("Content-Type","application/json");var b=document.getElementById("img-lock-flake").value;
a.send(JSON.stringify({flake:b}));return!1}
function showFlakeDetail(a,b,c,e){var d=document.getElementById("flake-details-overlay");b=document.getElementById("flakecheckinput");var f="";f=null!=b?b.value:a.flake;if("undefined"===typeof e||null==e){var g=document.documentElement;g.style.transitionTimingFunction="ease";g.style.opacity=1;g.style.transition="opacity 1s"}else g=document.getElementById(e);if(null==d){d=document.createElement("div");d.setAttribute("id","flake-details-overlay");d.style.zIndex="12000";document.body.appendChild(d);
e=document.createElement("div");e.classList.add("container");e.classList.add("v-center");c=document.createElement("div");c.classList.add("row");var k=document.createElement("div");k.classList.add("col-md-8");k.classList.add("col-md-offset-2");b=document.createElement("div");b.classList.add("panel");b.classList.add("panel-default");d.addEventListener("click",function(){$("#flake-details-overlay").fadeOut(500);removediv(d);g.style.transitionTimingFunction="ease";g.style.opacity=1;g.style.transition=
"opacity 1s"});b.addEventListener("click",function(a){a.stopPropagation()});var h=document.createElement("h4");h.appendChild(document.createTextNode("Flake: "+f));h.style.color="#737373";h.style.fontWeight=600>window.innerWidth?"500":"900";b.appendChild(h);var m=document.createElement("IMG");m.src="/static/icons/new-page.png";m.width="24";m.title="Display flake page";m.onclick=function(){$("#flake-details-overlay").fadeOut(100);removediv(d);showflakepageinapp(f);g.style.transitionTimingFunction="ease";
g.style.opacity=1;g.style.transition="opacity 1s"};m.onmouseenter=function(){m.style.opacity=.7};m.onmouseout=function(){m.style.opacity=1};b.appendChild(m);h=document.createElement("span");h.innerHTML="\x26times;";h.style.float="right";h.style.padding="2px 7px";h.style.fontSize="3em";h.style.top="0px";h.style.display="inline-block";h.style.color="#a2a2a2";h.style.cursor="default";h.addEventListener("mouseover",function(a){a.target.style.color="#d3d3d3"});h.addEventListener("mouseout",function(a){a.target.style.color=
"#a2a2a2"});h.addEventListener("click",function(){$("#flake-details-overlay").fadeOut(500);removediv(d);g.style.transitionTimingFunction="ease";g.style.opacity=1;g.style.transition="opacity 1s"});k.appendChild(h);h=document.createElement("p");h.classList.add("lead");h.setAttribute("id","createuser-flake-text-header");if(null==a||null==a.crtime)h.style.color="#d52323",h.appendChild(document.createTextNode("Invalid flake "));else{h.style.color="#737373";var l=a.crtime.split(" "),n=l[0].split("-");l=
n[2]+"/"+n[0]+"/"+n[1]+" "+l[1].split(".")[0]+" MST";h.appendChild(document.createTextNode("Created "+gettimedifference(l,!0)+" ago"))}h.style.fontWeight=600>window.innerWidth?"120":"200";b.appendChild(h);l=document.createElement("div");l.classList.add("row");n=document.createElement("div");n.classList.add("col-sm-8");n.classList.add("col-sm-offset-2");var p=document.createElement("p");p.classList.add("text-muted");p.setAttribute("id","createuser-flake-text");null==a||null==a.crtime?p.appendChild(document.createTextNode("This flake has not been created yet.")):
("F"==a.giveouttype&&p.appendChild(document.createTextNode("By: anonymous")),"A"==a.giveouttype&&p.appendChild(document.createTextNode("By: "+a.giveout+" [Alias]")),"N"==a.giveouttype&&p.appendChild(document.createTextNode("By: "+a.giveout)));p.style.color="#878787";600>window.innerWidth?p.style.fontWeight="350":h.style.fontWeight="600";n.appendChild(p);l.appendChild(n);b.appendChild(l);h=document.createElement("div");h.classList.add("row");h.classList.add("text-center");l=document.createElement("div");
l.style.padding="10px";l.setAttribute("id","cu-flake-can");h.appendChild(l);b.appendChild(h);k.appendChild(b);c.appendChild(k);e.appendChild(c);if(null!=a&&"undefined"!==typeof a.posts&&null!=a.posts){h=new Set;for(c=0;c<a.posts.length;c++)h.add(a.posts[c].topic);c=document.createElement("div");c.classList.add("row");k=document.createElement("div");k.classList.add("col-md-12");k.classList.add("pull-left");c.appendChild(k);k.appendChild(document.createTextNode("Other topics by this user: "));h=h.values();
for(l=null;l=h.next().value;)n=document.createElement("a"),n.href="/t/"+l,n.appendChild(document.createTextNode(l)),k.appendChild(n);b.appendChild(c)}d.appendChild(e)}null!=a&&null!=a.giveout&&generateFlakeOnCanvas("cu-flake-can",a.giveout,160,120,"medium");settimeoutid=setTimeout(function(){$("#flake-details-overlay").fadeIn("fast")},200)}
function splashTagsInbackground(a,b){var c=document.createElement("canvas");c.height=window.innerHeight;c.width=window.innerWidth;c.style.top="35px";c.style.position="absolute";var e=c.getContext("2d");e.fillStyle="white";e.fillRect(0,0,c.width,c.height);b=b.split(/[,;|]+/);for(var d=0;d<b.length-1;d++){var f=window.innerHeight/(2*b.length),g=26-b[d].length/8;e.save();var k=parseInt(.03*window.innerWidth)+parseInt(.04*window.innerWidth)*(d%2+1);e.translate(Math.pow(window.innerWidth/k-1,d%2)*k,f*
(d+1));e.rotate(Math.PI/180*Math.pow(-1,d%2)*(d%2+1)*7);e.textAlign="center";e.fillStyle="lightgrey";e.font="normal  bold "+parseInt(g)+"px serif";e.fontFamily="Impact";wrapTextincanvas(e,b[d],50+10*d*Math.pow(-1,d%2),f*(d+1),window.innerWidth/6,25);e.restore()}c=c.toDataURL();a.style.background="url("+c+")"}
function base64toBlob(a,b){b=b||"";a=atob(a);for(var c=a.length,e=Math.ceil(c/1024),d=Array(e),f=0;f<e;++f){for(var g=1024*f,k=Math.min(g+1024,c),h=Array(k-g),m=0;g<k;++m,++g)h[m]=a[g].charCodeAt(0);d[f]=new Uint8Array(h)}return new Blob(d,{type:b})}function fileToBase64(a){return new Promise((b,c)=>{const e=new FileReader;e.readAsDataURL(a);e.onload=()=>b(e.result);e.onerror=a=>c(a)})}
function wrapTextincanvas(a,b,c,e,d,f){b=b.split(" ");for(var g="",k=0;k<b.length;k++){var h=g+b[k]+" ";a.measureText(h).width>d&&0<k?(a.fillText(g,c,e),g=b[k]+" ",e+=f):g=h}a.fillText(g,c,e)}
function showadditionalcontentindicator(a){if(null==document.getElementById("additional-content-indicator")){var b=document.createElement("div");b.setAttribute("id","additional-content-indicator");b.innerHTML="\x3cp style\x3d'color:#727272; width:100%; height:100%; position:absolute; bottom:20px;'\x3eHover over image to see more images\x3c/p\x3e";b.style.width="100%";b.style.height="100%";b.style.color="#727272";b.style.bottom="20px";b.style.position="absolute";b.style.top=0;b.style.left=0;b.style.opacity=
1;b.style.transition="opacity 0.6s ease 0s";b.style.textAlign="center";a.parentNode.appendChild(b)}}function updateimagesonelement(a,b){var c=0;postimagesinterval=setInterval(function(){b.src=a[c].content;c<a.length-1?c++:c=0},2200)}
function displayfulluserpost(a){var b=document.getElementById("full-post-display");null!=b&&removediv(b);b=document.createElement("div");b.setAttribute("id","full-post-display");document.body.appendChild(b);var c=document.createElement("div");c.classList.add("container");c.classList.add("v-center");var e=document.createElement("div");e.classList.add("row");var d=document.createElement("div");d.classList.add("col-md-8");d.classList.add("col-md-offset-2");var f=document.createElement("div");f.classList.add("panel");
f.classList.add("panel-default");var g=document.createElement("h3");g.appendChild(document.createTextNode(""));g.style.color="#737373";g.style.fontWeight="900";f.appendChild(g);g=document.createElement("span");g.innerHTML="\x26times;";g.style.float="right";g.style.padding="2px 7px";g.style.fontSize="3em";g.style.top="0px";g.style.display="inline-block";g.style.color="#a2a2a2";g.style.cursor="default";g.addEventListener("mouseover",function(a){a.target.style.color="#d3d3d3"});g.addEventListener("mouseout",
function(a){a.target.style.color="#a2a2a2"});g.addEventListener("click",function(){fadeinelement("app");$("#full-post-display").fadeOut(200)});d.appendChild(g);g=document.createElement("p");g.classList.add("lead");g.setAttribute("id","createuser-flake-text-header");g.appendChild(document.createTextNode("Post"));g.style.color="#737373";g.style.fontWeight="700";g=document.createElement("div");g.classList.add("row");var k=document.createElement("div");k.classList.add("col-sm-8");k.classList.add("col-sm-offset-2");
var h=document.createElement("p");h.classList.add("text-muted");h.style.textAlign="left";h.style.wordWrap="break-word";h.setAttribute("id","createuser-flake-text");h.appendChild(document.createTextNode(a));h.style.color="#878787";h.style.fontWeight="600";k.appendChild(h);g.appendChild(k);f.appendChild(g);d.appendChild(f);e.appendChild(d);c.appendChild(e);b.appendChild(c);settimeoutid=setTimeout(function(){$("#full-post-display").fadeIn("fast")},100)}
function addpostheader(a,b){var c=document.createElement("div");c.setAttribute("id","post-header-"+b);c.style.margin="0";c.style.width="100%";c.style.height="20px";c.style.position="absolute";c.style.top="0";c.style.left="0";c.style.backgroundColor="#ffffff";c.style.zIndex="10";c.style.opacity="0.1";c.style.transition="opacity .6s";c.addEventListener("mouseover",function(a){c.style.opacity="0.9"});a.appendChild(c);a=document.createElement("span");a.innerHTML="\x3cimg src\x3d/static/icons/pencil-16.png\x3e";
a.style.float="left";a.style.height="20px";a.style.padding="1px 3px";a.style.margin="0px";a.style.fontSize="1.4em";a.style.top="0px";a.style.display="inline-block";a.style.color="#a2a2a2";a.style.cursor="default";a.addEventListener("mouseover",function(a){a.target.style.color="#d3d3d3"});a.addEventListener("mouseout",function(a){a.target.style.color="#a2a2a2"});a.addEventListener("click",function(a){a.stopPropagation();showsignuserpostmodal(b)});c.appendChild(a);a=document.createElement("span");a.innerHTML=
"\x26times;";a.style.float="right";a.style.height="20px";a.style.padding="1px 3px";a.style.margin="0px";a.style.fontSize="3em";a.style.top="0px";a.style.display="inline-block";a.style.color="#a2a2a2";a.style.cursor="default";a.addEventListener("mouseover",function(a){a.target.style.color="#d3d3d3"});a.addEventListener("mouseout",function(a){a.target.style.color="#a2a2a2"});a.addEventListener("click",function(){deleteuserpost(b)});c.appendChild(a)}
function refreshposts(a){displaynewpost(a,"user-posts-display")}function deleteuserpost(a){var b=a;a+="";0<=a.indexOf("-")&&(a=a.split("-")[0]);var c=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");c.onreadystatechange=function(){4==c.readyState&&200==c.status&&removepostfrompage(b)};c.open("POST","/newauth/api/deleteuserpost",!1);c.withCredentials=!0;c.setRequestHeader("Content-Type","application/json");c.send(JSON.stringify({sequence:a}))}
function showsignuserpostmodal(a){document.getElementById("post-preview-in-modal").innerHTML="";document.getElementById("post-preview-in-modal").innerHTML=document.getElementById("post-seq-"+a).innerHTML;document.getElementById("posttopic").value="";document.getElementById("posttags").value="";document.getElementById("postseq").value=a;document.getElementById("signuserpost-btn").display="block";document.getElementById("usersignpostnotify").innerHTML="";document.getElementById("post-global-url").innerHTML=
newauthurl+"/f/"+loggedinuserflake;$("#signuserpostmodal").modal("show")}function handletopicchange(){topicautocomplete(document.getElementById("posttopic"),[])}function handleflakesearch(){flakeautocomplete(document.getElementById("flakecheckinput"),[])}function handlegenericsearch(){genericinputautocomplete(document.getElementById("orgmembersearchinput"),[])}
function signuserpost(){var a=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");a.onreadystatechange=function(){if(4==a.readyState&&200==a.status){var b=document.getElementById("post-global-url").innerText;document.getElementById("usersignpostnotify").innerHTML="Your Post will be available very soon at \x3ca href\x3d'"+b+"'\x3e"+b+"\x3c/a\x3e";document.getElementById("signuserpost-btn").display="none"}406==a.status&&(document.getElementById("usersignpostnotify").innerHTML=
"\x3cbr\x3e\x3cp class\x3d'text-danger'\x3eThe topic owner is not allowing posts currently.\x3c/p\x3e")};a.open("POST","/newauth/api/signuserpost",!1);a.withCredentials=!0;a.setRequestHeader("Content-Type","application/json");var b=document.getElementById("posttopic").value;"true"==document.getElementById("posttopic").existingTopic&&(b="#"+b);var c=document.getElementById("postseq").value;0<=c.indexOf("-")&&(c=c.split("-")[0]);var e=[],d=document.getElementById("posttags").value;if(0<d.length){d=
d.split(",;");for(var f=0;f<d.length;f++)e.push(d[f])}b=JSON.stringify({sequence:c,topic:b,tags:e});a.send(b);document.getElementById("posttopic").existingTopic="false"}function removepostfrompage(a){var b=a,c=document.getElementById("post-seq-"+b);a+="";0<=a.indexOf("-")&&(a=a.split("-")[0]);parseInt(a)==parseInt(lastpostseq)&&--lastpostseq;0==parseInt(lastpostseq)?loadHome():null!=c&&$("#post-seq-"+b).hide("slow")}
function showpurchasedialog(a){"BUS-VAULT-SUB"!=a&&populateitemdetailsinpaymentdialog(a);console.log("item data loaded");if(null==stripe){var b=document.createElement("script");b.type="text/javascript";b.setAttribute("src","https://polyfill.io/v3/polyfill.min.js?version\x3d3.52.1\x26features\x3dfetch");var c=document.createElement("script");c.type="text/javascript";c.setAttribute("src","https://js.stripe.com/v3/");document.body.appendChild(b);document.body.appendChild(c);c.addEventListener("load",
function(){stripe=Stripe(nastripekey);afterstripeloaded(a)},!1)}else afterstripeloaded(a)}
function populateitemdetailsinpaymentdialog(a){var b=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");b.onreadystatechange=function(){if(4==b.readyState&&200==b.status){var a=JSON.parse(b.responseText);"undefined"!==typeof a.amount&&(document.getElementById("na-item-amount").innerText=a.amount);"undefined"!==typeof a.summary&&(document.getElementById("na-item-small-description").innerText=a.summary);"undefined"!==typeof a.description&&(document.getElementById("na-item-description").innerText=
a.description);"undefined"!==typeof a.imageurl&&null!=a.imageurl&&(document.getElementById("na-item-photo").src=a.imageurl)}};a=document.getElementById(a).value;b.open("POST","/newauth/api/getitemdetail",!1);b.withCredentials=!0;b.setRequestHeader("Content-Type","application/json");a=JSON.stringify({name:a});b.send(a)}
function afterstripeloaded(a){loadjscssfile("/static/css/pymt-temp.css","css");var b="",c;null!=document.getElementById(a)&&(b=document.getElementById(a).value);var e={items:[{name:b}]};"BUS-VAULT-SUB"==a&&(e=getBusinessVaultOrder());fetch("/secure/paymentintent",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}).then(function(a){return a.json()}).then(function(a){c=stripe.elements().create("card",{style:{base:{color:"#32325d",fontFamily:"Arial, sans-serif",fontSmoothing:"antialiased",
fontSize:"16px","::placeholder":{color:"#32325d"}},invalid:{fontFamily:"Arial, sans-serif",color:"#fa755a",iconColor:"#fa755a"}}});c.mount("#card-element");console.log("new card element mounted");c.on("change",function(a){document.querySelector("button").disabled=a.empty;document.querySelector("#card-error").textContent=a.error?a.error.message:""});var b=document.getElementById("payment-form");b.addEventListener("submit",b.submitfn=function(a,b,c){return function(a){a.preventDefault();document.querySelector("#submit-payment").disabled=
!0;d(stripe,b,c)}}(event,c,a.clientSecret))});var d=function(c,d,e){g(!0);c.confirmCardPayment(e,{payment_method:{card:d}}).then(function(c){c.error?f(c.error.message):(c=c.paymentIntent.id,g(!1),document.querySelector(".result-message").classList.remove("hidden"),document.querySelector("#submit-payment").disabled=!1,processorderinnewauth(b,c),"BUS-VAULT-SUB"==a&&(document.getElementById("brandsignedup").value=1))})},f=function(a){g(!1);var b=document.querySelector("#card-error");b.textContent=a;
setTimeout(function(){b.textContent=""},4E3)},g=function(a){a?(document.querySelector("#submit-payment").disabled=!0,document.querySelector("#spinner").classList.remove("hidden"),document.querySelector("#button-text").classList.add("hidden")):(document.querySelector("#submit-payment").disabled=!1,document.querySelector("#spinner").classList.add("hidden"),document.querySelector("#button-text").classList.remove("hidden"))};console.log("about to show paymentoverlay");"BUS-VAULT-SUB"==a&&($("#brandModal").modal("hide"),
$("#paymentOverlayModal").on("hidden.bs.modal",function(){console.log("payment modal hidden.. unmounting card element");c.unmount()}));$("#paymentOverlayModal").modal("show")}
function getBusinessVaultOrder(){var a={};document.getElementById("na-sub-items").innerHTML="";var b=1;0<document.getElementById("bus-subs-user-count-input").value.length&&(b=parseInt(document.getElementById("bus-subs-user-count-input").value));document.getElementById("order-user-count-display").innerHTML=b+"\x3cp\x3eUsers\x3c/p\x3e";a.items=[];document.getElementById("na-item-small-description").innerText="Business account";var c=document.createElement("LI");c.appendChild(document.createTextNode("Business Vault"));
a.items.push({name:"BUS-VAULT-SUB",quantity:b});document.getElementById("na-sub-items").appendChild(c);document.getElementById("bus-topic-page-chk").checked&&(a.items.push({name:"BUS-TOPIC-PAGE-SUB"}),c=document.createElement("LI"),c.appendChild(document.createTextNode("Brand Page")),document.getElementById("na-sub-items").appendChild(c));document.getElementById("app-topic-page-chk").checked&&(a.items.push({name:"APP-TOPIC-PAGE-SUB",quantity:b}),c=document.createElement("LI"),c.appendChild(document.createTextNode("Apps Pages")),
document.getElementById("na-sub-items").appendChild(c));document.getElementById("bus-newauth-identity-chk").checked&&(a.items.push({name:"BUS-NEWAUTH-IDENTITY-SUB",quantity:b}),c=document.createElement("LI"),c.appendChild(document.createTextNode("Newauth Login")),document.getElementById("na-sub-items").appendChild(c));document.getElementById("bus-newauth-pers-img-chk").checked&&(a.items.push({name:"BUS-NEWAUTH-PERS-IMAGE-SUB",quantity:b}),b=document.createElement("LI"),b.appendChild(document.createTextNode("User personal images")),
document.getElementById("na-sub-items").appendChild(b));document.getElementById("bus-newauth-brand-img-chk").checked&&(a.items.push({name:"BUS-NEWAUTH-BRAND-IMAGE-SUB"}),b=document.createElement("LI"),b.appendChild(document.createTextNode("Brand Image")),document.getElementById("na-sub-items").appendChild(b));document.getElementById("bus-newauth-export-data-chk").checked&&(a.items.push({name:"BUS-NEWAUTH-EXPORT-DATA-SUB"}),b=document.createElement("LI"),b.appendChild(document.createTextNode("Vault Data export")),
document.getElementById("na-sub-items").appendChild(b));return a}function loadjscssfile(a,b){if("js"==b){var c=document.createElement("script");c.setAttribute("type","text/javascript");c.setAttribute("src",a)}else"css"==b&&(c=document.createElement("link"),c.setAttribute("rel","stylesheet"),c.setAttribute("type","text/css"),c.setAttribute("href",a));"undefined"!=typeof c&&document.getElementsByTagName("head")[0].appendChild(c)}
function removejscssfile(a,b){var c="js"==b?"src":"css"==b?"href":"none";b=document.getElementsByTagName("js"==b?"script":"css"==b?"link":"none");for(var e=b.length;0<=e;e--)b[e]&&null!=b[e].getAttribute(c)&&-1!=b[e].getAttribute(c).indexOf(a)&&b[e].parentNode.removeChild(b[e])}
function processorderinnewauth(a,b){var c=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");c.onreadystatechange=function(){4==c.readyState&&200==c.status&&(0<a.indexOf("IMG")&&(document.getElementById("img-sub-content").innerHTML="",displaypersonalauthimages("img-sub-content")),setTimeout(function(){removejscssfile("/static/css/pymt-temp.css","css");document.querySelector(".result-message").classList.add("hidden");"BUS-VAULT-SUB"==a&&(document.querySelector("#signedup").value=
"1");$("#paymentOverlayModal").modal("hide")},2E3))};c.open("POST","/newauth/api/processorder",!1);c.withCredentials=!0;c.setRequestHeader("Content-Type","application/json");b=JSON.stringify({name:a,paymentintentid:b});c.send(b)}
function displaypersonalauthimages(a){a=document.getElementById(a);var b=document.createElement("p");b.classList.add("lead");b.appendChild(document.createTextNode("These are your personal images. Box them to use for authentication."));a.appendChild(b);var c=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");c.onreadystatechange=function(){4==c.readyState&&200==c.status&&(JSON.parse(c.responseText),setupUser())};c.open("POST","/newauth/api/getpersonalauthimages",!1);c.withCredentials=
!0;c.setRequestHeader("Content-Type","application/json");a=JSON.stringify({});c.send(a)}function readpersonalimagefile(a,b,c){a.stopPropagation();a.preventDefault();for(var e=a.target.files,d=0;d<e.length;d++){var f=new FileReader;f.onload=function(a){return function(c){updatepersonalauthimage(c,a,b)}}(e[d]);f.readAsDataURL(e[d])}c&&c(a.target.imgcount,postcontenthome.files)}
function updatepersonalauthimage(a,b,c){imageExists(a.target.result,function(e){var d=document.getElementById(c);document.getElementById("allocatephotos").innerHTML='\x3cdiv class\x3d"loader"\x3e\x3ch4\x3eLoading...\x3c/h4\x3e\x3c/div\x3e';var f=c.split("-")[1];if(e){e=document.createElement("img");e.src=a.target.result;var g=window.screen.availWidth,k=window.screen.availWidth/2;800>g&&(g=800);600>k&&(k=600);e=getresizedimage(e,b.type,g,k);d.src=e;d.height=null;d.style.padding=null;d.style.background=
null;d.style.maxHeight="64px";d.style.maxWidth="64px";d.style.opacity=1;d.parentNode.style.opacity=1;var h=new XMLHttpRequest;h.open("POST","/updatepersonalauthimage",!1);h.setRequestHeader("Content-Type","application/json");h.onreadystatechange=function(){4==h.readyState&&200==h.status&&setupUser()};fileToBase64(b).then(function(a){a=JSON.stringify({sequence:f,data:a.split(",")[1]});h.send(a)})}else alert("Not an image file")})}
function loadOrderDetails(){var a=new XMLHttpRequest;a.open("POST","/newauth/api/getallorders",!1);a.setRequestHeader("Content-Type","application/json");a.withCredentials=!0;a.onreadystatechange=function(){if(4==a.readyState&&200==a.status){var b=JSON.parse(a.responseText),e=document.getElementById("orderdetails");e.innerHTML="";for(var d=0;d<b.length;d++){var f=document.createElement("div");f.classList.add("row");var g=document.createElement("div");g.classList.add("col-xs-3");g.appendChild(document.createTextNode((new Date(b[d].orderdate)).toLocaleDateString("en-US")));
var k=document.createElement("div");k.classList.add("col-xs-4");k.appendChild(document.createTextNode(b[d].summary));var h=document.createElement("div");h.classList.add("col-xs-2");h.appendChild(document.createTextNode("$"+b[d].amount));var m=document.createElement("div");m.classList.add("col-xs-3");var l=document.createElement("button");l.setAttribute("type","button");l.classList.add("btn-default");l.classList.add("btn-xs");l.appendChild(document.createTextNode("Cancel"));l.addEventListener("click",
function(a,b,c){return function(){cancelorder(a,b,c)}}(b[d].orderdate,b[d].name,b[d].paymentintentid));30>gettimedifferenceinsec(b[d].orderdate)/86400?"undefined"!=typeof b[d].status&&"cancelled"==b[d].status?m.appendChild(document.createTextNode("Refunded")):m.appendChild(l):m.appendChild(document.createTextNode("Trial period expired."));f.appendChild(g);f.appendChild(k);f.appendChild(h);f.appendChild(m);e.appendChild(f)}}};var b=JSON.stringify({});a.send(b)}
function cancelorder(a,b,c){var e=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");e.onreadystatechange=function(){4==e.readyState&&200==e.status&&setupUser()};e.open("POST","/newauth/api/cancelorder",!1);e.withCredentials=!0;e.setRequestHeader("Content-Type","application/json");a=JSON.stringify({orderdateinmillis:a,name:b,paymentintentid:c});e.send(a)}
function showinfocontent(a,b){var c=document.getElementById("newauth-intro-video-player").getElementsByTagName("iframe")[0];null!=c&&c.contentWindow.postMessage('{"event":"command","func":"stopVideo","args":""}',"*");document.getElementById("newauth-intro-video-player").style.display="none";var e=document.getElementsByClassName("info-btn");for(c=0;c<e.length;c++)e[c].style.backgroundColor="white";b.target.style.backgroundColor="#a5a5a5";b=document.getElementsByClassName("content-display");for(c=0;c<
b.length;c++)b[c].style.display="none";document.getElementById(a).style.display="block"};