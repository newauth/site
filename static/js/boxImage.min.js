'use strict';var radius=20,linewidth=3,iintervalid,ointervalid,otimeoutid,x,y,clickevt,confirmedclicks,boxedimages,serversentclkdata,nextimgid,imgcanvas,img,context;function getMousePos2(b,d){var g=b.getBoundingClientRect();return{x:Math.round((d.clientX-g.left)/(g.right-g.left)*b.width),y:Math.round((d.clientY-g.top)/(g.bottom-g.top)*b.height)}}
function drawInwardCircle(){var b=document.getElementById("incircleCanvas");null==b&&(b=document.createElement("canvas"),b.id="incircleCanvas",document.body.appendChild(b));var d=b.getContext("2d");b.style.position="absolute";b.width=40;b.height=40;b.style.left=x+imgcanvas.getBoundingClientRect().left-20+"px";b.style.top=y+imgcanvas.getBoundingClientRect().top-20+"px";d.clearRect(0,0,b.width,b.height);d.save();d.beginPath();d.arc(20,20,radius,0,4*Math.PI,!1);d.lineWidth=3;d.strokeStyle="#ffffff";
d.stroke();radius-=3;d.restore();2>radius&&(radius=20,clearInterval(iintervalid))}
function DrawOutwardCircle(b,d){if(!confirmedclicks||3>confirmedclicks)clearTimeout(otimeoutid);else{var g=document.getElementById("outcircleCanvas");null==g&&(g=document.createElement("canvas"),g.id="outcircleCanvas",document.body.appendChild(g));var k=g.getContext("2d");g.style.position="absolute";g.width=2*d;g.height=2*d;g.style.left=x+imgcanvas.getBoundingClientRect().left-d+"px";g.style.top=y+imgcanvas.getBoundingClientRect().top-d+"px";k.clearRect(0,0,g.width,g.height);k.save();k.beginPath();
k.arc(d,d,radius,0,4*Math.PI,!1);k.lineWidth=linewidth;k.strokeStyle="#ffffff";k.stroke();radius+=2;k.restore();18==radius&&(k.lineWidth=linewidth+4);radius>d-2&&(radius=b,linewidth=3,clearTimeout(otimeoutid));setTimeout(clearAllBoxImageCanvas,5E3)}}
function drawGridAroundClick(){var b=document.getElementById("partialGridCanvas");null==b&&(b=document.createElement("canvas"),b.id="partialGridCanvas",document.body.appendChild(b));var d=b.getContext("2d");b.style.position="absolute";b.width=60;b.height=60;b.style.left=x+imgcanvas.getBoundingClientRect().left-20+"px";b.style.top=y+imgcanvas.getBoundingClientRect().top-20+"px";d.clearRect(0,0,b.width,b.height);d.strokeStyle="#ffffff";for(var g=0;5>g;g++)d.save(),d.beginPath(),d.moveTo(0,20*g),d.lineTo(b.width,
20*g),d.closePath(),d.stroke(),d.restore();for(g=0;5>g;g++)d.save(),d.beginPath(),d.moveTo(20*g,0),d.lineTo(20*g,b.height),d.closePath(),d.stroke(),d.restore()}function startDrawingOutwardCircle(){ointervalid=setInterval(function(){DrawOutwardCircle(4,20)},200)}
function clearAllBoxImageCanvas(){iintervalid&&clearInterval(iintervalid);ointervalid&&(clearInterval(ointervalid),clearTimeout(otimeoutid));var b=document.getElementById("partialGridCanvas");b&&b.parentNode.removeChild(b);(b=document.getElementById("incircleCanvas"))&&b.parentNode.removeChild(b);(b=document.getElementById("outcircleCanvas"))&&b.parentNode.removeChild(b)}
function showBoxNotificationDialog(b,d){var g=document.getElementById("app-notify-dialog");if(null==g){g=document.createElement("div");g.setAttribute("id","app-notify-dialog");document.body.appendChild(g);var k=document.createElement("div");k.classList.add("container");k.classList.add("v-center");var h=document.createElement("div");h.classList.add("row");var a=document.createElement("div");a.classList.add("col-md-8");a.classList.add("col-md-offset-2");var c=document.createElement("div");c.classList.add("panel");
c.classList.add("panel-default");var f=document.createElement("h3");"undefined"!=typeof d?f.appendChild(document.createTextNode(d)):f.appendChild(document.createTextNode("Success"));f.style.color="#737373";f.style.fontWeight="400";c.appendChild(f);d=document.createElement("p");d.classList.add("lead");d.setAttribute("id","createuser-flake-text-header");d.appendChild(document.createTextNode(b));d.style.color="#737373";d.style.fontWeight="150";c.appendChild(d);a.appendChild(c);h.appendChild(a);k.appendChild(h);
g.appendChild(k)}setTimeout(function(){$("#app-notify-dialog").fadeIn("fast")},100)}function clearBoxNotificationDialog(){$("#app-notify-dialog").fadeOut("fast");removediv(document.getElementById("app-notify-dialog"));clearTimeout(settimeoutid)}
function showBoxingInstructions(b){var d="minboxed"==b?document.getElementById("minbox-instruct-overlay"):"closeclicks"==b?document.getElementById("app-notifications-overlay"):document.getElementById("box-instruct-overlay");if(null==d){d=document.createElement("div");"closeclicks"==b?d.setAttribute("id","app-notifications-overlay"):"minboxed"==b?d.setAttribute("id","minbox-instruct-overlay"):d.setAttribute("id","box-instruct-overlay");document.body.appendChild(d);var g=document.createElement("div");
g.classList.add("container");g.classList.add("v-center");var k=document.createElement("div");k.classList.add("row");var h=document.createElement("div");h.classList.add("col-md-8");h.classList.add("col-md-offset-2");var a=document.createElement("div");a.classList.add("panel");a.classList.add("panel-default");var c=document.createElement("h3");"minboxed"==b?c.appendChild(document.createTextNode("You have boxed minimum required images.")):"closeclicks"==b&&c.appendChild(document.createTextNode("You seem to be clicking at the same location on every image."));
c.style.color="#737373";c.style.fontWeight="900";a.appendChild(c);c=document.createElement("p");c.classList.add("lead");c.setAttribute("id","createuser-flake-text-header");"minboxed"==b?c.appendChild(document.createTextNode("You can continue boxing more images or start using the profile.")):"closeclicks"==b?c.appendChild(document.createTextNode(" This is similar to setting 'password' as your password. Please choose locations that are not nearly identical.")):c.appendChild(document.createTextNode("You need to box at least 6 images before you can begin using Newauth."));
c.style.color="#737373";c.style.fontWeight="700";a.appendChild(c);c=document.createElement("div");c.classList.add("row");var f=document.createElement("div");f.classList.add("col-sm-8");f.classList.add("col-sm-offset-2");var e=document.createElement("p");e.classList.add("text-muted");e.setAttribute("id","createuser-flake-text");"minboxed"==b?e.appendChild(document.createTextNode("If you are done boxing images for now, Log out now. To log out, click On your Name in the top right of the screen in the header and then select Log Out. You will be taken to Welcome page. Once there, click on the Pending Setup tab. This will start your authentication process, the Newauth Way. You will need to click on the secret location on each image presented there. ")):
"closeclicks"==b?e.appendChild(document.createTextNode("Please restart boxing your images and make sure that the locations you choose on the images  are not the same.")):(e.appendChild(document.createTextNode("In order to box an image, you need to choose and click on a location on that image four times.  You will click on the same location during login. To help you track your progress, each click draws one side of a box around the image.  If you click on a different location any time before completing the box, you get a choice to reset your location.")),
e.appendChild(document.createElement("br")),e.appendChild(document.createElement("br")),e.appendChild(document.createTextNode("Try to choose a location on each image, which is not very obvious for someone to guess.")),e.appendChild(document.createElement("br")),e.appendChild(document.createElement("br")),e.appendChild(document.createTextNode("Here is how the clicks draw the border, the border is visible at the top of the page.")));e.style.color="#878787";e.style.fontWeight="600";f.appendChild(e);
c.appendChild(f);a.appendChild(c);b||a.appendChild(getvisualinstructions());c=document.createElement("div");c.classList.add("row");c.classList.add("text-center");f=document.createElement("div");f.setAttribute("id","cu-flake-can");c.appendChild(f);a.appendChild(c);c=document.createElement("div");c.classList.add("panel-body");c.classList.add("panel-word-wrap");f=document.createElement("div");f.classList.add("row");c.appendChild(f);e=document.createElement("input");e.setAttribute("id","clr-box-instructions");
e.classList.add("btn");e.classList.add("btn-primary");e.classList.add("btn-md");e.conversationID="";e.changestarttime="";e.type="button";e.value="Got it";"minboxed"==b?e.addEventListener("click",clearMinBoxingInstructions,!1):"closeclicks"==b?e.addEventListener("click",clearCloseclickInstructions,!1):e.addEventListener("click",clearBoxingInstructions,!1);var m=document.createElement("div");m.classList.add("col-sm-2");f.appendChild(m);m.appendChild(e);c.appendChild(f);a.appendChild(c);h.appendChild(a);
k.appendChild(h);g.appendChild(k);d.appendChild(g);setTimeout(function(){"closeclicks"==b?$("#app-notifications-overlay").fadeIn("slow"):"minboxed"==b?$("#minbox-instruct-overlay").fadeIn("slow"):$("#box-instruct-overlay").fadeIn("slow")},300)}}
function getvisualinstructions(){var b=document.createElement("div");b.classList.add("row");var d=document.createElement("div");d.classList.add("col-md-8");d.classList.add("col-md-offset-2");var g=document.createElement("div");g.classList.add("row");var k=document.createElement("div");k.classList.add("col-md-3");k.classList.add("text-center");var h=document.createElement("p");h.style.float="none";h.style.display="inline-block";h.style.verticalAlign="middle";h.style.width=20;h.style.height=20;h.style.borderLeft=
"solid #a2a2a2 2px";h.appendChild(document.createTextNode("1"));k.appendChild(h);h=document.createElement("div");h.classList.add("col-md-3");h.classList.add("text-center");var a=document.createElement("p");a.style.float="none";a.style.display="inline-block";a.style.verticalAlign="middle";a.style.width=20;a.style.height=20;a.style.borderLeft="solid #a2a2a2 2px";a.style.borderBottom="solid #a2a2a2 2px";a.appendChild(document.createTextNode("2"));h.appendChild(a);a=document.createElement("div");a.classList.add("col-md-3");
a.classList.add("text-center");var c=document.createElement("p");c.style.float="none";c.style.display="inline-block";c.style.verticalAlign="middle";c.style.width=20;c.style.height=20;c.style.borderLeft="solid #a2a2a2 2px";c.style.borderBottom="solid #a2a2a2 2px";c.style.borderRight="solid #a2a2a2 2px";c.appendChild(document.createTextNode("3"));a.appendChild(c);c=document.createElement("div");c.classList.add("col-md-3");c.classList.add("text-center");var f=document.createElement("p");f.style.float=
"none";f.style.display="inline-block";f.style.verticalAlign="middle";f.style.width=20;f.style.height=20;f.style.borderLeft="solid #a2a2a2 2px";f.style.borderBottom="solid #a2a2a2 2px";f.style.borderRight="solid #a2a2a2 2px";f.style.borderTop="solid #a2a2a2 2px";f.appendChild(document.createTextNode("4"));c.appendChild(f);g.appendChild(k);g.appendChild(h);g.appendChild(a);g.appendChild(c);d.appendChild(g);b.appendChild(d);return b}
function showImageClickResetInstruction(){var b=document.getElementById("image-reset-overlay");if(null==b){b=document.createElement("div");b.setAttribute("id","image-reset-overlay");document.body.appendChild(b);var d=document.createElement("div");d.classList.add("container");d.classList.add("v-center");var g=document.createElement("div");g.classList.add("row");var k=document.createElement("div");k.classList.add("col-md-8");k.classList.add("col-md-offset-2");var h=document.createElement("div");h.classList.add("panel");
h.classList.add("panel-default");var a=document.createElement("h3");a.appendChild(document.createTextNode("Do you want to select a new location?"));a.style.color="#737373";a.style.fontWeight="900";h.appendChild(a);a=document.createElement("p");a.classList.add("lead");a.setAttribute("id","createuser-flake-text-header");a.appendChild(document.createTextNode("Your last click location did not match your earlier clicks."));a.style.color="#737373";a.style.fontWeight="700";h.appendChild(a);a=document.createElement("div");
a.classList.add("row");var c=document.createElement("div");c.classList.add("col-sm-8");c.classList.add("col-sm-offset-2");var f=document.createElement("p");f.classList.add("text-muted");f.setAttribute("id","createuser-flake-text");f.appendChild(document.createTextNode(" Click 'No', if you want to keep the earlier location and try again.Click 'Reset Location' if you want to use the new location."));f.style.color="#878787";f.style.fontWeight="600";c.appendChild(f);a.appendChild(c);h.appendChild(a);
a=document.createElement("div");a.classList.add("row");a.classList.add("text-center");c=document.createElement("div");c.setAttribute("id","cu-flake-can");a.appendChild(c);h.appendChild(a);a=document.createElement("div");a.classList.add("panel-body");a.classList.add("panel-word-wrap");c=document.createElement("div");c.classList.add("row");a.appendChild(c);var e=document.createElement("input");e.setAttribute("id","clr-box-instructions");e.classList.add("btn");e.classList.add("btn-primary");e.classList.add("btn-md");
e.conversationID="";e.changestarttime="";e.type="button";e.value="No";e.addEventListener("click",clearImageClickResetInstruction,!1);var m=document.createElement("div");m.classList.add("col-sm-3");f=document.createElement("div");f.classList.add("col-sm-3");var l=document.createElement("input");l.setAttribute("id","reset-box-instructions");l.classList.add("btn");l.classList.add("btn-primary");l.classList.add("btn-md");l.type="button";l.value="Reset Location";l.addEventListener("click",resetImageClick,
!1);m.appendChild(e);f.appendChild(l);c.appendChild(m);e=document.createElement("div");e.classList.add("col-sm-6");c.appendChild(e);c.appendChild(f);a.appendChild(c);h.appendChild(a);k.appendChild(h);g.appendChild(k);d.appendChild(g);b.appendChild(d);setTimeout(function(){$("#image-reset-overlay").fadeIn("slow")},200)}}
function showHotspotInstruction(){var b=document.getElementById("image-hotspot-overlay");if(null==b){b=document.createElement("div");b.setAttribute("id","image-hotspot-overlay");document.body.appendChild(b);var d=document.createElement("div");d.classList.add("container");d.classList.add("v-center");var g=document.createElement("div");g.classList.add("row");var k=document.createElement("div");k.classList.add("col-md-8");k.classList.add("col-md-offset-2");var h=document.createElement("div");h.classList.add("panel");
h.classList.add("panel-default");var a=document.createElement("h3");a.appendChild(document.createTextNode("Could you select a different location?"));a.style.color="#737373";a.style.fontWeight="900";h.appendChild(a);a=document.createElement("p");a.classList.add("lead");a.setAttribute("id","createuser-flake-text-header");a.appendChild(document.createTextNode("The system suggests that you select a different location."));a.style.color="#737373";a.style.fontWeight="700";h.appendChild(a);a=document.createElement("div");
a.classList.add("row");var c=document.createElement("div");c.classList.add("col-sm-8");c.classList.add("col-sm-offset-2");var f=document.createElement("p");f.classList.add("text-muted");f.setAttribute("id","createuser-flake-text");f.appendChild(document.createTextNode(" Click 'No', if you want to keep the previous location. Click 'I will choose a different spot' if you want to choose a new location."));f.style.color="#878787";f.style.fontWeight="600";c.appendChild(f);a.appendChild(c);h.appendChild(a);
a=document.createElement("div");a.classList.add("row");a.classList.add("text-center");c=document.createElement("div");c.setAttribute("id","cu-flake-can");a.appendChild(c);h.appendChild(a);a=document.createElement("div");a.classList.add("panel-body");a.classList.add("panel-word-wrap");c=document.createElement("div");c.classList.add("row");a.appendChild(c);var e=document.createElement("input");e.setAttribute("id","clr-box-instructions");e.classList.add("btn");e.classList.add("btn-primary");e.classList.add("btn-md");
e.conversationID="";e.changestarttime="";e.type="button";e.value="No";e.addEventListener("click",forcehotspotclick,!1);var m=document.createElement("div");m.classList.add("col-sm-3");f=document.createElement("div");f.classList.add("col-sm-3");var l=document.createElement("input");l.setAttribute("id","reset-box-instructions");l.classList.add("btn");l.classList.add("btn-primary");l.classList.add("btn-md");l.type="button";l.value="Sure I will choose a different spot.";l.addEventListener("click",clearImageHotspotClick,
!1);m.appendChild(e);c.appendChild(m);e=document.createElement("div");e.classList.add("col-sm-6");e.appendChild(l);c.appendChild(f);c.appendChild(e);a.appendChild(c);h.appendChild(a);k.appendChild(h);g.appendChild(k);d.appendChild(g);b.appendChild(d);setTimeout(function(){$("#image-hotspot-overlay").fadeIn("slow")},200)}}
function showPostMinBoxedInstruction(){var b=document.getElementById("minbox-instruct-overlay");if(null==b){b=document.createElement("div");b.setAttribute("id","minbox-instruct-overlay");document.body.appendChild(b);var d=document.createElement("div");d.classList.add("container");d.classList.add("v-center");var g=document.createElement("div");g.classList.add("row");var k=document.createElement("div");k.classList.add("col-md-8");k.classList.add("col-md-offset-2");var h=document.createElement("div");
h.classList.add("panel");h.classList.add("panel-default");var a=document.createElement("h3");a.appendChild(document.createTextNode("You have boxed minimum required images."));a.style.color="#737373";a.style.fontWeight="900";h.appendChild(a);a=document.createElement("p");a.classList.add("lead");a.setAttribute("id","createuser-flake-text-header");a.appendChild(document.createTextNode("You can continue boxing more images or start using Newauth."));a.style.color="#737373";a.style.fontWeight="700";h.appendChild(a);
a=document.createElement("div");a.classList.add("row");var c=document.createElement("div");c.classList.add("col-sm-8");c.classList.add("col-sm-offset-2");var f=document.createElement("p");f.classList.add("text-muted");f.setAttribute("id","createuser-flake-text");f.appendChild(document.createTextNode(" Click 'Box some more', if you want to continue boxing more images. The more images you box, the more secure your profile."));f.appendChild(document.createElement("br"));f.appendChild(document.createElement("br"));
f.appendChild(document.createTextNode("Click 'Start using Newauth' if you are done boxing images for now and want to start using Newauth. You will be taken to Welcome page. Once there, click on the Pending Setup tab. This will start your authentication process, the Newauth Way. You will need to click on the secret location on each image presented there. You can come back to Setup tab any time and box more images."));f.style.color="#878787";f.style.fontWeight="600";c.appendChild(f);a.appendChild(c);
h.appendChild(a);a=document.createElement("div");a.classList.add("row");a.classList.add("text-center");c=document.createElement("div");c.setAttribute("id","cu-flake-can");a.appendChild(c);h.appendChild(a);a=document.createElement("div");a.classList.add("panel-body");a.classList.add("panel-word-wrap");c=document.createElement("div");c.classList.add("row");a.appendChild(c);var e=document.createElement("input");e.setAttribute("id","clr-box-instructions");e.classList.add("btn");e.classList.add("btn-primary");
e.classList.add("btn-md");e.conversationID="";e.changestarttime="";e.type="button";e.value="Box some more";e.addEventListener("click",clearPostMinBoxedInstruction,!1);var m=document.createElement("div");m.classList.add("col-sm-3");f=document.createElement("div");f.classList.add("col-sm-3");var l=document.createElement("input");l.setAttribute("id","reset-box-instructions");l.classList.add("btn");l.classList.add("btn-primary");l.classList.add("btn-md");l.type="button";l.value="Start using Newauth";
l.addEventListener("click",startUsingNewauth,!1);m.appendChild(e);f.appendChild(l);c.appendChild(m);e=document.createElement("div");e.classList.add("col-sm-6");c.appendChild(e);c.appendChild(f);a.appendChild(c);h.appendChild(a);k.appendChild(h);g.appendChild(k);d.appendChild(g);b.appendChild(d);setTimeout(function(){$("#minbox-instruct-overlay").fadeIn("slow")},200)}}function clearBoxingInstructions(){$("#box-instruct-overlay").fadeOut(300)}
function clearMinBoxingInstructions(){$("#minbox-instruct-overlay").fadeOut(300);null!=document.getElementById("minbox-instruct-overlay")&&document.getElementById("minbox-instruct-overlay").remove()}function clearCloseclickInstructions(){$("#app-notifications-overlay").fadeOut(300);destroyBoxingInstructions()}function destroyBoxingInstructions(){null!=document.getElementById("app-notifications-overlay")&&document.getElementById("app-notifications-overlay").remove()}
function clearImageClickResetInstruction(){$("#image-reset-overlay").fadeOut(500);cleardiv(document.getElementById("image-reset-overlay"));document.getElementById("image-reset-overlay").remove()}function clearImageHotspotClick(){$("#image-hotspot-overlay").fadeOut(500);cleardiv(document.getElementById("image-hotspot-overlay"));document.getElementById("image-hotspot-overlay").remove()}
function clearPostMinBoxedInstruction(){$("#minbox-instruct-overlay").fadeOut(500);cleardiv(document.getElementById("minbox-instruct-overlay"))}function startUsingNewauth(){clearPostMinBoxedInstruction();logOut()}
function resetImageClick(){if(null==serversentclkdata)return console.log("Nothing to reset click to."),!1;var b=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");b.open("POST","/newauth/postRegisterClickData",!1);b.setRequestHeader("Content-Type","application/json");b.onreadystatechange=function(){if(4==b.readyState)if(200==b.status)clearImageHotspotClick(),boxNextImage(nextimgid);else if(500==b.status)return showBoxNotificationDialog("Our servers seems temporarily busy. Please try again after some time.",
"ERROR"),setTimeout(function(){clearBoxNotificationDialog()},5E3),!1};b.send(JSON.stringify({imgID:serversentclkdata.imgID,delay:serversentclkdata.delay,reset:"Y",clickX:serversentclkdata.clickX,clickY:serversentclkdata.clickY,imgWidth:serversentclkdata.imgWidth,imgHeight:serversentclkdata.imgHeight}))}
function forcehotspotclick(){if(null==serversentclkdata)return console.log("Nothing to reset click to."),!1;var b=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");b.open("POST","/newauth/postRegisterClickData",!1);b.setRequestHeader("Content-Type","application/json");b.onreadystatechange=function(){if(4==b.readyState)if(200==b.status)clearImageHotspotClick(),boxNextImage(nextimgid);else if(500==b.status)return showBoxNotificationDialog("Our servers seems temporarily busy. Please try again after some time.",
"ERROR"),setTimeout(function(){clearBoxNotificationDialog()},5E3),!1};b.send(JSON.stringify({imgID:serversentclkdata.imgID,delay:serversentclkdata.delay,forcehotspot:"true",clickX:serversentclkdata.clickX,clickY:serversentclkdata.clickY,imgWidth:serversentclkdata.imgWidth,imgHeight:serversentclkdata.imgHeight}))};