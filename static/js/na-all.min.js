'use strict';var debugappui=!1,welcomebginterval,apptimeoutduration=1E4,sessionid,vaultkey="",userkey,otherkeys=[],valmap="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789_-+\x3d",publickeyb64="",privatekeyb64="",encprivkey="",loggedinuserflake,flakejsonobj,fullname,genericcounter=0,collageimagesloaded=0,flakegeneratorintid=0,currentavatar="",avatarcountDownDate,sseeventsource,headerflakebuttonhandler=!1,createuserdomainverkey,verifiedbranddomainname,postcontenthome,lastpostseq=0,newauthurl,
newauthcontactflake,lotimer,callservertimer,lasttime,delay,appcalltimeoutid,initialized=!1,allowedlapses=0,interactduration=3E5,lapses=0,settimeoutid,listoftopics={},listofflakes={},topicname,topicautocompleteregistered=!1,topicmaxdepth,topicstorage,flakeautocompleteregistered=!1,postimagesinterval,flakegiveoutmap={},postlocationmap,stripe=null,nastripekey=null,imgcheckinterval;const isJSON=a=>{try{return JSON.parse(a),!0}catch(b){return!1}};
document.addEventListener("DOMContentLoaded",updatescreenandwindowdims,!1);function getPositionOfanElement(a){for(var b=0,c=0;a;){if("BODY"==a.tagName){var d=a.scrollTop||document.documentElement.scrollTop;b+=a.offsetLeft-(a.scrollLeft||document.documentElement.scrollLeft)+a.clientLeft;c+=a.offsetTop-d+a.clientTop}else b+=a.offsetLeft-a.scrollLeft+a.clientLeft,c+=a.offsetTop-a.scrollTop+a.clientTop;a=a.offsetParent}return{x:b,y:c}}
function stopDefaultBackspaceBehaviour(a){a=a||window.event;if(8==a.keyCode){var b=a.srcElement||a.target,c=new RegExp(b.tagName.toUpperCase());"true"!=b.contentEditable&&c.test("HTML, BODY, TABLE, TBODY, TR, TD, DIV")&&(a.preventDefault?a.preventDefault():a.returnValue=!1)}}
function updatescreenandwindowdims(){for(var a=document.getElementsByTagName("form"),b=0;b<a.length;b++)for(var c=a[b].getElementsByTagName("input"),d=0;d<c.length;d++)if("screenwidth"===c[d].name){a[b].screenwidth.value=window.screen.availWidth;a[b].screenheight.value=window.screen.availHeight;a[b].windowwidth.value=window.innerWidth;a[b].windowheight.value=document.getElementById("app").clientHeight;break}}
function attachactivitylisteners(){debugappui&&console.log("attaching eventlisteners");window.addEventListener("load",resetSessionTimer);document.addEventListener("mousemove",resetSessionTimer);document.addEventListener("load",resetSessionTimer);document.addEventListener("mousedown",resetSessionTimer);document.addEventListener("touchstart",resetSessionTimer);document.addEventListener("click",resetSessionTimer);document.addEventListener("scroll",resetSessionTimer);document.addEventListener("keypress",
resetSessionTimer)}
function removeactivitylisteners(){debugappui&&console.log("removing eventlisteners");window.removeEventListener("load",resetSessionTimer);document.removeEventListener("mousemove",resetSessionTimer);document.removeEventListener("load",resetSessionTimer);document.removeEventListener("mousedown",resetSessionTimer);document.removeEventListener("touchstart",resetSessionTimer);document.removeEventListener("click",resetSessionTimer);document.removeEventListener("scroll",resetSessionTimer);document.removeEventListener("keypress",
resetSessionTimer);initialized=!1}function resetSessionTimer(){lasttime=new Date;lotimer&&clearTimeout(lotimer);lotimer=setTimeout(reenter_auth,delay);initialized||(setcallservertimer(),initialized=!0)}
function attachcatalogimagefilechangeeventhandler(){var a=document.getElementById("files-input");null!=a&&(debugappui&&console.log("attaching eventlistener for change on files-input"),a.addEventListener("change",function(a){handleImageUploadFileSelect(a,afterfilescheck);debugappui&&console.log("changed again")},!1))}
function handleImageUploadFileSelect(a,b){var c=a.target.files;a.target.imgcount=0;var d=[];debugappui&&console.log("onchange event fired for files-input");for(var e=0;e<c.length;e++){var f=new FileReader;f.onload=function(b){imageExists(b.target.result,function(b){b&&(a.target.imgcount++,d.push(c[e]),document.getElementById("file-select-feedback").value=c.length+" files selected. "+a.target.imgcount+" images.")})};f.readAsDataURL(c[e])}b(a.target.imgcount,d)}
function afterfilescheck(a,b){0<a&&(debugappui&&console.log("imgcount greater than zero..."+a),document.forms[0].files.value=b,document.getElementById("img-files-upload-btn").style.display="block")}function imageExists(a,b){var c=new Image;c.onload=function(){b(!0)};c.onerror=function(){b(!1)};c.src=a}
function videoExists(a,b){const c=document.createElement("video");c.src=a;c.currentTime=3;c.onloadedmetadata=b=>{window.URL.revokeObjectURL(c.src);console.log("Filename:"+a.name+" - Type:"+a.type+" - Size: "+c.videoWidth+"x"+c.videoHeight);console.log("canplay videomp4 "+c.canPlayType("video/mp4"))};c.ontimeupdate=function(){var a=document.querySelector("#post-video-preview-canvas");a.width=c.videoWidth;a.height=c.videoHeight;a.getContext("2d").drawImage(c,0,0,c.videoWidth,c.videoHeight);console.log("image saved on canvas now passing to callback");
b(!0)};c.onerror=()=>{console.log("File "+a+" not a video file");b(!1)}}function uploadimages(a){document.getElementById("img-files-upload-btn").classList.add("disabled");a&&0<a.length?(debugappui&&console.log("found formname : "+a+".. will submit to singleupload"),submitFormAjax("/singleUpload",a)):(debugappui&&console.log("found no formname : "+a),submitFormAjax("/singleUpload"));return!1}
function overloadimage(a,b){document.getElementById("img-files-upload-btn-overwrite").classList.add("disabled");a&&0<a.length?(console.log("found formname : "+a+".. will submit to singleupload"),submitFormAjax("/singleUpload/"+b,a)):(console.log("found no formname : "+a),submitFormAjax("/singleUpload/"+b));return!1}
function setcallservertimer(){callservertimer&&clearTimeout(callservertimer);debugappui&&console.log("setting timer for addsessiontime");callservertimer=setTimeout(addsessiontime,interactduration)}
function addsessiontime(){var a=new Date,b=(interactduration-(a-lasttime))/1E3;if(4<b){lapses=0;debugappui&&console.log("adding: "+b+" s to session."+a.toString().substring(16,24)+" "+lasttime.toString().substring(16,24)+" lapses: "+lapses+" of "+allowedlapses);var c=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");c.onreadystatechange=function(){4==c.readyState&&200==c.status&&0<c.getResponseHeader("SESSION_EXTENDED_TILL").length&&(avatarcountDownDate=c.getResponseHeader("SESSION_EXTENDED_TILL"))};
c.open("POST","/addsessionduration",!1);c.withCredentials=!0;c.setRequestHeader("Content-Type","application/json");c.send(JSON.stringify({data:interactduration,createdate:a}))}else lapses++,debugappui&&console.log("not enough duration to add: "+b+" s "+a.toString().substring(16,24)+" "+lasttime.toString().substring(16,24)+" lapses: "+lapses+" of "+allowedlapses);lasttime=new Date;setcallservertimer()}
function reenter_auth(){if(lapses>=allowedlapses){debugappui&&console.log("calling reenter_auth.. lapses: "+lapses+" .. also displaying login image");var a=document.getElementById("re-auth-overlay");null==a&&(a=document.createElement("div"),a.setAttribute("id","re-auth-overlay"),document.body.appendChild(a));var b=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");b.onreadystatechange=function(){4==b.readyState&&200==b.status&&(document.getElementById("re-auth-overlay").innerHTML=
b.responseText,document.getElementById("re-auth-overlay").style.display="block",debugappui&&console.log("clearing reenter_auth timer"),clearTimeout(lotimer),debugappui&&console.log("clearing addsessiontime timer"),clearTimeout(callservertimer),lapses=0,removeactivitylisteners(),document.querySelector(".auth-image-main-container")?afterauthscreenload(!0):(clearoverlay("re-auth-overlay"),document.getElementById("app").innerHTML='\x3cdiv style\x3d"display: block; position: relative; fontSize:15px; top: 50%;  text-align: center;"Your session has expired. Please login again.\x3c/div\x3e',
afterWelcomePageLoad()))};b.open("POST","/newauth/api/authenticate/reenter",!1);b.withCredentials=!0;b.setRequestHeader("Content-Type","application/json");b.send(JSON.stringify({userflake:loggedinuserflake,screenwidth:window.screen.availWidth,screenheight:window.screen.availHeight,winwidth:a.style.width,winheight:a.style.height,reenter:!0}))}else clearTimeout(lotimer),debugappui&&console.log("setting reenter_auth timer"),lotimer=setTimeout(reenter_auth,delay)}
function trackinactivityTime(a,b){attachactivitylisteners();interactduration=b;delay=a;allowedlapses=36E5/interactduration}String.prototype.startsWith||(String.prototype.startsWith=function(a,b){b=b||0;return this.indexOf(a,b)===b});function fadeOut(a){a.style.opacity=1;(function c(){0>(a.style.opacity-=.1)?a.style.display="none":requestAnimationFrame(c)})()}
function restoreheaderandfooter(){null!=document.getElementById("app-header").getAttribute("data-display")&&(document.getElementById("app-header").style.display=document.getElementById("app-header").getAttribute("data-display"),document.getElementById("app-header").style.height=document.getElementById("app-header").getAttribute("data-height"),document.getElementById("app-footer").style.display=document.getElementById("app-footer").getAttribute("data-display"),document.getElementById("app-footer").style.height=
document.getElementById("app-footer").getAttribute("data-height"),document.getElementById("app").style.height=document.getElementById("app").getAttribute("data-height"),document.getElementById("app").style.overflowY=document.getElementById("app").getAttribute("data-overflow"),document.getElementById("app").style.paddingTop=document.getElementById("app").getAttribute("data-paddingtop"),document.getElementById("app").style.paddingBottom=document.getElementById("app").getAttribute("data-paddingBottom"))}
function removeheaderandfooter(){document.getElementById("app-header").setAttribute("data-display",document.getElementById("app-header").style.display);document.getElementById("app-header").style.display="none";document.getElementById("app-header").setAttribute("data-height",document.getElementById("app-header").style.height);document.getElementById("app-header").style.height="0";document.getElementById("app-footer").setAttribute("data-display",document.getElementById("app-footer").style.display);
document.getElementById("app-footer").style.display="none";document.getElementById("app-footer").setAttribute("data-height",document.getElementById("app-footer").style.height);document.getElementById("app-footer").style.height="0";document.getElementById("app").setAttribute("data-height",document.getElementById("app").style.height);document.getElementById("app").style.height="100%";document.getElementById("app").setAttribute("data-overflow",document.getElementById("app").style.overflowY);document.getElementById("app").style.overflowY=
"hidden";document.getElementById("app").setAttribute("data-paddingtop",document.getElementById("app").style.paddingTop);document.getElementById("app").style.paddingTop="0";document.getElementById("app").setAttribute("data-paddingbottom",document.getElementById("app").style.paddingBottom);document.getElementById("app").style.paddingBottom="0"}function removealldots(){var a=document.getElementsByClassName("circle");if(null!=a)for(var b=0;b<a.length;b++)a[b].style.display="none"}
function submitFormAjax(a,b){var c=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");c.onreadystatechange=function(){4==c.readyState&&2==Math.trunc(c.status/100)&&("/newauth/authenticate"==a&&(null!=document.getElementById("app-header")&&(removeheaderandfooter(),removealldots()),document.getElementById("app").innerHTML=c.responseText,null!=document.getElementById("auth-image-main-container-id")&&(document.getElementById("auth-image-main-container-id").style.top="0"),
fadeinelement("app"),document.querySelector(".auth-image-main-container")?afterauthscreenload(!1):document.getElementById("setup-page-id")?(loadUrlAjax("/newauth/header?page\x3dsetupUser\x26pendSetup\x3dtrue","app-header"),afteranyscreenload()):document.getElementById("app-flk")?(loadUrlAjax("/newauth/header?page\x3dflake-page","app-header"),afteranyscreenload(),null!=document.getElementById("flake-page-id")&&(document.getElementById("flake-page-id").style.top="65px")):document.getElementById("create-page-id")?
(loadUrlAjax("/newauth/header?page\x3dcreateuser","app-header"),loadPageScripts("app"),afterCreateUserPageLoad(),removealldots()):afteranyscreenload()),"/newauth/postAuthClickData"==a&&(null!=document.getElementById("re-auth-overlay")?"FAIL"==c.getResponseHeader("AUTH_RESULT")?(document.getElementById("re-auth-overlay").innerHTML=c.responseText,afterauthscreenload(!0)):clearoverlay("re-auth-overlay"):(document.getElementById("app").innerHTML=c.responseText,document.querySelector(".auth-image-main-container")?
("FAIL"==c.getResponseHeader("AUTH_RESULT")?(hideloadingicon(),showAuthFailureDialog(),settimeoutid=setTimeout(function(){clearAuthFailureDialog()},1E3)):hideloadingicon(),afterauthscreenload(!1)):(document.getElementById("home-page-id")?(restoreheaderandfooter(),loadUrlAjax("/newauth/header?page\x3dhome","app-header")):document.getElementById("secure-page-id")?(restoreheaderandfooter(),loadUrlAjax("/newauth/header?page\x3dsecurePage","app-header")):document.getElementById("app-flk")&&(loadUrlAjax("/newauth/header?page\x3dflake-page",
"app-header"),null!=document.getElementById("flake-page-id")&&(document.getElementById("flake-page-id").style.top="65px")),afteranyscreenload()))),"/createUser"==a&&(document.getElementById("app").innerHTML=c.responseText,afteranyscreenload(),document.getElementById("setuppasswordcollapse")&&(loadUrlAjax("/newauth/header?page\x3dsetupUser\x26pendSetup\x3dtrue","app-header"),afterusersetupscreenload())),"/singleUpload"==a&&(document.getElementById("img-files-upload-btn").classList.add("active"),null!=
document.getElementById("adminImages")&&(document.getElementById("adminImages").innerHTML=c.responseText),null!=document.getElementById("initimageuploadresult")&&(document.getElementById("initimageuploadresult").innerHTML=c.responseText)))};c.open("POST",a,!0);updatescreenandwindowdims();b=new FormData(b&&0<b.length?document.forms[b]:document.forms[0]);c.withCredentials=!0;debugappui&&console.log("Posting form data");c.send(b)}
function showAuthFailureDialog(){hideAuthImage();var a=document.getElementById("app-notify-dialog");if(null==a){a=document.createElement("div");a.setAttribute("id","app-notify-dialog");document.body.appendChild(a);var b=document.createElement("div");b.classList.add("container");b.classList.add("v-center");var c=document.createElement("div");c.classList.add("row");var d=document.createElement("div");d.classList.add("col-md-8");d.classList.add("col-md-offset-2");var e=document.createElement("div");
e.classList.add("panel");e.classList.add("panel-default");var f=document.createElement("h3");f.appendChild(document.createTextNode("Could not authenticate"));f.style.color="#737373";f.style.fontWeight=600>window.innerWidth?"140":"400";e.appendChild(f);f=document.createElement("p");f.classList.add("lead");f.setAttribute("id","createuser-flake-text-header");f.appendChild(document.createTextNode("Please try again."));f.style.color="#737373";f.style.fontWeight=600>window.innerWidth?"60":"150";e.appendChild(f);
d.appendChild(e);c.appendChild(d);b.appendChild(c);a.appendChild(b)}settimeoutid=setTimeout(function(){$("#app-notify-dialog").fadeIn("fast")},100)}
function showAppTimeoutDialog(){null!=appcalltimeoutid&&clearTimeout(appcalltimeoutid);appcalltimeoutid=null;var a=document.getElementById("app-timeout-notify-dialog");if(null==a){a=document.createElement("div");a.setAttribute("id","app-timeout-notify-dialog");document.body.appendChild(a);var b=document.createElement("div");b.classList.add("container");b.classList.add("v-center");var c=document.createElement("div");c.classList.add("row");var d=document.createElement("div");d.classList.add("col-md-8");
d.classList.add("col-md-offset-2");var e=document.createElement("span");e.innerHTML="\x26times;";e.style.float="right";e.style.padding="2px 7px";e.style.fontSize="3em";e.style.top="0px";e.style.display="inline-block";e.style.color="#a2a2a2";e.style.cursor="default";e.addEventListener("mouseover",function(a){a.target.style.color="#d3d3d3"});e.addEventListener("mouseout",function(a){a.target.style.color="#a2a2a2"});e.addEventListener("click",function(){$("#createuser-flake-overlay").fadeOut(500);removediv(document.getElementById("app-timeout-notify-dialog"));
hideloadingicon()});d.appendChild(e);e=document.createElement("div");e.classList.add("panel");e.classList.add("panel-default");var f=document.createElement("h3");f.appendChild(document.createTextNode("Request did not complete in time"));f.style.color="#737373";f.style.fontWeight="150";e.appendChild(f);f=document.createElement("p");f.classList.add("lead");f.setAttribute("id","createuser-flake-text-header");f.appendChild(document.createTextNode("Please try again."));f.style.color="#737373";f.style.fontWeight=
"50";e.appendChild(f);f=document.createElement("input");f.setAttribute("id","cde-send-button");f.classList.add("btn");f.classList.add("btn-primary");f.classList.add("btn-sm");f.type="button";f.value="Try Again";f.addEventListener("click",function(){$("#app-timeout-notify-dialog").hide();removediv(a);loadWelcome()},!1);e.appendChild(f);e.appendChild(document.createElement("p"));d.appendChild(e);c.appendChild(d);b.appendChild(c);a.appendChild(b)}settimeoutid=setTimeout(function(){$("#app-timeout-notify-dialog").fadeIn("fast")},
100)}
function showImageLoadErrorDialog(){null!=appcalltimeoutid&&(console.log("clearing  appcalltimeoutid in showImageLoadErrorDialog "+appcalltimeoutid),clearTimeout(appcalltimeoutid));appcalltimeoutid=null;var a=document.getElementById("app-timeout-notify-dialog");if(null==a){a=document.createElement("div");a.setAttribute("id","app-timeout-notify-dialog");document.body.appendChild(a);var b=document.createElement("div");b.classList.add("container");b.classList.add("v-center");var c=document.createElement("div");c.classList.add("row");
var d=document.createElement("div");d.classList.add("col-md-8");d.classList.add("col-md-offset-2");var e=document.createElement("span");e.innerHTML="\x26times;";e.style.float="right";e.style.padding="2px 7px";e.style.fontSize="3em";e.style.top="0px";e.style.display="inline-block";e.style.color="#a2a2a2";e.style.cursor="default";e.addEventListener("mouseover",function(a){a.target.style.color="#d3d3d3"});e.addEventListener("mouseout",function(a){a.target.style.color="#a2a2a2"});e.addEventListener("click",
function(){$("#createuser-flake-overlay").fadeOut(500);removediv(document.getElementById("app-timeout-notify-dialog"))});d.appendChild(e);e=document.createElement("div");e.classList.add("panel");e.classList.add("panel-default");var f=document.createElement("h3");f.appendChild(document.createTextNode("Temporary error loading image"));f.style.color="#737373";f.style.fontWeight="150";e.appendChild(f);f=document.createElement("p");f.classList.add("lead");f.setAttribute("id","createuser-flake-text-header");
f.appendChild(document.createTextNode("Please try again."));f.style.color="#737373";f.style.fontWeight="50";e.appendChild(f);f=document.createElement("input");f.setAttribute("id","cde-send-button");f.classList.add("btn");f.classList.add("btn-primary");f.classList.add("btn-sm");f.type="button";f.value="Try Again";f.addEventListener("click",function(){$("#app-timeout-notify-dialog").hide();removediv(a);loadWelcome()},!1);e.appendChild(f);e.appendChild(document.createElement("p"));d.appendChild(e);c.appendChild(d);
b.appendChild(c);a.appendChild(b)}settimeoutid=setTimeout(function(){$("#app-timeout-notify-dialog").fadeIn("fast")},100)}function clearAuthFailureDialog(){showAuthImage();$("#app-notify-dialog").fadeOut("fast");clearTimeout(settimeoutid);removediv(document.getElementById("app-notify-dialog"))}function clearoverlay(a){document.getElementById(a).style.display="none";a=document.getElementById(a);removediv(a)}
function removediv(a){if(null!=a){for(;a.hasChildNodes();)a.removeChild(a.firstChild);null!=a.parentNode&&a.parentNode.removeChild(a)}}function cleardiv(a){if(null!=a)for(;a.hasChildNodes();)a.removeChild(a.firstChild)}
function loadUrlAjax(a,b){var c=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");c.onreadystatechange=function(){if(4==c.readyState&&2==Math.trunc(c.status/100)){document.getElementById(b).innerHTML="";document.getElementById(b).innerHTML=c.responseText;fadeinelement(b);"/newauth/welcome"==a&&(loadUrlAjax("/newauth/header","app-header"),afterWelcomePageLoad());a.startsWith("/newauth/orgPage")&&afteranyscreenload();"/newauth/home"==a&&(loadUrlAjax("/newauth/header?page\x3dhome",
"app-header"),afteranyscreenload(),stopSSEPolling());a.startsWith("/createUser")&&(loadUrlAjax("/newauth/header?page\x3dcreateuser","app-header"),loadPageScripts("app"),afterCreateUserPageLoad(),removealldots());a.startsWith("/newauth/authenticate")&&(null!=document.getElementById("app-header")&&(removeheaderandfooter(),removealldots()),document.querySelector(".auth-image-main-container")?(loadUrlAjax("/newauth/header?page\x3dauthenticate\x26authMessage\x3dIf%20you%20do%20not%20recognize%20the%20images,%20check%20the%20username%20you%20entered.",
"app-header"),afterauthscreenload(!1)):document.getElementById("setuppasswordcollapse")?(loadUrlAjax("/newauth/header?page\x3dsetupUser\x26pendSetup\x3dtrue","app-header"),afterusersetupscreenload()):document.getElementById("home-page-id")?(loadUrlAjax("/newauth/header?page\x3dhome","app-header"),document.getElementById("app-header").style.display="block",afteranyscreenload()):document.getElementById("secure-page-id")?(loadUrlAjax("/newauth/header?page\x3dsecurePage","app-header"),afteranyscreenload()):
document.getElementById("topic-page-id")?(loadUrlAjax("/newauth/header?page\x3dbrandPage","topic-app-header"),afteranyscreenload()):document.getElementById("app-flk")?(loadUrlAjax("/newauth/header?page\x3dflake-page","app-header"),null!=document.getElementById("flake-page-id")&&(document.getElementById("flake-page-id").style.top="65px"),afteranyscreenload()):(loadUrlAjax("/newauth/header?page\x3dpublicPage","app-header"),afterPublicPageScreenLoad()));a.startsWith("/newauth/postAuthColClickData")&&
(document.querySelector(".auth-image-main-container")&&(loadUrlAjax("/newauth/header?page\x3dauthenticate","app-header"),afterauthscreenload(!1)),document.getElementById("setuppasswordcollapse")&&(loadUrlAjax("/newauth/header?page\x3dsetupUser\x26pendSetup\x3dtrue","app-header"),afterusersetupscreenload()));"/newauth/setupUser"==a&&(loadUrlAjax("/newauth/header?page\x3dsetupUser","app-header"),afterusersetupscreenload());if(a.startsWith("/newauth/setimgpwd/")){var d=a.split("/"),e="";6<d.length&&
(e="/"+d[3]+"/"+d[4]+"/"+d[5]+"/"+d[6]+"/"+d[7]);loadUrlAjax("/newauth/imgpwdheader"+e,"app-header");afterBoxImageScreenLoad()}a.startsWith("/newauth/securePage")&&(loadUrlAjax("/newauth/header?page\x3dsecurePage","app-header"),afterSecurePageScreenLoad());a.startsWith("/newauth/publicPage")&&(loadUrlAjax("/newauth/header?page\x3dpublicPage","app-header"),afterPublicPageScreenLoad());if(a.startsWith("/newauth/header")){generateFlakeOnCanvas("hdr-flake-display-btn",flakejsonobj,60,40,"tiny",!1);var f=
document.getElementById("hdr-flake-display-btn");"undefined"!==typeof f&&null!==f&&("undefined"!=typeof flakejsonobj&&f.setAttribute("title",flakejsonobj.flake),f.addEventListener("click",function(a){var b=document.createElement("input");document.body.appendChild(b);b.setAttribute("value",loggedinuserflake);b.select();document.execCommand("copy");document.body.removeChild(b);displaybuttonbehavior(a,"Flake copied");displayflakeinmodal(f.innerHTML)},!1))}}};c.open("GET",a,!0);c.send();return!1}
function displaybuttonbehavior(a,b){var c=document.getElementById("identity-display");var d=null!=c?c.cloneNode(!0):document.createElement("div");d.setAttribute("id","buttonbehavior");d.style.position="absolute";null!=a?(d.style.top=a.target.getBoundingClientRect().top,d.style.left=a.target.getBoundingClientRect().left):(d.style.bottom=10,d.style.right=50);d.style.opacity="0.4";d.style.fontSize="14";d.style.backgroundColor="#fefefe";d.style.boxShadow="2px 3px 2px #ededed";d.style.color="#636363";
d.style.zIndex=9999;d.innerText=b;d.style.display="block";setTimeout(function(a){d.style.opacity="0.4";setTimeout(function(){removediv(d)},300)},2E3);document.body.appendChild(d);d.style.opacity=window.getComputedStyle(d).getPropertyValue("opacity");attachtransitionstyles(d);d.style.opacity="0.9";return d}
function displaypageloadingdiv(a){var b=0,c=0;a&&(c=getPositionOfanElement(a),b=c.x,c=c.y,0==b&&(b=40),0==c&&(c=40));a=document.getElementById("loading-box");if(null==a){a=document.createElement("div");a.setAttribute("id","loading-box");a.classList.add("text-center");var d=document.createElement("div");d.classList.add("text");d.classList.add("animated");d.classList.add("infinite");d.classList.add("pulse");d.appendChild(document.createTextNode("Loading"));a.appendChild(d);a.style.display="block";a.style.left=
b+"px";a.style.top=c+"px";document.body.appendChild(a)}}function removepageloadingdiv(){var a=document.getElementById("loading-box");null!=a&&removediv(a)}function afterWelcomePageLoad(){loadPageScripts("app");document.title="Newauth Welcome";stopSSEPolling()}
function afterauthscreenload(a){imagecounter=0;0==a?loadPageScripts("app"):loadPageScripts("re-auth-overlay");authimagecontainerdivelem=document.querySelector(".auth-image-main-container");authimagecontainerdivelem.style.display="table-cell";authimagecontainerdivelem.style.verticalAlign="middle";authimagecontainerdivelem.style.textAlign="center";imgs=document.querySelectorAll("img");if(null!=imgs&&0<imgs.length){for(a=0;a<imgs.length;a++)imgs[a].addEventListener("error",function(){showImageLoadErrorDialog()},
!1);for(a=0;a<imgs.length;a++)imgs[a].addEventListener("load",function(){collageimagesloaded++;collageimagesloaded==imgs.length&&(null!=appcalltimeoutid&&clearTimeout(appcalltimeoutid),appcalltimeoutid=null,removepageloadingdiv(),8<imgs.length?displayFirstImage():displayfirstimageoncanvas())},!1)}}
function afteranyscreenload(){null!=appcalltimeoutid&&clearTimeout(appcalltimeoutid);appcalltimeoutid=null;removepageloadingdiv();loadPageScripts("app");document.body.removeEventListener("click",topicdocumentclick)}function afterBoxImageScreenLoad(){restartTimer();afteranyscreenload()}function afterSecurePageScreenLoad(){afteranyscreenload();stopSSEPolling()}function afterPublicPageScreenLoad(){afteranyscreenload();document.title="Newauth - Live";publicpagelinkclicked=!1}
function loadPageScripts(a){a=document.getElementById(a).getElementsByTagName("script");for(var b=0;b<a.length;b++)eval(a[b].innerHTML)}function afterusersetupscreenload(){afteranyscreenload();stopSSEPolling()}function analyzeauthimage(a){var b=document.createElement("img");b.addEventListener("load",function(){displayauthimageanalyzer(b,a)});b.src="/image/"+a;document.getElementById("app").appendChild(b)}
function displayremoteuseronpage(a){var b=document.createElement("div");b.classList.add("circle-remote");var c=a.gridlocation.split(",")[0],d=a.gridlocation.split(",")[1];if(2<c.length){var e=c.length-2;c=parseInt(c)/Math.pow(10,e);c=parseInt(window.innerWidth*c/100)}2<d.length&&(e=d.length-2,d=parseInt(d)/Math.pow(10,e),e=document.getElementById("app").clientHeight,d=parseInt(e*d/100)+50);b.style.position="absolute";b.style.left=c+"px";b.style.top=d+"px";b.style.backgroundColor=a.color;b.style.zIndex=
"70";e=3*a.giveOut.length;var f=document.createElement("div");f.setAttribute("id",a.flake+"-circle-info");f.style.position="absolute";f.style.left=c-parseInt(e)+"px";f.style.height="20px";f.style.top=d+10+"px";f.style.opacity="0.6";f.style.color="#eaeaea";f.style.zIndex="80";f.style.display="none";f.appendChild(document.createTextNode(a.giveOut+"["+a.flake.substring(0,4)+"...]"));b.addEventListener("mouseover",function(){fadeinviajquery(a.flake+"-circle-info","fast")});b.addEventListener("mouseout",
function(){fadeoutviajquery(a.flake+"-circle-info","fast")});b.addEventListener("click",function(){showflakepageinapp(a.flake)});document.getElementById("app").appendChild(b);document.getElementById("app").appendChild(f);fadeinviajquery(a.flake+"-circle-info","fast");setTimeout(function(){fadeoutviajquery(a.flake+"-circle-info","slow")},2E3)}function fadeinviajquery(a,b){b=b||"fast";document.getElementById(a).display="block";$("#"+a).fadeIn(b)}
function fadeoutviajquery(a,b){b=b||"slow";$("#"+a).fadeOut(b)}function fadeincircleinfo(a,b){a=a.getElementsByClassName("circle-info")[0].id;document.getElementById(a).style.display="block"}function fadeoutcircleinfo(a,b){a=a.getElementsByClassName("circle-info")[0].id;document.getElementById(a).style.display="none"}
function displayauthimageanalyzer(a,b){var c=document.createElement("div");c.classList.add("modal");c.setAttribute("id","createuser-flake-overlay");c.style.backgroundColor="#ffffff";var d=document.createElement("span");d.innerHTML="\x26times;";d.style.float="right";d.style.padding="2px 7px";d.style.fontSize="3em";d.style.top="0px";d.style.display="inline-block";d.style.color="#a2a2a2";d.style.cursor="default";d.addEventListener("mouseover",function(a){a.target.style.color="#d3d3d3"});d.addEventListener("mouseout",
function(a){a.target.style.color="#a2a2a2"});d.addEventListener("click",function(){$("#createuser-flake-overlay").fadeOut(500);removediv(document.getElementById("createuser-flake-overlay"))});c.appendChild(d);d=document.createElement("div");var e=document.createElement("div"),f=document.createElement("div");f.classList.add("panel");f.style.margin="0 auto";var g=document.createElement("div");g.setAttribute("id","imganalyzercanvasdiv");var h=getnewimagesize(a);g.style.maxHeight="inherit";g.style.maxWidth=
"inherit";var k=document.createElement("canvas");h=getnewimagesize(a);k.width=h.width;k.height=h.height;g.addEventListener("click",function(c){analyzeauthimageclick(b,a,k,h,c)},!1);k.getContext("2d").drawImage(a,0,0,k.width,k.height);g.appendChild(k);f.appendChild(g);g=document.createElement("div");g.classList.add("panel");var l=document.createElement("p");l.setAttribute("id","authimganalysisclick");g.appendChild(l);l=document.createElement("p");l.setAttribute("id","authimganalysisoutput");l.classList.add("lead");
var m=document.createElement("INPUT");m.setAttribute("type","checkbox");m.setAttribute("id","plot-click-map-check");g.appendChild(m);g.appendChild(document.createTextNode(" Plot click spatter"));g.appendChild(document.createElement("br"));g.appendChild(l);e.appendChild(f);e.appendChild(g);d.appendChild(e);c.appendChild(d);document.getElementById("app").appendChild(c);$("#createuser-flake-overlay").show()}
function analyzeauthimageclick(a,b,c,d,e){d=getMousePos2(c,e);x=d.x;y=d.y;d=parseInt(Math.sqrt(100)/2);e=0;getandplotclickdatafromdb(x,y,a,c,!0,b);if(1==document.getElementById("plot-click-map-check").checked)for(b=0;b<d;b++)for(var f=0;f<d;f++){var g=x-10*b,h=x+10*b,k=y-10*f,l=y+10*f;0<=g&&g<=c.width&&0<=k&&k<=c.height&&getandplotclickdatafromdb(g,k,a,c);if(0!=b||0!=f)0<=h&&h<=c.width&&0<=l&&l<=c.height&&getandplotclickdatafromdb(h,l,a,c),0!=b&&0!=f&&(0<=g&&g<=c.width&&0<=l&&l<=c.height&&getandplotclickdatafromdb(g,
l,a,c),0<=h&&h<=c.width&&0<=k&&k<=c.height&&getandplotclickdatafromdb(h,k,a,c),e++)}}
function getandplotclickdatafromdb(a,b,c,d,e,f){c=JSON.stringify({imgID:c,delay:0,clickX:parseInt(a),clickY:parseInt(b),imgWidth:d.width,imgHeight:d.height});"undefined"!=typeof e&&1==e&&(document.getElementById("authimganalysisclick").innerText=parseInt(a)+","+parseInt(b));var g=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");g.open("POST","/newauth/api/analyzeauthimageclick",!1);g.setRequestHeader("Content-Type","application/json");g.onreadystatechange=function(){if(4==
g.readyState&&200==g.status){var c=g.responseText.split(" ")[0];drawcircleoverimage(d,a,b,4,c);if("undefined"!=typeof e&&1==e){c=g.responseText;document.getElementById("authimganalysisoutput").innerHTML="";document.getElementById("authimganalysisoutput").appendChild(document.createTextNode(c.split(" ")[0]+" "));document.getElementById("authimganalysisoutput").appendChild(document.createTextNode(c.split(" ")[1]+" "));document.getElementById("authimganalysisoutput").appendChild(document.createTextNode(c.split(" ")[2]+
" "));document.getElementById("authimganalysisoutput").appendChild(document.createTextNode(c.split(" ")[3]+" "));for(var k=c.split(" ")[4],l=c.split(" ")[7],m=0;m<k.length;m++){var n=document.createElement("a");n.addEventListener("mouseover",displayhashportiononimage.bind(this,f,d,k,m));n.appendChild(document.createTextNode(k.charAt(m)));document.getElementById("authimganalysisoutput").appendChild(n)}document.getElementById("authimganalysisoutput").appendChild(document.createTextNode(" "+c.split(" ")[5]+
" "));document.getElementById("authimganalysisoutput").appendChild(document.createTextNode(c.split(" ")[6]+" "));for(m=0;m<l.length;m++)n=document.createElement("a"),n.addEventListener("mouseover",displayhashportiononimage.bind(this,f,d,l,m)),n.appendChild(document.createTextNode(l.charAt(m))),document.getElementById("authimganalysisoutput").appendChild(n)}}};0<=parseInt(a)&&0<=parseInt(b)&&parseInt(a)<=d.width&&parseInt(b)<=d.height?g.send(c):document.getElementById("authimganalysisoutput").innerText=
""}function displayhashportiononimage(a,b,c,d){c+="";for(var e=b.width/Math.pow(2,d+1),f=b.height/Math.pow(2,d+1),g=0,h=0,k=0;k<=d;k++){if(2==c.charAt(parseInt(k))||4==c.charAt(parseInt(k)))g+=b.width/Math.pow(2,k+1);if(3==c.charAt(parseInt(k))||4==c.charAt(parseInt(k)))h+=b.height/Math.pow(2,k+1)}drawrectangleoverimage(a,b,parseInt(g),parseInt(h),parseInt(e),parseInt(f));return!1}
function displayflakeinmodal(a){var b=document.getElementById("flake-display-modal");if(null==b){b=document.createElement("div");b.classList.add("modal");b.classList.add("fade");b.setAttribute("id","flake-display-modal");var c=document.createElement("div");c.classList.add("modal-dialog");c.classList.add("modal-md");var d=document.createElement("div");d.classList.add("modal-content");var e=document.createElement("div");e.classList.add("panel");e.classList.add("text-center");var f=document.createElement("p");
f.style.color="#121212";f.classList.add("lead");f.appendChild(document.createTextNode(fullname));e.appendChild(f);var g=document.createElement("IMG");g.src="/static/icons/new-page.png";g.width="24";g.title="Display flake page";g.onclick=function(){showflakepageinapp(flakejsonobj.flake)};g.onmouseenter=function(){g.style.border="2px solid gray"};g.onmouseout=function(){g.style.border="none"};e=document.createElement("div");e.classList.add("panel");e.classList.add("text-center");e.setAttribute("id",
"flake-modal-flake-text-container");f=document.createElement("p");f.style.color="#626262";f.style.maxWidth="50%";f.style.textAlign="center";f.style.margin="0 auto";f.style.border="1px solid darkgrey";f.appendChild(document.createTextNode(loggedinuserflake));f.setAttribute("id","flake-select-text");f.addEventListener("click",flakeclickhandler);e.appendChild(f);d.appendChild(e);f=document.createElement("div");f.classList.add("panel");f.classList.add("text-center");e=document.createElement("div");e.setAttribute("id",
"flakecanvasdivmodal");f.appendChild(e);d.appendChild(f);c.appendChild(d);b.appendChild(c);document.getElementById("app").appendChild(b);null!=flakejsonobj?generateFlakeOnCanvas("flakecanvasdivmodal",flakejsonobj,300,300,"medium","false"):null!=a&&generateFlakeOnCanvas("flakecanvasdivmodal",a,300,300,"medium","false")}$("#flake-display-modal").modal("show")}
function flakeclickhandler(a){if(40<a.target.textContent.length)document.getElementById("flakecanvasdivmodal").innerHTML="",generateFlakeOnCanvas("flakecanvasdivmodal",flakejsonobj,300,300,"medium",!1);else{var b=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");b.onreadystatechange=function(){if(4==b.readyState&&200==b.status)if(null!=b.responseText&&0<b.responseText.length){flakejsonobj.fullflake=b.responseText;if(1==document.getElementById("flake-modal-flake-text-container").children.length){var a=
document.createElement("p");a.style.color="#626262";a.style.maxWidth="60%";a.style.textAlign="center";a.style.margin="0 auto";a.style.border="1px solid darkgrey";a.appendChild(document.createTextNode(flakejsonobj.fullflake));a.setAttribute("id","full-flake-select-text");a.addEventListener("click",flakeclickhandler);document.getElementById("flake-modal-flake-text-container").appendChild(document.createElement("br"));document.getElementById("flake-modal-flake-text-container").appendChild(a)}document.getElementById("flakecanvasdivmodal").innerHTML=
"";flakegeneratorintid=setInterval(function(){null!=flakejsonobj.fullflake&&genericcounter<flakejsonobj.fullflake.length-15?(document.getElementById("flakecanvasdivmodal").innerHTML="",flakejsonobj.flake=flakejsonobj.fullflake.substring(0,16+genericcounter),generateBottomPartOfFlakeOnCanvas("flakecanvasdivmodal",flakejsonobj,300,300,"medium",!1),genericcounter++):(genericcounter=0,null!=flakejsonobj.fullflake&&(flakejsonobj.flake=flakejsonobj.fullflake.substring(0,16)),clearInterval(flakegeneratorintid))},
1/(1+genericcounter)*75)}else console.log("No full flake returned by server")};b.open("POST","/newauth/api/fullflakeforuser",!1);b.withCredentials=!0;b.setRequestHeader("Content-Type","application/json");var c=JSON.stringify({flake:loggedinuserflake});b.send(c)}document.selection?(c=document.body.createTextRange(),c.moveToElementText(a.target),c.select(),a.target.style.backgroundColor="#cecece"):window.getSelection&&(c=document.createRange(),c.selectNodeContents(a.target),window.getSelection().removeAllRanges(),
window.getSelection().addRange(c),a.target.style.backgroundColor="#cecece");try{var d=document.execCommand("copy")?"successful":"unsuccessful";debugappui&&console.log("Copying text command was "+d);window.getSelection?window.getSelection().removeAllRanges():document.selection&&document.selection.empty()}catch(e){debugappui&&console.log("Oops, unable to copy")}"full-flake-select-text"==a.target.id&&(document.getElementById("flake-select-text").style.backgroundColor="#ffffff");"flake-select-text"==
a.target.id&&null!=document.getElementById("full-flake-select-text")&&(document.getElementById("full-flake-select-text").style.backgroundColor="#ffffff")}function loadCreateUserPage(a){removehighlights();fadeoutelement("app");"undefined"!=typeof a?loadUrlAjax("/createUser?ref\x3d"+a,"app"):loadUrlAjax("/createUser","app");document.title="Newauth - Create User";return!1}
function fadeoutelement(a){document.getElementById(a).classList.toggle("show-na",!1);document.getElementById(a).classList.toggle("hide-na",!0);displayloadingicon()}function fadeinelement(a){null!=document.getElementById(a)&&("none"==document.getElementById(a).style.display&&(document.getElementById(a).style.display="block"),document.getElementById(a).classList.toggle("hide-na",!1),document.getElementById(a).classList.toggle("show-na",!0))}
function announceapptimeouterror(){showAppTimeoutDialog()}function displayloadingicon(){var a=document.getElementById("displayloadingcontainer");null!=a&&(a.style.display="inline-block",a.style.opacity="1",null==appcalltimeoutid&&(appcalltimeoutid=setTimeout(announceapptimeouterror,apptimeoutduration)),console.log("setting  appcalltimeoutid in displayloadingicon "+appcalltimeoutid))}
function hideloadingicon(){var a=document.getElementById("displayloadingcontainer");null!=a&&(a.style.display="none",fadeinelement("app"),null!=appcalltimeoutid&&(console.log("clearing  appcalltimeoutid in hideloadingicon "+appcalltimeoutid),clearTimeout(appcalltimeoutid)),appcalltimeoutid=null)}function loaddisabledcreatemessage(a){mobileusercreate(a);return!1}
function fadeIn(a,b){a.style.opacity=0;a.style.display=b||"block";(function d(){var b=parseFloat(a.style.opacity);1<(b+=.1)||(a.style.opacity=b,requestAnimationFrame(d))})()}var waitForFinalResizeEvent=function(){var a={};return function(b,c,d){d||(d="Don't call this twice without a uniqueId");a[d]&&clearTimeout(a[d]);a[d]=setTimeout(b,c)}}();
function authenticate(a,b){removehighlights();fadeoutelement("app");loadUrlAjax("/newauth/authenticate/"+a+"/"+window.screen.availWidth+"/"+window.screen.availHeight+"/"+window.innerWidth+"/"+window.innerHeight,"app");return!1}
function showwelcomepage(){fadeoutelement("app");removeactivitylisteners();for(var a=document.getElementById("re-auth-overlay");a.hasChildNodes();)a.removeChild(a.firstChild);a.style.display="none";loadUrlAjax("/newauth/welcome","app");document.title="Newauth Home";return!1}function setupUser(a){fadeoutelement("app");loadUrlAjax("/newauth/setupUser","app");document.title="Newauth - Setup User";return!1}
function showPrivateDataPage(a){document.getElementById("securePage").classList.contains("disabled")||(fadeoutelement("app"),loadUrlAjax("/newauth/securePage","app"),fadeinelement("app"),document.title="Newauth - Vault");return!1}function showOrgPage(a,b){fadeoutelement("app");loadOrgPage(a,b);document.title="Newauth - Org";return!1}
function showPublicPage(a){document.getElementById("publicPage").classList.contains("disabled")||(fadeoutelement("app"),loadUrlAjax("/newauth/publicPage","app"),document.title="Newauth - Live");return!1}function showBrandPage(a,b){document.getElementById("brandPage").classList.contains("disabled")||(fadeoutelement("app"),showurloverapp("/t/"+b),document.title=b+" At Newauth");return!1}
function logOut(){fadeoutelement("app");var a=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");a.onreadystatechange=function(){4==a.readyState&&200==a.status&&loadWelcome()};a.open("POST","/newauth/logout",!0);a.withCredentials=!0;a.setRequestHeader("Content-Type","application/json");var b=JSON.stringify({flake:loggedinuserflake});a.send(b);return!1}
function burnFlake(){var a=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");removeInfoFromClipboard();a.onreadystatechange=function(){4==a.readyState&&200==a.status&&loadWelcome()};a.open("POST","/newauth/burnflake",!1);a.withCredentials=!0;a.setRequestHeader("Content-Type","application/json");var b=JSON.stringify({flake:loggedinuserflake});a.send(b);return!1}
function removeInfoFromClipboard(){var a=document.createElement("input");document.body.appendChild(a);a.setAttribute("value","NOPASSWORDSHERE");a.select();document.execCommand("copy");document.body.removeChild(a);console.log("Cleared data from Clipboard")}function copytexttocbandhighlight(a,b,c){var d=document.createElement("input");document.body.appendChild(d);d.setAttribute("value",a);d.select();document.execCommand("copy");document.body.removeChild(d);displaybuttonbehavior(c,b)}
function loadHome(){document.getElementById("home").classList.contains("disabled")||(fadeoutelement("app"),loadUrlAjax("/newauth/home","app"),document.title="Newauth - Home");return!1}function loadWelcome(){fadeoutelement("app");window.location.assign("/");document.title="Newauth";return!1}
function convertusernametohash(){var a=document.forms[0].username.value,b=hashUserForAuthentication(a);vaultkey=a;null!=document.forms[0].elements.namedItem("usernameclear")&&(document.forms[0].usernameclear.value=a);document.forms[0].username.value=b}
function submitcreatewithuserhash(){if((null==document.getElementById("usernameprovided").value||0==document.getElementById("usernameprovided").value.length)&&!confirm('Please confirm the username  "'+document.getElementById("usernameinput").value+'"  . Newauth Username is supposed to be only known to you. Newauth does not store it in clear.  If you need to make a note of your username, do so now. Click OK to continue.'))return!1;console.log("updating screen dims");updatescreenandwindowdims();document.getElementById("createuserbtn").disabled=
!0;document.title="Newauth - Create User";submitFormAjax("/createUser","create-user-form");return!1}function populateUserKeyPair(){var a=sjcl.ecc.elGamal.generateKeys(384),b=a.pub.get();a=a.sec.get();publickeyb64=b=sjcl.codec.base64.fromBits(b.x.concat(b.y));document.forms["create-user-form"].publicKey.value=publickeyb64;privatekeyb64=a=sjcl.codec.base64.fromBits(a);document.forms[0]&&document.forms[0].publicKey&&(document.forms[0].publicKey.value=b,document.forms[0].encprivatekey.value="")}
function getEncMessageUsingPublickey(a,b){b=new sjcl.ecc.elGamal.publicKey(sjcl.ecc.curves.c384,sjcl.codec.base64.toBits(b));return sjcl.encrypt(b,a)}function getDecMessageUsingPrivateKey(a,b,c){b=sjcl.decrypt(c,b);b=new sjcl.ecc.elGamal.secretKey(sjcl.ecc.curves.c384,sjcl.ecc.curves.c384.field.fromBits(sjcl.codec.base64.toBits(b)));return sjcl.decrypt(b,a)}function loadExtUrl(a,b,c){a.startsWith("http")||(a="http://"+a);var d=window.open(a,"_blank");d.onload=function(){d.focus()}}
function submitwithuserhash(){clearInterval(imgcheckinterval);if(6>document.forms[0].username.value.length){var a=document.getElementById("username");a.placeholder="Enter Username (min 6 letters)";a.style.border="2px solid red";setTimeout(function(){a.placeholder="User name";a.style.border="1px solid #aeaeae"},3E3);return!1}a=document.getElementById("login-button");null!=a&&(a.style.transform="scale(1.3)",a.style.opacity=1);fadeoutelement("app");convertusernametohash();document.title="Newauth - Authenticate";
submitFormAjax("/newauth/authenticate");return!1}function removehighlights(){for(var a=document.getElementsByClassName("highlight-text"),b=0;b<a.length;b++)a[b].style.display="none"}
function afterCreateUserPageLoad(){null!=appcalltimeoutid&&clearTimeout(appcalltimeoutid);appcalltimeoutid=null;$('input[name\x3d"usertypeinputradio"]').change(function(){$(this).is(":checked")&&1==$(this).val()&&$("#brandModal").modal("show")});document.getElementById("na-item-amount").innerText="$"+computeSubPrice(1);document.getElementById("bus-subs-user-count-input").addEventListener("input",function(){if(0==document.getElementById("bus-subs-user-count-input").value.length)document.getElementById("bus-user-count").innerText=
1,document.getElementById("bus-sub-chg-amt").innerText=computeSubPrice(1);else try{var a=parseInt(document.getElementById("bus-subs-user-count-input").value);document.getElementById("bus-user-count").innerText=a;document.getElementById("bus-sub-chg-amt").innerText=computeSubPrice(a)}catch(b){document.getElementById("bus-subs-user-count-input").style.border="2px solid red",setTimeout(function(){document.getElementById("bus-subs-user-count-input").style.border="2px solid gray"},3E3)}});document.getElementById("bus-vault-chk").addEventListener("change",
function(){document.getElementById("bus-vault-chk").checked="true";return!1});document.getElementById("app-topic-page-chk").addEventListener("change",function(){if(0==document.getElementById("bus-subs-user-count-input").value.length)document.getElementById("bus-user-count").innerText=1,document.getElementById("bus-sub-chg-amt").innerText=computeSubPrice(1);else{var a=parseInt(document.getElementById("bus-subs-user-count-input").value);document.getElementById("bus-user-count").innerText=a;document.getElementById("bus-sub-chg-amt").innerText=
computeSubPrice(a)}});document.getElementById("bus-newauth-identity-chk").addEventListener("change",function(){if(0==document.getElementById("bus-subs-user-count-input").value.length)document.getElementById("bus-user-count").innerText=1,document.getElementById("bus-sub-chg-amt").innerText=computeSubPrice(1);else{var a=parseInt(document.getElementById("bus-subs-user-count-input").value);document.getElementById("bus-user-count").innerText=a;document.getElementById("bus-sub-chg-amt").innerText=computeSubPrice(a)}});
document.getElementById("bus-newauth-pers-img-chk").addEventListener("change",function(){if(0==document.getElementById("bus-subs-user-count-input").value.length)document.getElementById("bus-user-count").innerText=1,document.getElementById("bus-sub-chg-amt").innerText=computeSubPrice(1);else{var a=parseInt(document.getElementById("bus-subs-user-count-input").value);document.getElementById("bus-user-count").innerText=a;document.getElementById("bus-sub-chg-amt").innerText=computeSubPrice(a)}});document.getElementById("bus-newauth-brand-img-chk").addEventListener("change",
function(){if(0==document.getElementById("bus-subs-user-count-input").value.length)document.getElementById("bus-user-count").innerText=1,document.getElementById("bus-sub-chg-amt").innerText=computeSubPrice(1);else{var a=parseInt(document.getElementById("bus-subs-user-count-input").value);document.getElementById("bus-user-count").innerText=a;document.getElementById("bus-sub-chg-amt").innerText=computeSubPrice(a)}});document.getElementById("bus-newauth-export-data-chk").addEventListener("change",function(){if(0==
document.getElementById("bus-subs-user-count-input").value.length)document.getElementById("bus-user-count").innerText=1,document.getElementById("bus-sub-chg-amt").innerText=computeSubPrice(1);else{var a=parseInt(document.getElementById("bus-subs-user-count-input").value);document.getElementById("bus-user-count").innerText=a;document.getElementById("bus-sub-chg-amt").innerText=computeSubPrice(a)}})}
function computeSubPrice(a){var b=document.getElementById("bus-newauth-identity-chk").checked,c=document.getElementById("app-topic-page-chk").checked,d=document.getElementById("bus-newauth-pers-img-chk").checked,e=document.getElementById("bus-newauth-brand-img-chk").checked,f=document.getElementById("bus-newauth-export-data-chk").checked,g=0,h=0,k=0,l=0,m=0;b&&(g=100+36*a);d&&(k=20*a);c&&(h=10*a);e&&(l=1E3);f&&(m=100);console.log("apptopic "+c+"naidentity "+b+" napersimage "+d+" nabrandimage "+e+
" nadataexport "+f);a=parseInt(79*a+h+g+k+l+m);document.getElementById("na-item-amount").innerText="$"+a;return a}
function createUserFlakeOverlay(a){var b=document.getElementById("createuser-flake-overlay");if(null==b){b=document.createElement("div");b.setAttribute("id","createuser-flake-overlay");document.body.appendChild(b);var c=document.createElement("div");c.classList.add("container");c.classList.add("v-center");var d=document.createElement("div");d.classList.add("row");var e=document.createElement("div");e.classList.add("col-md-8");e.classList.add("col-md-offset-2");var f=document.createElement("div");
f.classList.add("panel");f.classList.add("panel-default");f.setAttribute("id","createuser-overlay-content");var g=document.createElement("h3");g.appendChild(document.createTextNode(""));g.style.color="#737373";g.style.fontWeight="900";f.appendChild(g);g=document.createElement("span");g.innerHTML="\x26times;";g.style.float="right";g.style.padding="2px 7px";g.style.fontSize="3em";g.style.top="0px";g.style.display="inline-block";g.style.color="#a2a2a2";g.style.cursor="default";g.addEventListener("mouseover",
function(a){a.target.style.color="#d3d3d3"});g.addEventListener("mouseout",function(a){a.target.style.color="#a2a2a2"});g.addEventListener("click",function(){$("#createuser-flake-overlay").fadeOut(500);removediv(document.getElementById("createuser-flake-overlay"));loadWelcome()});e.appendChild(g);g=document.createElement("p");g.classList.add("lead");g.setAttribute("id","createuser-flake-text-header");g.appendChild(document.createTextNode("Please enter the Flake you received in your invitation."));
g.style.color="#737373";g.style.fontWeight="700";f.appendChild(g);g=document.createElement("div");g.classList.add("row");var h=document.createElement("div");h.classList.add("col-sm-8");h.classList.add("col-sm-offset-2");var k=document.createElement("p");k.classList.add("text-muted");k.setAttribute("id","createuser-flake-text");k.appendChild(document.createTextNode("Currently, Newauth membership is by invitation only. Your invitation contains a token called flake. Please enter it below. A flake can also be found on the Welcome page after the web extension install."));
k.style.color="#878787";k.style.fontWeight="600";var l=document.createElement("p");l.classList.add("text-muted");l.setAttribute("id","createuser-flake-text");l.appendChild(document.createTextNode("If you do not have a flake, please enter your email address to be added to the wait list."));l.style.color="#878787";l.style.fontWeight="500";h.appendChild(k);0<a.length&&"true"==a&&h.appendChild(l);g.appendChild(h);f.appendChild(g);a=document.createElement("div");a.classList.add("row");a.classList.add("text-center");
g=document.createElement("div");g.setAttribute("id","cu-flake-can");a.appendChild(g);f.appendChild(a);a=document.createElement("div");a.classList.add("panel-body");a.classList.add("panel-word-wrap");g=document.createElement("div");g.classList.add("row");h=document.createElement("div");h.classList.add("col-sm-8");h.classList.add("col-sm-offset-2");h.setAttribute("id","create-flk-input-holder");g.appendChild(h);a.appendChild(g);k=document.createElement("input");k.setAttribute("type","text");k.setAttribute("id",
"cu-flake-input");k.setAttribute("autofocus","true");k.classList.add("form-control");k.classList.add("input-md");k.addEventListener("input",function(){var a=document.getElementById("cu-flake-can");cleardiv(a);a=document.getElementById("cu-flake-input").value;generateFlakeOnCanvas("cu-flake-can",a,64,64,"tiny");8==a.length||16==a.length||17==a.length?$("#flk-send-button").fadeIn("slow"):document.getElementById("flk-send-button").style.display="none";0<a.indexOf("@")&&(document.getElementById("flk-send-button").value=
"Get Invite",document.getElementById("cu-flake-can").style.display="none",$("#flk-send-button").fadeIn("slow"))},!1);k.style.color="#646464";l=document.createElement("input");l.setAttribute("id","flk-send-button");l.classList.add("btn");l.classList.add("btn-primary");l.classList.add("btn-md");l.conversationID="";l.changestarttime="";l.type="button";l.value="Validate";l.style.display="none";l.addEventListener("click",validatecreateuserflake,!1);var m=document.createElement("div");m.classList.add("col-sm-2");
g.appendChild(m);h.appendChild(k);m.appendChild(l);a.appendChild(g);f.appendChild(a);e.appendChild(f);d.appendChild(e);c.appendChild(d);b.appendChild(c);generateFlakeOnCanvas("cu-flake-can",null,64,64,"tiny");$("#cu-flake-input").focus()}settimeoutid=setTimeout(function(){$("#createuser-flake-overlay").fadeIn("slow")},500)}
function validatecreateuserflake(){document.getElementById("cu-flake-input").style.borderColor="default";var a=document.getElementById("cu-flake-input").value;if(null==a||0==a.length)return!1;var b=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");b.onreadystatechange=function(){if(4==b.readyState&&200==b.status){var c=JSON.parse(b.responseText);if("VALID"==c.status.statuscode)document.forms["create-user-form"].refflake.value=document.getElementById("cu-flake-input").value,
$("#createuser-flake-overlay").fadeOut(500),removediv(document.getElementById("createuser-flake-overlay"));else if("EMAIL-SENT"==c.status.statuscode){c=document.getElementById("createuser-overlay-content");cleardiv(c);var e=document.createElement("h4");e.appendChild(document.createTextNode("An invite has been sent to "+a+". Please check and follow the instructions there."));e.style.color="#737373";e.style.fontWeight="200";c.appendChild(e);e=document.createElement("h5");e.appendChild(document.createTextNode("If you do not find an email from Newauth in your Inbox, please check your Spam folder."));
e.style.color="#929292";e.style.fontWeight="120";c.appendChild(e)}else document.getElementById("cu-flake-input").style.borderWidth="2px",document.getElementById("cu-flake-input").style.borderColor="red"}};b.open("POST","/newauth/api/validateFlake",!1);b.withCredentials=!0;b.setRequestHeader("Content-Type","application/json");var c=JSON.stringify({flake:a});b.send(c)}
function hashUserForAuthentication(a){var b=sjcl.codec.base64.toBits("sugar"),c=sjcl.misc.pbkdf2(a,b,1E3,256);c=sjcl.codec.base64.fromBits(c);sjcl.codec.base64.fromBits(b);debugappui&&console.log(a+" "+c);return c}function displayImage(a){location.href="/newauth/display/image/"+a+"/"+window.screen.availWidth+"/"+window.screen.availHeight+"/"+window.innerWidth+"/"+window.innerHeight;return!1}
function displayImageStat(a,b){var c=document.getElementById("img-stat-overlay");console.log("in displayImageStat overlay is null  -- id seq"+a+" "+b);c=document.createElement("div");c.setAttribute("id","img-stat-overlay");document.getElementById("app").appendChild(c);a=document.createElement("div");a.classList.add("container");var d=document.createElement("div");d.classList.add("row");var e=document.createElement("div");e.classList.add("col-md-6");e.classList.add("col-md-offset-3");var f=document.createElement("span");
f.innerHTML="\x26times;";f.style.float="right";f.style.padding="2px 7px";f.style.fontSize="3em";f.style.top="0px";f.style.display="inline-block";f.style.color="#a2a2a2";f.style.cursor="default";f.addEventListener("mouseover",function(a){a.target.style.color="#d3d3d3"});f.addEventListener("mouseout",function(a){a.target.style.color="#a2a2a2"});f.addEventListener("click",function(){$("#img-stat-overlay").fadeOut(500);removediv(document.getElementById("img-stat-overlay"))});e.appendChild(f);f=document.createElement("div");
f.classList.add("panel");f.classList.add("panel-default");var g=document.createElement("p");g.classList.add("lead");g.setAttribute("id","createuser-flake-text-header");g.appendChild(document.createTextNode("Image "+b));g.style.color="#737373";g.style.fontWeight="50";f.appendChild(g);g=document.createElement("p");g.classList.add("lead");g.setAttribute("id","image-user-count");g.appendChild(document.createTextNode("---"));g.style.color="#737373";g.style.fontWeight="60";f.appendChild(g);g=document.createElement("p");
g.setAttribute("id","image-sizes");g.appendChild(document.createTextNode("---"));g.style.color="#737373";g.style.fontWeight="60";f.appendChild(g);g=document.createElement("div");g.classList.add("row");var h=document.createElement("div");h.classList.add("col-md-12");g.appendChild(h);var k=document.createElement("div");h.appendChild(k);f.appendChild(g);k.innerHTML='\x3cform method\x3d"POST" enctype\x3d"multipart/form-data" name\x3d"admimagesoverwriteform" class\x3d"form-horizontal"\x3e\t\t\t\t\t           \x3cdiv class\x3d"form-group"\x3e\t\t\t           \t\t\x3cdiv class\x3d"col-md-12"\x3e\t\t\t\t\t            \x3cdiv class\x3d"input-group"\x3e\t\t\t\t\t                \x3clabel class\x3d"input-group-btn"\x3e\t\t\t\t\t                    \x3cspan class\x3d"btn btn-primary"\x3e\t\t\t\t\t                        Browse\x26hellip; \x3cinput type\x3d"file" name\x3d"files" id\x3d"files-input-overwrite" accept\x3d"image/*" style\x3d"display: none;"\x3e\t\t\t\t\t                    \x3c/span\x3e\t\t\t\t\t                \x3c/label\x3e\t\t\t\t\t                \x3cinput type\x3d"text" class\x3d"form-control" id\x3d"file-select-feedback-overwrite" readonly\x3e\t\t\t\t\t            \x3c/div\x3e\t\t\t\t            \x3c/div\x3e\t\t\t            \x3c/div\x3e\t\t\t            \x3cdiv class\x3d"form-group"\x3e\t                        \x3cdiv class\x3d"has-error"\x3e\t                            \x3cform:errors path\x3d"url" class\x3d"help-inline"/\x3e\t                        \x3c/div\x3e\t\t\t\t\t   \x3c/div\x3e\t\t\t           \x3cdiv class\x3d"row"\x3e\t\t\t            \t\x3cdiv class\x3d"col-md-12"\x3e\t\t\t\t                \x3cdiv class\x3d"floatRight"\x3e\t\t\t\t                    \x3cinput type\x3d"submit" value\x3d"Change"   class\x3d"btn btn-primary btn-sm" disabled id\x3d"img-files-upload-btn-overwrite"\x3e\t\t\t\t                \x3c/div\x3e\t\t\t                \x3c/div\x3e\t\t\t            \x3c/div\x3e\t\t\t        \x3c/form\x3e';
e.appendChild(f);d.appendChild(e);a.appendChild(d);c.appendChild(a);document.getElementById("files-input-overwrite").addEventListener("change",function(a){document.getElementById("img-files-upload-btn-overwrite").disabled=!1},!1);document.getElementById("img-files-upload-btn-overwrite").onclick=function(){return overloadimage("admimagesoverwriteform",b)};loadimageusercount(b,"image-user-count");loadimagesizes(b,"image-sizes");setTimeout(function(){$("#img-stat-overlay").fadeIn("slow")},200);return!1}
function loadimageusercount(a,b){var c=new XMLHttpRequest;c.open("GET","/newauth/api/getimageuserscount/"+a,!1);c.setRequestHeader("Content-Type","application/json");c.onreadystatechange=function(){if(4==c.readyState&&200==c.status){var a=c.responseText;document.getElementById(b).innerHTML=a+" users"}};c.send(null)}
function loadimagesizes(a,b){var c=new XMLHttpRequest;c.open("GET","/newauth/api/getimagesizes/"+a,!1);c.setRequestHeader("Content-Type","application/json");c.onreadystatechange=function(){if(4==c.readyState&&200==c.status){var a=c.responseText;document.getElementById(b).innerHTML=a}};c.send(null)}
function selectSegmentOnImage(a){a="/newauth/setimgpwd/"+window.screen.availWidth+"/"+window.screen.availHeight+"/"+window.innerWidth+"/"+document.getElementById("app").clientHeight+"/"+a;document.title="Newauth - Box Images";loadUrlAjax(a,"app");return!1}
function boxNextImage(a){clearAllBoxImageCanvas();a="/newauth/setimgpwd/"+window.screen.availWidth+"/"+window.screen.availHeight+"/"+window.innerWidth+"/"+document.getElementById("app").clientHeight+"/"+a;document.title="Newauth - Box Images";loadUrlAjax(a,"app");return!1}function debounce(a,b,c){var d;console.log("in debounce");return function(){var e=this,f=arguments,g=c&&!d;clearTimeout(d);d=setTimeout(function(){d=null;c||a.apply(e,f)},b);g&&a.apply(e,f)}}var stompClient=null;
function setConnected(a){$("#connect").prop("disabled",a);$("#disconnect").prop("disabled",!a);a?$("#conversation").show():$("#conversation").hide();$("#greetings").html("")}
function checkUserName(){debugappui&&console.log("In checkUserName");document.getElementById("usernamedisplay").innerHTML="";document.getElementById("privkey").innerHTML="";document.getElementById("privkeycheck").style.display="none";var a=document.getElementById("usernameinput").value;if(6>a.length)return document.getElementsByClassName("has-error")[0].innerHTML="The username  has to be atleast 6 characters long.",document.getElementById("usernameinput").focus(),setTimeout(clearUserNameErrorDiv,
4E3),$("#usernamecollapse").on("hidden.bs.collapse",allowusernamedivtocollapse),$("#usernamecollapse").on("shown.bs.collapse",allowusernamedivtocollapse),!1;var b=new XMLHttpRequest;b.open("POST","/newauth/api/oktocreateusername",!1);b.setRequestHeader("Content-Type","application/json");b.onreadystatechange=function(){if(4==b.readyState&&200==b.status){var a=b.responseText;null!=a&&0<a.length&&handleUsernamecheck(a)}};b.send(JSON.stringify({username:hashUserForAuthentication(a),clientip:""}))}
function allowusernamedivtocollapse(){username=document.getElementById("usernameinput").value;6>username.length&&$("#usernamecollapse").collapse("show");6<username.length&&(debugappui&&console.log("in condition \x3e 6"),$("#usernamecollapse").collapse("hide"),$("#usernamecollapse").off("shown.bs.collapse",allowusernamedivtocollapse),$("#usernamecollapse").off("hidden.bs.collapse",allowusernamedivtocollapse))}
function closePrivacySettingsBeforeSetup(){6>document.getElementById("numboxed").value?$("#privacysettingcollapse").collapse("hide"):(debugappui&&console.log("in condition \x3e 6"),$("#privacysettingcollapse").collapse("show"),$("#privacysettingcollapse").off("shown.bs.collapse",closePrivacySettingsBeforeSetup),$("#privacysettingcollapse").off("hidden.bs.collapse",closePrivacySettingsBeforeSetup))}function clearUserNameErrorDiv(){document.getElementsByClassName("has-error")[0].innerHTML=""}
function clearAliasErrorDiv(){document.getElementsByClassName("has-error")[1].innerHTML=""}function clearErrorDiv(a){document.getElementById(a).innerHTML=""}
function handleusertypedone(a){document.getElementById("usertypecheck").style.display="inline";a=document.getElementsByName("usertypeinputradio");for(var b,c=0;c<a.length;c++)"radio"==a[c].type&&a[c].checked&&(b=a[c].value);document.forms["create-user-form"].type.value=b;if("1"==b){b=document.getElementById("brandsignedup").value;console.log("signedup "+b);if("0"==b)return alert("Please Complete Subscription or Select Personal Account"),a[0].checked="checked",!1;document.getElementById("brandnamefielddisclosure").classList.remove("hidden");
a=document.getElementsByName("giveoutinputradio");a[0].disabled=!0;a[1].checked="checked";a[2].disabled=!0}document.getElementById("giveoutdiv").style.visibility="visible"}function showtopicsetupmodal(){$("#topic-setup-modal").modal("show")}
function processTopicSettingsChange(a){var b=!1;var c=document.getElementById("commentsettingsselect").value;var d=document.getElementById("storagesettingsselect").value;var e=document.getElementById("postsettingsselect").value;document.getElementById("topicprivatecheckbox").checked&&(b=!0);var f=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");f.onreadystatechange=function(){4==f.readyState&&200==f.status&&$("#topic-setup-modal").modal("hide")};f.open("POST","/newauth/api/updatetopicsetting",
!1);f.withCredentials=!0;f.setRequestHeader("Content-Type","application/json");a=JSON.stringify({topic:a,comments:c,posts:e,storage:d,maxdepth:document.getElementById("topicmaxdepthinput").value,topicprivate:b});f.send(a)}
function processFlakeSettingsChange(a){for(var b,c=!1,d=document.getElementsByName("flakemessageinputradio"),e=0;e<d.length;e++)"radio"==d[e].type&&d[e].checked&&(b=d[e].value);"quiet"==b&&(c=!0);b=document.getElementById("chatgroupsize").value;d=document.getElementById("flakelife").value;"Until compromised"==d&&(d=-1);var f=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");f.onreadystatechange=function(){4==f.readyState&&200==f.status&&$("#flake-setup-modal").modal("hide")};
f.open("POST","/newauth/api/updateflakesetting",!1);f.withCredentials=!0;f.setRequestHeader("Content-Type","application/json");a=JSON.stringify({flake:a,chatgroupsize:b,flakelife:d,qiet:c});f.send(a)}
function handlegiveoutdone(){document.getElementById("giveoutcheck").style.display="inline";for(var a=document.getElementsByName("giveoutinputradio"),b,c=0;c<a.length;c++)"radio"==a[c].type&&a[c].checked&&(b=a[c].value);document.forms["create-user-form"].giveOut.value=b;null==document.getElementById("usernameprovided").value||0==document.getElementById("usernameprovided").value.length?showusernamecaveatscreen():(document.getElementById("createuserbtn").value="Update newauth Account",document.getElementById("msgbeforesubmit").innerText=
"You are nearly done",document.getElementById("usernameinput").style.display="none",document.getElementById("usernamediv").style.visibility="visible",null!=document.getElementById("usernamepaneltitle")&&(document.getElementById("usernamepaneltitle").innerText+=" - selected"),document.forms["create-user-form"].username.value=document.getElementById("usernameprovided").value,document.getElementById("usernamedisplay").innerHTML="\x3cp\x3eYou have already selected a username. It is the same one you typed in the username box earlier.\x3c/p\x3e\x3cp\x3eNewauth stores your username as: \x3c/p\x3e\x3cp\x3e"+
document.getElementById("usernameprovided").value+"\x3c/p\x3e",populateUserKeyPair(),document.getElementById("usernamecheck").style.display="inline",document.getElementById("checkusernamebutton").style.display="none",$("#usernamecollapse").collapse("show"),$("#usernamecollapse").off("shown.bs.collapse",allowusernamedivtocollapse),$("#usernamecollapse").off("hidden.bs.collapse",allowusernamedivtocollapse),setTimeout(function(){$("#usernamecollapse").collapse("hide");document.getElementById("other-identification").style.visibility=
"visible"},4E3))}
function showusernamecaveatscreen(){var a=document.getElementById("createuser-flake-overlay");if(null==a){a=document.createElement("div");a.setAttribute("id","createuser-flake-overlay");document.body.appendChild(a);var b=document.createElement("div");b.classList.add("container");b.classList.add("v-center");var c=document.createElement("div");c.classList.add("row");var d=document.createElement("div");d.classList.add("col-md-8");d.classList.add("col-md-offset-2");var e=document.createElement("div");e.classList.add("panel");
e.classList.add("panel-default");e.setAttribute("id","createuser-overlay-content");var f=document.createElement("h3");f.appendChild(document.createTextNode(""));f.style.color="#737373";f.style.fontWeight="900";e.appendChild(f);f=document.createElement("span");f.innerHTML="\x26times;";f.style.float="right";f.style.padding="2px 7px";f.style.fontSize="3em";f.style.top="0px";f.style.display="inline-block";f.style.color="#a2a2a2";f.style.cursor="default";f.addEventListener("mouseover",function(a){a.target.style.color=
"#d3d3d3"});f.addEventListener("mouseout",function(a){a.target.style.color="#a2a2a2"});f.addEventListener("click",function(){$("#createuser-flake-overlay").fadeOut(500);removediv(document.getElementById("createuser-flake-overlay"))});d.appendChild(f);f=document.createElement("p");f.classList.add("lead");f.setAttribute("id","createuser-flake-text-header");f.appendChild(document.createTextNode("Important: Your username in Newauth is secret."));f.style.color="#737373";f.style.fontWeight="700";e.appendChild(f);
f=document.createElement("div");f.classList.add("row");var g=document.createElement("div");g.classList.add("col-sm-8");g.classList.add("col-sm-offset-2");var h=document.createElement("p");h.classList.add("text-muted");h.setAttribute("id","createuser-flake-text");h.appendChild(document.createTextNode("Treat this username as you would treat a password in another system. Do NOT use one of your common usernames here."));h.style.color="#878787";h.style.fontWeight="600";var k=document.createElement("p");
k.classList.add("text-muted");k.setAttribute("id","createuser-flake-text");k.appendChild(document.createTextNode("You will use this username to access Newauth. It is also used as a key to your vault. You can change your vault key later. If you choose your username carefully here, you can avoid having to remember two secrets."));k.style.color="#878787";k.style.fontWeight="500";g.appendChild(h);g.appendChild(k);f.appendChild(g);e.appendChild(f);f=document.createElement("div");f.classList.add("row");
f.classList.add("text-center");g=document.createElement("div");g.setAttribute("id","cu-flake-can");f.appendChild(g);e.appendChild(f);f=document.createElement("div");f.classList.add("panel-body");f.classList.add("panel-word-wrap");g=document.createElement("div");g.classList.add("row");h=document.createElement("div");h.classList.add("col-sm-8");h.classList.add("col-sm-offset-2");h.setAttribute("id","create-flk-input-holder");g.appendChild(h);f.appendChild(g);h=document.createElement("input");h.setAttribute("id",
"flk-send-button");h.classList.add("btn");h.classList.add("btn-primary");h.classList.add("btn-md");h.conversationID="";h.changestarttime="";h.type="button";h.value="Got it";h.style.display="block";h.addEventListener("click",function(){$("#createuser-flake-overlay").fadeOut(500);removediv(document.getElementById("createuser-flake-overlay"));document.getElementById("usernamediv").style.visibility="visible"},!1);k=document.createElement("div");k.classList.add("col-sm-2");g.appendChild(k);k.appendChild(h);
f.appendChild(g);e.appendChild(f);d.appendChild(e);c.appendChild(d);b.appendChild(c);a.appendChild(b)}settimeoutid=setTimeout(function(){$("#createuser-flake-overlay").fadeIn("slow")},500)}
function handleUsernamecheck(a){if("DONOTCREATE"==a)return document.getElementById("create-username-has-error").innerHTML="The username  "+document.getElementById("usernameinput").value+"  is already taken. Please select another username.",document.getElementById("usernameinput").value="",document.getElementById("usernameinput").focus(),$("#usernamecollapse").on("hidden.bs.collapse",allowusernamedivtocollapse),$("#usernamecollapse").on("shown.bs.collapse",allowusernamedivtocollapse),setTimeout("clearUserNameErrorDiv()",
4E3),!1;populateUserKeyPair();document.getElementById("pubkey").innerHTML=publickeyb64;a=document.getElementById("usernameinput").value;encprivkey=encryptdatawithstretchedkey(privatekeyb64,a,"",0);document.getElementById("privkey").innerHTML="Original Value: "+privatekeyb64+"\x3cbr\x3e\x3cbr\x3eEncrypted Value: "+JSON.parse(encprivkey).ct;document.getElementById("privkeycheck").style.display="inline";document.forms["create-user-form"].encprivatekey.value=encprivkey;a=hashUserForAuthentication(document.getElementById("usernameinput").value);
document.forms["create-user-form"].username.value=a;document.getElementById("usernamedisplay").innerHTML="Newauth stores this as: \x3cp\x3e"+a+"\x3c/p\x3e";document.getElementById("usernamecheck").style.display="inline";document.getElementById("other-identification").style.visibility="visible"}
function handleOtherIdInput(){var a=otherIDErrorMessage();if(0<a.length)return document.getElementById("other-id-has-error").innerHTML=a,setTimeout(function(){clearErrorDiv("other-id-has-error")},4E3),$("#otheridcollapse").on("hidden.bs.collapse",allowotheriddivtocollapse),$("#otheridcollapse").on("shown.bs.collapse",allowotheriddivtocollapse),!1;document.forms["create-user-form"].firstname.value=document.getElementById("firstnameinput").value;document.forms["create-user-form"].lastname.value=document.getElementById("lastnameinput").value;
a=document.forms["create-user-form"].type.value;var b=document.getElementById("aliasinput").value;checkAlias(b,a);return!0}
function checkAlias(a,b){debugappui&&console.log("In checkAlias");if(0==a.length&&"1"==b)return document.getElementsByClassName("has-error")[1].innerHTML="Alias can not be empty for a brand user",document.getElementById("aliasinput").focus(),setTimeout(clearAliasErrorDiv,4E3),$("#otheridcollapse").on("hidden.bs.collapse",allowotheriddivtocollapse),$("#otheridcollapse").on("shown.bs.collapse",allowotheriddivtocollapse),!1;if(0==a.length)return!0;var c=new XMLHttpRequest;c.open("POST","/newauth/api/oktocreatealias",
!1);c.setRequestHeader("Content-Type","application/json");c.onreadystatechange=function(){if(4==c.readyState&&200==c.status){var a=c.responseText;null!=a&&0<a.length&&handleAliascheck(a)}};c.send(JSON.stringify({alias:a}))}
function handleAliascheck(a){if("DONOTCREATE"==a)return document.getElementById("other-id-has-error").innerHTML="The alias  "+document.getElementById("aliasinput").value+"  is already taken. Please enter another alias.",document.getElementById("aliasinput").value="",document.getElementById("aliasinput").focus(),$("#otheridcollapse").on("hidden.bs.collapse",allowotheriddivtocollapse),$("#otheridcollapse").on("shown.bs.collapse",allowotheriddivtocollapse),setTimeout("clearAliasErrorDiv()",4E3),!1;document.forms["create-user-form"].alias.value=
document.getElementById("aliasinput").value;document.getElementById("otheridcheck").style.display="inline";document.getElementById("contact-info-div").style.visibility="visible"}
function handleContactInfoInput(){var a=contactInfoErrorMessage();if(0<a.length)return document.getElementById("contact-info-has-error").innerHTML=a,setTimeout(function(){clearErrorDiv("contact-info-has-error")},4E3),$("#contactcollapse").on("hidden.bs.collapse",allowotheriddivtocollapse),$("#contactcollapse").on("shown.bs.collapse",allowotheriddivtocollapse),!1;document.getElementById("contactcheck").style.display="inline";document.getElementById("password-notice-div").style.visibility="visible";
return!0}function contactInfoErrorMessage(){return""}function parseJsonWithFallback(a){try{return JSON.parse(a)}catch(b){a=a.replace(/\\"/g,'"');try{return JSON.parse(a)}catch(c){return console.error("Error parsing JSON:",c),null}}}
function otherIDErrorMessage(){var a=document.forms["create-user-form"].type.value,b=document.getElementById("usernameinput").value,c=document.getElementById("firstnameinput").value,d=document.getElementById("lastnameinput").value,e=document.getElementById("aliasinput").value;return 0==e.length&&1==a?"Alias needs to contain the Brand name that you want to reserve as a brand user.":0==c.length&&0==d.length&&0==e.length?"Please enter at least one of firstname, lastname and Screen name":0<b.length&&
(c==b||d==b||e==b)?"Username can not be same as firstname, lastname or alias":""}function allowotheriddivtocollapse(){0<otherIDErrorMessage().length?$("#otheridcollapse").collapse("show"):($("#otheridcollapse").collapse("hide"),$("#otheridcollapse").off("shown.bs.collapse",allowotheriddivtocollapse),$("#otheridcollapse").off("hidden.bs.collapse",allowotheriddivtocollapse))}function encryptdatausingpassword(a,b){var c=sjcl.random.randomWords(1,7);return sjcl.encrypt(b,a,{ks:256,salt:c,iter:1E4})}
function encryptdatawithstretchedkey(a,b,c,d){0==c.length&&(c=getrandomsalt(6));0==d&&(d=1E4);sjcl.misc.pbkdf2(b,c,d,256);c=sjcl.codec.hex.toBits(c);return sjcl.encrypt(b,a,{ks:256,salt:sjcl.codec.hex.fromBits(c),iter:d})}function getrandomsalt(a){for(var b="";b.length<a;){var c=sjcl.random.randomWords(1,10)[0];b+=btoa(c)}return b=b.substr(0,a)}var starttime=Date.now();function restartTimer(){starttime=Date.now()}function gettimetoclick(){return Date.now()-starttime}
function animateClick(a){a.classList.add("animated");a.classList.add("flash")}
function avatarclock(){var a=setInterval(function(){var b=(new Date).getTime();b=avatarcountDownDate-b;var c=Math.floor(b/864E5),d=Math.floor(b%864E5/36E5),e=Math.floor(b%36E5/6E4),f=Math.floor(b%6E4/1E3);null!=document.getElementById("avatar-timer-display")?0<c?document.getElementById("avatar-timer-display").innerHTML=c+"d ":0<d?document.getElementById("avatar-timer-display").innerHTML=d+"h ":0<e?document.getElementById("avatar-timer-display").innerHTML=e+"m "+f+"s ":0<f&&(document.getElementById("avatar-timer-display").innerHTML=
f+"s "):clearInterval(a);0>b&&(clearInterval(a),document.getElementById("avatar-timer-display").innerHTML="EXPIRED")},1E3)}function getReadableFileSizeString(a){var b=-1;do a/=1024,b++;while(1024<a);return Math.max(a,.1).toFixed(1)+" kB; MB; GB; TB;PB;EB;ZB;YB".split(";")[b]}function ValidateEmail(a){if(/^\w+([\.-]?\w+)*@\w+([\.-]?\w+)*(\.\w{2,3})+$/.test(a))return!0;document.getElementById("emailinputerror").innerHTML="Please check the email address!";return!1}
function ValidatePhone(a){a=a.replace(/\s/g,"");return isNaN(a)?!1:!0}function stopSSEPolling(){null!=sseeventsource&&(sseeventsource.close(),sseeventsource=null)}function joinconversation(a){null==sseeventsource?establishnewSSEConnection(a):sseeventsource.url.endsWith(a)||(stopSSEPolling(),establishnewSSEConnection(a))}
function establishnewSSEConnection(a){if("undefined"!==typeof EventSource)sseeventsource=new EventSource("/newauth/api/joinConversation/"+a),sseeventsource.addEventListener("message",function(b){var c=0;b=JSON.parse(b.data);b.author!=fullname&&(c=1);"SYSTEM"==b.author&&(c=1E3);if(null!=b.participants&&0<b.participants.length){c=new Date;debugappui&&console.log("Received participants list [ "+b.participants+"] "+c.toTimeString());var e=document.getElementById("conv-header-"+b.conversationID);if(null!=
e){var f=document.createElement("img");f.classList.add("user-icon");for(var g=e.getElementsByClassName("user-icon");0<g.length;)g[0].parentNode.removeChild(g[0]);void 0!==convparticipants[a]&&1==convparticipants[a].length&&(1==b.participants.length&&(f.src="/static/icons/one-user-green-16.png"),0==b.participants.length&&(f.src="/static/icons/one-user-grey-16.png"));void 0!==convparticipants[a]&&1<convparticipants[a].length&&(1<b.participants.length&&(f.src="/static/icons/multiple-users-green-16.png"),
0==b.participants.length&&(f.src="/static/icons/multiple-users-grey-16.png"));e.appendChild(f)}}else{null==b.message&&"true"==b.typing&&(debugappui&&console.log("Received typing event"),e=document.getElementById("conv-header-"+b.conversationID),f=document.createElement("img"),f.classList.add("typing-icon"),f.src="/static/icons/pencil-16.png",e.appendChild(f));if(null==b.message&&"false"==b.typing)for(debugappui&&console.log("Received stopped typing event"),e=document.getElementById("conv-header-"+
b.conversationID),g=e.getElementsByClassName("typing-icon");0<g.length;)g[0].parentNode.removeChild(g[0]);if(null!=b.message)if(debugappui&&console.log("Received message "+b.message),void 0!==convmsgtimemap[b.conversationID])if(-1==convmsgtimemap[b.conversationID].indexOf(b.messagecreatetime)){convmsgtimemap[b.conversationID].push(b.messagecreatetime);e=document.getElementById("conv-header-"+b.conversationID);for(g=e.getElementsByTagName("img");0<g.length;)g[0].parentNode.removeChild(g[0]);e=document.getElementById("conv-data-"+
b.conversationID);addconversationmessagetopanel(e,atob(b.message),c,b.messagecreatetime,b.author)}else debugappui&&console.log("ignoring message. createtime exists at position? "+convmsgtimemap[b.conversationID].indexOf(b.messagecreatetime));else e=[],e.push(b.messagecreatetime),convmsgtimemap[b.conversationID]=e,debugappui&&console.log("Adding message to panel . Created at: "+b.messagecreatetime),e=document.getElementById("conv-data-"+b.conversationID),addconversationmessagetopanel(e,atob(b.message),
c,b.messagecreatetime,b.author)}});else{var b=document.getElementById("conv-data-"+a);addconversationmessagetopanel(b,"This browser does not support server-sent-events. Instant messsaging will not work.",1E3)}}
function loadconversation(a,b,c,d,e){var f=new XMLHttpRequest;f.onreadystatechange=function(){if(4==f.readyState&&200==f.status){var b=JSON.parse(f.responseText);if(0<b.length)for(var c=0;c<b.length;c++){var d=0;b[c].author!=fullname&&(d=1);"SYSTEM"==b[c].author&&(d=1E3);var l=document.getElementById("conv-data-"+b[c].conversationID);addconversationmessagetopanel(l,b[c].message,d,b[c].messagecreatetime,b[c].author,e)}else l=document.getElementById("conv-data-"+a),addconversationmessagetopanel(l,"No messages found.",
null,null,null,e)}};f.open("POST","/newauth/api/getconversation",!1);f.withCredentials=!0;f.setRequestHeader("Content-Type","application/json");b=JSON.stringify({messagecreatetime:b,conversationID:a,topicname:c,postcrtime:d});f.send(b)}
function loadconversationsbyparticipant(a,b,c){var d=new XMLHttpRequest;d.onreadystatechange=function(){if(4==d.readyState&&200==d.status){var a=JSON.parse(d.responseText),b=document.getElementsByClassName("conv-modal-title")[0];if(null!=b){var c=document.createElement("h4");c.appendChild(document.createTextNode("Conversations"));var e=document.createElement("a");e.style.cursor="pointer";e.addEventListener("click",function(){var a=document.createElement("h4");a.appendChild(document.createTextNode("Conversations"));
b.innerHTML="";b.appendChild(a);displayconvosondiv(JSON.parse(document.getElementById("allconv").value),"conv-trans-in-modal")});e.appendChild(document.createTextNode("\x3e All"));b.innerHTML="";b.appendChild(c);b.appendChild(e)}displayconvosondiv(a,"conv-trans-in-modal",!0)}};d.open("POST","/newauth/api/getconversationsbyparticipant",!1);d.withCredentials=!0;d.setRequestHeader("Content-Type","application/json");var e=[];"undefined"!=typeof c&&null!=c&&e.push(c);a=JSON.stringify({messagecreatetime:b,
conversationID:a,participants:e});d.send(a)}
function loadconversationmesagesbyparticipant(a,b,c){var d=new XMLHttpRequest;d.onreadystatechange=function(){if(4==d.readyState&&200==d.status){var b=JSON.parse(d.responseText),c=document.getElementById("conv-data-"+a);c.innerHTML="";if(0<b.length)for(var e=0;e<b.length;e++){var k=0;b[e].author!=fullname&&(k=1);"SYSTEM"==b[e].author&&(k=1E3);document.getElementById("conv-data-"+a).parentNode.classList.remove("hidden");document.getElementById("conv-data-"+a).parentNode.classList.remove("visuallyhidden");
addconversationmessagetopanel(c,b[e].message,k,b[e].messagecreatetime,b[e].author)}else document.getElementById("conv-data-"+a).parentNode.classList.remove("hidden"),document.getElementById("conv-data-"+a).parentNode.classList.remove("visuallyhidden"),addconversationmessagetopanel(c,"NO messages found",27,null,"")}};d.open("POST","/newauth/api/getconversationmessagesbyparticipant",!1);d.withCredentials=!0;d.setRequestHeader("Content-Type","application/json");var e=[];"undefined"!=typeof c&&null!=
c&&e.push(c);b=JSON.stringify({messagecreatetime:b,conversationID:a,participants:e});d.send(b)}
function addconversationmessagetopanel(a,b,c,d,e,f){if(null!=a){var g=document.createElement("div");g.classList.add("row");g.style.border="1px solid #b9b9b9";var h=document.createElement("div");h.classList.add("col-sm-12");var k=document.createElement("div");k.classList.add("col-sm-4");var l=document.createElement("p");l.appendChild(document.createTextNode(e));l.style.color="#747474";e=document.createElement("p");null!=d&&0<d.length&&e.appendChild(document.createTextNode(gettimedifference(d)));e.style.color=
"#747474";d=document.createElement("p");d.appendChild(document.createTextNode(b));d.style.color="#fefefe";0==c&&(d.style.backgroundColor="#00a2a2");1==c&&(d.style.backgroundColor="#a2a2a2");1E3==c&&(d.style.backgroundColor="#a200a2");27==c&&(d.style.backgroundColor="#fb8e8e");b=document.createElement("div");b.classList.add("row");var m=document.createElement("div");m.classList.add("col-sm-6");b.appendChild(m);l.classList.add("pull-left");m.appendChild(l);h.appendChild(m);m=document.createElement("div");
m.classList.add("col-sm-6");e.classList.add("pull-right");m.appendChild(e);b.appendChild(m);b=document.createElement("div");b.classList.add("row");m=document.createElement("div");m.classList.add("col-sm-12");m.appendChild(l);m.appendChild(e);m.appendChild(document.createElement("br"));m.appendChild(d);b.appendChild(m);h.appendChild(b);1==c&&g.appendChild(k);g.appendChild(h);0==c&&g.appendChild(k);c=document.createElement("div");c.classList.add("row");d=document.createElement("div");d.classList.add("col-sm-6");
k=document.createElement("div");k.classList.add("col-sm-6");l=document.createElement("a");l.classList.add("pull-right");l.appendChild(document.createTextNode("Unread"));l.style.border="1px solid #c2c2c2";l.style.color="#878787";l.style.padding="1px";l.style.margin="2px";l.style.cursor="pointer";e=document.createElement("a");e.classList.add("pull-right");e.appendChild(document.createTextNode("Save"));e.style.border="1px solid #c2c2c2";e.style.color="#878787";e.style.padding="1px";e.style.margin="2px";
e.style.cursor="pointer";if("undefined"==typeof f||1==f)k.appendChild(e),k.appendChild(l);c.appendChild(d);c.appendChild(k);f=document.createElement("div");f.classList.add("row");k=document.createElement("div");k.classList.add("col-sm-8");d=document.createElement("p");d.appendChild(document.createTextNode(""));k.appendChild(d);f.appendChild(k);a.appendChild(g);a.appendChild(f);h.appendChild(c);a.scrollTop=a.scrollHeight}}
function createMessagePanel(a){if(null==document.getElementById("conversation-"+a)){var b=document.createElement("div");b.classList.add("panel");b.classList.add("panel-default");b.setAttribute("id","conversation-"+a);var c=document.createElement("div");c.classList.add("panel-heading");var d=document.createElement("h5");d.classList.add("panel-title");d.appendChild(document.createTextNode("Messages"));d.setAttribute("id","conv-header-"+a);c.appendChild(d);b.appendChild(c);c=document.createElement("div");
c.classList.add("panel-body");c.classList.add("panel-word-wrap");c.classList.add("pre-scrollable");c.setAttribute("id","conv-data-"+a);c.style.backgroundColor="#cacaca";b.appendChild(c);document.getElementById("conversations-panel-body").appendChild(b);joinconversation(a);loadconversation(a);c.scrollTop=c.scrollHeight}}
function drawPoint(a,b,c,d,e,f,g,h,k){var l=d/2;b+=.35;var m=d+l*Math.cos(-a*Math.PI/180)*b,n=e+l*Math.sin(-a*Math.PI/180)*b;debugappui&&console.log("drawing point "+a+" "+b+" "+c+" "+d+" "+e);"undefined"!==typeof k&&null!=k&&k.startsWith("#")?(f.fillStyle=k,f.strokeStyle=k,f.globalAlpha=.7):(f.fillStyle="#43464b",f.strokeStyle="silver");180<a&&(f.strokeStyle="#FAA0A0",f.fillStyle="#FAA0A0");"tiny"!=g?("large"==g?(g=3,f.lineWidth=1):g=2,f.moveTo(d+l*Math.cos(-a*Math.PI/180)*.09,e+l*Math.sin(-a*Math.PI/
180)*.09),f.lineTo(m,n),f.stroke(),null!=h&&"true"==h&&(f.font="8px",f.fillText(c,d+l*Math.cos(-a*Math.PI/180)*(b+.08),e+l*Math.sin(-a*Math.PI/180)*(b+.08)))):g=1;f.beginPath();f.arc(m,n,g,0,2*Math.PI);f.fill()}function drawDash(a,b,c,d,e,f,g,h,k){f.fillText("-",d+d/2*Math.cos(-a*Math.PI/180)*(b+.35),e+8)}
function drawborderllines(a){var b=a.getContext("2d");b.strokeStyle="#343434";b.beginPath();b.moveTo(0,a.height/10);b.lineTo(0,0);b.stroke();b.beginPath();b.moveTo(0,0);b.lineTo(a.width/5,0);b.stroke();b.beginPath();b.moveTo(a.width,4*a.height/5);b.lineTo(a.width,a.height);b.stroke();b.beginPath();b.moveTo(a.width,a.height);b.lineTo(9*a.width/10,a.height);b.stroke()}
function generateFlakeOnCanvas(a,b,c,d,e,f,g){a=document.getElementById(a);var h=!1;if(null==a)return!1;c=createHiDPICanvas(c,d);a.appendChild(c);if(null!=b){d="test".constructor;if(b.constructor===d)var k=b;else null!=b.flake&&(k=b.flake);var l=k.length,m=c.width/2,n=c.height/2;"tiny"==e&&(n=5*c.height/8);var p=c.getContext("2d");p.clearRect(0,0,c.width,c.height);if(25>k.length){h=!0;for(var r=k.length,q=0;q<r;q++)k+="z"}for(q=0;16>q;q++){r=1/valmap.length*valmap.indexOf(k.charAt(q));var v=12*q;
180>=v&&drawPoint(v,r,k.charAt(q),m,n,p,e,f,g)}for(q=16;q<k.length;q++)r=1/valmap.length*valmap.indexOf(k.charAt(q)),v=180+180/(l-15)*(q-15),180<v&&h?drawDash(v,r,k.charAt(q),m,n,p,e,f,g):drawPoint(v,r,k.charAt(q),m,n,p,e,f,g);b.constructor!==d&&null!=b.crtime&&(p.fillStyle="black",p.strokeStyle="black","tiny"==e?(b=document.createElement("div"),b.style.position="absolute",b.style.top="2px",b.style.left="10px",b.style.textAlign="center",f=document.createElement("h4"),f.style.color="#599aab",f.appendChild(document.createTextNode(k.substring(0,
4))),b.appendChild(f),a.appendChild(b)):p.fillText(b.crtime,2,c.height-2))}"tiny"!=e&&drawborderllines(c);return c}
function generateBottomPartOfFlakeOnCanvas(a,b,c,d,e,f){var g=document.getElementById(a);if(null==g)return!1;a=createHiDPICanvas(c,d);a.width=c;a.height=d;g.appendChild(a);if(null!=b){c="test".constructor;if(b.constructor===c)return!1;if(null!=b.flake)var h=b.flake;d=b.fullflake.length;g=a.width/2;var k=a.height/2,l=a.getContext("2d");if(17>h.length)for(var m=h.length,n=0;n<m;n++)h+="z";for(n=0;16>n;n++){m=.015625*"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-+".indexOf(h.charAt(n));
var p=12*n;180>=p&&drawPoint(p,m,h.charAt(n),g,k,l,e,f)}for(n=16;n<h.length;n++)m=.015625*"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-+".indexOf(h.charAt(n)),p=180+180/(d-15)*(n-15),drawPoint(p,m,h.charAt(n),g,k,l,e,f);b.constructor!==c&&null!=b.crtime&&("tiny"==e?l.fillText(gettimedifference(b.crtime),2,a.height-2):l.fillText(b.crtime,2,a.height-2))}drawborderllines(a)}
function PIXEL_RATIO(){var a=document.createElement("canvas").getContext("2d");return(window.devicePixelRatio||1)/(a.webkitBackingStorePixelRatio||a.mozBackingStorePixelRatio||a.msBackingStorePixelRatio||a.oBackingStorePixelRatio||a.backingStorePixelRatio||1)}
function createHiDPICanvas(a,b,c){c||(c=PIXEL_RATIO());var d=document.createElement("canvas");d.width=a*c;d.height=b*c;d.style.width=a+"px";d.style.height=b+"px";d.getContext("2d").setTransform(c,0,0,c,0,0);d.getContext("2d").imageSmoothingEnabled=!1;d.getContext("2d").scale(1/c,1/c);return d}function getdatefromdatetime(a){a=Date.parse(a);a=new Date(a);return a.getMonth()+1+"/"+a.getDate()+"/"+a.getFullYear()}
function gettimedifferenceinsec(a){var b=Date.now();a="number"!=typeof a?Date.parse(a):new Date(a);return Math.floor((b-a)/1E3)}function gettimedifference(a,b){var c=Date.now();a="number"!=typeof a?Date.parse(a):new Date(a);return converttimediffmstocalendar(Math.abs(c-a),b)}
function converttimediffmstocalendar(a,b){var c=Math.floor(a/864E5),d=Math.floor(a%864E5/36E5),e=Math.floor(a%864E5%36E5/6E4),f=Math.floor(a%864E5%36E5%6E4/1E3);return 7<c?"undefined"!=typeof b?1==b?Math.floor(c/7)+" w ":a:Math.floor(c/7)+" w ":1<=c?c+" d":1<=d?d+" h":1<=e?e+" m":f+" s"}
function validateDomain(){var a=document.getElementById("domainbrandname").value;if(/^[a-zA-Z0-9][a-zA-Z0-9-]{1,61}[a-zA-Z0-9](?:\.[a-zA-Z]{2,})+$/.test(a)){document.getElementById("domainbrandname").style.borderColor="";for(var b=document.getElementsByName("domainchoiceinputradio"),c,d=0;d<b.length;d++)"radio"==b[d].type&&b[d].checked&&(c=b[d].value);if(0==c){var e=new XMLHttpRequest;e.onreadystatechange=function(){if(4==e.readyState&&200==e.status){createuserdomainverkey=JSON.parse(e.responseText).domainkey;
var b="Please create a TXT record in the DNS entry of domain "+a+" containing this value";b+="\x3cbr\x3e\x3cbr\x3e\x3cb\x3enewauth-domain-verify:"+flakejsonobj.flake+"\x3c/b\x3e\x3cbr\x3e\x3cbr\x3e";b+="Name of the TXT record could be @ or remain blank\x3cbr\x3e\x3cbr\x3eTime to live (TTL) of the TXT record could be 86400 or default\x3cbr\x3e\x3cbr\x3eClick Verify when you have added the TXT record.";document.getElementById("domainveroptions").style.display="none";document.getElementById("adddomainfeedback").innerHTML=
b;document.getElementById("domainverifybtn").value="Verify";document.getElementById("domainbrandname").style.display="none";document.getElementById("domainbrandname").value=a;document.getElementById("domainverifybtn").onclick=validateDomainTxt}else document.getElementById("adddomainfeedback").innerHTML='\x3cfont color\x3d"red"\x3e'+e.responseText+"\x3c/font\x3e"};e.open("POST","/newauth/api/adddomain/TXT/"+a+"/",!1);e.setRequestHeader("Content-Type","application/json");b=JSON.stringify({domainname:a});
void 0!==document.forms["create-user-form"]&&(document.forms["create-user-form"].domains.value=a);document.getElementById("domainbrandname").value="";e.send(b)}if(1==c)return confirm("We are sending a code to the emails associated with the domain "+a+". You will need to verify the code to prove your ownership. Are you ready?")?(e=new XMLHttpRequest,e.onreadystatechange=function(){if(4==e.readyState&&200==e.status){var a=JSON.parse(e.responseText);createuserdomainverkey=a.domainkey;a=a.emails;for(var b=
"A code has been sent to these emails \x3cul\x3e",c=0;c<a.length;c++)b+="\x3cli\x3e"+a[c]+"\x3c/li\x3e";b+="\x3c/ul\x3e\x3cbr\x3eplease enter the code below.\x3cbr\x3e";document.getElementById("adddomainfeedback").innerHTML=b;document.getElementById("domainverifybtn").value="Verify";document.getElementById("domainbrandname").placeholder="Provide code here";document.getElementById("domainverifybtn").onclick=validateDomainEmail}else document.getElementById("adddomainfeedback").innerHTML='\x3cfont color\x3d"red"\x3e'+
e.responseText+"\x3c/font\x3e"},e.open("POST","/newauth/api/adddomain/EMAIL/"+a+"/",!1),e.setRequestHeader("Content-Type","application/json"),b=JSON.stringify({domainname:a}),void 0!==document.forms["create-user-form"]&&(document.forms["create-user-form"].domains.value=a),document.getElementById("domainbrandname").value="",e.send(b),!0):!1}else document.getElementById("domainbrandname").style.borderColor="red"}
function validateDomainEmail(){var a=document.forms[0].domains.value,b=document.getElementById("domainbrandname").value;if(null!=b&&0<b.length){var c=new XMLHttpRequest;c.open("POST","/newauth/api/verifycode",!1);c.setRequestHeader("Content-Type","application/json");c.onreadystatechange=function(){4==c.readyState&&200==c.status&&("VERIFIED"===JSON.parse(c.responseText).status.statuscode?($("#brandModal").modal("hide"),verifiedbranddomainname=a,document.getElementById("brandwebsitenamedisplay").innerHTML=
a,document.getElementById("brandwebsiterow").classList.remove("hidden")):document.getElementById("adddomainfeedback").innerHTML='\x3cfont color\x3d"red"\x3eInvalid code. Please check \x3c/font\x3e')};b=JSON.stringify({domain:a,verificationKeyCode:createuserdomainverkey,verificationKeyInput:b});document.forms["create-user-form"].domains.value=a;document.getElementById("domainbrandname").value="Provide code here";c.send(b)}}
function validateDomainTxt(){var a=document.getElementById("domainbrandname").value,b="newauth-domain-verify:"+flakejsonobj.flake;if(null!=b&&0<b.length){var c=new XMLHttpRequest;c.open("POST","/newauth/api/verifycode",!1);c.setRequestHeader("Content-Type","application/json");c.onreadystatechange=function(){4==c.readyState&&200==c.status&&("VERIFIED"===JSON.parse(c.responseText).status.statuscode?($("#brandModal").modal("hide"),verifiedbranddomainname=a,document.getElementById("brandwebsitenamedisplay").innerHTML=
a,document.getElementById("brandwebsiterow").classList.remove("hidden")):document.getElementById("adddomainfeedback").innerHTML='\x3cfont color\x3d"red"\x3eWe could not verify the code. Please try again later. Do not log out before verifying again. \x3c/font\x3e')};b=JSON.stringify({domain:a,verificationKeyCode:createuserdomainverkey,verificationKeyInput:b});c.send(b)}}
function loadSystemCacheInfo(a){var b=new XMLHttpRequest;b.open("GET","/newauth/api/getSystemCacheInfo",!1);b.setRequestHeader("Content-Type","application/json");b.onreadystatechange=function(){if(4==b.readyState&&200==b.status){removepageloadingdiv();var a=JSON.parse(b.responseText);populateCacheDisplay(a)}};b.send(null)}
function loadSystemImages(a){displaypageloadingdiv(a);var b=new XMLHttpRequest;b.open("GET","/getSystemImages",!1);b.setRequestHeader("Content-Type","application/json");b.onreadystatechange=function(){4==b.readyState&&200==b.status&&(removepageloadingdiv(),document.getElementById("adminImages").innerHTML=b.responseText,$("#adminimagescollapse").collapse("show"))};b.send(null)}
function loadSystemUsersInfo(a){var b=new XMLHttpRequest;b.open("GET","/newauth/api/getSystemUsersInfo",!1);b.setRequestHeader("Content-Type","application/json");b.onreadystatechange=function(){if(4==b.readyState&&200==b.status){removepageloadingdiv();var a=JSON.parse(b.responseText);populateUsersDisplay(a)}};b.send(null)}
function loadSystemDBInfo(a){var b=new XMLHttpRequest;b.open("GET","/newauth/api/getSystemDBInfo",!1);b.setRequestHeader("Content-Type","application/json");b.onreadystatechange=function(){if(4==b.readyState&&200==b.status){removepageloadingdiv();var a=JSON.parse(b.responseText);populateDBDisplay(a)}};b.send(null)}
function populateCacheDisplay(a){document.getElementById("cachedisplay").innerHTML="";var b=document.createElement("div");b.classList.add("row");var c=document.createElement("div");c.classList.add("col-xs-12");for(var d=0;d<a.length;d++){var e=document.createElement("div");e.classList.add("row");for(var f=0;4>f;f++){var g=document.createElement("p"),h=document.createElement("div");h.classList.add("col-xs-3");0==f&&g.appendChild(document.createTextNode(a[d].cachename));1==f&&g.appendChild(document.createTextNode(a[d].localentries));
2==f&&g.appendChild(document.createTextNode(a[d].entries));h.appendChild(g);e.appendChild(h)}c.appendChild(e)}b.appendChild(c);document.getElementById("cachedisplay").appendChild(b)}
function populateUsersDisplay(a){document.getElementById("usersdisplay").innerHTML="";var b=document.createElement("div");b.classList.add("row");var c=document.createElement("div");c.classList.add("col-xs-12");var d=document.createElement("div");d.classList.add("row");for(var e=0;3>e;e++){var f=document.createElement("p"),g=document.createElement("div");g.classList.add("col-xs-4");0==e&&f.appendChild(document.createTextNode("Users: "+a.activeusers+"/"+a.usercount));1==e&&f.appendChild(document.createTextNode("Brands: "+
a.brandusercount));2==e&&f.appendChild(document.createTextNode("Admins: "+a.admincount));g.appendChild(f);d.appendChild(g)}c.appendChild(d);b.appendChild(c);document.getElementById("usersdisplay").appendChild(b)}
function populateDBDisplay(a){document.getElementById("dbdisplay").innerHTML="";var b=document.createElement("div");b.classList.add("row");var c=document.createElement("div");c.classList.add("col-xs-12");var d=document.createElement("div");d.classList.add("row");var e=document.createElement("div");e.classList.add("col-xs-12");var f=document.createElement("p");f.appendChild(document.createTextNode(a.clustername+"["+a.nodes+"]"));e.appendChild(f);d.appendChild(e);c.appendChild(d);for(d=0;d<a.nodelist.length;d++){e=
document.createElement("div");e.classList.add("row");for(var g=0;4>g;g++){f=document.createElement("p");var h=document.createElement("div");0==g&&(h.classList.add("col-xs-4"),f.appendChild(document.createTextNode(a.nodelist[d].broadcastAddress+"("+a.nodelist[d].address+")")));1==g&&(h.classList.add("col-xs-2"),f.appendChild(document.createTextNode(a.nodelist[d].datacenter)));2==g&&(h.classList.add("col-xs-2"),f.appendChild(document.createTextNode(a.nodelist[d].rack)));3==g&&(h.classList.add("col-xs-4"),
f.appendChild(document.createTextNode(a.nodelist[d].cassandraVersion.major+"."+a.nodelist[d].cassandraVersion.minor+"."+a.nodelist[d].cassandraVersion.patch)));h.appendChild(f);e.appendChild(h)}c.appendChild(e)}b.appendChild(c);document.getElementById("dbdisplay").appendChild(b)}
function convertDivToInput(a,b,c){var d=document.getElementById(a),e=d.textContent;d.innerHTML="";var f=document.createElement("INPUT");f.setAttribute("type","text");f.setAttribute("name",a+"-INPUT");f.setAttribute("value",e);f.setAttribute("size","30");f.style.color="#888888";f.style.padding="4px";f.style.border="none";f.style.borderBottom="2px solid grey";var g=function(a){var d=a.target.name.replace("-INPUT",""),e=document.getElementById(d),f=e.children[0];f.innerHTML="";f.appendChild(document.createTextNode(a.target.value));
e.appendChild(f);updatenewdataindb(a.target.value,d,b,c)};f.addEventListener("blur",g,!1);f.addEventListener("keyup",function(a){13!==a.keyCode&&9!==a.keyCode||g(a)});d.appendChild(f);f.focus()}function loadhomepage(){document.title="Newauth - Home";loadhomepagesection("homepage-location-display");loadhomepagesection("homepage-occupation-display");loadhomepagesection("homepage-headline-display")}
function loadorgpagedata(){loadhomepagesection("org-location-display",orgownerflake,orgID);loadhomepagesection("org-purpose-display",orgownerflake,orgID);loadhomepagesection("org-headline-display",orgownerflake,orgID)}
function loadhomepagesection(a){var b=new XMLHttpRequest,c="/newauth/api/gethomepagedata/"+a;c=null!=orgownerflake&&0<orgownerflake.length?c+("/"+orgownerflake+"/"+orgID):c+"/0/0";b.open("GET",c,!1);b.setRequestHeader("Content-Type","application/json");b.onreadystatechange=function(){if(4==b.readyState&&200==b.status){var c=b.responseText;if(null!=c&&0<c.length&&(c=JSON.parse(c),null!=c.data&&0<c.data.length)){var e=document.createElement("DIV");e.innerHTML=c.data;c=e.textContent||e.innerText||"";
0<c.length&&populatehomepagedatainsection(c,a)}}};b.send(null)}function updatenewdataindb(a,b,c,d){var e=new XMLHttpRequest;e.open("POST","/newauth/api/updatehomepagedata",!1);e.setRequestHeader("Content-Type","application/json");e.onreadystatechange=function(){4==e.readyState&&200==e.status&&populatehomepagedatainsection(a,b)};"undefined"==typeof c&&(c=null);"undefined"==typeof d&&(d=null);c=JSON.stringify({section:b,data:a,ownerflake:c,orgid:d});e.send(c)}
function populatehomepagedatainsection(a,b){var c=document.getElementById(b);if(null!=c){c.innerHTML="";var d=document.createElement("p");b.includes("occupation")&&d.classList.add("text-muted");b.includes("headline")&&d.classList.add("lead");d.style.color="#323232";d.style.backgroundColor="white";d.appendChild(document.createTextNode(a));c.appendChild(d)}}
function loadOrgPage(a,b){a="/newauth/orgPage/"+a+"/"+b;fadeoutelement("app");loadUrlAjax("/newauth/header?page\x3d"+b,"app-header");loadUrlAjax(a,"app");document.title="Newauth - Org";return!1}
function displayvideolink(a,b){document.getElementById(a).innerHTML="";var c=document.createElement("iframe");c.setAttribute("src","https://www.youtube.com/embed/"+b+"?rel\x3d0\x26autoplay\x3d0\x26autohide\x3d1\x26border\x3d0\x26wmode\x3dopaque\x26enablejsapi\x3d1\x26modestbranding\x3d1\x26showinfo\x3d0\x26controls\x3d0");c.setAttribute("frameborder","0");document.getElementById(a).appendChild(c);document.getElementById(a).style.display="block";return!1}
function removevideo(a){null!=document.getElementById(a)&&(document.getElementById(a).innerHTML="")}
function flakecheck(a,b){b.preventDefault();b.stopPropagation();var c=document.createElement("div");c.setAttribute("id","flakecheckinputdiv");c.style.position="absolute";c.style.bottom=window.getComputedStyle(document.getElementById("username")).getPropertyValue("bottom");c.style.right=window.getComputedStyle(document.getElementById("username")).getPropertyValue("left");c.style.zIndex="100";c.style.display="block";var d=document.createElement("input");d.setAttribute("id","flakecheckinput");d.setAttribute("type",
"text");d.setAttribute("placeholder","Search flake");d.style.width="150px";d.style.height="26px";d.style.color="#434343";d.style.fontSize="15px";d.style.border="2px solid grey";d.addEventListener("input",function(a){a=document.getElementById("flakecheckinput").value;0>valmap.indexOf(a[a.length-1])&&(document.getElementById("flakecheckinput").value="",document.getElementById("flakecheckinput").style.border="1px solid red");if(16==a.length)d.style.border="2px solid grey",displayThirdPartyFlakeDetails(a,
10,20,"app"),$("#flakecheckinputdiv").fadeOut("fast");else return handleflakesearch()});document.getElementById("app").addEventListener("click",function(a){"flakecheckinputdiv"!==a.target.id&&"flakecheckinput"!==a.target.id&&removediv(c)});c.appendChild(d);document.getElementById("app").appendChild(c);document.getElementById("flakecheckinput").value="";$("#flakecheckinputdiv").fadeIn("fast");document.getElementById("flakecheckinput").focus();return!1}
function showcontactmodal(a){generateFlakeOnCanvas("tinymessageflakeholder",newauthcontactflake,50,50,"tiny");document.getElementById("tinymessageflakeholder").addEventListener("click",function(){showflakepageinapp(newauthcontactflake);$("#contactmodal").modal("hide")});$("#contactmodal").modal("show")}
function manageDisplay(a,b,c){var d=0;$("#"+a).mouseenter(function(){d=setTimeout(function(){$(".extra-elements-in-answer").not("#"+b).hide();$("#"+b).show("fast")},250)}).mouseleave(function(){"undefined"!=typeof c&&0!=c||$("#"+b).hide();clearTimeout(d)})}function autoGrow(a){a.scrollHeight>a.clientHeight&&(a.style.height=a.scrollHeight+"px")}
function loadtopicimage(a,b){var c=new XMLHttpRequest;c.open("GET","/newauth/api/gettopicimage/"+a,!0);c.setRequestHeader("Content-Type","application/json");c.onreadystatechange=function(){if(4==c.readyState&&200==c.status){var a=c.responseText;null!=a&&0<a.length&&(document.getElementById(b).src=a)}};c.send(null)}
function topicautocomplete(a,b){function c(a){var b=a.target.value;if(0<b.replace("#","").length)if(null!=listoftopics[b])d(a),document.getElementById("post-global-url").innerHTML=newauthurl+"/t/"+b.replace("#","");else{var c=new XMLHttpRequest,e="/newauth/api/gettopics/"+b.replace("#","");c.open("GET",e,!1);c.setRequestHeader("Content-Type","application/json");c.onreadystatechange=function(){if(4==c.readyState&&200==c.status){var e=c.responseText;null!=e&&0<e.length&&(listoftopics[b]=JSON.parse(e),
d(a))}};c.send(null)}}function d(b){var c,d=b.target.value;f();if(!d)return!1;g=-1;var e=document.createElement("DIV");e.setAttribute("id",b.target.id+"autocomplete-list");e.setAttribute("class","autocomplete-items");b.target.parentNode.appendChild(e);for(c=0;c<listoftopics[d].length;c++)listoftopics[d][c].substr(1,d.length).toUpperCase()==d.toUpperCase()&&(b=document.createElement("DIV"),b.innerHTML="\x3cstrong\x3e"+listoftopics[d][c].substr(1,d.length-1)+"\x3cinput type\x3d'hidden' value\x3d'"+
listoftopics[d][c]+"'\x3e\x3c/strong\x3e",b.innerHTML+=listoftopics[d][c].substr(d.length),b.addEventListener("click",function(b){a.value=b.target.getElementsByTagName("input")[0].value.replace("#","");a.existingTopic="true";document.getElementById("post-global-url").innerHTML=newauthurl+"/t/"+b.target.getElementsByTagName("input")[0].value.replace("#","");f()}),e.appendChild(b))}function e(a){if(!a)return!1;for(var b=0;b<a.length;b++)a[b].classList.remove("autocomplete-active");g>=a.length&&(g=0);
0>g&&(g=a.length-1);a[g].classList.add("autocomplete-active")}function f(b){for(var c=document.getElementsByClassName("autocomplete-items"),d=0;d<c.length;d++)b!=c[d]&&b!=a&&c[d].parentNode.removeChild(c[d])}var g;a.addEventListener("input",function(a){null!=settimeoutid&&clearTimeout(settimeoutid);settimeoutid=setTimeout(function(){c(a)},300);document.getElementById("post-global-url").innerHTML="";var b=a.target.value;0<b.length?document.getElementById("post-global-url").innerHTML=newauthurl+"/t/"+
b.replace("#",""):document.getElementById("post-global-url").innerHTML=newauthurl+"/f/"+loggedinuserflake});a.addEventListener("keydown",function(a){var b=document.getElementById(this.id+"autocomplete-list");b&&(b=b.getElementsByTagName("div"));40==a.keyCode?(g++,e(b)):38==a.keyCode?(g--,e(b)):13==a.keyCode&&(a.preventDefault(),-1<g&&b&&b[g].click())});document.addEventListener("click",function(a){f(a.target)})}
function flakeautocomplete(a,b){function c(a){var b=a.target.value;if(3<b.length)if(null!=listofflakes[b])d(a);else{var c=new XMLHttpRequest;c.open("GET","/newauth/api/searchflakesstartingwith/"+b,!1);c.setRequestHeader("Content-Type","application/json");c.onreadystatechange=function(){if(4==c.readyState&&200==c.status){var e=c.responseText;null!=e&&0<e.length&&(listofflakes[b]=JSON.parse(e),16==b.length?displayThirdPartyFlakeDetails(b,10,20,"app"):d(a))}};console.log("Calling searchflakesstartingwith.."+
b);c.send(null)}}function d(b){var c,d=b.target.value;f();if(!d)return!1;g=-1;var e=document.createElement("DIV");e.setAttribute("id",b.target.id+"autocomplete-list");e.setAttribute("class","autocomplete-items");b.target.parentNode.appendChild(e);0==listofflakes[d].length&&(b=document.createElement("DIV"),b.innerHTML="No results found",e.appendChild(b));for(c=0;c<listofflakes[d].length;c++)if(listofflakes[d][c].flake.substr(0,d.length).toUpperCase()==d.toUpperCase()){b=document.createElement("DIV");
var h="";null!=listofflakes[d][c].giveOut&&listofflakes[d][c].giveOut!=listofflakes[d][c].flake&&(h=" ["+listofflakes[d][c].giveOut+"]");b.innerHTML="\x3cstrong\x3e"+listofflakes[d][c].flake.substr(0,d.length)+"\x3cinput type\x3d'hidden' value\x3d'"+listofflakes[d][c].flake+"'\x3e\x3c/strong\x3e";b.innerHTML+=listofflakes[d][c].flake.substr(d.length)+h;b.addEventListener("click",function(b){a.value=b.target.getElementsByTagName("input")[0].value;displayThirdPartyFlakeDetails(b.target.getElementsByTagName("input")[0].value,
10,20,"app");$("#flakecheckinputdiv").fadeOut("fast");f()});e.appendChild(b)}}function e(a){if(!a)return!1;for(var b=0;b<a.length;b++)a[b].classList.remove("autocomplete-active");g>=a.length&&(g=0);0>g&&(g=a.length-1);a[g].classList.add("autocomplete-active")}function f(b){for(var c=document.getElementsByClassName("autocomplete-items"),d=0;d<c.length;d++)b!=c[d]&&b!=a&&c[d].parentNode.removeChild(c[d])}var g;a.addEventListener("input",function(a){null!=settimeoutid&&clearTimeout(settimeoutid);settimeoutid=
setTimeout(function(){c(a)},300)});a.addEventListener("keydown",function(a){var b=document.getElementById(this.id+"autocomplete-list");b&&(b=b.getElementsByTagName("div"));40==a.keyCode?(g++,e(b)):38==a.keyCode?(g--,e(b)):13==a.keyCode&&(a.preventDefault(),-1<g&&b&&b[g].click())});document.addEventListener("click",function(a){f(a.target)})}
function genericinputautocomplete(a,b){function c(a){var b=a.target.value;if(3<b.length)if(null!=listofflakes[b])d(a);else{var c=new XMLHttpRequest;c.open("GET","/newauth/api/searchuserbyflakeortag/"+b,!1);c.setRequestHeader("Content-Type","application/json");c.onreadystatechange=function(){if(4==c.readyState&&200==c.status){var e=c.responseText;null!=e&&0<e.length&&(listofflakes[b]=JSON.parse(e),d(a))}};console.log("Calling searchuserbyflakeortag.."+b);c.send(null)}}function d(b){var c,d=b.target.value;
f();if(!d)return!1;g=-1;var e=document.createElement("DIV");e.setAttribute("id",b.target.id+"autocomplete-list");e.setAttribute("class","autocomplete-items");b.target.parentNode.appendChild(e);0==listofflakes[d].length&&(b=document.createElement("DIV"),b.innerHTML="No results found",e.appendChild(b));for(c=0;c<listofflakes[d].length;c++)if(listofflakes[d][c].flake.substr(0,d.length).toUpperCase()==d.toUpperCase()||listofflakes[d][c].giveOut.substr(0,d.length).toUpperCase()==d.toUpperCase()){b=document.createElement("DIV");
var h="";null!=listofflakes[d][c].giveOut&&listofflakes[d][c].giveOut!=listofflakes[d][c].flake&&(h=" ["+listofflakes[d][c].giveOut+"]");b.innerHTML="\x3cstrong\x3e"+listofflakes[d][c].giveOut.substr(0,d.length)+"\x3cinput type\x3d'hidden' value\x3d'"+listofflakes[d][c].flake+h+"'\x3e\x3c/strong\x3e";b.innerHTML+=listofflakes[d][c].giveOut.substr(d.length);b.addEventListener("click",function(b,c){return function(b){a.value=b.target.getElementsByTagName("input")[0].value;document.getElementById("orgmemberflake").value=
c;f()}}(event,listofflakes[d][c].flake));e.appendChild(b)}}function e(a){if(!a)return!1;for(var b=0;b<a.length;b++)a[b].classList.remove("autocomplete-active");g>=a.length&&(g=0);0>g&&(g=a.length-1);a[g].classList.add("autocomplete-active")}function f(b){for(var c=document.getElementsByClassName("autocomplete-items"),d=0;d<c.length;d++)b!=c[d]&&b!=a&&c[d].parentNode.removeChild(c[d])}var g;a.addEventListener("input",function(a){null!=settimeoutid&&clearTimeout(settimeoutid);settimeoutid=setTimeout(function(){c(a)},
300)});a.addEventListener("keydown",function(a){var b=document.getElementById(this.id+"autocomplete-list");b&&(b=b.getElementsByTagName("div"));40==a.keyCode?(g++,e(b)):38==a.keyCode?(g--,e(b)):13==a.keyCode&&(a.preventDefault(),-1<g&&b&&b[g].click())});document.addEventListener("click",function(a){f(a.target)})}
function postcontenttohome(){null==postcontenthome&&(postcontenthome={files:[]});var a=document.getElementById("indiv-post-text-input").value;postcontenthome.text=a;if(0==postcontenthome.text.length&&(!postcontenthome.files||0==postcontenthome.files.length))return console.log("nothing to post"),!1;var b=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");b.onreadystatechange=function(){if(4==b.readyState&&200==b.status){var a=JSON.parse(b.responseText);1==parseInt(a.lastseq)?
loadHome():refreshposts(a)}};b.open("POST","/newauth/api/postcontenttohomepage",!1);b.withCredentials=!0;b.setRequestHeader("Content-Type","application/json");a=JSON.stringify({text:postcontenthome.text,files:postcontenthome.files});a=1E3<a.length?sjcl.hash.sha256.hash(a.substring(0,1E3)):sjcl.hash.sha256.hash(a);a=sjcl.codec.hex.fromBits(a);b.send(JSON.stringify({text:postcontenthome.text,files:postcontenthome.files,hash:a}));postcontenthome=null;document.getElementById("indiv-post-text-input").value=
"";document.getElementById("indiv-post-text-input").style.height="";document.getElementById("attached-file-preview").innerHTML=""}function bannerimgfilechangeeventhandler(a){var b=document.getElementById("bannerimgfile");null!=b&&(debugappui&&console.log("attaching eventlistener for change on bannerimgfile"),b.addEventListener("change",function(b){readbannerimage(b,a);debugappui&&console.log("changed again")},!1))}
function attachedfilechangeeventhandler(){var a=document.getElementById("attachedfiles");null!=a&&(debugappui&&console.log("attaching eventlistener for change on attachedfiles"),a.addEventListener("change",function(a){displaypreview(a);debugappui&&console.log("changed again")},!1))}
function readbannerimage(a,b,c){var d=a.target.files;debugappui&&console.log("onchange event fired for banner img files");for(var e=0;e<d.length;e++){var f=new FileReader;f.onload=function(a){return function(c){updatebannerimage(c,a,b)}}(d[e]);f.readAsDataURL(d[e])}c&&c(a.target.imgcount,postcontenthome.files)}
function displaypreview(a,b){var c=a.target.files;null==postcontenthome&&(postcontenthome={files:[]});postcontenthome.files||(postcontenthome.files=[]);debugappui&&console.log("onchange event fired for attachedfiles");for(var d=0;d<c.length;d++){var e=new FileReader;e.onload=function(a){return function(b){processloadedattachedfile(b,a)}}(c[d]);e.readAsDataURL(c[d])}b&&b(a.target.imgcount,postcontenthome.files)}
function updatebannerimage(a,b,c){imageExists(a.target.result,function(d){var e=document.getElementById(c);if(d){d=document.createElement("img");d.src=a.target.result;var f=window.screen.availWidth/2,g=window.screen.availWidth/4;800>f&&(f=800);600>g&&(g=600);d=getresizedimage(d,b.type,f,g);e.src=d;e=new XMLHttpRequest;e.open("POST","/newauth/api/updatehomepagedata",!1);e.setRequestHeader("Content-Type","application/json");f=JSON.stringify({section:"home-banner-image",data:d});0<=c.indexOf("org")&&
(f=JSON.stringify({section:"org-banner-image",data:d,ownerflake:orgownerflake,orgid:orgID}));e.send(f)}else alert("Not an image file")})}
function processloadedattachedfile(a,b){imageExists(a.target.result,function(c){var d=document.getElementById("attached-file-preview");if(c){c=document.createElement("img");c.src=a.target.result;var e=window.screen.availWidth,f=window.screen.availHeight;800>e&&(e=800);600>f&&(f=600);e=getresizedimage(c,b.type,e,f);d.innerHTML="";f=document.createElement("IMG");f.classList.add("fade-in");f.style.objectFit="cover";f.width="64";f.height="64";f.src=e;d.style.backgroundColor="#ffffff";d.appendChild(f);
postcontenthome.files.push({name:b.name,size:b.size,type:b.type,content:e,thumbnail:getresizedimage(c,b.type,200,200)})}else d.style.backgroundColor="#989898",d.innerHTML="\x3ch5\x3eFile\x3c/h5\x3e",postcontenthome.files.push({name:b.name,size:b.size,type:b.type,content:a.target.result});1<postcontenthome.files.length&&(c=document.createElement("div"),c.classList.add("fade-in"),c.style.width="64",c.style.height="64",c.style.opacity="0.6",e=document.createElement("h4"),e.style.background="#515151",
e.classList.add("text-center"),e.appendChild(document.createTextNode("+"+(postcontenthome.files.length-1))),c.appendChild(e),d.appendChild(c))})}function getresizedimage(a,b,c,d){b=document.createElement("canvas");var e=a.width,f=a.height;e>f?e>c&&(f*=c/e,e=c):f>d&&(e*=d/f,f=d);b.width=e;b.height=f;b.getContext("2d").drawImage(a,0,0,e,f);return b.toDataURL("image/jpeg")}
function displaynopostmessageondiv(a){a=document.getElementById(a);var b=document.createElement("div");b.classList.add("panel-body");b.classList.add("panel-word-wrap");var c=document.createElement("div");c.classList.add("col-12");c.classList.add("text-center");var d=document.createElement("p");d.classList.add("lead");d.appendChild(document.createTextNode("This topic does not have any posts currently. "));var e=document.createElement("p");e.appendChild(document.createTextNode("If you would like to post something to this topic, please log in and post your content here"));
c.appendChild(d);c.appendChild(e);b.appendChild(c);a.appendChild(b)}
function displaypostsondiv(a,b,c){b=document.getElementById(b);if(null!=a){var d=document.createElement("div");d.classList.add("panel-body");d.classList.add("panel-word-wrap");var e=document.createElement("div");e.classList.add("col-xs-12");var f=document.createElement("div");f.classList.add("row");f.style.margin="5px auto 30px auto";f.style.backgroundColor="white";f.setAttribute("id","post-content-row");e.appendChild(f);for(var g=0;g<a.length;g++){var h=JSON.parse(a[g].data);0==g&&(lastpostseq=a[g].lastseq);
var k=a[g].ownerflake;null!=a[g].giveout&&0<a[g].giveout.length&&(k=a[g].giveout);h="undefined"===typeof h.files||null==h.files||0==h.files.length?createTextOnlyPostDisplay(h,f,a[g].lastseq,a[g].ownerflake,c,a[g].convid):null==h.text||0==h.text.length?createFileOnlyPostDisplay(h,f,a[g].lastseq,a[g].ownerflake,c,a[g].convid):createTextandFilePostDisplay(h,f,a[g].lastseq,a[g].ownerflake,c,a[g].convid);"undefined"!=typeof c&&1==c&&addauthorinfobelowpost(h,a[g].createdate,a[g].ownerflake,a[g].lastseq,
k,a[g].tags,a[g].topic,a[g].convid)}d.appendChild(e);b.appendChild(d)}}
function displayconvosondiv(a,b,c){console.log("Starting displayconvosondiv");b=document.getElementById(b);b.innerHTML="";b.style.height="70%";b.style.overflowY="scroll";for(var d=0;d<a.length;d++){var e=document.createElement("div");e.classList.add("panel");e.classList.add("panel-default");var f=document.createElement("div");f.classList.add("panel-heading");e.appendChild(f);var g=document.createElement("div");g.classList.add("row");"undefined"!=typeof c&&0!=c||g.addEventListener("click",function(a){return function(){for(var b=
document.getElementsByClassName("conv-details"),c=0;c<b.length;c++)b[c].innerHTML="",b[c].parentNode.classList.add("hidden"),b[c].parentNode.classList.add("visuallyhidden");loadconversation(a);document.getElementById("conv-data-"+a).parentNode.classList.remove("hidden");document.getElementById("conv-data-"+a).parentNode.classList.remove("visuallyhidden")}}(a[d].convid));var h=document.createElement("div");h.classList.add("col-xs-4");h.style.cursor="pointer";var k=a[d].flake.substring(0,4)+"... ";
k+=gettimedifference(a[d].flakecreatetime,!0);h.appendChild(document.createTextNode(k));k=document.createElement("div");k.classList.add("col-xs-4");var l=document.createElement("div");l.classList.add("col-xs-4");if("undefined"!=typeof a[d].tags)for(var m=a[d].tags.toString().split(","),n=0;n<m.length;n++){var p=document.createElement("a");p.style.paddingRight="5px";p.style.cursor="pointer";p.addEventListener("click",function(a,b,d){return function(a){a.stopPropagation();null!=document.getElementById("msg-flake-recipient-input")&&
(document.getElementById("msg-flake-recipient-input").value=b);if("undefined"!=typeof c&&1==c){a=document.getElementsByClassName("conv-details");for(var e=0;e<a.length;e++)a[e].innerHTML="",a[e].parentNode.classList.add("hidden"),a[e].parentNode.classList.add("visuallyhidden");loadconversationmesagesbyparticipant(d,null,b)}else loadconversationsbyparticipant(null,null,b)}}(event,m[n],a[d].convid));p.appendChild(document.createTextNode(m[n]));p.classList.add("pull-right");l.appendChild(p)}g.appendChild(h);
g.appendChild(k);g.appendChild(l);h=document.createElement("div");h.classList.add("panel-body");h.classList.add("hidden");h.classList.add("visuallyhidden");h.style.transition="all 3s ease-in-out";h.style.display="block";k=document.createElement("div");k.classList.add("col-xs-12");k.classList.add("conv-details");k.setAttribute("id","conv-data-"+a[d].convid);h.appendChild(k);f.appendChild(g);e.appendChild(f);e.appendChild(h);b.appendChild(e)}console.log("about to end .. showing displayconvosondiv");
$("#convertransmodal").modal("show")}
function displaynewpost(a,b){b=document.getElementById(b);if(null!=a){if(null==document.getElementById("post-content-row")){var c=document.createElement("div");c.classList.add("panel-body");c.classList.add("panel-word-wrap");var d=document.createElement("div");d.classList.add("col-12");d.classList.add("text-center");var e=document.createElement("div");e.classList.add("row");e.style.margin="5px";e.setAttribute("id","post-content-row");d.appendChild(e);c.appendChild(d);b.appendChild(c)}b=document.getElementById("post-content-row");
c=JSON.parse(a.data);"undefined"===typeof c.files||null==c.files||0==c.files.length?createTextOnlyPostDisplay(c,b,a.lastseq):null==c.text||0==c.text.length?createFileOnlyPostDisplay(c,b,a.lastseq):createTextandFilePostDisplay(c,b,a.lastseq);lastpostseq=a.lastseq}}
function addauthorinfobelowpost(a,b,c,d,e,f,g,h){var k=document.createElement("div");k.classList.add("row");k.classList.add("text-center");k.style.color="#a3a3a3";var l=document.createElement("div");l.classList.add("col-md-4");l.classList.add("col-xs-6");l.style.left="3px";b=b.split(" ");var m=b[0].split("-");m=m[2]+"/"+m[0]+"/"+m[1]+" "+b[1].split(".")[0]+" MST";var n=document.createElement("div");n.classList.add("col-md-4");n.classList.add("col-xs-1");n.classList.add("text-center");b=document.createElement("div");
b.classList.add("col-md-4");b.classList.add("col-xs-5");b.classList.add("pull-right");var p=document.createElement("p");p.innerText=e;b.appendChild(document.createTextNode(gettimedifference(m,!0)+" ago"));l.appendChild(p);k.appendChild(l);k.appendChild(n);k.appendChild(b);"undefined"!==typeof f&&null!=f&&0<f.length&&(e=document.createElement("div"),e.style.display="none",e.innerText=f,e.setAttribute("name","post-tags"),k.appendChild(e));"undefined"!==typeof g&&null!=g&&0<g.length&&(f=document.createElement("div"),
f.classList.add("row"),e=document.createElement("div"),e.classList.add("col-xs-12"),e.innerHTML="\x3cp\x3ePosted to topic: "+g+"\x3c/p\x3e",e.setAttribute("name","post-topic"),f.appendChild(e),k.appendChild(f));"undefined"!==typeof h&&null!=h&&0<h.length&&(f=document.createElement("img"),f.classList.add("img-responsive"),f.classList.add("pull-right"),f.style.display="inline",f.style.float="left",f.style.opacity=".6",f.width="14",f.height="14",f.src="/static/icons/comment_64.png",f.onclick=function(){loadpostcommmentsontopicpage(h,
c,d,g)},b.appendChild(f));a.parentNode.appendChild(k)}
function loadpostcommmentsontopicpage(a,b,c,d){var e="post-comments";if(600>window.innerWidth||600>window.innerHeight)e="post-comments-mobile";document.getElementById(e).innerHTML="";var f=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");f.open("GET","/newauth/api/loadpostcomments/"+a+"/"+d,!1);f.setRequestHeader("Content-Type","application/json");f.onreadystatechange=function(){if(4==f.readyState&&200==f.status){var g=f.responseText;if(null!=g&&0<g.length){g=g.replace(/<\/?[^>]+>/gi,
"");g=JSON.parse(g);for(var h=0,k=0;k<g.length;k++)g[k].ok&&h++,displaycommentondiv(g[k],e);0==g.length?document.getElementById(e).innerHTML="\x3cp\x3e No comments to display\x3c/p\x3e":document.getElementById("cmt-count").innerText="["+h+"]";document.getElementById("full-post-display").appendChild(document.getElementById("display-post-comments-modal"));document.getElementById("flk-send-button").onclick=function(){addCommentToPost(a,d,b,c,crtime)};(600>window.innerWidth||600>window.innerHeight)&&
0<g.length&&(document.getElementById("topic-post-comment-button").src="/static/icons/comment-fill-64.png")}}};f.send(null)}function highlighttopic(a){document.getElementById("innerhex-"+a).style.cursor="pointer";$("#topicname-"+a).fadeIn(400)}function unhighlighttopic(a){document.getElementById("innerhex-"+a).style.cursor="default";$("#topicname-"+a).fadeOut(400)}
function showurlinapp(a){fadeoutelement("app");var b=document.createElement("div");b.setAttribute("id","displayloadingcontainer");b.style.position="absolute";b.style.margin="auto";b.style.top="0";b.style.left="0";b.style.right="0";b.style.bottom="0";b.style.width="200px";b.style.height="40px";var c=document.createElement("div");c.classList.add("loader");c.innerHTML="\x3ch4\x3eLoading...\x3c/h4\x3e";b.appendChild(c);b.style.zIndex="1000";b.style.opacity="1";document.getElementById("app").appendChild(b);
displayloadingicon();var d=document.getElementById("url-in-app-display");null!=d&&removediv(d);d=document.createElement("div");d.setAttribute("id","url-in-app-display");document.body.appendChild(d);var e=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");e.open("GET",a,!1);e.setRequestHeader("Content-Type","application/json");e.onreadystatechange=function(){if(4==e.readyState&&200==e.status){var a=e.responseText;null!=a&&0<a.length&&(removediv(document.getElementById("app")),
d.innerHTML=a,d.style.display="inline-block",loadPageScripts("url-in-app-display"),clearTimeout(appcalltimeoutid),fadeinelement("app"))}};e.send(null);return!1}
function showurloverapp(a){fadeoutelement("app");var b=document.createElement("div");b.setAttribute("id","displayloadingcontainer");b.style.position="absolute";b.style.margin="auto";b.style.top="0";b.style.left="0";b.style.right="0";b.style.bottom="0";b.style.width="200px";b.style.height="40px";var c=document.createElement("div");c.classList.add("loader");c.innerHTML="\x3ch4\x3eLoading...\x3c/h4\x3e";b.appendChild(c);b.style.zIndex="1000";b.style.opacity="1";document.getElementById("app").appendChild(b);
displayloadingicon();var d=document.getElementById("url-over-app-display");null!=d&&removediv(d);d=document.createElement("div");d.setAttribute("id","url-over-app-display");document.body.appendChild(d);let e=document.createElement("span");e.innerHTML="\x26times;";e.style.float="right";e.style.padding="5px";e.style.fontSize="4em";e.style.top="-0.4em";e.style.right="0px";e.style.zIndex="10000";e.style.position="absolute";e.style.display="inline-block";e.style.color="darkgray";e.style.cursor="default";
e.addEventListener("mouseover",function(a){a.target.style.color="#d3d3d3"});e.addEventListener("mouseout",function(a){a.target.style.color="#a2a2a2"});e.addEventListener("click",function(){hideloadingicon();$("#url-over-app-display").fadeOut(200);postimagesinterval&&clearInterval(postimagesinterval);settimeoutid&&clearTimeout(settimeoutid);document.body.removeEventListener("click",topicdocumentclick);document.title="newauth";fadeinelement("app")});var f=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");
f.open("GET",a,!1);f.setRequestHeader("Content-Type","application/json");f.onreadystatechange=function(){if(4==f.readyState&&200==f.status){var a=f.responseText;null!=a&&0<a.length&&(d.innerHTML=a,d.appendChild(e),d.style.display="inline-block",loadPageScripts("url-over-app-display"),clearTimeout(appcalltimeoutid))}};f.send(null);return!1}
function showflakepageinapp(a){fadeoutelement("app");var b=document.createElement("div");b.setAttribute("id","displayloadingcontainer");b.style.position="absolute";b.style.margin="auto";b.style.top="0";b.style.left="0";b.style.right="0";b.style.bottom="0";b.style.width="200px";b.style.height="40px";var c=document.createElement("div");c.classList.add("loader");c.innerHTML="\x3ch4\x3eLoading...\x3c/h4\x3e";b.appendChild(c);b.style.zIndex="1000";b.style.opacity="1";document.getElementById("app").appendChild(b);
displayloadingicon();var d=document.getElementById("topic-in-app-display");null!=d&&removediv(d);d=document.createElement("div");d.setAttribute("id","topic-in-app-display");document.body.appendChild(d);var e=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");e.open("GET","/f/"+a,!1);e.setRequestHeader("Content-Type","application/json");e.onreadystatechange=function(){if(4==e.readyState&&200==e.status){var a=e.responseText;null!=a&&0<a.length&&(d.innerHTML=a,d.style.display=
"inline-block",loadPageScripts("topic-in-app-display"),clearTimeout(appcalltimeoutid),a=document.createElement("span"),a.innerHTML="\x26times;",a.style.float="right",a.style.padding="2px 7px",a.style.fontSize="3em",a.style.top="0px",a.style.right="0px",a.style.zIndex="10000",a.style.position="absolute",a.style.display="inline-block",a.style.color="#a2a2a2",a.style.cursor="default",a.addEventListener("mouseover",function(a){a.target.style.color="#d3d3d3"}),a.addEventListener("mouseout",function(a){a.target.style.color=
"#a2a2a2"}),a.addEventListener("click",function(){hideloadingicon();document.body.removeEventListener("click",topicdocumentclick);$("#topic-in-app-display").fadeOut(200);postimagesinterval&&clearInterval(postimagesinterval);settimeoutid&&clearTimeout(settimeoutid);fadeinelement("app")}),d.appendChild(a))}};e.send(null)}
function displaycommentondiv(a,b){document.getElementById(b).style.height="50%";document.getElementById(b).style.overflowY="scroll";document.getElementById(b).style.backgroundColor="#fdfdfd";600<window.innerWidth&&600<window.innerHeight&&(document.getElementById(b).style.boxShadow="2px 2px 3px #9a9a9a");document.getElementById(b).style.opacity=.9;var c=document.createElement("div");c.classList.add("row");c.style.margin="5px";c.setAttribute("id","comment-row-"+a.conversationid+"-"+a.crtime);var d=
document.createElement("div");d.classList.add("col-12");var e=document.createElement("div");e.style.width="100%";e.style.padding="6px";e.style.borderBottom="1px solid black";if(!a.ok){var f=document.createElement("input");f.setAttribute("id","remove-"+a.conversationid+"-"+a.crtime);f.classList.add("btn");f.classList.add("btn-primary");f.classList.add("btn-xs");f.classList.add("pull-right");f.type="button";f.value="Remove";f.style.backgroundColor="tomato";var g=document.createElement("input");g.setAttribute("id",
"allow-"+a.conversationid+"-"+a.crtime);g.classList.add("btn");g.classList.add("btn-primary");g.classList.add("btn-xs");g.type="button";g.value="Allow";g.style.backgroundColor="green";g.addEventListener("click",function(){finalizecomment(a.conversationid,a.crtime,a.author,!0)});f.addEventListener("click",function(){finalizecomment(a.conversationid,a.crtime,a.author,!1)});e.appendChild(g);e.appendChild(f)}f=document.createElement("p");f.style.textAlign="left";f.appendChild(document.createTextNode(a.comment));
e.appendChild(f);f=document.createElement("div");f.classList.add("row");f.style.color="#898989";g=document.createElement("div");g.classList.add("col-xs-8");g.style.fontSize="8";g.appendChild(document.createTextNode(a.author));f.appendChild(g);document.createElement("div").classList.add("col-xs-4");g=document.createElement("div");g.classList.add("col-xs-4");g.style.fontSize="8";var h=gettimedifference(new Date(a.crtime),!0);g.appendChild(document.createTextNode(h));f.appendChild(g);e.appendChild(f);
d.appendChild(e);c.appendChild(d);document.getElementById(b).appendChild(c)}
function finalizecomment(a,b,c,d){var e=new XMLHttpRequest;e.open("POST","/newauth/api/finalizecomment",!1);e.setRequestHeader("Content-Type","application/json");e.onreadystatechange=function(){4==e.readyState&&200==e.status&&(d?(document.getElementById("allow-"+a+"-"+b).style.display="none",document.getElementById("remove-"+a+"-"+b).style.display="none"):cleardiv(document.getElementById("comment-row-"+a+"-"+b)))};c=JSON.stringify({conversationid:a,crtime:b,author:c,topic:topicname,ok:d});e.send(c)}
function createTextOnlyPostDisplay(a,b,c,d,e,f){var g=document.createElement("div");g.classList.add("col-xs-12");var h="";"undefined"==typeof d||null==d?h="post-seq-"+c:(h="post-seq-"+c+"-"+d,c+="-"+d);g.setAttribute("id",h);g.style.marginBottom="40px";g.style.boxShadow="3px 5px 7px #c9c9c9";h=document.createElement("div");h.classList.add("row");h.style.border="1px solid lightgrey";h.style.margin="10px";h.style.padding="0px";h.style.maxHeight="200px";h.style.backgroundColor="white";g.appendChild(h);
"undefined"!=typeof e&&0!=e||addpostheader(h,c);e=document.createElement("div");e.style.margin="10px";e.style.overflowY="hidden";e.style.overflowX="hidden";e.style.textAlign="left";e.style.padding="10px 10px 0px 5px";e.addEventListener("mouseover",function(a){g.style.opacity="0.8";highlightpostheader(c)});e.addEventListener("mouseout",function(a){g.style.opacity="1";unhighlightpostheader(c)});e.addEventListener("click",function(b){fadeoutelement("app");displayfulluserpost(a.text,d,f)});var k=document.createElement("p");
k.style.textOverflow="ellipsis";k.style.overflow="hidden";k.classList.add("first-line-bold");k.style.color="#848484";k.appendChild(document.createTextNode(a.text.substring(0,92)));if(92<a.text.length){var l=document.createElement("a");l.addEventListener("click",function(b){displayfulluserpost(a.text)});l.appendChild(document.createTextNode("   ...more"));k.appendChild(l)}e.appendChild(k);h.appendChild(e);parseInt(c)<lastpostseq?b.appendChild(g):(e=document.querySelectorAll('div[id^\x3d"post-seq-'+
lastpostseq+'"]')[0],b.insertBefore(g,e));return h}
function createTextandFilePostDisplay(a,b,c,d,e,f){var g=document.createElement("div");g.classList.add("col-xs-12");var h="";"undefined"==typeof d||null==d?h="post-seq-"+c:(h="post-seq-"+c+"-"+d,c+="-"+d);g.setAttribute("id",h);g.style.marginBottom="40px";g.style.boxShadow="3px 5px 7px #c9c9c9";h=document.createElement("div");h.classList.add("row");h.style.border="1px solid lightgrey";h.style.margin="10px";h.style.padding="0px";h.style.backgroundColor="white";h.style.maxHeight="200px";g.appendChild(h);
"undefined"!=typeof e&&0!=e||addpostheader(g,c);var k=!1,l=!1;a.files.forEach(function(a,b){0>a.type.indexOf("image")&&(k=!0)});k&&a.files.forEach(function(a,b){0<=a.type.indexOf("image")&&(l=!0)});if(k)if(l)n=document.createElement("div"),n.classList.add("col-xs-4"),n.classList.add("col-md-3"),n.style.height="70px",a.files.forEach(function(a,b){0<=a.type.indexOf("image")&&(b=document.createElement("img"),b.style.maxHeight="100%",b.classList.add("img-responsive"),b.classList.add("center-block"),b.src=
a.thumbnail,b.addEventListener("mouseenter",function(a){g.style.opacity="0.8";highlightpostheader(c)}),b.addEventListener("mouseleave",function(a){g.style.opacity="1";unhighlightpostheader(c)}),n.appendChild(b));0>a.type.indexOf("image")&&(b=document.createElement("div"),b.setAttribute("id","obj-heading-"+c),b.style.top="0px",b.style.maxWidth="90%",b.style.width="90%",b.style.color="#323232",b.style.textAlign="center",b.style.backgroundColor="#d2d2d2",b.style.opacity="0.8",b.style.position="absolute",
b.style.top="0px",b.style.margin="0 auto",b.style.display="none",b.appendChild(document.createTextNode(a.type.replace("application/",""))),n.appendChild(b),b=document.createElement("div"),b.setAttribute("id","obj-filename-"+c),b.style.color="#323232",b.style.margin="40px 0px 0px 10px",b.style.position="absolute",b.style.top="50px",b.style.backgroundColor="#d2d2d2",b.style.opacity="0.8",b.style.display="none",b.appendChild(document.createTextNode(a.name)),n.appendChild(b),n.addEventListener("mouseover",
function(a){$("#obj-heading-"+c).show();$("#obj-filename-"+c).show()}),n.addEventListener("mouseout",function(a){$("#obj-heading-"+c).hide();$("#obj-filename-"+c).hide()}))}),h.appendChild(n),n.addEventListener("click",function(b){fadeoutelement("app");getfullfilefrompost(c,a.text,d,f)}),parseInt(c)<lastpostseq?b.appendChild(g):(e=document.querySelectorAll('div[id^\x3d"post-seq-'+lastpostseq+'"]')[0],b.insertBefore(g,e));else{e=document.createElement("div");e.classList.add("col-xs-4");e.classList.add("col-md-3");
e.style.height="70px";e.style.backgroundColor="#c3c3c3";e.style.opacity="0.8";e.addEventListener("mouseenter",function(a){g.style.opacity="0.8";highlightpostheader(c)});e.addEventListener("mouseleave",function(a){g.style.opacity="1";unhighlightpostheader(c)});e.appendChild(document.createTextNode(a.files[0].type.replace("application/","")));var m=document.createElement("div");m.style.backgroundColor="#d2d2d2";m.style.opacity="0.8";m.appendChild(document.createTextNode(a.files[0].name));e.appendChild(m);
e.addEventListener("click",function(b){fadeoutelement("app");getfullfilefrompost(c,a.text,d)});h.appendChild(e)}else{var n=document.createElement("div");n.classList.add("col-xs-4");n.classList.add("col-md-3");a.files.forEach(function(a,b){var d=document.createElement("img");d.style.maxHeight="100%";d.classList.add("img-responsive");d.classList.add("center-block");d.src=a.thumbnail;d.addEventListener("mouseenter",function(a){g.style.opacity="0.8";highlightpostheader(c)});0<parseInt(b)?d.style.display=
"none":(d.classList.add("img-responsive"),d.classList.add("center-block"));d.addEventListener("mouseleave",function(a){g.style.opacity="1";unhighlightpostheader(c)});n.appendChild(d)});h.appendChild(n);n.addEventListener("click",function(b){fadeoutelement("app");getfullfilefrompost(c,a.text,d,f)});parseInt(c)<lastpostseq?b.appendChild(g):(e=document.querySelectorAll('div[id^\x3d"post-seq-'+lastpostseq+'"]')[0],b.insertBefore(g,e))}parseInt(c)<lastpostseq?b.appendChild(g):(e=document.querySelectorAll('div[id^\x3d"post-seq-'+
lastpostseq+'"]')[0],b.insertBefore(g,e));b=document.createElement("div");b.style.textAlign="left";b.style.position="relative";b.style.padding="10px 5px 0px 3px";b=document.createElement("div");b.classList.add("col-xs-8");b.classList.add("col-md-9");e=document.createElement("p");e.style.width="100%";e.style.position="relative";e.style.maxHeight="80px";e.style.overflow="hidden";e.style.color="#848484";e.classList.add("first-line-bold");e.appendChild(document.createTextNode(a.text.substring(0,92)));
92<a.text.length&&(m=document.createElement("a"),m.onclick=function(){loadfulluserpost(a,null)},m.appendChild(document.createTextNode("   ...more")),e.appendChild(m));b.appendChild(e);h.appendChild(b);return h}
function createFileOnlyPostDisplay(a,b,c,d,e,f){var g=document.createElement("div");g.classList.add("col-xs-12");g.classList.add("text-center");var h="";"undefined"==typeof d||null==d?h="post-seq-"+c:(h="post-seq-"+c+"-"+d,c+="-"+d);g.setAttribute("id",h);g.style.marginBottom="40px";g.style.boxShadow="3px 5px 7px #c9c9c9";h=document.createElement("div");h.classList.add("row");h.style.border="1px solid lightgrey";h.style.margin="10px";h.style.padding="0px";h.style.backgroundColor="white";h.style.maxHeight=
"200px";g.appendChild(h);"undefined"!=typeof e&&0!=e||addpostheader(h,c);var k=!1,l=!1;a.files.forEach(function(a,b){0>a.type.indexOf("image")&&(k=!0)});k&&a.files.forEach(function(a,b){0<=a.type.indexOf("image")&&(l=!0)});if(k){if(l)n=document.createElement("div"),n.style.padding="0px",n.style.position="relative",a.files.forEach(function(a,b){0<=a.type.indexOf("image")&&(b=document.createElement("img"),b.style.top="0",b.style.width="100%",b.style.maxHeight="100%",b.style.objectFit="cover",b.src=
a.thumbnail,b.addEventListener("mouseover",function(a){g.style.opacity="0.8";highlightpostheader(c)}),1==n.querySelectorAll("img").length?b.style.display="none":(b.classList.add("img-responsive"),b.classList.add("center-block")),b.addEventListener("mouseout",function(a){g.style.opacity="1";unhighlightpostheader(c)}),n.appendChild(b));0>a.type.indexOf("image")&&(b=document.createElement("div"),b.style.maxWidth="90%",b.style.width="90%",b.style.textAlign="center",b.style.top="0px",b.setAttribute("id",
"obj-heading-"+c),b.style.position="absolute",b.style.color="#323232",b.style.backgroundColor="#d2d2d2",b.style.opacity="0.8",b.style.display="none",b.appendChild(document.createTextNode(a.type.replace("application/",""))),n.appendChild(b),b=document.createElement("div"),b.setAttribute("id","obj-filename-"+c),b.style.color="#323232",b.style.margin="40px 0px 0px 10px",b.style.position="absolute",b.style.top="50px",b.style.backgroundColor="#d2d2d2",b.style.opacity="0.8",b.style.display="none",b.appendChild(document.createTextNode(a.name)),
n.appendChild(b),n.addEventListener("mouseover",function(a){$("#obj-heading-"+c).show();$("#obj-filename-"+c).show()}),n.addEventListener("mouseout",function(a){$("#obj-heading-"+c).hide();$("#obj-filename-"+c).hide()}))}),h.appendChild(n),n.addEventListener("click",function(b){fadeoutelement("app");getfullfilefrompost(c,a.text,d,f)});else{e=document.createElement("div");e.style.padding="0px";e.style.margin="0px";e.style.width="100%";e.style.top="0px";e.style.color="#323232";e.style.backgroundColor=
"#d2d2d2";e.addEventListener("mouseover",function(a){g.style.opacity="0.8";highlightpostheader(c)});e.addEventListener("mouseout",function(a){g.style.opacity="1";unhighlightpostheader(c)});e.appendChild(document.createTextNode(file.type.replace("application/","")));var m=document.createElement("div");m.style.margin="40px 0px 0px 10px";m.style.position="absolute";m.style.backgroundColor="#d2d2d2";m.style.color="#323232";m.style.opacity="0.8";m.appendChild(document.createTextNode(file.name));e.appendChild(m);
e.addEventListener("click",function(b){fadeoutelement("app");getfullfilefrompost(c,a.text,d,f)});h.appendChild(e)}parseInt(c)<lastpostseq?b.appendChild(g):(e=document.querySelectorAll('div[id^\x3d"post-seq-'+lastpostseq+'"]')[0],b.insertBefore(g,e))}else{var n=document.createElement("div");n.style.padding="0px";n.style.position="relative";a.files.forEach(function(a,b){var d=document.createElement("img");d.style.top="0";d.style.width="100%";d.style.maxHeight="100%";d.style.objectFit="cover";d.src=
a.thumbnail;d.addEventListener("mouseover",function(a){g.style.opacity="0.8";highlightpostheader(c)});0<parseInt(b)?d.style.display="none":(d.classList.add("img-responsive"),d.classList.add("center-block"));d.addEventListener("mouseout",function(a){g.style.opacity="1";unhighlightpostheader(c)});n.appendChild(d)});h.appendChild(n);n.addEventListener("click",function(b){fadeoutelement("app");getfullfilefrompost(c,a.text,d,f)});parseInt(c)<lastpostseq?b.appendChild(g):(e=document.querySelectorAll('div[id^\x3d"post-seq-'+
lastpostseq+'"]')[0],b.insertBefore(g,e))}return h}function highlightpostheader(a){null!=document.getElementById("post-header-"+a)&&(document.getElementById("post-header-"+a).style.opacity="0.8")}function unhighlightpostheader(a){null!=document.getElementById("post-header-"+a)&&(document.getElementById("post-header-"+a).style.opacity="0.1")}
function getfullfilefrompost(a,b,c,d){var e=new XMLHttpRequest,f=document.getElementById("post-seq-"+a),g=null;null!=f&&(f=f.querySelector('div[name\x3d"post-tags"]'),null!=f&&(g=f.innerText));a+="";0<=a.indexOf("-")&&(a=a.split("-")[0]);e.open("GET","/newauth/api/getpostfullimage/"+c+"/"+a,!1);e.setRequestHeader("Content-Type","application/json");e.onreadystatechange=function(){if(4==e.readyState&&200==e.status){var f=e.responseText;null!=f&&0<f.length&&loadfulluserpost(JSON.parse(f),b,g,d,c,a)}};
e.send(null)}
function loadfulluserpost(a,b,c,d,e,f){hideloadingicon();null!=appcalltimeoutid&&clearTimeout(appcalltimeoutid);appcalltimeoutid=null;var g=document.getElementById("full-post-display");null!=g&&removediv(g);g=document.createElement("div");g.setAttribute("id","full-post-display");g.classList.add("effect7");document.body.appendChild(g);var h=document.createElement("div");h.classList.add("container-fluid");var k=document.createElement("div");k.classList.add("row");k.style.zIndex=100;var l=document.createElement("div");
l.classList.add("col-xs-12");l.classList.add("col-md-12");l.classList.add("text-center");var m=document.createElement("p"),n=document.createElement("a");n.onclick=function(){displayThirdPartyFlakeDetails(a.ownerflake,x,y,"full-post-display")};"A"===a.giveouttype&&(n.innerHTML="\x3cem\x3e"+a.giveout+"\x3c/em\x3e");"N"===a.giveouttype&&(n.innerHTML="\x3cstrong\x3e"+a.giveout+"\x3c/strong\x3e");null!=a.giveouttype&&"F"!==a.giveouttype||n.setAttribute("id","tiny-flake-display");n.style.fontSize="15px";
var p=document.createElement("div"),r=document.createTextNode(getdatefromdatetime(a.createdate));m.style.color="#727272";m.style.maxWidth="100";m.appendChild(r);p.appendChild(m);m=document.createElement("div");m.classList.add("row");var q=document.createElement("div");q.classList.add("col-xs-4");q.classList.add("col-md-4");var v=document.createElement("div");v.classList.add("col-xs-4");v.classList.add("col-md-4");r=document.createElement("div");r.classList.add("col-xs-4");r.classList.add("col-md-4");
q.appendChild(n);v.appendChild(p);m.appendChild(q);m.appendChild(v);n=document.createElement("div");n.classList.add("row");n.classList.add("no-gutters");p=document.createElement("div");p.classList.add("col-xs-4");p.classList.add("col-md-4");q=document.createElement("div");q.classList.add("col-xs-4");q.classList.add("col-md-4");v=document.createElement("div");v.classList.add("col-xs-4");v.classList.add("col-md-4");n.appendChild(p);n.appendChild(q);n.appendChild(v);let w=document.createElement("div");
w.innerHTML='\x3cimg width\x3d"16" height\x3d"16" src\x3d"/static/icons/cross-sign.png"/\x3e';w.style.float="right";w.style.padding="8px";w.style.opacity=.5;w.style.top="0px";w.style.display="inline-block";w.style.cursor="default";w.addEventListener("mouseover",function(a){a.target.style.opacity=.8});w.addEventListener("mouseout",function(a){a.target.style.opacity=.5});w.addEventListener("click",function(a){a.stopPropagation();null!=document.getElementById("display-post-comments-modal")&&(document.getElementById("topic-page-id").appendChild(document.getElementById("display-post-comments-modal")),
$("#display-post-comments-modal").modal("hide"),document.body.addEventListener("click",topicdocumentclick));$("#full-post-display").fadeOut(200);postimagesinterval&&clearInterval(postimagesinterval);settimeoutid&&clearTimeout(settimeoutid);fadeinelement("app")});v.appendChild(w);v=document.createElement("img");v.src="/static/icons/link-50.png";v.width=24;v.height=24;if(600>window.innerWidth||600>window.innerHeight)v.width=16,v.height=16;v.style.display="inline-block";v.style.cursor="default";v.addEventListener("mouseover",
function(a){a.target.style.color="#d3d3d3"});v.addEventListener("mouseout",function(a){a.target.style.color="#a2a2a2"});v.addEventListener("click",function(){displaypublicrefsforpost(e,f)});q.appendChild(v);if("undefined"!==typeof d&&null!=d&&0<d.length){q=document.createElement("img");q.setAttribute("id","topic-post-comment-button");q.style.display="block";q.style.float="right";q.style.opacity=".7";q.width=24;q.height=24;if(600>window.innerWidth||600>window.innerHeight)q.width=18,q.height=18;q.src=
"/static/icons/comment_32.png";q.title="Leave a comment";q.onclick=function(){$("#display-post-comments-modal").modal("show");document.getElementById("flk-send-button").onclick=function(){addCommentToPost(d,a.topic,e,f,a.crtime)}};p.appendChild(q)}r.appendChild(n);m.appendChild(r);l.appendChild(m);k.appendChild(l);h.appendChild(k);k=document.createElement("div");k.classList.add("row");k.style.marginTop="50px";l=document.createElement("div");l.classList.add("col-md-12");l.classList.add("text-center");
l.style.float="none";l.style.margin="0 auto";var u=document.createElement("div");p=document.createElement("h3");p.appendChild(document.createTextNode(""));p.style.color="#737373";p.style.fontWeight="900";if("undefined"!==typeof a.data){m=JSON.parse(a.data);var D=!1;null!=m&&(m.forEach(function(a,b){0>a.type.indexOf("image")&&(D=!0)}),D&&m.forEach(function(a,b){a.type.indexOf("image")}));var A=null;D?null!=m&&m.forEach(function(a,b){if(0>a.type.indexOf("image"))if(window.navigator&&window.navigator.msSaveOrOpenBlob){var c=
a.content.replace(/^[^,]+,/,"");c=base64toBlob(c,a.type);window.navigator.msSaveOrOpenBlob(c,a.name)}else if(window.navigator.userAgent.match(/iPad/i)||window.navigator.userAgent.match(/iPhone/i))b=document.createElement("a"),b.setAttribute("href",a.content),b.setAttribute("download",a.name),b.appendChild(document.createTextNode(" Click to download the file")),u.appendChild(document.createTextNode("Document preview is not working. ")),u.appendChild(b);else{A=document.createElement("object");800<window.innerWidth&&
(A.style.width=parseInt(66*window.innerWidth/100)+"px",A.style.height=parseInt(70*window.innerHeight/100)+"px");A.setAttribute("data",a.content);A.setAttribute("id","createuser-flake-text-header");0==a.type.length?A.setAttribute("type","text/plain"):A.setAttribute("type",a.type);A.style.color="#737373";A.style.fontWeight="700";var d=document.createElement("embed");d.setAttribute("src",a.content);d.setAttribute("type",a.type);800<window.innerWidth&&(d.setAttribute("width",parseInt(66*window.innerWidth/
100)+"px"),d.setAttribute("height",parseInt(70*window.innerHeight/100)+"px"));b=document.createElement("a");c=a.content.replace(/^[^,]+,/,"");c=base64toBlob(c,a.type);b.setAttribute("href",a.content);b.setAttribute("download",a.name);setTimeout(function(){},100);d.appendChild(document.createTextNode("Document preview is not working."));b.appendChild(document.createTextNode("Click to download the file"));d.appendChild(b);u.appendChild(d)}}):null!=m&&m.forEach(function(b,c){if(0<=b.type.indexOf("image")){A=
document.createElement("img");A.style.maxWidth="100%";A.style.maxHeight="80%";A.style.top="0";A.style.zIndex="1";A.style.padding="0px";A.src=b.content;var d=JSON.parse(a.data);1<d.length?(b=document.createElement("div"),b.style.position="relative",b.addEventListener("mouseover",function(a){showadditionalcontentindicator(A);settimeoutid=setTimeout(function(){updateimagesonelement(d,A)},600)}),b.addEventListener("mouseout",function(a){clearInterval(postimagesinterval);clearTimeout(settimeoutid)}),b.appendChild(A),
u.appendChild(b)):u.appendChild(A)}})}m=document.createElement("div");m.classList.add("row");r=document.createElement("div");r.classList.add("col-sm-8");r.classList.add("col-sm-offset-2");n=document.createElement("div");n.style.wordWrap="break-word";n.style.padding="5px";n.style.height=70*window.innerHeight/100;n.style.overflowY="auto";n.setAttribute("id","createuser-flake-text");p=!1;if("undefined"!==typeof a.text){b=a.text.split(/\r\n|\n\r|\n|\r/);for(q=0;q<b.length;q++)p=document.createElement("p"),
0==q&&p.classList.add("first-line-bold"),p.classList.add("text-muted"),p.style.textAlign="left",p.appendChild(document.createTextNode(b[q])),n.appendChild(p);p=!0}else if(null!=b){b=b.split(/\r\n|\n\r|\n|\r/);for(q=0;q<b.length;q++)p=document.createElement("p"),0==q&&p.classList.add("first-line-bold"),p.classList.add("text-muted"),p.style.textAlign="left",p.appendChild(document.createTextNode(b[q])),n.appendChild(p);p=!0}n.style.color="#878787";1==p&&(r.appendChild(n),m.appendChild(r),u.appendChild(m));
l.appendChild(u);k.appendChild(l);h.appendChild(k);g.appendChild(h);if(null==a.giveouttype||"F"===a.giveouttype)document.getElementById("tiny-flake-display").width="50",document.getElementById("tiny-flake-display").height="50",generateFlakeOnCanvas("tiny-flake-display",a.giveout,50,50,"tiny");"undefined"!==typeof c&&null!=c&&splashTagsInbackground(g,c);settimeoutid=setTimeout(function(){$("#full-post-display").fadeIn("fast");document.getElementById("full-post-display").style.zIndex="10000"},100)}
function displaypublicrefsforpost(a,b){var c=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");c.onreadystatechange=function(){if(4==c.readyState&&200==c.status){var a=c.responseText;null!=a&&0<a.length?loadpublicrefsforpost(JSON.parse(a)):loadpublicrefsforpost(null)}};c.open("POST","/newauth/api/getpostrefs",!1);c.withCredentials=!0;c.setRequestHeader("Content-Type","application/json");c.send(JSON.stringify({flake:a,sequence:b}))}
function loadpublicrefsforpost(a){var b=document.getElementById("public-ref-display");if(null==b){b=document.createElement("div");b.setAttribute("id","public-ref-display");document.getElementById("full-post-display").appendChild(b);var c=document.createElement("div");c.classList.add("container-fluid");var d=document.createElement("div");d.classList.add("row");d.classList.add("no-gutters");var e=document.createElement("div");e.classList.add("col-md-4");e.classList.add("col-md-offset-8");e.classList.add("col-xs-12");
var f=document.createElement("div");f.classList.add("panel");f.classList.add("panel-default");f.style.boxShadow="3px 5px 4px #aeaeae";b.addEventListener("click",function(){$("#do-comment-overlay").fadeOut(400);removediv(document.getElementById("public-ref-display"))});f.addEventListener("click",function(a){a.stopPropagation()});f.setAttribute("id","public-ref-display-content");var g=document.createElement("h3");null!=a&&g.appendChild(document.createTextNode("This post has been shared as"));g.style.color=
"#737373";g.style.fontWeight="500";f.appendChild(g);g=document.createElement("span");g.innerHTML="\x26times;";g.style.float="right";g.style.padding="2px 7px";g.style.fontSize="3em";g.style.top="0px";g.style.display="inline-block";g.style.color="#a2a2a2";g.style.cursor="default";g.addEventListener("mouseover",function(a){a.target.style.color="#d3d3d3"});g.addEventListener("mouseout",function(a){a.target.style.color="#a2a2a2"});g.addEventListener("click",function(){$("#public-ref-display").fadeOut(200);
removediv(document.getElementById("public-ref-display"))});e.appendChild(g);g=document.createElement("div");g.classList.add("panel-body");g.classList.add("panel-word-wrap");var h=document.createElement("div");h.classList.add("row");var k=document.createElement("div");k.classList.add("col-xs-10");k.classList.add("col-xs-offset-1");k.setAttribute("id","create-flk-input-holder");if(null==a){var l=document.createElement("p");l.classList.add("text-left");l.appendChild(document.createTextNode("This post has not been shared on another topic or flake"));
k.appendChild(l)}else for(var m=0;m<a.length;m++){var n=document.createElement("div");n.classList.add("row");var p=document.createElement("div");p.classList.add("col-xs-9");var r=document.createElement("div");r.classList.add("col-xs-3");n.appendChild(p);n.appendChild(r);l=document.createElement("p");l.classList.add("text-left");l.classList.add("lead");l.appendChild(document.createTextNode(a[m]));var q=document.createElement("button");q.style.float="right";q.style.top="0";q.appendChild(document.createTextNode("Copy Link"));
q=document.createElement("input");q.setAttribute("id","copy-url-"+a[m]);q.classList.add("btn");q.classList.add("btn-xs");q.classList.add("pull-right");q.type="button";q.value="Copy Link";q.addEventListener("click",function(a){return function(){var b=document.createElement("input");document.body.appendChild(b);b.setAttribute("value",newauthurl+a);b.select();document.execCommand("copy");document.body.removeChild(b);removediv(document.getElementById("public-ref-display"))}}(a[m]));p.appendChild(l);r.appendChild(q);
k.appendChild(n)}h.appendChild(k);g.appendChild(h);f.appendChild(g);e.appendChild(f);d.appendChild(e);c.appendChild(d);b.appendChild(c);$("#comment-input").focus()}settimeoutid=setTimeout(function(){$("#public-ref-display").fadeIn("fast")},200)}
function displaycommmentsonpostpage(a,b,c,d,e){var f=document.getElementById("do-comment-overlay");if(null==f){f=document.createElement("div");f.setAttribute("id","do-comment-overlay");document.getElementById("full-post-display").appendChild(f);var g=document.createElement("div");g.classList.add("container-fluid");var h=document.createElement("div");h.classList.add("row");h.classList.add("no-gutters");var k=document.createElement("div");k.classList.add("col-md-4");k.classList.add("col-md-offset-8");
k.classList.add("col-xs-12");var l=document.createElement("div");l.classList.add("panel");l.classList.add("panel-default");f.addEventListener("click",function(){$("#do-comment-overlay").fadeOut(400);removediv(document.getElementById("do-comment-overlay"))});l.addEventListener("click",function(a){a.stopPropagation()});l.setAttribute("id","do-comment-overlay-content");var m=document.createElement("h3");m.appendChild(document.createTextNode(""));m.style.color="#737373";m.style.fontWeight="900";l.appendChild(m);
m=document.createElement("span");m.innerHTML="\x26times;";m.style.float="right";m.style.padding="2px 7px";m.style.fontSize="3em";m.style.top="0px";m.style.display="inline-block";m.style.color="#a2a2a2";m.style.cursor="default";m.addEventListener("mouseover",function(a){a.target.style.color="#d3d3d3"});m.addEventListener("mouseout",function(a){a.target.style.color="#a2a2a2"});m.addEventListener("click",function(){$("#do-comment-overlay").fadeOut(200);removediv(document.getElementById("do-comment-overlay"))});
k.appendChild(m);m=document.createElement("div");m.classList.add("panel-body");m.classList.add("panel-word-wrap");var n=document.createElement("div");n.classList.add("row");var p=document.createElement("div");p.classList.add("col-sm-8");p.classList.add("col-sm-offset-2");p.classList.add("col-xs-9");p.setAttribute("id","create-flk-input-holder");n.appendChild(p);m.appendChild(n);var r=document.createElement("textarea");r.setAttribute("type","text");r.style.fontSize="14px";r.style.color="#848484";r.setAttribute("placeholder",
"Add your comments");r.setAttribute("id","comment-input");r.setAttribute("autofocus","true");r.classList.add("form-control");r.classList.add("input-md");r.addEventListener("keydown",function(a){autoGrow(event.target)},!1);r.addEventListener("input",function(){$("#flk-send-button").fadeIn("slow")},!1);r.style.color="#646464";var q=document.createElement("input");q.setAttribute("id","flk-send-button");q.classList.add("btn");q.classList.add("btn-primary");q.classList.add("btn-md");q.conversationID="";
q.changestarttime="";q.type="button";q.value="Add";q.style.display="none";q.onclick=function(){addCommentToPost(a,b,c,d,e)};var v=document.createElement("div");v.classList.add("col-sm-2");v.classList.add("col-xs-3");n.appendChild(v);p.appendChild(r);v.appendChild(q);m.appendChild(n);m.appendChild(document.createElement("br"));p=document.createElement("div");p.classList.add("row");n=document.createElement("div");n.classList.add("col-sm-8");n.classList.add("col-sm-offset-2");n.classList.add("col-xs-9");
n.setAttribute("id","create-flk-input-holder");p.appendChild(n);m.appendChild(p);m.appendChild(document.createElement("br"));p=document.createElement("input");p.setAttribute("type","text");p.setAttribute("placeholder","Name (optional)");p.setAttribute("id","comment-author-input");p.classList.add("form-control");p.classList.add("input-md");n.appendChild(p);l.appendChild(m);k.appendChild(l);h.appendChild(k);k=document.createElement("div");k.style.display="none";k.setAttribute("id","add-comment-notify-div");
g.appendChild(h);l.appendChild(k);f.appendChild(g);$("#comment-input").focus()}settimeoutid=setTimeout(function(){$("#do-comment-overlay").fadeIn("fast")},200)}
function addCommentToPost(a,b,c,d,e){var f=document.getElementById("comment-input").value,g=document.getElementById("comment-author-input").value;if(0<f.length){var h=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");h.onreadystatechange=function(){4==h.readyState&&200==h.status&&(null!=document.getElementById("display-post-comments-modal")&&$("#display-post-comments-modal").modal("hide"),null!=document.getElementById("do-comment-overlay")&&($("#do-comment-overlay").fadeOut(400),
removediv(document.getElementById("do-comment-overlay"))))};h.open("POST","/newauth/api/addcommenttopost",!1);h.withCredentials=!0;h.setRequestHeader("Content-Type","application/json");h.send(JSON.stringify({comment:f,author:g,conversationid:a,topic:b,flake:c,seq:d,crtime:e}))}else a=document.getElementById("add-comment-notify-div"),a.style.display="inline",a.innerHTML='\x3cp color\x3d"red"\x3e You have not added any comment.\x3c/p\x3e'}
function sendmessagetoflake(a){var b=document.getElementById("msg-flake-input").value,c=document.getElementById("msg-flake-author-input").value,d=document.getElementById("msg-flake-recipient-input").value;if(("undefined"==typeof document.getElementById("msg-flake-author-input").readOnly||0==document.getElementById("msg-flake-author-input").readOnly)&&0==c.length)return document.getElementById("msg-flake-author-input").style.border="2px solid red",!1;var e=window.XMLHttpRequest?new XMLHttpRequest:
new ActiveXObject("Microsoft.XMLHTTP");e.onreadystatechange=function(){if(4==e.readyState&&200==e.status){var a=[];a.push(JSON.parse(e.responseText));populateflakeconversationindiv(a,"flake-messages");600>=window.innerWidth&&(document.getElementById("flake-msg-modal").classList.remove("modal-md"),document.getElementById("flake-msg-modal").classList.remove("modal-lg"));$("#display-flake-messages-modal").modal("show");document.getElementById("flake-messages").scrollTop=document.getElementById("flake-messages").scrollHeight;
$(".modal-backdrop").removeClass("modal-backdrop");document.getElementById("msg-flake-input").value="";document.getElementById("msg-flake-input").style.height=""}};e.open("POST","/newauth/api/messagetoflake",!1);e.withCredentials=!0;e.setRequestHeader("Content-Type","application/json");document.getElementById("msg-flake-author-input").style.border="";e.send(JSON.stringify({flake:a,comment:b,author:c,recipient:d}))}
function loadflakeconvinmodal(a){populateflakeconversationindiv(a,"flake-messages");$("#display-flake-messages-modal").modal("show");document.getElementById("flake-messages").scrollTop=document.getElementById("flake-messages").scrollHeight;$(".modal-backdrop").removeClass("modal-backdrop")}
function populateflakeconversationindiv(a,b){b=document.getElementById(b);if(null!=b&&null!=a&&0<a.length){var c=document.createElement("div");c.classList.add("row");c.setAttribute("id","flake-message-row");var d=document.createElement("div");d.classList.add("col-xs-12");for(var e=0;e<a.length;e++){var f=document.createElement("div");f.classList.add("row");var g=document.createElement("div");g.classList.add("col-xs-9");"undefined"!=typeof a[e].author&&fullname!=a[e].author&&g.classList.add("col-xs-offset-3");
var h=document.createElement("div");h.classList.add("row");var k=document.createElement("div");k.classList.add("row");"undefined"==typeof a[e].author||0==a[e].author.length||fullname==a[e].author?k.classList.add("message-by-self"):k.classList.add("message-by-other");var l=document.createElement("div");l.classList.add("col-xs-9");var m=document.createElement("div");m.classList.add("col-xs-3");var n=document.createElement("div");n.classList.add("col-xs-12");var p=document.createElement("p");p.classList.add("text-muted");
p.style.margin="5 0 0 0";p.style.textAlign="left";p.appendChild(document.createTextNode(a[e].author));n.appendChild(p);h.appendChild(n);n=document.createElement("p");n.style.overflowWrap="break-word";n.style.textAlign="left";n.style.margin="5 0 0 0";n.appendChild(document.createTextNode(a[e].comment));l.appendChild(n);n=document.createElement("span");p=document.createElement("p");p.style.textAlign="right";p.style.margin="5 0 0 0";var r=gettimedifference(a[e].crtime,!0).split(" ");p.appendChild(document.createTextNode(r[0]+
r[1].charAt(0)));m.appendChild(p);k.appendChild(l);k.appendChild(n);k.appendChild(m);g.appendChild(h);g.appendChild(k);"undefined"!=typeof a[e].author&&fullname!=a[e].author&&0<document.getElementById("manageflake").innerHTML.length&&g.addEventListener("mouseenter",function(a,b,c){return function(a){a=document.getElementsByClassName("tmp-reply-btn");if(null!=a)for(var d=0;d<a.length;d++)a[d].style.display="none";a=document.createElement("input");a.classList.add("btn");a.classList.add("btn-xs");a.classList.add("pull-right");
a.classList.add("tmp-reply-btn");a.type="button";a.value="Reply";a.addEventListener("click",function(){document.getElementById("msg-flake-recipient-input").value=b});""==c.getElementsByTagName("span")[0].innerHTML?c.getElementsByTagName("span")[0].appendChild(a):c.getElementsByTagName("span")[0].getElementsByClassName("tmp-reply-btn")[0].style.display="inline-block"}}(event,a[e].author,g));f.appendChild(g);d.appendChild(f)}c.appendChild(d);b.appendChild(c)}}
function displayThirdPartyFlakeDetails(a,b,c,d){var e=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");var f="undefined"===typeof d||null==d?document.documentElement:document.getElementById(d);f.style.transitionTimingFunction="ease";f.style.opacity=.2;f.style.transition="opacity 1s";e.onreadystatechange=function(){4==e.readyState&&200==e.status&&showFlakeDetail(JSON.parse(e.responseText),b,c,d)};e.open("POST","/fc/"+a,!1);e.withCredentials=!0;e.send(JSON.stringify({reset:"hello"}))}
function runAdHocFunction(){var a=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");a.onreadystatechange=function(){4==a.readyState&&200==a.status&&alert("done")};a.open("POST","/newauth/api/adhoc",!1);a.withCredentials=!0;a.send(JSON.stringify({adhoc:"adhoc"}));return!1}
function lockUserImages(){if(0==document.getElementById("img-lock-flake").value.length)return document.getElementById("img-lock-flake").style.border="1px solid red",!1;var a=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");a.onreadystatechange=function(){4==a.readyState&&200==a.status&&alert("User images locked now")};a.open("POST","/newauth/api/lockuserimages",!1);a.withCredentials=!0;a.setRequestHeader("Content-Type","application/json");var b=document.getElementById("img-lock-flake").value;
a.send(JSON.stringify({flake:b}));return!1}
function deleteUser(){if(0==document.getElementById("img-lock-flake").value.length)return document.getElementById("img-lock-flake").style.border="1px solid red",!1;var a=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");a.onreadystatechange=function(){4==a.readyState&&200==a.status&&alert("User deleted")};a.open("POST","/newauth/api/deleteuser",!1);a.withCredentials=!0;a.setRequestHeader("Content-Type","application/json");var b=document.getElementById("img-lock-flake").value;
a.send(JSON.stringify({flake:b}));return!1}
function showFlakeDetail(a,b,c,d){var e=document.getElementById("flake-details-overlay");b=document.getElementById("flakecheckinput");var f="";f=null!=b?b.value:a.flake;if("undefined"===typeof d||null==d){var g=document.documentElement;g.style.transitionTimingFunction="ease";g.style.opacity=1;g.style.transition="opacity 1s"}else g=document.getElementById(d);if(null==e){e=document.createElement("div");e.setAttribute("id","flake-details-overlay");e.style.zIndex="12000";document.body.appendChild(e);
d=document.createElement("div");d.classList.add("container");d.classList.add("v-center");c=document.createElement("div");c.classList.add("row");var h=document.createElement("div");h.classList.add("col-md-8");h.classList.add("col-md-offset-2");b=document.createElement("div");b.classList.add("panel");b.classList.add("panel-default");e.addEventListener("click",function(){$("#flake-details-overlay").fadeOut(500);removediv(e);g.style.transitionTimingFunction="ease";g.style.opacity=1;g.style.transition=
"opacity 1s"});b.addEventListener("click",function(a){a.stopPropagation()});var k=document.createElement("h4");k.appendChild(document.createTextNode("Flake: "+f));k.style.color="#737373";k.style.fontWeight=600>window.innerWidth?"500":"900";b.appendChild(k);var l=document.createElement("IMG");l.src="/static/icons/new-page.png";l.width="24";l.title="Display flake page";l.onclick=function(){$("#flake-details-overlay").fadeOut(100);removediv(e);showflakepageinapp(f);g.style.transitionTimingFunction="ease";
g.style.opacity=1;g.style.transition="opacity 1s"};l.onmouseenter=function(){l.style.opacity=.7};l.onmouseout=function(){l.style.opacity=1};b.appendChild(l);k=document.createElement("span");k.innerHTML="\x26times;";k.style.float="right";k.style.padding="2px 7px";k.style.fontSize="3em";k.style.top="0px";k.style.display="inline-block";k.style.color="#a2a2a2";k.style.cursor="default";k.addEventListener("mouseover",function(a){a.target.style.color="#d3d3d3"});k.addEventListener("mouseout",function(a){a.target.style.color=
"#a2a2a2"});k.addEventListener("click",function(){$("#flake-details-overlay").fadeOut(500);removediv(e);g.style.transitionTimingFunction="ease";g.style.opacity=1;g.style.transition="opacity 1s"});h.appendChild(k);k=document.createElement("p");k.classList.add("lead");k.setAttribute("id","createuser-flake-text-header");if(null==a||null==a.crtime)k.style.color="#d52323",k.appendChild(document.createTextNode("Invalid flake "));else{k.style.color="#737373";var m=a.crtime.split(" "),n=m[0].split("-");m=
n[2]+"/"+n[0]+"/"+n[1]+" "+m[1].split(".")[0]+" MST";k.appendChild(document.createTextNode("Created "+gettimedifference(m,!0)+" ago"))}k.style.fontWeight=600>window.innerWidth?"120":"200";b.appendChild(k);m=document.createElement("div");m.classList.add("row");n=document.createElement("div");n.classList.add("col-sm-8");n.classList.add("col-sm-offset-2");var p=document.createElement("p");p.classList.add("text-muted");p.setAttribute("id","createuser-flake-text");null==a||null==a.crtime?p.appendChild(document.createTextNode("This flake has not been created yet.")):
("F"==a.giveouttype&&p.appendChild(document.createTextNode("By: anonymous")),"A"==a.giveouttype&&p.appendChild(document.createTextNode("By: "+a.giveout+" [Alias]")),"N"==a.giveouttype&&p.appendChild(document.createTextNode("By: "+a.giveout)));p.style.color="#878787";600>window.innerWidth?p.style.fontWeight="350":k.style.fontWeight="600";n.appendChild(p);m.appendChild(n);b.appendChild(m);k=document.createElement("div");k.classList.add("row");k.classList.add("text-center");m=document.createElement("div");
m.style.padding="10px";m.setAttribute("id","cu-flake-can");k.appendChild(m);b.appendChild(k);h.appendChild(b);c.appendChild(h);d.appendChild(c);if(null!=a&&"undefined"!==typeof a.posts&&null!=a.posts){k=new Set;for(c=0;c<a.posts.length;c++)k.add(a.posts[c].topic);c=document.createElement("div");c.classList.add("row");h=document.createElement("div");h.classList.add("col-md-12");h.classList.add("pull-left");c.appendChild(h);h.appendChild(document.createTextNode("Other topics by this user: "));k=k.values();
for(m=null;m=k.next().value;)n=document.createElement("a"),n.href="/t/"+m,n.appendChild(document.createTextNode(m)),h.appendChild(n);b.appendChild(c)}e.appendChild(d)}null!=a&&null!=a.giveout&&generateFlakeOnCanvas("cu-flake-can",a.giveout,160,120,"medium");settimeoutid=setTimeout(function(){$("#flake-details-overlay").fadeIn("fast")},200)}
function splashTagsInbackground(a,b){var c=document.createElement("canvas");c.height=window.innerHeight;c.width=window.innerWidth;c.style.top="35px";c.style.position="absolute";var d=c.getContext("2d");d.fillStyle="white";d.fillRect(0,0,c.width,c.height);b=b.split(/[,;|]+/);for(var e=0;e<b.length-1;e++){var f=window.innerHeight/(2*b.length),g=26-b[e].length/8;d.save();var h=parseInt(.03*window.innerWidth)+parseInt(.04*window.innerWidth)*(e%2+1);d.translate(Math.pow(window.innerWidth/h-1,e%2)*h,f*
(e+1));d.rotate(Math.PI/180*Math.pow(-1,e%2)*(e%2+1)*7);d.textAlign="center";d.fillStyle="lightgrey";d.font="normal  bold "+parseInt(g)+"px serif";d.fontFamily="Impact";wrapTextincanvas(d,b[e],50+10*e*Math.pow(-1,e%2),f*(e+1),window.innerWidth/6,25);d.restore()}c=c.toDataURL();a.style.background="url("+c+")"}
function base64toBlob(a,b){b=b||"";a=atob(a);for(var c=a.length,d=Math.ceil(c/1024),e=Array(d),f=0;f<d;++f){for(var g=1024*f,h=Math.min(g+1024,c),k=Array(h-g),l=0;g<h;++l,++g)k[l]=a[g].charCodeAt(0);e[f]=new Uint8Array(k)}return new Blob(e,{type:b})}function fileToBase64(a){return new Promise((b,c)=>{const d=new FileReader;d.readAsDataURL(a);d.onload=()=>b(d.result);d.onerror=a=>c(a)})}
function wrapTextincanvas(a,b,c,d,e,f){b=b.split(" ");for(var g="",h=0;h<b.length;h++){var k=g+b[h]+" ";a.measureText(k).width>e&&0<h?(a.fillText(g,c,d),g=b[h]+" ",d+=f):g=k}a.fillText(g,c,d)}
function showadditionalcontentindicator(a){if(null==document.getElementById("additional-content-indicator")){var b=document.createElement("div");b.setAttribute("id","additional-content-indicator");b.innerHTML="\x3cp style\x3d'color:#727272; width:100%; height:100%; position:absolute; bottom:20px;'\x3eHover over image to see more images\x3c/p\x3e";b.style.width="100%";b.style.height="100%";b.style.color="#727272";b.style.bottom="20px";b.style.position="absolute";b.style.top=0;b.style.left=0;b.style.opacity=
1;b.style.transition="opacity 0.6s ease 0s";b.style.textAlign="center";a.parentNode.appendChild(b)}}function updateimagesonelement(a,b){var c=0;postimagesinterval=setInterval(function(){b.src=a[c].content;c<a.length-1?c++:c=0},2200)}
function displayfulluserpost(a){var b=document.getElementById("full-post-display");null!=b&&removediv(b);b=document.createElement("div");b.setAttribute("id","full-post-display");document.body.appendChild(b);var c=document.createElement("div");c.classList.add("container");c.classList.add("v-center");var d=document.createElement("div");d.classList.add("row");var e=document.createElement("div");e.classList.add("col-md-8");e.classList.add("col-md-offset-2");var f=document.createElement("div");f.classList.add("panel");
f.classList.add("panel-default");var g=document.createElement("h3");g.appendChild(document.createTextNode(""));g.style.color="#737373";g.style.fontWeight="900";f.appendChild(g);g=document.createElement("span");g.innerHTML="\x26times;";g.style.float="right";g.style.padding="2px 7px";g.style.fontSize="3em";g.style.top="0px";g.style.display="inline-block";g.style.color="#a2a2a2";g.style.cursor="default";g.addEventListener("mouseover",function(a){a.target.style.color="#d3d3d3"});g.addEventListener("mouseout",
function(a){a.target.style.color="#a2a2a2"});g.addEventListener("click",function(){fadeinelement("app");$("#full-post-display").fadeOut(200)});e.appendChild(g);g=document.createElement("p");g.classList.add("lead");g.setAttribute("id","createuser-flake-text-header");g.appendChild(document.createTextNode("Post"));g.style.color="#737373";g.style.fontWeight="700";g=document.createElement("div");g.classList.add("row");var h=document.createElement("div");h.classList.add("col-sm-8");h.classList.add("col-sm-offset-2");
var k=document.createElement("p");k.classList.add("text-muted");k.style.textAlign="left";k.style.wordWrap="break-word";k.setAttribute("id","createuser-flake-text");k.appendChild(document.createTextNode(a));k.style.color="#878787";k.style.fontWeight="600";h.appendChild(k);g.appendChild(h);f.appendChild(g);e.appendChild(f);d.appendChild(e);c.appendChild(d);b.appendChild(c);settimeoutid=setTimeout(function(){$("#full-post-display").fadeIn("fast")},100)}
function addpostheader(a,b){var c=document.createElement("div");c.setAttribute("id","post-header-"+b);c.style.margin="0";c.style.width="100%";c.style.height="20px";c.style.position="absolute";c.style.top="0";c.style.left="0";c.style.backgroundColor="#ffffff";c.style.zIndex="10";c.style.opacity="0.1";c.style.transition="opacity .6s";c.addEventListener("mouseover",function(a){c.style.opacity="0.9"});a.appendChild(c);a=document.createElement("span");a.innerHTML="\x3cimg src\x3d/static/icons/pencil-16.png\x3e";
a.style.float="left";a.style.height="20px";a.style.padding="1px 3px";a.style.margin="0px";a.style.fontSize="1.4em";a.style.top="0px";a.style.display="inline-block";a.style.color="#a2a2a2";a.style.cursor="default";a.addEventListener("mouseover",function(a){a.target.style.color="#d3d3d3"});a.addEventListener("mouseout",function(a){a.target.style.color="#a2a2a2"});a.addEventListener("click",function(a){a.stopPropagation();showsignuserpostmodal(b)});c.appendChild(a);a=document.createElement("span");a.innerHTML=
"\x26times;";a.style.float="right";a.style.height="20px";a.style.padding="1px 3px";a.style.margin="0px";a.style.fontSize="3em";a.style.top="0px";a.style.display="inline-block";a.style.color="#a2a2a2";a.style.cursor="default";a.addEventListener("mouseover",function(a){a.target.style.color="#d3d3d3"});a.addEventListener("mouseout",function(a){a.target.style.color="#a2a2a2"});a.addEventListener("click",function(){deleteuserpost(b)});c.appendChild(a)}
function refreshposts(a){displaynewpost(a,"user-posts-display")}function deleteuserpost(a){var b=a;a+="";0<=a.indexOf("-")&&(a=a.split("-")[0]);var c=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");c.onreadystatechange=function(){4==c.readyState&&200==c.status&&removepostfrompage(b)};c.open("POST","/newauth/api/deleteuserpost",!1);c.withCredentials=!0;c.setRequestHeader("Content-Type","application/json");c.send(JSON.stringify({sequence:a}))}
function showsignuserpostmodal(a){document.getElementById("post-preview-in-modal").innerHTML="";document.getElementById("post-preview-in-modal").innerHTML=document.getElementById("post-seq-"+a).innerHTML;document.getElementById("posttopic").value="";document.getElementById("posttags").value="";document.getElementById("postseq").value=a;document.getElementById("signuserpost-btn").display="block";document.getElementById("usersignpostnotify").innerHTML="";document.getElementById("post-global-url").innerHTML=
newauthurl+"/f/"+loggedinuserflake;$("#signuserpostmodal").modal("show")}function handletopicchange(){topicautocomplete(document.getElementById("posttopic"),[])}function handleflakesearch(){flakeautocomplete(document.getElementById("flakecheckinput"),[])}function handlegenericsearch(){genericinputautocomplete(document.getElementById("orgmembersearchinput"),[])}
function signuserpost(){var a=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");a.onreadystatechange=function(){if(4==a.readyState&&200==a.status){var b=document.getElementById("post-global-url").innerText;document.getElementById("usersignpostnotify").innerHTML="Your Post will be available very soon at \x3ca href\x3d'"+b+"'\x3e"+b+"\x3c/a\x3e";document.getElementById("signuserpost-btn").display="none"}406==a.status&&(document.getElementById("usersignpostnotify").innerHTML=
"\x3cbr\x3e\x3cp class\x3d'text-danger'\x3eThe topic owner is not allowing posts currently.\x3c/p\x3e")};a.open("POST","/newauth/api/signuserpost",!1);a.withCredentials=!0;a.setRequestHeader("Content-Type","application/json");var b=document.getElementById("posttopic").value;"true"==document.getElementById("posttopic").existingTopic&&(b="#"+b);var c=document.getElementById("postseq").value;0<=c.indexOf("-")&&(c=c.split("-")[0]);var d=[],e=document.getElementById("posttags").value;if(0<e.length){e=
e.split(",;");for(var f=0;f<e.length;f++)d.push(e[f])}b=JSON.stringify({sequence:c,topic:b,tags:d});a.send(b);document.getElementById("posttopic").existingTopic="false"}function removepostfrompage(a){var b=a,c=document.getElementById("post-seq-"+b);a+="";0<=a.indexOf("-")&&(a=a.split("-")[0]);parseInt(a)==parseInt(lastpostseq)&&--lastpostseq;0==parseInt(lastpostseq)?loadHome():null!=c&&$("#post-seq-"+b).hide("slow")}
function showpurchasedialog(a){"BUS-VAULT-SUB"!=a&&populateitemdetailsinpaymentdialog(a);console.log("item data loaded");if(null==stripe){var b=document.createElement("script");b.type="text/javascript";b.setAttribute("src","https://polyfill.io/v3/polyfill.min.js?version\x3d3.52.1\x26features\x3dfetch");var c=document.createElement("script");c.type="text/javascript";c.setAttribute("src","https://js.stripe.com/v3/");document.body.appendChild(b);document.body.appendChild(c);c.addEventListener("load",
function(){stripe=Stripe(nastripekey);afterstripeloaded(a)},!1)}else afterstripeloaded(a)}
function populateitemdetailsinpaymentdialog(a){var b=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");b.onreadystatechange=function(){if(4==b.readyState&&200==b.status){var a=JSON.parse(b.responseText);"undefined"!==typeof a.amount&&(document.getElementById("na-item-amount").innerText=a.amount);"undefined"!==typeof a.summary&&(document.getElementById("na-item-small-description").innerText=a.summary);"undefined"!==typeof a.description&&(document.getElementById("na-item-description").innerText=
a.description);"undefined"!==typeof a.imageurl&&null!=a.imageurl&&(document.getElementById("na-item-photo").src=a.imageurl)}};a=document.getElementById(a).value;b.open("POST","/newauth/api/getitemdetail",!1);b.withCredentials=!0;b.setRequestHeader("Content-Type","application/json");a=JSON.stringify({name:a});b.send(a)}
function afterstripeloaded(a){loadjscssfile("/static/css/pymt-temp.css","css");var b="",c;null!=document.getElementById(a)&&(b=document.getElementById(a).value);var d={items:[{name:b}]};"BUS-VAULT-SUB"==a&&(d=getBusinessVaultOrder());fetch("/secure/paymentintent",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(d)}).then(function(a){return a.json()}).then(function(a){c=stripe.elements().create("card",{style:{base:{color:"#32325d",fontFamily:"Arial, sans-serif",fontSmoothing:"antialiased",
fontSize:"16px","::placeholder":{color:"#32325d"}},invalid:{fontFamily:"Arial, sans-serif",color:"#fa755a",iconColor:"#fa755a"}}});c.mount("#card-element");console.log("new card element mounted");c.on("change",function(a){document.querySelector("button").disabled=a.empty;document.querySelector("#card-error").textContent=a.error?a.error.message:""});var b=document.getElementById("payment-form");b.addEventListener("submit",b.submitfn=function(a,b,c){return function(a){a.preventDefault();document.querySelector("#submit-payment").disabled=
!0;e(stripe,b,c)}}(event,c,a.clientSecret))});var e=function(c,d,e){g(!0);c.confirmCardPayment(e,{payment_method:{card:d}}).then(function(c){c.error?f(c.error.message):(c=c.paymentIntent.id,g(!1),document.querySelector(".result-message").classList.remove("hidden"),document.querySelector("#submit-payment").disabled=!1,processorderinnewauth(b,c),"BUS-VAULT-SUB"==a&&(document.getElementById("brandsignedup").value=1))})},f=function(a){g(!1);var b=document.querySelector("#card-error");b.textContent=a;
setTimeout(function(){b.textContent=""},4E3)},g=function(a){a?(document.querySelector("#submit-payment").disabled=!0,document.querySelector("#spinner").classList.remove("hidden"),document.querySelector("#button-text").classList.add("hidden")):(document.querySelector("#submit-payment").disabled=!1,document.querySelector("#spinner").classList.add("hidden"),document.querySelector("#button-text").classList.remove("hidden"))};console.log("about to show paymentoverlay");"BUS-VAULT-SUB"==a&&($("#brandModal").modal("hide"),
$("#paymentOverlayModal").on("hidden.bs.modal",function(){console.log("payment modal hidden.. unmounting card element");c.unmount()}));$("#paymentOverlayModal").modal("show")}
function getBusinessVaultOrder(){var a={};document.getElementById("na-sub-items").innerHTML="";var b=1;0<document.getElementById("bus-subs-user-count-input").value.length&&(b=parseInt(document.getElementById("bus-subs-user-count-input").value));document.getElementById("order-user-count-display").innerHTML=b+"\x3cp\x3eUsers\x3c/p\x3e";a.items=[];document.getElementById("na-item-small-description").innerText="Business account";var c=document.createElement("LI");c.appendChild(document.createTextNode("Business Vault"));
a.items.push({name:"BUS-VAULT-SUB",quantity:b});document.getElementById("na-sub-items").appendChild(c);document.getElementById("bus-topic-page-chk").checked&&(a.items.push({name:"BUS-TOPIC-PAGE-SUB"}),c=document.createElement("LI"),c.appendChild(document.createTextNode("Brand Page")),document.getElementById("na-sub-items").appendChild(c));document.getElementById("app-topic-page-chk").checked&&(a.items.push({name:"APP-TOPIC-PAGE-SUB",quantity:b}),c=document.createElement("LI"),c.appendChild(document.createTextNode("Apps Pages")),
document.getElementById("na-sub-items").appendChild(c));document.getElementById("bus-newauth-identity-chk").checked&&(a.items.push({name:"BUS-NEWAUTH-IDENTITY-SUB",quantity:b}),c=document.createElement("LI"),c.appendChild(document.createTextNode("Newauth Login")),document.getElementById("na-sub-items").appendChild(c));document.getElementById("bus-newauth-pers-img-chk").checked&&(a.items.push({name:"BUS-NEWAUTH-PERS-IMAGE-SUB",quantity:b}),b=document.createElement("LI"),b.appendChild(document.createTextNode("User personal images")),
document.getElementById("na-sub-items").appendChild(b));document.getElementById("bus-newauth-brand-img-chk").checked&&(a.items.push({name:"BUS-NEWAUTH-BRAND-IMAGE-SUB"}),b=document.createElement("LI"),b.appendChild(document.createTextNode("Brand Image")),document.getElementById("na-sub-items").appendChild(b));document.getElementById("bus-newauth-export-data-chk").checked&&(a.items.push({name:"BUS-NEWAUTH-EXPORT-DATA-SUB"}),b=document.createElement("LI"),b.appendChild(document.createTextNode("Vault Data export")),
document.getElementById("na-sub-items").appendChild(b));return a}function loadjscssfile(a,b){if("js"==b){var c=document.createElement("script");c.setAttribute("type","text/javascript");c.setAttribute("src",a)}else"css"==b&&(c=document.createElement("link"),c.setAttribute("rel","stylesheet"),c.setAttribute("type","text/css"),c.setAttribute("href",a));"undefined"!=typeof c&&document.getElementsByTagName("head")[0].appendChild(c)}
function removejscssfile(a,b){var c="js"==b?"src":"css"==b?"href":"none";b=document.getElementsByTagName("js"==b?"script":"css"==b?"link":"none");for(var d=b.length;0<=d;d--)b[d]&&null!=b[d].getAttribute(c)&&-1!=b[d].getAttribute(c).indexOf(a)&&b[d].parentNode.removeChild(b[d])}
function processorderinnewauth(a,b){var c=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");c.onreadystatechange=function(){4==c.readyState&&200==c.status&&(0<a.indexOf("IMG")&&(document.getElementById("img-sub-content").innerHTML="",displaypersonalauthimages("img-sub-content")),setTimeout(function(){removejscssfile("/static/css/pymt-temp.css","css");document.querySelector(".result-message").classList.add("hidden");"BUS-VAULT-SUB"==a&&(document.querySelector("#signedup").value=
"1");$("#paymentOverlayModal").modal("hide")},2E3))};c.open("POST","/newauth/api/processorder",!1);c.withCredentials=!0;c.setRequestHeader("Content-Type","application/json");b=JSON.stringify({name:a,paymentintentid:b});c.send(b)}
function displaypersonalauthimages(a){a=document.getElementById(a);var b=document.createElement("p");b.classList.add("lead");b.appendChild(document.createTextNode("These are your personal images. Box them to use for authentication."));a.appendChild(b);var c=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");c.onreadystatechange=function(){4==c.readyState&&200==c.status&&(JSON.parse(c.responseText),setupUser())};c.open("POST","/newauth/api/getpersonalauthimages",!1);c.withCredentials=
!0;c.setRequestHeader("Content-Type","application/json");a=JSON.stringify({});c.send(a)}function readpersonalimagefile(a,b,c){a.stopPropagation();a.preventDefault();for(var d=a.target.files,e=0;e<d.length;e++){var f=new FileReader;f.onload=function(a){return function(c){updatepersonalauthimage(c,a,b)}}(d[e]);f.readAsDataURL(d[e])}c&&c(a.target.imgcount,postcontenthome.files)}
function updatepersonalauthimage(a,b,c){imageExists(a.target.result,function(d){var e=document.getElementById(c);document.getElementById("allocatephotos").innerHTML='\x3cdiv class\x3d"loader"\x3e\x3ch4\x3eLoading...\x3c/h4\x3e\x3c/div\x3e';var f=c.split("-")[1];if(d){d=document.createElement("img");d.src=a.target.result;var g=window.screen.availWidth,h=window.screen.availWidth/2;800>g&&(g=800);600>h&&(h=600);d=getresizedimage(d,b.type,g,h);e.src=d;e.height=null;e.style.padding=null;e.style.background=
null;e.style.maxHeight="64px";e.style.maxWidth="64px";e.style.opacity=1;e.parentNode.style.opacity=1;var k=new XMLHttpRequest;k.open("POST","/updatepersonalauthimage",!1);k.setRequestHeader("Content-Type","application/json");k.onreadystatechange=function(){4==k.readyState&&200==k.status&&setupUser()};fileToBase64(b).then(function(a){a=JSON.stringify({sequence:f,data:a.split(",")[1]});k.send(a)})}else alert("Not an image file")})}
function loadOrderDetails(){var a=new XMLHttpRequest;a.open("POST","/newauth/api/getallorders",!1);a.setRequestHeader("Content-Type","application/json");a.withCredentials=!0;a.onreadystatechange=function(){if(4==a.readyState&&200==a.status){var b=JSON.parse(a.responseText),d=document.getElementById("orderdetails");d.innerHTML="";for(var e=0;e<b.length;e++){var f=document.createElement("div");f.classList.add("row");var g=document.createElement("div");g.classList.add("col-xs-3");g.appendChild(document.createTextNode((new Date(b[e].orderdate)).toLocaleDateString("en-US")));
var h=document.createElement("div");h.classList.add("col-xs-4");h.appendChild(document.createTextNode(b[e].summary));var k=document.createElement("div");k.classList.add("col-xs-2");k.appendChild(document.createTextNode("$"+b[e].amount));var l=document.createElement("div");l.classList.add("col-xs-3");var m=document.createElement("button");m.setAttribute("type","button");m.classList.add("btn-default");m.classList.add("btn-xs");m.appendChild(document.createTextNode("Cancel"));m.addEventListener("click",
function(a,b,c){return function(){cancelorder(a,b,c)}}(b[e].orderdate,b[e].name,b[e].paymentintentid));30>gettimedifferenceinsec(b[e].orderdate)/86400?"undefined"!=typeof b[e].status&&"cancelled"==b[e].status?l.appendChild(document.createTextNode("Refunded")):l.appendChild(m):l.appendChild(document.createTextNode("Trial period expired."));f.appendChild(g);f.appendChild(h);f.appendChild(k);f.appendChild(l);d.appendChild(f)}}};var b=JSON.stringify({});a.send(b)}
function cancelorder(a,b,c){var d=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");d.onreadystatechange=function(){4==d.readyState&&200==d.status&&setupUser()};d.open("POST","/newauth/api/cancelorder",!1);d.withCredentials=!0;d.setRequestHeader("Content-Type","application/json");a=JSON.stringify({orderdateinmillis:a,name:b,paymentintentid:c});d.send(a)}
function showinfocontent(a,b){var c=document.getElementById("newauth-intro-video-player").getElementsByTagName("iframe")[0];null!=c&&c.contentWindow.postMessage('{"event":"command","func":"stopVideo","args":""}',"*");document.getElementById("newauth-intro-video-player").style.display="none";var d=document.getElementsByClassName("info-btn");for(c=0;c<d.length;c++)d[c].style.backgroundColor="white";b.target.style.backgroundColor="#a5a5a5";b=document.getElementsByClassName("content-display");for(c=0;c<
b.length;c++)b[c].style.display="none";document.getElementById(a).style.display="block"};var responsedata=[],imagecounter=0,authimagecontainerdivelem,imgs,images,attemptdiv,collagex=0,collagey=0,maxzoom=2,currentzoom=0,succgrid,impliedx=0,impliedy=0,gridSize=2,zoomfurther=!0;
function displayrecoverybutton(){attemptdiv=document.querySelector("#auth-progress-display");var a=document.createElement("BUTTON");a.classList.add("btn");a.classList.add("btn-xs");a.classList.add("btn-default");a.classList.add("pull-right");a.onclick=function(a){sendrecoverycode(vaultkey)};a.innerHTML="Recover Account";null!=attemptdiv&&attemptdiv.appendChild(a)}
function displayAttemptIndicator(a){if(attemptdiv=document.querySelector("#auth-progress-display")){attemptdiv.classList.add("animated");attemptdiv.classList.add("flash");attemptdiv.classList.add("v-center");attemptdiv.innerHTML="";var b=document.createElement("p");b.classList.add("lead");b.style.maxWidth="80%";b.style.display="inline-block";b.style.textDecoration="line-through";b.style.color="#600102";a=document.createTextNode(" "+a+" ");b.appendChild(a);attemptdiv.appendChild(b)}}
function displayauthenticatingicon(){document.getElementById("displayauthenticatingcontainer").style.display="inline-block";appcalltimeoutid=setTimeout(announceapptimeouterror,1E4)}
function postCollageSelection(a){var b=document.getElementById("auth-photos");null!==b&&(b.style.display="none");collageimagesloaded=0;a="/newauth/postAuthColClickData/"+a;displayloadingicon();loadUrlAjax(a,"app");document.title="Newauth - Authenticate";loadUrlAjax("/newauth/header?page\x3dauthenticate","app-header");return!1}
function sendrecoverycode(a){var b=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");b.onreadystatechange=function(){if(4==b.readyState&&200==b.status){var c=b.responseText;console.log("response out of sendrecoverycode "+c);var e=JSON.parse(c).emaildisplay;c=JSON.parse(c).vercode;createRecoverAccountOverlay(a,e,c)}};b.open("POST","/newauth/api/sendrecoverycode",!1);b.withCredentials=!0;b.setRequestHeader("Content-Type","application/json");var c=JSON.stringify({username:hashUserForAuthentication(a)});
b.send(c)}function displayFirstImage(){hideloadingicon();null!==document.getElementById("auth-photos")&&(document.getElementById("auth-image-main-container-id").style.top="50px",document.getElementById("auth-image-main-container-id").style.left="12px",$("#auth-photos").fadeIn(500),restartTimer())}
function displayfirstimageoncanvas(){hideloadingicon();clearTimeout(appcalltimeoutid);null!==document.getElementById("auth-images")&&(imgs=document.querySelectorAll("img"),null!==imgs&&(drawimgbyindex(imgs,0),restartTimer()))}
function drawimgbyindex(a,b){document.getElementById("auth-image-main-container-id");var c=document.getElementById("imdata"+b);null!=c&&(c.style.display="block");c=document.getElementById("imgholder");c.addEventListener("click",handleauthimgclickevent,!1);var d=getnewimagesize(a[b]);c.width=d.width;c.height=d.height;c.top=0;d=c.getContext("2d");0<b&&d.clearRect(0,0,c.width,c.height);d.drawImage(a[b],0,0,c.width,c.height)}
function hideAuthImage(){document.getElementById("auth-image-main-container-id").style.display="none"}function showAuthImage(){document.getElementById("auth-image-main-container-id").style.display="table-cell"}
function getnewimagesize(a){var b=a.width,c=a.height,d=a.width/a.height;(window.innerWidth-12)/(window.innerHeight-94)<=d?window.innerWidth<a.width&&(b=window.innerWidth-12,c=b/d):window.innerHeight-94<a.height&&(c=window.innerHeight-94,b=c*d);return{width:b.toFixed(2),height:c.toFixed(2)}}
function handleauthimgclickevent(a){clearauthheadermessage();var b=gettimetoclick();null!==document.getElementById("auth-images")&&(imgs=document.querySelectorAll("img"));var c=document.getElementById("imgholder");var d=getMousePos2(c,a);x=d.x;y=d.y;if(600>window.innerWidth&&currentzoom<maxzoom&&zoomfurther){var e=document.getElementById("imgholder"),f=0,g=0,h=getgridclicked(x,y,c.width,c.height,gridSize);0<currentzoom&&(f=collagex+d.x/Math.pow(gridSize,currentzoom)-impliedx,g=collagey+d.y/Math.pow(gridSize,
currentzoom)-impliedy);impliedx=collagex+d.x/Math.pow(gridSize,currentzoom);impliedy=collagey+d.y/Math.pow(gridSize,currentzoom);if(0==currentzoom||Math.abs(f)>.1*c.width||Math.abs(g)>.1*c.height){collagex+=c.width*(h.col-1)/Math.pow(gridSize,currentzoom+1);collagey+=c.height*(h.row-1)/Math.pow(gridSize,currentzoom+1);drawGridOverImage(e,gridSize);zoomimagegrid(h,imgs[imagecounter],e);return}zoomfurther=!1}600>window.innerWidth&&(x=collagex+d.x/Math.pow(gridSize,currentzoom),y=collagey+d.y/Math.pow(gridSize,
currentzoom),collageimagesloaded=collagey=collagex=0);0<=parseInt(x)&&parseInt(x)<=c.width&&0<=parseInt(y)&&parseInt(y)<=c.height&&(b=JSON.stringify({imgID:images[imagecounter],delay:b,clickX:parseInt(x),clickY:parseInt(y),imgWidth:c.width,imgHeight:c.height}),responsedata.push(b),b=document.getElementsByClassName("auth-image-main"),b[imagecounter].style.display="none",c=document.getElementById("imdata"+imagecounter),null!=c&&(c.style.display="none"),imagecounter<b.length-1?(imagecounter++,drawimgbyindex(imgs,
imagecounter),currentzoom=0,zoomfurther=!0,restartTimer()):(attemptdiv&&(attemptdiv.classList.remove("animated"),attemptdiv.classList.remove("flash"),attemptdiv.innerHTML=""),null!=document.getElementById("imgholder")&&(document.getElementById("imgholder").style.display="none",cleardiv(document.getElementById("imgholder"))),displayauthenticatingicon(),document.getElementById("authResponseForm").responsedata.value="["+responsedata+"]",authimagecontainerdivelem.removeEventListener("click",handleauthimgclickevent,
!0),console.log("submitting auth form. counter "+imagecounter+" length "+b.length),submitFormAjax("/newauth/postAuthClickData","authResponseForm"),currentzoom=collageimagesloaded=0,zoomfurther=!0,responsedata=[],images=[]));a.stopPropagation()}
function drawcircleoverimage(a,b,c,d,e){a=a.getContext("2d");a.beginPath();a.globalAlpha=.4;a.arc(b,c,d,0,2*Math.PI,!1);a.fillStyle="white";50>e&&(a.fillStyle="darkred");70<=e&&(a.fillStyle="orange");89<=e&&(a.globalAlpha=.1,a.fillStyle="green");100==e&&(a.globalAlpha=0,a.fillStyle="black");100!=e&&a.fill();a.lineWidth=5;100!=e&&a.fill()}
function drawrectangleoverimage(a,b,c,d,e,f){var g=b.getContext("2d");g.clearRect(0,0,b.width,b.height);g.globalAlpha=1;g.drawImage(a,0,0,b.width,b.height);g.globalAlpha=.5;g.beginPath();g.rect(c,d,e,f);g.fillStyle="gray";g.fill()}
function drawGridOverImage(a,b){null==b&&(b=4);var c=b,d=a.getContext("2d");d.strokeStyle="#dddddd";for(var e=0;e<c;e++)d.save(),d.beginPath(),d.moveTo(0,a.height/c*e),d.lineTo(a.width,a.height/c*e),d.closePath(),d.stroke(),d.restore();for(c=0;c<b;c++)d.save(),d.beginPath(),d.moveTo(a.width/b*c,0),d.lineTo(a.width/b*c,a.height),d.closePath(),d.stroke(),d.restore()}function getgridclicked(a,b,c,d,e){null==e&&(e=4);var f={};f.col=parseInt((a-1)*e/c+1);f.row=parseInt((b-1)*e/d+1);f.size=e;return f}
function zoomimagegrid(a,b,c){var d=c.width,e=c.height;c.getContext("2d");var f=parseInt(d/a.size*(a.col-1));2<f&&(f-=2);var g=parseInt(e/a.size*(a.row-1));2<g&&(g-=2);f=parseInt(b.width/d*collagex);g=parseInt(b.height/e*collagey);var h=parseInt(b.width/(a.size*(currentzoom+1))),k=parseInt(b.height/(a.size*(currentzoom+1)));setTimeout(function(){zoomimagecliponcanvasinsteps(b,c,a,f,g,h,k,15);currentzoom++},200)}
async function zoomimagecliponcanvasinsteps(a,b,c,d,e,f,g,h){var k=b.width,l=b.height;b=b.getContext("2d");for(var m=0;m<h;m++){var n=1+(m+1)/h;b.clearRect(0,0,k,l);var p=0,r=0,q=k*n/2;n=l*n/2;1<c.col&&(p=k*(1-(m+1)/h)/2);1<c.row&&(r=l*(1-(m+1)/h)/2);b.drawImage(a,d,e,f,g,p,r,q,n);(new Date).getTime();await sleep(parseInt(600/h))}}function sleep(a){return new Promise(b=>setTimeout(b,a))}
function imagedata_to_image(a){var b=document.createElement("canvas"),c=b.getContext("2d");b.width=a.width;b.height=a.height;c.putImageData(a,0,0);a=new Image;a.src=b.toDataURL();return a}
function getMousePos2OLD(a,b){var c=a.getBoundingClientRect();debugappui&&console.log("mouseposition getBoundingClientRect "+c.right+","+c.left+","+c.bottom+","+c.top);return 0==c.right-c.left||0==c.bottom-c.top?{x:Math.round(b.clientX),y:Math.round(b.clientY)}:{x:Math.round((b.clientX-c.left)/(c.right-c.left)*a.width),y:Math.round((b.clientY-c.top)/(c.bottom-c.top)*a.height)}}
function getMousePos2(a,b){var c=a.getBoundingClientRect();return{x:Math.round((b.clientX-c.left)/(c.right-c.left)*a.width),y:Math.round((b.clientY-c.top)/(c.bottom-c.top)*a.height)}}function gradientBackground(){return!1}function clearauthheadermessage(){$("#authmessagedisplay").fadeOut(100)}
function createRecoverAccountOverlay(a,b,c){var d=document.getElementById("recover-account-overlay");if(null==d){d=document.createElement("div");d.setAttribute("id","recover-account-overlay");document.body.appendChild(d);var e=document.createElement("div");e.classList.add("container");e.classList.add("v-center");var f=document.createElement("div");f.classList.add("row");var g=document.createElement("div");g.classList.add("col-md-8");g.classList.add("col-md-offset-2");var h=document.createElement("div");
h.classList.add("panel");h.classList.add("panel-default");var k=document.createElement("h3");k.appendChild(document.createTextNode(""));k.style.color="#737373";k.style.fontWeight="900";h.appendChild(k);k=document.createElement("span");k.innerHTML="\x26times;";k.style.float="right";k.style.padding="2px 7px";k.style.fontSize="1.6em";k.style.top="0px";k.style.display="inline-block";k.style.color="#a2a2a2";k.style.cursor="default";k.addEventListener("mouseover",function(a){a.target.style.color="#d3d3d3"});
k.addEventListener("mouseout",function(a){a.target.style.color="#a2a2a2"});k.addEventListener("click",function(){$("#recover-account-overlay").fadeOut(500);loadWelcome()});g.appendChild(k);k=document.createElement("p");k.classList.add("lead");k.setAttribute("id","createuser-flake-text-header");k.appendChild(document.createTextNode("Please enter the recovery code you received in your email."));k.style.color="#737373";k.style.fontWeight="700";h.appendChild(k);k=document.createElement("div");k.classList.add("row");
var l=document.createElement("div");l.classList.add("col-sm-8");l.classList.add("col-sm-offset-2");var m=document.createElement("p");m.classList.add("text-muted");m.setAttribute("id","createuser-flake-text");m.appendChild(document.createTextNode("We just sent a recovery code to your email address "+b+" Please enter it below"));m.style.color="#878787";m.style.fontWeight="600";l.appendChild(m);k.appendChild(l);h.appendChild(k);b=document.createElement("div");b.classList.add("panel-body");b.classList.add("panel-word-wrap");
k=document.createElement("div");k.classList.add("row");l=document.createElement("div");l.classList.add("col-sm-8");l.classList.add("col-sm-offset-2");k.appendChild(l);b.appendChild(k);m=document.createElement("input");m.setAttribute("type","text");m.setAttribute("id","recovery-code-input");m.setAttribute("autofocus","true");m.classList.add("form-control");m.classList.add("input-md");m.addEventListener("input",function(){40<document.getElementById("recovery-code-input").value.length?$("#cde-send-button").fadeIn("slow"):
document.getElementById("cde-send-button").style.display="none"},!1);m.style.color="#646464";var n=document.createElement("input");n.setAttribute("id","cde-send-button");n.classList.add("btn");n.classList.add("btn-primary");n.classList.add("btn-md");n.conversationID="";n.changestarttime="";n.type="button";n.value="Recover";n.style.display="none";n.addEventListener("click",function(){verifyrecoverycode(a,c)},!1);var p=document.createElement("div");p.classList.add("col-sm-2");k.appendChild(p);l.appendChild(m);
p.appendChild(n);b.appendChild(k);h.appendChild(b);g.appendChild(h);f.appendChild(g);e.appendChild(f);d.appendChild(e);$("#recovery-code-input").focus()}settimeoutid=setTimeout(function(){$("#recover-account-overlay").fadeIn("slow")},500)}
function verifyrecoverycode(a,b){var c=document.getElementById("recovery-code-input").value;if(null!=c&&0<c.length){var d=new XMLHttpRequest;d.open("POST","/newauth/api/verifycode",!1);d.setRequestHeader("Content-Type","application/json");d.onreadystatechange=function(){4==d.readyState&&200==d.status&&("VERIFIED"===JSON.parse(d.responseText).status.statuscode?($("#recover-account-overlay").fadeOut("slow"),loadUrlAjax("/newauth/header?page\x3dhome","app-header"),loadUrlAjax("/newauth/welcome","app")):
document.getElementById("createuser-flake-text").innerHTML='\x3cfont color\x3d"red"\x3eInvalid code. Please check \x3c/font\x3e')};a=JSON.stringify({username:hashUserForAuthentication(a),verificationKeyCode:b,verificationKeyInput:c});d.send(a)}};var currentfinalizeduserimagecount,totalimagecount,verificationcode,avatartimerinterval,loggedinusername,typingTimer,inmanage=!1;const doneTypingInterval=1500;function minimumentropy(){var a=factorial(6);a=getBaseLog(2,Math.pow(16384,6)*a);return parseFloat(Math.round(100*a)/100).toFixed(2)}
function currententropy(){if(2>currentfinalizeduserimagecount)return"--";var a=6<currentfinalizeduserimagecount?factorial(totalimagecount)/factorial(totalimagecount-currentfinalizeduserimagecount):factorial(currentfinalizeduserimagecount);a=getBaseLog(2,Math.pow(16384,currentfinalizeduserimagecount)*a);return parseFloat(Math.round(100*a)/100).toFixed(2)}
function maximumentropy(){var a=factorial(totalimagecount)/factorial(totalimagecount-6);a=getBaseLog(2,Math.pow(16384,6)*a);return parseFloat(Math.round(100*a)/100).toFixed(2)}function getBaseLog(a,b){return Math.log(b)/Math.log(a)}function factorial(a){return 0===a?1:a*factorial(a-1)}
function displayAuthScale(){var a=document.querySelector("#canvasdiv"),b=createHiDPICanvas("600","200");a.appendChild(b);a=b.getContext("2d");b.style.position="relative";a.clearRect(0,0,b.width,b.height);a.beginPath();a.moveTo(20,b.height-40);a.lineTo(b.width-20,b.height-40);a.lineTo(b.width-20,40);a.fillStyle="#c2c2c2";a.fillStyle="#c2c2c2";a.fill();a.beginPath();a.moveTo(20,b.height-40);a.quadraticCurveTo(b.width-20,b.height-40,b.width-20,40);a.fillStyle="#ffffff";a.fillStyle="#ffffff";a.fill();
a.font="9px Arial";a.fillStyle="#737373";for(var c=1;17>c;c++)a.fillText(c,20+c*(b.width-20)/16,b.height-80/3);a.font="9px Arial";a.fillText("16",b.width-20,b.height-80/3);a.fillText("6.3 M",b.width-20-5,40);a.fillStyle="#d00";6==currentfinalizeduserimagecount?a.fillText("You are here",20+currentfinalizeduserimagecount*(b.width-20)/16,b.height-40/7):a.fillText("You are here",20+currentfinalizeduserimagecount*(b.width-20)/16,b.height-40/3);a.font="9px Arial";a.fillText("Min",20+6*(b.width-20)/16,b.height-
40/3);a.fillText("Max",b.width-20-5,b.height-40/3);a.font="12px Arial";a.fillStyle="#0a0a0a";a.fillText("Boxed images",20+7.2*(b.width-20)/16,b.height-5)}
function togglesearchbyalias(){if(confirm("Are you sure you want to allow others to search you by your alias? ")){var a=new XMLHttpRequest;a.onreadystatechange=function(){4==a.readyState&&200==a.status?(document.getElementById("aliasvisiblecheck").checked=!0,document.getElementById("fullnamevisiblecheck").checked=!1,document.getElementById("giveoutspan").innerText="Alias",setupUser()):alert(a.responseText)};a.open("POST","/newauth/api/search/addalias",!1);a.setRequestHeader("Content-Type","application/json");
var b=JSON.stringify({username:document.getElementById("usernameinput").value,alias:document.getElementById("aliasinput").value,firstname:document.getElementById("firstnameinput").value,lastname:document.getElementById("lastnameinput").value});a.send(b);return!0}return!1}
function togglesearchbyflake(){if(confirm("Are you sure you want to go dark? No one will be able to search you by your name or alias.")){var a=new XMLHttpRequest;a.onreadystatechange=function(){4==a.readyState&&200==a.status?(document.getElementById("aliasvisiblecheck").checked=!1,document.getElementById("fullnamevisiblecheck").checked=!1,document.getElementById("giveoutspan").innerText="Flake",setupUser()):alert(a.responseText)};a.open("POST","/newauth/api/search/removenameandalias",!1);a.setRequestHeader("Content-Type",
"application/json");var b=JSON.stringify({username:document.getElementById("usernameinput").value,alias:document.getElementById("aliasinput").value,firstname:document.getElementById("firstnameinput").value,lastname:document.getElementById("lastnameinput").value});a.send(b);return!0}return!1}
function togglesearchbyfullname(){if(confirm("Are you sure you want to allow others to search you by your name?")){var a=new XMLHttpRequest;a.onreadystatechange=function(){4==a.readyState&&200==a.status?(document.getElementById("fullnamevisiblecheck").checked=!0,document.getElementById("giveoutspan").innerText="Full Name",setupUser()):alert(a.responseText)};a.open("POST","/newauth/api/search/addname",!1);a.setRequestHeader("Content-Type","application/json");var b=JSON.stringify({username:document.getElementById("usernameinput").value,
alias:document.getElementById("aliasinput").value,firstname:document.getElementById("firstnameinput").value,lastname:document.getElementById("lastnameinput").value});a.send(b);return!0}return!1}
function togglesearchbyemailphone(){if(confirm("Are you sure you want to allow others to search you by your email and phone?")){var a=new XMLHttpRequest;a.open("POST","/newauth/api/search/addrecoveryoptions",!1);var b=[],c=document.getElementsByClassName("current-recovery-email");if(c)for(var d=0;d<c.length;d++)b.push(c[d].getElementsByTagName("p")[0].innerText.trim());c=[];var e=document.getElementsByClassName("current-recovery-phone");if(e)for(d=0;d<e.length;d++){var f=JSON.parse('{"number":"'+
e[d].getElementsByTagName("p")[0].innerText.trim()+'"}');c.push(f)}a.setRequestHeader("Content-Type","application/json");b=JSON.stringify({username:document.getElementById("usernameinput").value,emails:b,phones:c});document.getElementById("emailphonevisiblecheck").checked=!0;a.send(b);setupUser();return!0}return!1}
function addemail(){var a=document.getElementById("emailinput").value;if(ValidateEmail(a)){document.getElementById("verificationModeDetail").innerHTML="email: "+a;var b=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");b.onreadystatechange=function(){4==b.readyState&&200==b.status&&(verificationcode=JSON.parse(b.responseText).vercode,$("#verifyModal").modal("show"))};b.open("POST","/newauth/api/addemail",!0);b.setRequestHeader("Content-Type","application/json");a=JSON.stringify({username:document.getElementById("usernameinput").value,
emails:document.getElementById("emailinput").value});b.send(a)}return!1}function deleterecoveryemail(a){alert("Not implemented "+a)}
function addphone(){var a=document.getElementById("phoneinput").value;if(ValidatePhone(a)){document.getElementById("verificationModeDetail").innerHTML="SMS: "+phone;var b=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");b.onreadystatechange=function(){4==b.readyState&&200==b.status&&(verificationcode=JSON.parse(b.responseText).vercode,$("#verifyModal").modal("show"))};b.open("POST","/newauth/api/addphone",!0);b.setRequestHeader("Content-Type","application/json");a=JSON.stringify({username:document.getElementById("usernameinput").value,
phones:'{[{"number":"'+document.getElementById("phoneinput").value+'"}]}'});b.send(a)}return!1}
function verifyCode(){document.getElementById("verificationcodeinput").classList.remove("error");var a=document.getElementById("verificationcodeinput").value,b=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");b.onreadystatechange=function(){if(4==b.readyState&&200==b.status){var a=JSON.parse(b.responseText);"VERIFIED"===a.status.statuscode?($("#verifyModal").modal("hide"),setupUser()):document.getElementById("verifyerror").innerHTML="\x3cp class\x3derror\x3e"+a.status.detail+
"\x3c/p\x3e"}};b.open("POST","/newauth/api/verifycode",!0);b.setRequestHeader("Content-Type","application/json");a=JSON.stringify({username:document.getElementById("usernameinput").value,email:document.getElementById("emailinput").value,phone:document.getElementById("phoneinput").value,verificationKeyCode:verificationcode,verificationKeyInput:a});b.send(a);return!1}
function updateUsername(){var a=hashUserForAuthentication(document.getElementById("unu-currentusername").value),b=hashUserForAuthentication(document.getElementById("unu-newusername").value);if(a!==loggedinusername)return console.log("loggedinusername"+loggedinusername+" input user hash "+a),document.getElementById("updateuserfeedback").innerText="Please check the current username entered.",!1;var c=new XMLHttpRequest;c.open("POST","/newauth/api/oktocreateusername",!1);c.setRequestHeader("Content-Type",
"application/json");c.onreadystatechange=function(){if(4==c.readyState&&200==c.status){var d=c.responseText;if(null!=d&&0<d.length){if("DONOTCREATE"==d)return document.getElementById("updateuserfeedback").innerText="This username is already taken. Please choose a different username",!1;if(confirm("You are about to change your username for Newauth. Your new user name is  '"+document.getElementById("unu-newusername").value+"'  Please make a note of this if you need to.")){document.getElementById("updateuserfeedback").innerHTML=
"";var e=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");e.onreadystatechange=function(){if(4==e.readyState&&200==e.status){var a=e.responseText;document.getElementById("updateuserfeedback").innerHTML=a}};e.open("POST","/newauth/api/updateusername",!0);e.setRequestHeader("Content-Type","application/json");d=JSON.stringify({currentusername:a,newusername:b,processcode:document.getElementById("updateuserprocesscode").value});e.send(d)}else document.getElementById("updateuserfeedback").innerText=
"Your username has not been changed."}}};c.send(JSON.stringify({username:b,clientip:""}));return!1}
function populateDeviceDisplayPanel(){var a=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");a.onreadystatechange=function(){if(4==a.readyState&&200==a.status){var b=a.responseText;if(0<b.length){b=JSON.parse(b);0<b.length?document.getElementById("deviceinfodisplaypanel").innerHTML+='\x3cp class\x3d"lead"\x3eYou can restore your device settings to any of the previous settings.\x3c/p\x3e\x3cp\x3e Age is in number of days. Users is the number of Users which have successfully authenticated from this device.\x3c/p\x3e\t\x3chr\x3e':document.getElementById("deviceinfodisplaypanel").innerHTML+=
'\x3cp class\x3d"lead"\x3eNo devices found\x3c/p\x3e';for(var d=0;d<b.length;d++)document.getElementById("deviceinfodisplaypanel").innerHTML+=b[d].useragent,navigator.userAgent.substring(0,45)==b[d].useragent.substring(0,45)&&(b[d].activeJWTId?document.getElementById("deviceinfodisplaypanel").innerHTML+="\x3cp\x3e\x3cmark\x3eCurrent device : Age: "+b[d].ageindays+" Users: "+b[d].attachedusers+"\x3c/mark\x3e\x3c/p\x3e":document.getElementById("deviceinfodisplaypanel").innerHTML+=' \x3cbutton type\x3d"button" class\x3d"btn btn-sm btn-default" onclick\x3d"return swapJWT(\''+
b[d].jwtid+"');\"\x3eID:"+b[d].jwtid.substring(0,8)+" Age: "+b[d].ageindays+" Users: "+b[d].attachedusers+"\x3c/button\x3e"),document.getElementById("deviceinfodisplaypanel").innerHTML+=" \x3chr\x3e"}}};a.open("POST","/newauth/api/devicedataforuser",!0);a.setRequestHeader("Content-Type","application/json");var b=JSON.stringify({flake:loggedinuserflake});a.send(b);document.getElementById("deviceinfodisplaypanel").innerHTML="";return!1}
function swapJWT(a){var b=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");b.onreadystatechange=function(){if(4==b.readyState&&200==b.status){var a=b.responseText;document.getElementById("deviceinfodisplaypanel").innerHTML+=a}};b.open("POST","/newauth/api/changedeviceid",!0);b.setRequestHeader("Content-Type","application/json");a=JSON.stringify({newid:a,flake:loggedinuserflake});b.send(a);return!1}
function manageOrg(a){if(a){var b=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");b.onreadystatechange=function(){if(4==b.readyState&&200==b.status&&b.responseText){var a=b.responseText;null!=a&&0<a.length&&(a=JSON.parse(a),null!=a&&(document.getElementById("orgid").value=a.orgid,document.getElementById("orgtabname").value=a.orgtabname,document.getElementById("orgname").value=a.orgname),$("#manageorgmodal").modal("show"))}};b.open("POST","/newauth/api/getorganizationinfo",
!0);b.setRequestHeader("Content-Type","application/json");var c="";null!=document.getElementById("orgownerflake")&&(c=document.getElementById("orgownerflake").value);a=JSON.stringify({orgid:a,ownerflake:c});b.send(a)}else document.getElementById("orgid").value="",document.getElementById("orgtabname").value="",document.getElementById("orgname").value="",$("#manageorgmodal").modal("show")}
function removeOrg(a,b){if(a){var c=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");c.onreadystatechange=function(){if(4==c.readyState&&200==c.status){var d=c.responseText;if(null!=d&&0<d.length&&(d=JSON.parse(d),null!=d&&(document.getElementById("orgid").value=d.orgid,document.getElementById("orgtabname").value=d.orgtabname,document.getElementById("orgname").value=d.orgname,confirm("Are you sure you want to delete organization "+document.getElementById("orgname").value)))){var f=
window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");f.onreadystatechange=function(){4==f.readyState&&200==f.status&&(removeorgfromsetuppage(a),removeorgfromheader(a))};f.open("POST","/newauth/api/removeorg",!0);f.setRequestHeader("Content-Type","application/json");d=JSON.stringify({orgid:a,orgtabname:document.getElementById("orgtabname").value,status:"Inactive",ownerflake:b});f.send(d)}}};c.open("POST","/newauth/api/getorganizationinfo",!0);c.setRequestHeader("Content-Type",
"application/json");var d=JSON.stringify({orgid:a,ownerflake:b});c.send(d)}}
function updateorg(){if(null==vaultkey||0==vaultkey.length)return createvaultkeyoverlay(),!1;var a=document.getElementById("orgid").value,b=document.getElementById("orgtabname").value,c=document.getElementById("orgname").value;if(null==a||0==a.length)for(var d=document.getElementsByClassName("user-org"),e=0;e<d.length;e++)if(d[e].getAttribute("data-orgname")==c||d[e].innerText==b)return document.getElementById("updateorg-err-message").innerText="Duplicate Org name or tabname not allowed",!1;e=sjcl.ecc.elGamal.generateKeys(384);
d=e.pub.get();var f=e.sec.get();d=sjcl.codec.base64.fromBits(d.x.concat(d.y));f=sjcl.codec.base64.fromBits(f);var g=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");g.onreadystatechange=function(){if(4==g.readyState&&200==g.status){var c=g.responseText,d=c.split(":\x3d")[1];if(null==a||0==a.length)addorgtoheader(d,b),addorgtosetuppage(d,b),addOrgPrivateKeytoUserData(c,f);$("#manageorgmodal").modal("hide")}};g.open("POST","/newauth/api/updateorg",!0);g.setRequestHeader("Content-Type",
"application/json");e="";null!=document.getElementById("orgownerflake")&&(e=document.getElementById("orgownerflake").value);c=JSON.stringify({orgid:a,orgname:c,orgtabname:b,publicKey:d,ownerflake:e,status:"active"});g.send(c);return!1}
function addOrgPrivateKeytoUserData(a,b){null!=b&&0<b.length&&getuserdatafromdb(0,function(c){var d=[];if(null!=c&&0<c.length){if("string"===typeof c&&0>c.indexOf('"'))d.push(c);else if(c=JSON.parse(c),Array.isArray(c))for(var e=0;e<c.length;e++)d.push(c[e]);else d.push(c);c={org:a,privkey:b};pushUniqueToArray(d,c)?otherkeys.push(c):d=[]}if(0<d.length){var f=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");f.open("POST","/secure/adduserdata",!1);f.withCredentials=!0;
f.setRequestHeader("Content-Type","application/json");d=encryptdatawithstretchedkey(JSON.stringify(d),vaultkey,"",0);f.onreadystatechange=function(){4==f.readyState&&200==f.status&&(clearsecureuserdatafromdb("ORGKEY"),console.log("New orgkey successfully updated to userdata."))};f.send(JSON.stringify({data:d,sequence:0}))}else console.log("The Orgkey already existed in user data, not updating...");null!=document.getElementById("vault-key-overlay")&&$("#vault-key-overlay").fadeOut("slow")})}
function pushUniqueToArray(a,b){if(-1===a.findIndex(a=>a.org===b.org))return a.push(b),!0;console.warn("Tried to add duplicate entry to array "+JSON.stringify(b));return!1}
function checkUniqueUsername(a){var b=document.getElementById("cu-username-input").value;if(6>b.length)return document.getElementById("flk-send-button").style.display="block",document.getElementById("flk-send-button").disabled="true",!1;var c=displaybuttonbehavior(a,"Wait ... checking username");fetch("/newauth/api/oktocreateusername",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:hashUserForAuthentication(b),clientip:""})}).then(a=>{if(!a.ok)throw Error("Network response was not ok");
return a.text()}).then(d=>{"OK"==d?(removediv(c),document.getElementById("cu-username-input").value=b,document.getElementById("cu-username-input").placeholder="Minimum 6 symbols",document.getElementById("cu-username-input").style.border="",document.getElementById("flk-send-button").removeAttribute("disabled"),displaybuttonbehavior(a,"Click Create button now.")):(document.getElementById("cu-username-input").style.border="2px solid red",displaybuttonbehavior(a,"Please choose a different username"),
document.getElementById("cu-username-input").value="",document.getElementById("flk-send-button").disabled="true")}).catch(a=>{console.error("Error:",a);document.getElementById("cu-username-input").style.border="2px solid red";document.getElementById("cu-username-input").value="";document.getElementById("cu-username-input").placeholder="Please try later. Network error"})}
function mobileusercreate(a){var b=document.getElementById("createuser-mobile-overlay");if(null==b){var c=function(a){typingTimer=setTimeout(function(){checkUniqueUsername(a)},doneTypingInterval)},d=function(a){clearTimeout(typingTimer)};b=document.createElement("div");b.setAttribute("id","createuser-mobile-overlay");document.body.appendChild(b);var e=document.createElement("div");e.classList.add("container");e.style.marginTop="5px";var f=document.createElement("div");f.classList.add("row");var g=
document.createElement("div");g.classList.add("col-md-8");g.classList.add("col-md-offset-2");var h=document.createElement("div");h.classList.add("panel");h.classList.add("panel-default");h.setAttribute("id","createuser-overlay-content");var k=document.createElement("h3");k.appendChild(document.createTextNode(""));k.style.color="#737373";k.style.fontWeight="900";k=document.createElement("div");k.classList.add("row");k.classList.add("text-center");var l=document.createElement("div");l.classList.add("col-xs-12");
var m=document.createElement("p");m.style.fontSize="18px";m.style.fontFamily="Arial Black";m.appendChild(document.createTextNode("Create newauth Account"));l.appendChild(m);k.appendChild(l);h.appendChild(k);k=document.createElement("div");k.classList.add("row");k.classList.add("text-center");l=document.createElement("div");l.classList.add("col-xs-4");l.classList.add("col-xs-offset-4");m=document.createElement("img");m.src="/static/icons/vlt-aniim-gif.gif";m.classList.add("center-block");m.width="65";
m.height="65";m.style.borderRadius="4px";m.setAttribute("id","cu-flake-can");l.appendChild(m);k.appendChild(l);h.appendChild(k);k=document.createElement("span");k.innerHTML="\x26times;";k.style.float="right";k.style.padding="0px 8px";k.style.fontSize="3em";k.style.top="0px";k.style.display="inline-block";k.style.color="#a2a2a2";k.style.cursor="default";k.addEventListener("mouseover",function(a){a.target.style.color="#d3d3d3"});k.addEventListener("mouseout",function(a){a.target.style.color="#a2a2a2"});
k.addEventListener("click",function(){$("#createuser-mobile-overlay").fadeOut(500);removediv(document.getElementById("createuser-mobile-overlay"))});g.appendChild(k);k=document.createElement("p");k.classList.add("lead");k.setAttribute("id","createuser-flake-text-header");k.appendChild(document.createTextNode("Choose your username"));k.style.color="#737373";k.style.fontWeight="700";k.style.paddingTop="5px";h.appendChild(k);k=document.createElement("div");k.classList.add("row");l=document.createElement("div");
l.classList.add("col-sm-8");l.classList.add("col-sm-offset-2");m=document.createElement("p");m.classList.add("text-muted");m.setAttribute("id","createuser-flake-text");m.appendChild(document.createTextNode("Your username is for your eyes only. Newauth doesn't store it. Don't share."));m.style.color="#878787";m.style.fontWeight="600";var n=document.createElement("p");n.classList.add("text-muted");n.setAttribute("id","createuser-flake-text");n.appendChild(document.createTextNode("Avoid using your full name. Other than that, choose anything you can remember and type easily."));
n.style.color="#878787";n.style.paddingLeft="8px";n.style.paddingRight="8px";n.style.paddingTop="2px";n.style.fontWeight="500";l.appendChild(m);l.appendChild(n);k.appendChild(l);h.appendChild(k);k=document.createElement("div");k.classList.add("panel-body");k.classList.add("panel-word-wrap");l=document.createElement("div");l.classList.add("row");m=document.createElement("div");m.classList.add("col-xs-8");m.setAttribute("id","create-user-input-holder");l.appendChild(m);k.appendChild(l);n=document.createElement("input");
n.setAttribute("type","password");n.setAttribute("id","cu-username-input");n.style.fontSize="18px";n.setAttribute("placeholder","At least 6 characters");n.setAttribute("autofocus","true");n.setAttribute("data-toggle","password");n.setAttribute("data-message","Show/hide username");n.classList.add("form-control");n.classList.add("input-md");n.addEventListener("input",function(a){d(a);c(a)},!1);n.style.color="#646464";var p=document.createElement("input");p.setAttribute("id","flk-send-button");p.classList.add("btn");
p.classList.add("btn-primary");p.classList.add("btn-md");p.conversationID="";p.changestarttime="";p.type="button";p.disabled="true";p.value="Create";p.style.display="block";p.addEventListener("click",function(){createaccountfrommobile(a)},!1);var r=document.createElement("div");r.classList.add("col-xs-4");l.appendChild(r);m.appendChild(n);r.appendChild(p);k.appendChild(l);h.appendChild(k);g.appendChild(h);f.appendChild(g);e.appendChild(f);b.appendChild(e);$("#cu-username-input").focus()}settimeoutid=
setTimeout(function(){$("#createuser-mobile-overlay").fadeIn("slow")},500)}
function createaccountfrommobile(a){confirm('Please confirm the username  "'+document.getElementById("cu-username-input").value+'"  . Your Newauth username should be kept private and only known to you. Newauth does not store it in a readable format. If you need to make a note of your username, do so now before continuing. Click OK to confirm and create your account.')&&(document.getElementById("flk-send-button").disabled="true",createusershell(document.getElementById("cu-username-input").value,a),
document.getElementById("createuser-mobile-overlay").style.opacity="0.6");return!1}
function createusershell(a,b){var c=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");c.onreadystatechange=function(){if(4==c.readyState&&200==c.status){var a=c.responseText;10<a.length&&(addCollageCSS(),createCollage(a),$("#createuser-mobile-overlay").fadeOut(500),removediv(document.getElementById("createuser-mobile-overlay")))}};c.open("POST","/newauth/api/addusername",!0);c.setRequestHeader("Content-Type","application/json");a=hashUserForAuthentication(a);b=JSON.stringify({username:a,
refflake:b,type:0});c.send(b);return!1}
function addCollageCSS(){const a=document.createElement("style");a.innerHTML="\n    .collage-container {\n\t\t  background-color: #545454;\n\t\t   z-index: 9998;\n      \t\tposition: fixed;\n      \t\ttop: 0;\n      \t\tleft: 0;\n      \t\twidth: 100%;\n      \t\theight:100%;\n\t\t}\n    \n    .collage {\n      display: flex;\n      align-items: flex-start; \n      justify-content: center;\n      flex-wrap: wrap;\n      top: 50%; \n      position:fixed;\n      max-height: 60%;\n\t  width: 90%;  \n\t  margin-left: auto;\n  \tmargin-right: auto;\n      transform: translateY( -50%);\n      object-fit: cover;\n      overflow: hidden;\n    }\n    \n    .collage img {\n      width: 30%;\n      opacity: 0.1;\n  \t\theight: auto;\n  \t\tmax-height: 20%;\n  \t\t\n    }\n    \n    \n  ";document.head.appendChild(a)}
function createCollage(a){var b=JSON.parse(a);a=[];for(var c=0;c<b.length;c++)a.push("/image/"+b[c].imageid);b=document.createElement("div");b.style.position="fixed";b.style.top="20px";b.style.zIndex="9999";b.style.left="50%";b.style.transform="translate(-50%, 0)";c=document.createElement("img");c.width="28";c.height="28";c.src="/static/icons/lock-64.png";b.appendChild(c);document.body.appendChild(b);b=document.createElement("div");b.classList.add("collage-container");const d=document.createElement("div");
d.classList.add("collage");var e=0;a.forEach(a=>{const b=document.createElement("img");b.src=a;15>e&&d.appendChild(b);e++});b.appendChild(d);document.body.appendChild(b);a=document.createElement("div");a.id="acct-cr-notice";a.style.position="fixed";a.style.top="50%";a.style.left="50%";a.style.width="80%";a.style.display="none";a.style.backgroundColor="#454545";a.style.opacity="0.9";a.style.zIndex="9999";a.style.textAlign="center";a.style.fontSize="18px";a.style.transform="translate(-50%, -50%)";a.style.color=
"#838383";a.innerHTML='\x3ch4 style\x3d"font-size: 18; font-family:Arial black; color: #f5f5f5;"\x3eAccount setup pending!\x3c/h4\x3e\x3cbr\x3e \x3cp style\x3d"font-size: 14; padding-left:5px; padding-right: 5px; color: #d6d6d6;"\x3eTo complete setup, you must visit our website from a Desktop or Laptop computer. Their larger screens allow us to precisely track actions during setup for improved security.\x3c/p\x3e \x3cp style\x3d"font-size: 12; padding-left:5px; padding-right: 5px;color: #bababa;"\x3eFrom a \x3cstrong\x3eDesktop or Laptop\x3c/strong\x3e, go to: \x3c/p\x3e\x3cp style\x3d"font-size: 13;padding-left:5px; padding-right: 5px;font-family:Arial black; color: #bababa;"\x3e\x3cstrong\x3ehttps://newauth.io\x3c/strong\x3e\x3c/p\x3e\x3cp style\x3d"font-size: 12; padding-left:5px; padding-right: 5px;color: #bababa;"\x3eEnter your username and follow the instructions provided. \x3c/p\x3e';
setTimeout(function(){$("#acct-cr-notice").fadeIn("slow")},2E3);document.body.appendChild(a);a=document.createElement("div");a.style.position="fixed";a.style.bottom="15px";a.style.right="15px";a.style.zIndex="9999";a.style.fontSize="18px";a.style.color="#a3a3a3";a.appendChild(document.createTextNode("n e w a u t h"));document.body.appendChild(a);const f=document.querySelectorAll(".collage img");f.forEach(a=>{a.style.transition="opacity 2s"});let g=[];setInterval(()=>{f.forEach(a=>{g.includes(a)||
(g.push(a),a.style.transition="opacity 1.2s",a.style.opacity=.8<Math.random()?1:.3,setTimeout(()=>{g=g.filter(b=>b!==a)},800))})},500)}
function createvaultkeyoverlay(a){var b=document.getElementById("vault-key-overlay");if(null==b){b=document.createElement("div");b.setAttribute("id","vault-key-overlay");document.body.appendChild(b);var c=document.createElement("div");c.classList.add("container");c.classList.add("v-center");var d=document.createElement("div");d.classList.add("row");var e=document.createElement("div");e.classList.add("col-md-8");e.classList.add("col-md-offset-2");var f=document.createElement("div");f.classList.add("panel");
f.classList.add("panel-default");var g=document.createElement("h3");g.appendChild(document.createTextNode(""));g.style.color="#737373";g.style.fontWeight="900";f.appendChild(g);g=document.createElement("span");g.innerHTML="\x26times;";g.style.float="right";g.style.padding="2px 7px";g.style.fontSize="1.6em";g.style.top="0px";g.style.display="inline-block";g.style.color="#a2a2a2";g.style.cursor="default";g.addEventListener("mouseover",function(a){a.target.style.color="#d3d3d3"});g.addEventListener("mouseout",
function(a){a.target.style.color="#a2a2a2"});g.addEventListener("click",function(){$("#vault-key-overlay").fadeOut(500)});e.appendChild(g);g=document.createElement("p");g.classList.add("lead");g.setAttribute("id","createuser-flake-text-header");g.appendChild(document.createTextNode("This operation requires data from your vault in order to proceed."));g.style.color="#737373";g.style.fontWeight="700";f.appendChild(g);g=document.createElement("div");g.classList.add("row");var h=document.createElement("div");
h.classList.add("col-sm-8");h.classList.add("col-sm-offset-2");var k=document.createElement("p");k.classList.add("text-muted");k.setAttribute("id","createuser-flake-text");k.appendChild(document.createTextNode("Please enter your Vault Key below. Your username is your vault key if you have not changed it."));k.style.color="#878787";k.style.fontWeight="600";h.appendChild(k);g.appendChild(h);f.appendChild(g);g=document.createElement("div");g.classList.add("panel-body");g.classList.add("panel-word-wrap");
h=document.createElement("div");h.classList.add("row");k=document.createElement("div");k.classList.add("col-sm-8");k.classList.add("col-sm-offset-2");h.appendChild(k);g.appendChild(h);var l=document.createElement("input");l.setAttribute("type","password");l.setAttribute("id","vault-key-input");l.setAttribute("autofocus","true");l.classList.add("form-control");l.classList.add("input-md");l.addEventListener("input",function(){6<=document.getElementById("vault-key-input").value.length?$("#cde-send-button").fadeIn("slow"):
document.getElementById("cde-send-button").style.display="none"},!1);l.style.color="#646464";l.addEventListener("keyup",function(){13===event.keyCode&&(vaultkey=document.getElementById("vault-key-input").value,getuserdatafromdb(0,function(b){if("ERROR"!=b){if("string"===typeof b&&0>b.indexOf('"'))userkey=b;else{b=JSON.parse(b);userkey=b[0];for(var c=1;c<b.length;c++)otherkeys.push(b[c])}a&&a();$("#vault-key-overlay").fadeOut("slow")}else document.getElementById("vault-key-input").style.borderColor=
"red",document.getElementById("vault-key-input").value}))},!1);var m=document.createElement("input");m.setAttribute("id","cde-send-button");m.classList.add("btn");m.classList.add("btn-primary");m.classList.add("btn-md");m.conversationID="";m.changestarttime="";m.type="button";m.value="Submit";m.style.display="none";m.addEventListener("click",function(){vaultkey=document.getElementById("vault-key-input").value;getuserdatafromdb(0,function(b){if("ERROR"!=b){if("string"===typeof b&&0>b.indexOf('"'))userkey=
b;else{b=JSON.parse(b);userkey=b[0];for(var c=1;c<b.length;c++)otherkeys.push(b[c])}a&&a();$("#vault-key-overlay").fadeOut("slow")}else document.getElementById("vault-key-input").style.borderColor="red",document.getElementById("vault-key-input").value})},!1);var n=document.createElement("div");n.classList.add("col-sm-2");h.appendChild(n);k.appendChild(l);n.appendChild(m);g.appendChild(h);f.appendChild(g);e.appendChild(f);d.appendChild(e);c.appendChild(d);b.appendChild(c);$("#vault-key-input").focus()}settimeoutid=
setTimeout(function(){$("#vault-key-overlay").fadeIn("slow")},500)}function addorgtoheader(a,b){var c=document.getElementById("hdr-right-list"),d=document.createElement("li");d.setAttribute("id","user-org-header-"+a);var e=document.createElement("a");e.onclick=function(){return loadOrgPage(loggedinuserflake,a)};e.classList.add("na-header-anchor");b=document.createTextNode(b);e.appendChild(b);d.appendChild(e);c.insertBefore(d,c.childNodes[0])}
function addorgtosetuppage(a,b){var c=document.getElementById("user-org-list"),d=document.createElement("div");d.classList.add("row");d.setAttribute("id","user-org-"+a);var e=document.createElement("div");e.classList.add("col-md-4");var f=document.createElement("p");f.classList.add("text-right");var g=document.createElement("a");g.onclick="javascript:return manageOrg('"+a+"', '"+loggedinuserflake+"');";b=document.createTextNode(b);g.appendChild(b);f.appendChild(g);e.appendChild(f);d.appendChild(e);
e=document.createElement("div");e.classList.add("col-md-4");f=document.createElement("BUTTON");f.classList.add("btn");f.classList.add("btn-xs");f.classList.add("btn-default");f.onclick=function(b){addmembertoOrgModal(a,loggedinuserflake)};f.innerHTML="Add member";e.appendChild(f);d.appendChild(e);e=document.createElement("div");e.classList.add("col-md-4");f=document.createElement("BUTTON");f.classList.add("btn");f.classList.add("btn-xs");f.classList.add("btn-default");f.onclick=function(b){removeOrg(a,
loggedinuserflake)};f.innerHTML="Remove";e.appendChild(f);d.appendChild(e);c.appendChild(d)}function removeorgfromsetuppage(a,b){a=document.getElementById("user-org-"+a);a.parentNode.removeChild(a)}function removeorgfromheader(a){a=document.getElementById("user-org-header-"+a);a.parentNode.removeChild(a)}
function addmembertoOrgModal(a,b){null!=vaultkey&&0!=vaultkey.length||createvaultkeyoverlay();if(a){var c=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");c.onreadystatechange=function(){if(4==c.readyState&&200==c.status){var a=c.responseText;null!=a&&0<a.length&&(a=JSON.parse(a),null!=a&&(document.getElementById("orgid").value=a.orgid,document.getElementById("orgtabname").value=a.orgtabname,document.getElementById("orgname").value=a.orgname,document.getElementById("orgownerflake").value=
b,document.getElementById("org-fullname-title").innerHTML=a.orgname,$("#manageorgmembermodal").modal("show")))}};c.open("POST","/newauth/api/getorganizationinfo",!0);c.setRequestHeader("Content-Type","application/json");a=JSON.stringify({orgid:a,ownerflake:b});c.send(a)}}
function exitmemberfromOrg(a,b){if("undefined"===typeof a||null==a||0==a.length)a=document.getElementById("orgid").value;"undefined"!==typeof b&&null!=b&&0!=b.length||null==document.getElementById("orgownerflake")||(b=document.getElementById("orgownerflake").value);if(a){var c=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");c.onreadystatechange=function(){if(4==c.readyState&&200==c.status){var b=c.responseText;null!=b&&0<b.length&&(removeorgfromheader(a),$("#manageorgmembermodal").modal("hide"),
loadHome())}};c.open("POST","/newauth/api/exitmemberfromorg",!0);c.setRequestHeader("Content-Type","application/json");b=JSON.stringify({orgid:a,memberflake:loggedinuserflake,ownerflake:b,isOwner:!1});c.send(b)}}
function addmembertoOrg(a,b){if("undefined"===typeof a||null==a||0==a.length)a=document.getElementById("orgid").value;var c=document.getElementById("orgmemberflake").value;"undefined"!==typeof b&&null!=b&&0!=b.length||null==document.getElementById("orgownerflake")||(b=document.getElementById("orgownerflake").value);if(null==c||15>c.length)return document.getElementById("orgmemberflake").style.border.color="#a20000",document.getElementById("memberadderror").value="Please enter new member's flake",
!1;if(a){var d=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");d.onreadystatechange=function(){if(4==d.readyState)if(200==d.status){var e=d.responseText;null!=e&&0<e.length&&0<=e.indexOf("publickey")&&(e=JSON.parse(e).publickey,null!=e&&0<e.length&&sendOrgKeyToNewMember(a,b,c,e),$("#manageorgmembermodal").modal("hide"))}else e=d.responseText,0<e.length&&(document.getElementById("orgmemberflake").style.borderColor="#a20000",document.getElementById("memberadderror").innerHTML=
e)};var e=document.getElementById("ismemberowner").checked;d.open("POST","/newauth/api/addmembertoorg",!0);d.setRequestHeader("Content-Type","application/json");e=JSON.stringify({orgid:a,memberflake:c,ownerflake:b,isOwner:e});d.send(e)}}
function sendOrgKeyToNewMember(a,b,c,d){for(var e=0;e<otherkeys.length;e++)if(otherkeys[e].org&&otherkeys[e].org.split(":\x3d")[1]==a&&otherkeys[e].org.split(":\x3d")[0]==b){var f=new sjcl.ecc.elGamal.publicKey(sjcl.ecc.curves.c384,sjcl.codec.base64.toBits(d));f=sjcl.encrypt(f,JSON.stringify(otherkeys[e]));new sjcl.ecc.elGamal.secretKey(sjcl.ecc.curves.c384,sjcl.ecc.curves.c384.field.fromBits(sjcl.codec.base64.toBits(userkey)));var g=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");
g.onreadystatechange=function(){4==g.readyState&&200==g.status&&console.log("Org keys sent to the new member")};document.getElementById("ismemberowner");g.open("POST","/newauth/api/sendsecuremessagetoflake",!0);g.setRequestHeader("Content-Type","application/json");f=JSON.stringify({flake:c,data:f,tag:"ORGKEY",publickey:d});alert(f);g.send(f)}}
function showvianaref(a){"one"==a&&(document.getElementById("mode-one-reference").style.display="block",document.getElementById("mode-two-reference").style.display="none");"two"==a&&(document.getElementById("mode-one-reference").style.display="none",document.getElementById("mode-two-reference").style.display="block")}function setupDomainForAuth(a){$("#domainsetupModal").modal("show");document.getElementById("managedomainforauth").value=a}
function updateJsonSchema(a){for(var b={},c=0;c<a.length;c++)b[a[c].name]={type:a[c].type,hashed:a[c].hashed};document.getElementById("json-schema").value=JSON.stringify(b,null,2);document.getElementById("jsoncontentstructure").value=document.getElementById("json-schema").value}
function createTopic(a){if(a){if(1==document.getElementById("jsoncontentcheck").checked){var b=[];"function"===typeof document.getElementById("add-json-field-btn").onclick?console.log("Event handler already set."):(document.getElementById("add-json-field-btn").addEventListener("click",function(){var a=document.getElementById("json-field-type").value,c=document.getElementById("json-field-name").value,f=document.getElementById("json-field-hashed").checked;c&&(b.push({name:c,type:a,hashed:f}),updateJsonSchema(b),
document.getElementById("json-field-name").value="",document.getElementById("json-field-type").value="")}),document.getElementById("json-schema").addEventListener("change",function(){document.getElementById("jsoncontentstructure").value=document.getElementById("json-schema").value}));if(0==document.getElementById("jsoncontentstructure").value.length)return 0<document.getElementById("json-schema").value.length&&(document.getElementById("jsoncontentstructure").value=document.getElementById("json-schema").value),
$("#setjsonschemamodal").modal("show"),document.getElementById("topicupdatebtn").disabled=!0,!1}var c=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");c.onreadystatechange=function(){if(4==c.readyState)if(200==c.status){if(c.responseText){var a=c.responseText;null!=a&&0<a.length&&(document.getElementById("topic-create-status").innerHTML=a,document.getElementById("createtopicname").value="",document.getElementById("createtopicname").value="",document.getElementById("topic_invite_message").value=
"",document.getElementById("inviteaddress").value="",document.getElementById("idmembersbydevice").checked=!1,document.getElementById("daystojoin").value="",document.getElementById("transferoncreatecheck").checked=!1,document.getElementById("jsoncontentcheck").checked=!1,document.getElementById("json-schema").value="",document.getElementById("jsoncontentstructure").value="",document.getElementById("hashedcontentcheck").checked=!1,document.getElementById("topicmaxdepthinput").value="",document.getElementById("topiccrtime").value=
"",document.getElementById("topicupdatebtn").disabled=!1,setTimeout(function(){$("#managetopicmodal").modal("hide")},2E3))}}else document.getElementById("createtopicname").value="",document.getElementById("createtopicname").placeholder="Please choose a different topic name",document.getElementById("createtopicname").focus(),document.getElementById("topic-create-status").style.color="darkred",document.getElementById("topic-create-status").innerHTML=c.responseText,document.getElementById("topicupdatebtn").disabled=
!1};c.open("POST","/newauth/api/createtopic",!0);c.withCredentials=!0;c.setRequestHeader("Content-Type","application/json");a=JSON.stringify({topic:document.getElementById("createtopicname").value,commentoption:document.getElementById("commentsettingsselect").value,postoption:document.getElementById("postsettingsselect").value,storeoption:document.getElementById("storagesettingsselect").value,display:document.getElementById("createtopicname").value,invitemessage:document.getElementById("topic_invite_message").value,
inviteaddress:document.getElementById("inviteaddress").value,idbydevice:document.getElementById("idmembersbydevice").checked,daystojoin:document.getElementById("daystojoin").value,transferownership:document.getElementById("transferoncreatecheck").checked,jsoncontent:document.getElementById("jsoncontentcheck").checked,jsonschema:document.getElementById("json-schema").value,hashedcontent:document.getElementById("hashedcontentcheck").checked,topicmaxdepth:document.getElementById("topicmaxdepthinput").value,
crTime:document.getElementById("topiccrtime").value});c.send(a);document.getElementById("topicupdatebtn").disabled=!0}else document.getElementById("inviteaddress").value="",document.getElementById("createtopicname").value="",document.getElementById("createtopicname").addEventListener("change",function(){var a=document.getElementById("createtopicname").value,b=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");b.onreadystatechange=function(){4==b.readyState&&200==b.status&&
b.responseText&&"EXISTS"==b.responseText&&(document.getElementById("createtopicname").value="",document.getElementById("createtopicname").placeholder="Please choose a different topic name",document.getElementById("createtopicname").focus(),document.getElementById("topic-create-status").style.fontColor="darkred",document.getElementById("topic-create-status").innerHTML="The topic name '"+a+"' is already taken.")};b.open("GET","/newauth/api/doestopicexist/"+a,!0);b.setRequestHeader("Content-Type","application/json");
b.send(null)}),document.getElementById("inviteaddress").addEventListener("input",function(){0<document.getElementById("inviteaddress").value.indexOf("@")&&(document.getElementById("transferoncreatecheck").checked=!0)}),document.getElementById("createtopicname").removeAttribute("readonly")}
function loadusertopics(){var a=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");a.onreadystatechange=function(){if(4==a.readyState&&200==a.status&&a.responseText){var b=JSON.parse(a.responseText),c=document.getElementById("user-topic-list");c.innerHTML="";for(var d=0;d<b.length;d++){var e=document.createElement("div");e.classList.add("row");e.setAttribute("id","topic-row-"+b[d].topic);var f=document.createElement("div");f.classList.add("col-xs-4");f.appendChild(document.createTextNode(b[d].topic+
" ["+b[d].hits+"]"));var g=document.createElement("div");g.classList.add("col-xs-4");var h=document.createElement("button");h.classList.add("btn");h.classList.add("btn-xs");h.classList.add("btn-default");h.appendChild(document.createTextNode("Manage"));h.addEventListener("click",function(a){return function(){manageTopic(a)}}(b[d]));g.appendChild(h);h=document.createElement("div");h.classList.add("col-xs-4");var k=document.createElement("button");k.classList.add("btn");k.classList.add("btn-xs");k.classList.add("btn-default");
k.appendChild(document.createTextNode("Remove"));k.addEventListener("click",function(a){return function(){removeTopic(a)}}(b[d]));h.appendChild(k);e.appendChild(f);e.appendChild(g);e.appendChild(h);c.appendChild(e)}}};a.open("GET","/newauth/api/gettopicsbyuser",!0);a.setRequestHeader("Content-Type","application/json");a.send(null)}
function manageTopic(a){var b=new XMLHttpRequest;b.onreadystatechange=function(){if(4==b.readyState&&200==b.status){inmanage=!0;var a=JSON.parse(b.responseText),d=parseJsonWithFallback(a.settings);null!=d&&(document.getElementById("createtopicname").value=a.topic,document.getElementById("createtopicname").setAttribute("readonly","readonly"),d.idbydevice&&(document.getElementById("idmembersbydevice").checked=!0),document.getElementById("daystojoin").value=a.daystojoin,document.getElementById("inviteaddress").value=
a.inviteaddress,d.transferownership&&(document.getElementById("transferoncreatecheck").checked=!0),document.getElementById("topic_invite_message").value=d.invitemessage,document.getElementById("commentsettingsselect").value=d.comments,document.getElementById("storagesettingsselect").value=d.storage,document.getElementById("postsettingsselect").value=d.posts,d.jsoncontent&&(document.getElementById("jsoncontentcheck").checked=!0),d.hashedcontent&&(document.getElementById("hashedcontentcheck").checked=
!0),"undefined"!=typeof d.maxdepth&&(document.getElementById("topicmaxdepthinput").value=d.maxdepth),document.getElementById("topicupdatebtn").value="Update",document.getElementById("topiccrtime").value=a.crTime,document.getElementById("json-schema").value=d.jsonschema)}};b.open("GET","/newauth/api/gettopicbyname/"+a.topic,!1);b.send(null);$("#managetopicmodal").modal("show")}
function activatetopicdeadline(a){1==a.checked?(document.getElementById("topic-join-deadline").style.display="block",document.getElementById("daystojoin").value="1"):document.getElementById("daystojoin").value="0";document.getElementById("topic-join-deadline").style.display="none";return!1}function launchmanagetopicdialog(){$("#managetopicmodal").modal("show")}
function updatetopic(){if(3<document.getElementById("createtopicname").value.length){let a=document.getElementById("createtopicname").value;if(null!=document.getElementById("topic-row-"+a.toLowerCase())&&!inmanage)return document.getElementById("topic-create-status").style.color="darkred",document.getElementById("topic-create-status").innerHTML="You have created this topic already. Please use the manage button to change its settings",!1;createTopic(document.getElementById("createtopicname").value)}else document.getElementById("topic-create-status").innerHTML=
"Topic name must be longer than 3 characters"}function removeTopic(a){var b=new XMLHttpRequest;b.onreadystatechange=function(){4==b.readyState&&200==b.status&&(document.getElementById("topic-row-"+a.topic).style.display="none")};b.open("POST","/newauth/api/removetopic",!1);b.setRequestHeader("Content-Type","application/json");var c=JSON.stringify({topic:a.topic});b.send(c)};var userdatainsystem,filenametodownload,ftypetodownload,datatodownload,filedatamap={},copytimer,lastfileseq=101,filecontentobject=[],selectedfiles={},copyclickmap={},handleFileSelect=function(a){var b=a.target.files;for(a=0;a<b.length;a++){var c=b[a];if(b&&c){var d=new FileReader;d.onload=function(a){return function(c){populateFileContent(c,a);Object.keys(selectedfiles).length===b.length&&(document.getElementById("vault-file-upload-button").disabled=!1)}}(c);0==c.type.length?d.readAsText(c):d.readAsBinaryString(c)}}},
handleImportFileSelect=function(a){a=a.target.files;var b=a[0];a&&b&&(a=new FileReader,a.onload=function(a){1>b.size/1024/1024?(loadcredcsvfile(a,b.name),document.getElementById("vault-file-import-button").disabled=!1):(document.getElementById("csvfiledisplay").appendChild(document.createTextNode("Files larger than 1 MB not allowed")),console.log("Too large a file. More than 1 MB"))},a.readAsText(b))};
function loadcredcsvfile(a,b){var c=document.getElementById("cred-csv-data").value;a=a.target.result.split(/\r?\n/);var d=null;if(0<a.length){d=document.getElementById("csvfiledisplay");d.innerHTML="";d.style.height=100;d.style.overflowY="scroll";d.style.overflowX="hidden";var e=document.createElement("div");e.classList.add("row");e.style.borderBottom="solid 1px grey";var f=document.createElement("div");f.classList.add("col-xs-3");f.innerHTML="\x3cstrong\x3eSite\x3c/strong\x3e";e.appendChild(f);f=
document.createElement("div");f.classList.add("col-xs-3");f.innerHTML="\x3cstrong\x3eUsername\x3c/strong\x3e";e.appendChild(f);f=document.createElement("div");f.classList.add("col-xs-3");f.innerHTML="\x3cstrong\x3ePassword\x3c/strong\x3e";e.appendChild(f);f=document.createElement("div");f.classList.add("col-xs-3");f.innerHTML="\x3cstrong\x3eDescription\x3c/strong\x3e";e.appendChild(f);d.appendChild(e);document.getElementById("remove-header-id").classList.remove("hidden");document.getElementById("remove-header").addEventListener("change",
function(){if(1==document.getElementById("remove-header").checked){if(null!=document.getElementById("header-possible")){document.getElementById("header-possible").style.display="none";var a=JSON.parse(document.getElementById("cred-csv-data").value);a.splice(0,1);document.getElementById("cred-csv-data").value=JSON.stringify(a);document.getElementById("remove-header").disabled=!0}}else null!=document.getElementById("header-possible")&&(document.getElementById("header-possible").style.display="block")})}for(var g=
0;g<a.length;g++){var h=a[g].split(",");4==h.length&&(e={siteUrl:h[0],sitedesc:h[3],siteuser:h[1],sitepwd:h[2],source:b},c=0==c.length?JSON.stringify(e):c+(","+JSON.stringify(e)),e=document.createElement("div"),e.classList.add("row"),0==g&&e.setAttribute("id","header-possible"),f=document.createElement("div"),f.classList.add("col-xs-3"),f.appendChild(document.createTextNode(h[0])),f.style.overflowX="hidden",e.appendChild(f),f=document.createElement("div"),f.classList.add("col-xs-3"),f.appendChild(document.createTextNode(h[1])),
f.style.overflowX="hidden",e.appendChild(f),f=document.createElement("div"),f.classList.add("col-xs-3"),f.appendChild(document.createTextNode(h[2])),f.style.overflowX="hidden",e.appendChild(f),f=document.createElement("div"),f.classList.add("col-xs-3"),f.appendChild(document.createTextNode(h[3])),f.style.overflowX="hidden",e.appendChild(f),d.appendChild(e),console.log("added one row"))}0==c.length?d.appendChild(document.createTextNode("No valid credential data found. Please check the file you selected")):
document.getElementById("cred-csv-data").value="["+c+"]"}function populateFileContent(a,b){selectedfiles[b.name+":"+b.type+":"+b.size]=btoa(a.target.result)}function unblur(){this.getAttribute("id");this.classList.remove("blur")}function blur(){this.getAttribute("id");this.classList.add("blur")}function registereventhandlers(){for(var a=document.getElementsByClassName("blur"),b=0;b<a.length;b++)a[b].addEventListener("mouseenter",unblur,!1),a[b].addEventListener("mouseleave",blur,!1)}
function checkKey(){var a=document.getElementById("keybox").value;if(0==a.length)return alert("Invalid key."),!1;vaultkey=a;displayUserDataClear();return!1}function displaykeyalert(a){$("#key-input-div").fadeIn(600);$("#no-key-alert-holder").fadeIn(600)}function processvaultsearch(){null!=settimeoutid&&clearTimeout(settimeoutid);settimeoutid=setTimeout(function(){displayUserDataClear(document.getElementById("vault-search-input").value)},200)}
function changevaultkey(){var a=document.getElementById("newvaultkey").value;if(vaultkey==a)document.getElementById("vault-key-update-notification").innerHTML="This key is identical to your current key",document.getElementById("newvaultkey").value="";else if(6>a.length)document.getElementById("vault-key-update-notification").innerHTML="Please choose a vault key longer than 6 characters",document.getElementById("newvaultkey").value="";else{var b="",c=0;if(0<JSON.parse(userdatainsystem).length){document.getElementById("vault-key-update-notification").innerHTML=
"Update in progress...";for(var d=JSON.parse(userdatainsystem),e=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP"),f=0;f<d.length;f++)if(0===d[f].sequence){var g=sjcl.decrypt(vaultkey,d[f].data);g=encryptdatawithstretchedkey(g,a,"",0);e.open("POST","/secure/adduserdata",!1);e.withCredentials=!0;e.setRequestHeader("Content-Type","application/json");e.send(JSON.stringify({salt:d[f].salt,iterations:d[f].iterations,data:g,sequence:d[f].sequence,createdate:d[f].createdate}))}else if(encruptanduploaddatawithdiffvaultkey(d[f],
vaultkey,a),"3"==d[f].sequence){b=d[f].salt;c=d[f].iterations;var h=d[f].createdate;g=decryptwithstretchedkey("oth",vaultkey,d[f].data);g=JSON.parse(g);for(var k=g[0].fileseq,l=0;l<g.length;l++)e.open("POST","/secure/getuserdata",!1),e.withCredentials=!0,e.setRequestHeader("Content-Type","application/json"),e.onreadystatechange=function(d){return function(f){if(4==e.readyState&&200==e.status&&(f=JSON.parse(e.responseText),null!=f)){f=decryptwithstretchedkey("oth",vaultkey,f.data);f=encryptdatawithstretchedkey(f,
a,b,c);var g=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");g.open("POST","/secure/adduserdata",!1);g.withCredentials=!0;g.setRequestHeader("Content-Type","application/json");g.onreadystatechange=function(a){return function(b){4==g.readyState&&200==g.status&&k==a&&(console.log("File content "+a+" saved with new vault key"),document.getElementById("vault-key-update-notification").innerHTML="Your Vault Key has been updated successfully. Please make a note of it, if you need to.")}}(d);
g.send(JSON.stringify({salt:b,iterations:c,data:f,sequence:d,createdate:h}))}}}(g[l].fileseq),e.send(JSON.stringify({sequence:g[l].fileseq,createdate:h}));filedatamap={}}else parseInt(d[f].sequence)==d.length-1&&(document.getElementById("vault-key-update-notification").innerHTML="Your Vault Key has been updated successfully. Please make a note of it, if you need to.");vaultkey=a}}}
function encruptanduploaddatawithdiffvaultkey(a,b,c){var d="";"1"==a.sequence&&(d="sites");"2"==a.sequence&&(d="fin");"3"==a.sequence&&(d="oth");try{var e=decryptwithstretchedkey(d,b,a.data),f=encryptdatawithstretchedkey(e,c,a.salt,a.iterations),g=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");g.open("POST","/secure/adduserdata",!1);g.withCredentials=!0;g.setRequestHeader("Content-Type","application/json");g.send(JSON.stringify({salt:a.salt,iterations:a.iterations,
data:f,sequence:a.sequence,createdate:a.createdate}))}catch(h){return vaultkey="",displaykeyalert("Could not decrypt existing data with your old Vault key. Please come back to this page and provide you original vault key before updating it. "),!1}}
function displayUserDataClear(a){var b=0,c=0,d=document.getElementById("securedata-sites");d.removeEventListener("mouseenter",unblur,!1);d.removeEventListener("mouseleave",blur,!1);d.classList.remove("blur");d=document.getElementById("securedata-fin");d.removeEventListener("mouseenter",unblur,!1);d.removeEventListener("mouseleave",blur,!1);d.classList.remove("blur");d=document.getElementById("securedata-oth");d.removeEventListener("mouseenter",unblur,!1);d.removeEventListener("mouseleave",blur,!1);
d.classList.remove("blur");if(0<JSON.parse(userdatainsystem).length){document.getElementById("vault-intro").style.display="none";d=JSON.parse(userdatainsystem);for(var e=0;e<d.length;e++){0===d[e].sequence&&d[e].lastupdatedate!=d[e].createdate&&(document.getElementById("vault-key-last-change-info").innerText="You changed your vault key on "+d[e].lastupdatedate);if(1===d[e].sequence){document.getElementById("clear-sites-btn").style.display="inline-block";if("undefined"!=typeof d[e].copies&&0<d[e].copies.length){document.getElementById("revert-sites-btn").setAttribute("data-current",
d[e].lastupdatedate);for(var f=0;f<d[e].copies.length;f++)d[e].lastupdatedate==d[e].copies[f]&&(document.getElementById("revert-sites-btn").style.display="inline-block",f==d[e].copies.length-1?document.getElementById("revert-sites-btn").setAttribute("data-next",d[e].copies[0]):document.getElementById("revert-sites-btn").setAttribute("data-next",d[e].copies[f+1]))}f=document.getElementById("securedata-sites").innerHTML;document.getElementById("securedata-sites").innerHTML="";try{var g=decryptwithstretchedkey("sites",
vaultkey,d[e].data);d[e].data=g}catch(m){return document.getElementById("securedata-sites").innerHTML=f,vaultkey="",displaykeyalert("The key you entered is incorrect. Most users use their username as the key here. You need to provide the same key you entered while adding data here. "),!1}}if(2===d[e].sequence){document.getElementById("clear-fin-btn").style.display="inline-block";f=document.getElementById("securedata-fin").innerHTML;document.getElementById("securedata-fin").innerHTML="";try{var h=
decryptwithstretchedkey("fin",vaultkey,d[e].data);d[e].data=h}catch(m){return document.getElementById("securedata-fin").innerHTML=f,vaultkey="",displaykeyalert("The key you entered is incorrect. Most users use their username as the key here. You need to provide the same key you entered while adding data here."),!1}}if(3===d[e].sequence){document.getElementById("clear-oth-btn").style.display="inline-block";f=document.getElementById("securedata-oth").innerHTML;document.getElementById("securedata-oth").innerHTML=
"";try{h=decryptwithstretchedkey("oth",vaultkey,d[e].data),d[e].data=h}catch(m){return document.getElementById("securedata-oth").innerHTML=f,vaultkey="",displaykeyalert("The key you entered is incorrect. Most users use their username as the key here. You need to provide the same key you entered while adding data here."),!1}}removeKeyboxAndAlert();f=JSON.parse(d[e].data);for(var k=0;k<f.length;k++){if(1===d[e].sequence){document.getElementById("sites-siteUrl").value=f[k].siteUrl;document.getElementById("sites-siteuser").value=
f[k].siteuser;document.getElementById("sites-sitepwd").value=f[k].sitepwd;document.getElementById("sites-sitedesc").value=f[k].sitedesc;document.getElementById("sites-sitename").value=f[k].sitename;"undefined"!=typeof f[k].sharedwith?document.getElementById("sites-sharedwith").value=JSON.stringify(f[k].sharedwith):document.getElementById("sites-sharedwith").value="";document.getElementById("sites-seq").value=d[e].sequence;document.getElementById("sites-slt").value=d[e].salt;document.getElementById("sites-itns").value=
d[e].iterations;document.getElementById("sites-crdate").value=d[e].createdate;document.getElementById("sites-upddate").value=d[e].lastupdatedate;document.getElementById("sites-accdate").value=d[e].lastaccessdate;0==document.getElementById("sites-last-update-display").innerText.length&&(document.getElementById("sites-last-update-display").innerText=gettimedifference(d[e].lastupdatedate,!0),document.getElementById("sites-last-access-display").innerText=gettimedifference(d[e].lastaccessdate,!0));var l=
parseInt(k+1);document.getElementById("vault-site-count").innerText=" ("+l+")";if("undefined"==typeof a||0<=f[k].siteUrl.toLowerCase().indexOf(a.toLowerCase())||0<=f[k].siteuser.toLowerCase().indexOf(a.toLowerCase())||0<=f[k].sitepwd.indexOf(a))b++,addWebsiteToSecurePage(),"undefined"!=typeof a&&(document.getElementById("vault-filteredsite-count").innerText=b+" of");"undefined"===typeof a&&(document.getElementById("vault-filteredsite-count").innerText="");0==b&&(document.getElementById("vault-filteredsite-count").innerText=
" 0 of")}2===d[e].sequence&&(document.getElementById("fin-institution").value=f[k].institution,document.getElementById("fin-accType").value=f[k].accType,document.getElementById("fin-acctNum").value=f[k].acctNum,document.getElementById("fin-seq").value=d[e].sequence,document.getElementById("fin-slt").value=d[e].salt,document.getElementById("fin-itns").value=d[e].iterations,document.getElementById("fin-crdate").value=d[e].createdate,document.getElementById("fin-upddate").value=d[e].lastupdatedate,addFinDataToSecurePage());
if(3===d[e].sequence){document.getElementById("oth-seq").value=d[e].sequence;document.getElementById("oth-slt").value=d[e].salt;document.getElementById("oth-itns").value=d[e].iterations;document.getElementById("oth-crdate").value=d[e].createdate;document.getElementById("oth-upddate").value=d[e].lastupdatedate;document.getElementById("oth-accdate").value=d[e].lastaccessdate;if("undefined"==typeof a||0<=f[k].filename.toLowerCase().indexOf(a.toLowerCase())||0<=f[k].filetype.toLowerCase().indexOf(a.toLowerCase()))addFileDataToSecurePage(f[k]),
c++,"undefined"!=typeof a&&(document.getElementById("vault-filteredfile-count").innerText=c+" of");0==k&&(lastfileseq=f[k].fileseq);l=parseInt(k+1);document.getElementById("vault-file-count").innerText=" "+l;"undefined"===typeof a&&(document.getElementById("vault-filteredfile-count").innerText="");0==c&&(document.getElementById("vault-filteredfile-count").innerText=" 0 of")}}}document.getElementById("sites-siteUrl").value="";document.getElementById("sites-siteuser").value="";document.getElementById("sites-sitepwd").value=
"";document.getElementById("sites-sitedesc").value="";document.getElementById("sites-sitename").value="";document.getElementById("sites-sharedwith").value="";document.getElementById("fin-institution").value="";document.getElementById("fin-accType").value="";document.getElementById("fin-acctNum").value="";document.getElementById("vault-search-input").style.display="block";document.getElementById("vaultkeychangebutton").classList.remove("hidden")}}
function revertvaultdata(a){if(confirm("Do you want to restore the previous version of your vault content?")&&"1"==a){document.getElementById("revert-sites-btn").getAttribute("data-current");a=document.getElementById("revert-sites-btn").getAttribute("data-next");var b=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");b.open("POST","/secure/revertuserdata",!1);b.withCredentials=!0;b.setRequestHeader("Content-Type","application/json");b.onreadystatechange=function(){4==
b.readyState&&200==b.status&&showPrivateDataPage()};b.send(JSON.stringify({sequence:1,createdate:document.getElementById("sites-crdate").value,lastupdatedate:a}))}}function removeKeyboxAndAlert(){$("#key-input-div").hide("slow");$("#no-key-alert-holder").hide("slow")}
function displayUserData(){if(0<JSON.parse(userdatainsystem).length){document.getElementById("vault-intro").style.display="none";for(var a=JSON.parse(userdatainsystem),b=1;b<a.length;b++){var c=JSON.parse(a[b].data),d=document.createElement("div");d.classList.add("row");var e=document.createElement("div");e.classList.add("col-xs-12");var f=document.createElement("p");f.style.wordWrap="break-word";f.style.maxWidth="90%";f.style.display="inline-block";f.style.fontSize="16px";c=300<c.ct.length?c.ct.substr(0,
300)+"...":c.ct;c=document.createTextNode(c);f.appendChild(c);addinfolabel(e);e.appendChild(f);d.appendChild(e);1===a[b].sequence&&(document.getElementById("securedata-sites").innerHTML="",document.getElementById("securedata-sites").appendChild(d));2===a[b].sequence&&(document.getElementById("securedata-fin").innerHTML="",document.getElementById("securedata-fin").appendChild(d));3===a[b].sequence&&(document.getElementById("securedata-oth").innerHTML="",document.getElementById("securedata-oth").appendChild(d))}}}
function addinfolabel(a){var b=document.createElement("p");b.style.wordWrap="break-word";b.style.maxWidth="90%";b.style.display="inline-block";b.classList.add("lead");var c=document.createTextNode("You can decrypt this data only with the key you used to add this data");b.appendChild(c);a.appendChild(b)}
function submitencuserdata(a,b){if(0==vaultkey.length)return createvaultpagekeyoverlay(),!1;if(b){if("sites"===a&&0==document.getElementById("sites-sitepwd").value.length||"fin"===a&&0==document.getElementById("fin-institution").value.length)return!1;if(!createUserData(a))return $("#"+a+"Modal").modal("hide"),!1}"sites"===a&&(document.getElementById(a+"-seq").value="1");"fin"===a&&(document.getElementById(a+"-seq").value="2");"oth"===a&&(document.getElementById(a+"-seq").value="3");document.getElementById(a+
"-data");b=encryptwithstretchedkey(a,vaultkey);var c=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");c.open("POST","/secure/adduserdata",!1);c.withCredentials=!0;c.setRequestHeader("Content-Type","application/json");c.onreadystatechange=function(){4==c.readyState&&200==c.status&&"oth"!=a&&($("#"+a+"Modal").hasClass("in")&&$("#"+a+"Modal").modal("hide"),showPrivateDataPage())};c.send(JSON.stringify({group:a,salt:document.getElementById(a+"-slt").value,iterations:document.getElementById(a+
"-itns").value,data:b,sequence:document.getElementById(a+"-seq").value,createdate:document.getElementById(a+"-crdate").value,lastupdatedate:document.getElementById(a+"-upddate").value}));if("oth"===a)for(var d=0;d<filecontentobject.length;d++)document.getElementById(a+"-data").value=JSON.stringify(filecontentobject[d]),document.getElementById(a+"-data"),b=encryptwithstretchedkey(a,vaultkey),c.open("POST","/secure/adduserdata",!1),c.withCredentials=!0,c.setRequestHeader("Content-Type","application/json"),
c.onreadystatechange=function(){4==c.readyState&&200==c.status&&($("#"+a+"Modal").modal("hide"),showPrivateDataPage())},c.send(JSON.stringify({group:a,salt:document.getElementById(a+"-slt").value,iterations:document.getElementById(a+"-itns").value,data:b,sequence:filecontentobject[d].fileseq,createdate:document.getElementById(a+"-crdate").value,lastupdatedate:document.getElementById(a+"-upddate").value}));return!1}
function addimportedcredentialsfromfile(){if(0==vaultkey.length)return createvaultpagekeyoverlay(),!1;var a=JSON.parse(userdatainsystem);if(0<a.length){for(var b="",c=0;c<a.length;c++)if(1===a[c].sequence)for(var d=JSON.parse(decryptwithstretchedkey("sites",vaultkey,a[c].data)),e=0;e<d.length;e++)b+=JSON.stringify(d[e]),e<d.length&&(b+=", ");document.getElementById("cred-csv-data").value=document.getElementById("cred-csv-data").value.replace("[","");document.getElementById("cred-csv-data").value=
document.getElementById("cred-csv-data").value.replace("]","");document.getElementById("sites-data").value="["+b+document.getElementById("cred-csv-data").value+"]"}else document.getElementById("sites-data").value="["+document.getElementById("cred-csv-data").value+"]";submitencuserdata("sites",!1);$("#importfilemodal").modal("hide")}
function createUserData(a){var b="";"sites"===a&&(b='"siteUrl":"'+document.getElementById("sites-siteUrl").value+'", "siteuser":"'+document.getElementById("sites-siteuser").value+'", "sitepwd":"'+document.getElementById("sites-sitepwd").value+'", "sitedesc":"'+document.getElementById("sites-sitedesc").value+'", "sitename":"'+document.getElementById("sites-sitename").value+'", ',addWebsiteToSecurePage());"fin"===a&&(b='"institution":"'+document.getElementById("fin-institution").value+'", "accType":"'+
document.getElementById("fin-accType").value+'", "acctNum":"'+document.getElementById("fin-acctNum").value+'", ',addFinDataToSecurePage());if("oth"===a){for(var c=document.getElementById("secure-file").files,d=0;d<c.length;d++){var e=c[d];if(1<e.size/1024/1024)return alert("Files greater than 1 MB not supported right now."),!1;var f={filename:e.name,filetype:e.type,filesize:e.size,fileseq:lastfileseq+1,createtime:Date.now()};filecontentobject.push({filename:e.name,filetype:e.type,filesize:e.size,
fileseq:lastfileseq+1,content:selectedfiles[e.name+":"+e.type+":"+e.size]});b+=JSON.stringify(f);d<c.length-1&&(b+=", ");lastfileseq+=1;addFileDataToSecurePage(f)}selectedfiles={}}c=JSON.parse(userdatainsystem);if(0<c.length){if("sites"===a){var g="";for(e=0;e<c.length;e++)if(1===c[e].sequence)for(f=JSON.parse(decryptwithstretchedkey("sites",vaultkey,c[e].data)),d=0;d<f.length;d++)g+=JSON.stringify(f[d]),d<f.length&&(g+=", ");document.getElementById("sites-data").value="["+g+"{"+b.substring(0,b.length-
2)+"}]"}if("fin"===a){g="";for(e=0;e<c.length;e++)if(2===c[e].sequence)for(f=JSON.parse(decryptwithstretchedkey("fin",vaultkey,c[e].data)),d=0;d<f.length;d++)g+=JSON.stringify(f[d]),d<f.length&&(g+=", ");document.getElementById("fin-data").value="["+g+"{"+b.substring(0,b.length-2)+"}]"}if("oth"===a){a=b;for(e=0;e<c.length;e++)if(3===c[e].sequence)for(f=JSON.parse(decryptwithstretchedkey("oth",vaultkey,c[e].data)),d=0;d<f.length;d++)a+=", "+JSON.stringify(f[d]),lastfileseq=f[d].fileseq;document.getElementById("oth-data").value=
"["+a+"]"}}else"oth"===a?document.getElementById(a+"-data").value="["+b+"]":document.getElementById(a+"-data").value="[{"+b.substring(0,b.length-2)+"}]";return!0}function getHostName(a){const b=document.createElement("a");-1==a.indexOf("http")&&(a="http://"+a);b.setAttribute("href",a);return b.hostname}function getDomain(a){return(a=a.match(/^(?:https?:\/\/)?(?:www\.)?([a-zA-Z0-9-]+(?:\.[a-zA-Z0-9-]+)+)(?:\/.*)?$/))?a[1]:null}
function addWebsiteToSecurePage(){var a;var b=document.getElementById("sites-siteUrl").value;var c=document.getElementById("sites-siteuser").value;var d=document.getElementById("sites-sitepwd").value;var e=document.getElementById("sites-sharedwith").value;document.getElementById("sites-sitedesc");var f=document.getElementById("sites-sitename").value;var g=null;if("undefined"!==b){g=getDomain(b);null!=g?a=g.split(".")[0]:null!=f&&(a=f);var h=document.createElement("div");h.classList.add("col-md-2");
h.classList.add("col-xs-4");h.classList.add("website-cred-display");h.style.height="100px";f=document.createElement("div");f.classList.add("center-block");f.classList.add("text-center");f.style.height="80px";var k=null;null!=g?(k=document.createElement("img"),k.setAttribute("src","https://www.google.com/s2/favicons?domain\x3d"+g),k.setAttribute("height","24"),k.setAttribute("width","24"),k.setAttribute("alt",b),k.classList.add("center-block")):(k=document.createElement("p"),k.style.fontWeight="bold",
k.setAttribute("height","24"),k.setAttribute("width","24"),k.setAttribute("alt",b),k.classList.add("center-block"),k.appendChild(document.createTextNode(b.substring(0,15))));g=document.createElement("div");g.style.textAlign="center";var l=document.createElement("p");l.classList.add("font-weight-bold");l.style.maxWidth="100px";l.style.margin="auto";var m=document.createTextNode(c);l.appendChild(m);g.appendChild(l);l=document.createElement("p");l.style.maxWidth="100px";l.style.margin="auto";"undefined"!=
a&&null!=a&&0<a.length&&(m=a.charAt(0).toUpperCase()+a.substring(1,15),a=document.createTextNode(m),0<e.length&&(a=document.createTextNode(m+"*")),m=document.createElement("strong"),m.appendChild(a),l.appendChild(m),f.appendChild(l),f.appendChild(document.createElement("br")));f.appendChild(k);f.appendChild(g);h.addEventListener("mouseover",function(a){h.style.border="1px solid #828282"},!1);h.addEventListener("mouseout",function(a){h.style.border="none";clearTimeout(copytimer)},!1);h.addEventListener("click",
function(a){var f=document.getElementsByClassName("website-cred-display"),g;for(g=0;g<f.length;g++)f[g].style.background="transparent",makeallchildrentransparent(f[g]);if(a.target.classList.contains("website-cred-display"))a.target.style.background="#e2e2e2";else{for(f=a.target;!f.classList.contains("website-cred-display");)f=f.parentElement;f.classList.contains("website-cred-display")&&(f.style.background="#e2e2e2")}copyInfoToClipboard(a,b,c,d,e)},!1);k=document.getElementById("securedata-sites");
h.appendChild(f);createcardlayout(k,h)}}function makeallchildrentransparent(a){for(var b=0;b<a.childNodes.length;b++){var c=a.childNodes[b];makeallchildrentransparent(c);c.style&&(c.style.background="transparent")}}
function copyInfoToClipboard(a,b,c,d,e){a.target.style.background="#e2e2e2";var f;null==document.getElementById("securedata-sites")&&(f="Org");if(null==copyclickmap[b+c]){for(var g in copyclickmap)delete copyclickmap[g];copyclickmap[b+c]=1;$("#sitessettingfootercollapse").collapse("show");g=document.createElement("input");document.body.appendChild(g);g.setAttribute("value",c);g.select();document.execCommand("copy");document.body.removeChild(g);g=document.getElementById("sitessettingfootercontent");
if(null!=g){var h=document.createElement("p");h.setAttribute("id","sitesettingnotification");h.appendChild(document.createTextNode("Username "+c+" for "+b+" copied to clipboard. Click once more to open the site in a different window"));g.innerHTML="";h=b;15<h.length&&(h=b.substring(0,15));displaybuttonbehavior(a,"Username copied to clipboard. Click again to open "+h);h=document.createElement("BUTTON");h.classList.add("btn");h.classList.add("btn-xs");h.classList.add("pull-right");h.style.marginRight=
"10px";h.classList.add("btn-default");h.onclick=function(a){deletesiteinfo(b,c,f)};h.innerHTML="Delete Credential";var k=document.createElement("BUTTON");k.classList.add("btn");k.classList.add("btn-xs");k.classList.add("pull-right");k.style.marginRight="10px";k.classList.add("btn-default");k.onclick=function(a){changepasswordmodal(b,c,f)};k.innerHTML="Change password";a=document.createElement("BUTTON");a.classList.add("btn");a.classList.add("btn-xs");a.classList.add("pull-right");a.style.marginRight=
"10px";a.classList.add("btn-default");a.onclick=function(a){sharesiteinfomodal(b,c,d,f)};a.innerHTML="Share Credential";var l=document.createElement("BUTTON");l.classList.add("btn");l.classList.add("btn-xs");l.classList.add("pull-right");l.style.marginRight="10px";l.classList.add("btn-default");l.onclick=function(a){viewsiteinfo(b,c)};l.innerHTML="View Credential";var m=document.createElement("BUTTON");m.classList.add("btn");m.classList.add("btn-xs");m.classList.add("btn-default");m.style.marginLeft=
"10px";m.onclick=function(a){copyusernametocb(b,c,d,f)};m.innerHTML="Copy Password";g.appendChild(m);g.appendChild(l);g.appendChild(h);g.appendChild(k);if(null!=document.getElementsByClassName("user-org")){h=document.getElementsByClassName("user-org");k=[];for(l=0;l<h.length;l++)k.push(h[l].getAttribute("data-orgid"));if(null!=k&&0<k.length&&(g.appendChild(a),a="","undefined"!==typeof e&&0<e.length&&(a=JSON.parse(e)),0<a.length)){e="";for(h=0;h<a.length;h++)if(4>h)e+=a[h],h<a.length-1&&(e+=", ");
else if(4==h)e+="...";else break;a=document.createElement("p");a.setAttribute("id","siteshareinfo");a.classList.add("text-muted");a.classList.add("pull-right");a.style.padding="3px";a.style.paddingRight="5px";a.appendChild(document.createTextNode("Shared with "+e));g.appendChild(a)}}}}else if(1==copyclickmap[b+c]){for(g in copyclickmap)delete copyclickmap[g];a.target.style.background="#e2e2e2";loadExtUrl(b,c,d);copyclickmap[b+c]++}}
function viewsiteinfo(a,b){if(0<JSON.parse(userdatainsystem).length)for(var c=JSON.parse(userdatainsystem),d=0;d<c.length;d++)if(1==c[d].sequence){for(var e=JSON.parse(decryptwithstretchedkey("sites",vaultkey,c[d].data)),f=0;f<e.length;f++)if(a==e[f].siteUrl&&b==e[f].siteuser){document.getElementById("sites-view-siteUrl").value=e[f].siteUrl;document.getElementById("sites-view-siteuser").value=e[f].siteuser;document.getElementById("sites-view-sitepwd").value=e[f].sitepwd;document.getElementById("sites-view-sitedesc").value=
e[f].sitedesc;document.getElementById("sites-view-sitename").value=e[f].sitename;if("undefined"!=typeof e[f].oldpwds&&0<e[f].oldpwds.length){document.getElementById("sites-view-siteoldpass").style.display="block";document.getElementById("sites-view-siteoldpass-tbl").innerHTML="";a=document.createElement("tr");b=document.createElement("th");var g=document.createElement("th");b.style.fontSize="11px";g.style.fontSize="11px";b.textContent="Password";g.textContent="Changed";a.appendChild(b);a.appendChild(g);
document.getElementById("sites-view-siteoldpass-tbl").appendChild(a);for(b=e[f].oldpwds.length-1;0<=b;b--){g=e[f].oldpwds[b];a=document.createElement("tr");const c=document.createElement("td"),d=document.createElement("td");c.textContent=g.password;d.textContent=gettimedifference(g.changed,!0)+" ago";c.style.fontSize="10px";d.style.fontSize="10px";a.appendChild(c);a.appendChild(d);document.getElementById("sites-view-siteoldpass-tbl").appendChild(a)}}else document.getElementById("sites-view-siteoldpass").style.display=
"none",document.getElementById("sites-view-siteoldpass-tbl").innerHTML="";"undefined"!=typeof e[f].sharedwith&&0<e[f].sharedwith.length?(document.getElementById("sites-view-sharedwith-div").style.display="block",document.getElementById("sites-view-sharedwith").value=JSON.stringify(e[f].sharedwith),e=e[f].sharedwith.join("\x3cbr\x3e"),document.getElementById("sites-view-sharedwith-disp").innerHTML=e):(document.getElementById("sites-view-sharedwith").value="",document.getElementById("sites-view-sharedwith-div").style.display=
"none",document.getElementById("sites-view-sharedwith-disp").innerHTML="");document.getElementById("sites-view-seq").value=c[d].sequence;document.getElementById("sites-view-slt").value=c[d].salt;document.getElementById("sites-view-itns").value=c[d].iterations;document.getElementById("sites-view-crdate").value=c[d].createdate;document.getElementById("sites-view-upddate").value=c[d].lastupdatedate;document.getElementById("sites-view-accdate").value=c[d].lastaccessdate;document.getElementById("cred-ctrl-data").innerHTML=
"Salt:"+c[d].salt+"| Iter:"+c[d].iterations+"| Created:"+(new Date(c[d].createdate)).toLocaleDateString()+"| Updated:"+gettimedifference(c[d].lastupdatedate,!0)+" ago| Accessed:"+gettimedifference(c[d].lastaccessdate,!0)+" ago";break}break}$("#sitesviewModal").modal("show")}
function sharesiteinfomodal(a,b,c,d,e,f){delete copyclickmap[a+b];document.getElementById("orgsharemodal-orgcheckboxes").innerHTML="";document.getElementById("orgsharemodal-sites-siteurl-disp").innerHTML="";$("#sitessettingfootercollapse").collapse("hide");document.getElementById("orgsharemodal-sites-siteurl-disp").appendChild(document.createTextNode(b+" at "+a));document.getElementById("orgsharemodal-sites-siteurl").value=a;document.getElementById("orgsharemodal-sites-siteuser").value=b;document.getElementById("orgsharemodal-sites-sitepwd").value=
c;document.getElementById("orgsharemodal-sites-sitedesc").value=e;document.getElementById("orgsharemodal-sites-sitename").value=f;a=document.getElementsByClassName("user-org");for(b=0;b<a.length;b++)c=document.createElement("DIV"),c.classList.add("form-check"),d=document.createElement("label"),d.classList.add("form-check-label"),e=document.createElement("input"),e.classList.add("form-check-input"),e.setAttribute("type","checkbox"),e.setAttribute("name","orgsharemodal-selected-orgs-checkbox"),e.value=
a[b].getAttribute("data-orgid"),d.appendChild(e),d.appendChild(document.createTextNode(" "+a[b].getAttribute("data-orgname"))),c.appendChild(d),document.getElementById("orgsharemodal-orgcheckboxes").appendChild(c);$("#datetimepickerst").datetimepicker();$("#datetimepickeren").datetimepicker({useCurrent:!1});$("#datetimepickerst").on("dp.change",function(a){$("#datetimepickeren").data("DateTimePicker").minDate(a.date)});$("#datetimepickeren").on("dp.change",function(a){$("#datetimepickerst").data("DateTimePicker").maxDate(a.date)});
$("#orgsharemodal").modal("show")}
function sharecredentialwithorgs(){for(var a=document.getElementsByName("orgsharemodal-selected-orgs-checkbox"),b=[],c=0;c<a.length;c++)if(a[c].checked){b.push(a[c].value);for(var d=document.getElementsByClassName("user-org"),e=0;e<d.length;e++)if(d[e].getAttribute("data-orgid")==a[c].value){orgownerflake=d[e].getAttribute("data-orgownerflake");break}extractorgkeyandaddsite(a[c].value,orgownerflake,function(a,b,c){for(var d=document.getElementsByName("infoshareoption"),e=0,f=d.length;e<f;e++)if(d[e].checked)if("R"==
d[e].value)readcurrentcredetialsinorg(a,b,c,0,null);else if("T"==d[e].value){console.log("Time fenced share.. will add it as fresh data");var g=document.getElementById("datetimepickerst").getElementsByTagName("INPUT")[0].value;readcurrentcredetialsinorg(a,b,c,1,g)}})}0==b.length&&(document.getElementById("share-credential-update-notification").innerHTML="Please select an org. ")}
function extractorgkeyandaddsite(a,b,c){orgID=a;orgownerflake=b;orgkey=null;if(null==otherkeys||0==otherkeys.length)console.log("No org keys found.. will see if it has arrived in secured data"),getsecureuserdatafromdb("ORGKEY",function(d){extractOrgKeysFromsecuredata(d);c(a,b,orgkey)});else{for(var d=0;d<otherkeys.length;d++)if(otherkeys[d].org&&orgownerflake==otherkeys[d].org.split(":\x3d")[0]&&a==otherkeys[d].org.split(":\x3d")[1]){orgkey=otherkeys[d].privkey;c(a,b,orgkey);break}if(null==orgkey||
0==orgkey.length)console.log("No org key found in otherkeys object.. will see if it has arrived in secured data"),getsecureuserdatafromdb("ORGKEY",function(d){extractOrgKeysFromsecuredata(d);c(a,b,orgkey)})}}
function readcurrentcredetialsinorg(a,b,c,d,e){var f=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");f.open("POST","/secure/readorgcredentials",!0);f.withCredentials=!0;f.setRequestHeader("Content-Type","application/json");f.onreadystatechange=function(){if(4==f.readyState&&200==f.status){var d=f.responseText;null!=d&&0<d.length&&(d=JSON.parse(d),addsitetoorgcredentials(a,b,c,d))}};f.send(JSON.stringify({ownerflake:b,section:"org-credentials",orgid:a,seq:d,startdate:e}))}
function addsitetoorgcredentials(a,b,c,d){var e={key:"publickey of the user",credential:{siteUrl:document.getElementById("orgsharemodal-sites-siteurl").value,sitedesc:" Shared Credential ",siteuser:document.getElementById("orgsharemodal-sites-siteuser").value,sitepwd:document.getElementById("orgsharemodal-sites-sitepwd").value,sitename:document.getElementById("orgsharemodal-sites-sitename").value}};b=1;var f=[];if(null!=d){console.log("There are existing credentials. Need to add to them.");c=new sjcl.ecc.elGamal.secretKey(sjcl.ecc.curves.c384,
sjcl.ecc.curves.c384.field.fromBits(sjcl.codec.base64.toBits(c)));for(var g=0;g<d.length;g++)if(null!=d[g].data&&0==d[g].seq){f=JSON.parse(sjcl.decrypt(c,d[g].data));f.push(e);b=0;break}}else console.log("There are no existing credentials. Need to create them."),f=[],f.push(e);0==f.length&&f.push(e);e=getEncMessageUsingPublickey(JSON.stringify(f),d[0].publicKey);var h=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");h.open("POST","/secure/addorgdata",!1);h.withCredentials=
!0;h.setRequestHeader("Content-Type","application/json");h.onreadystatechange=function(){4==h.readyState&&200==h.status&&(addsharenoticetocred(a,orgownerflake),document.getElementById("share-credential-update-notification").innerHTML="Credential has been shared successfully with the Org. It will be available in the Org page. ")};f=document.getElementById("datetimepickerst").getElementsByTagName("INPUT")[0].value;c=document.getElementById("datetimepickeren").getElementsByTagName("INPUT")[0].value;
g=document.getElementById("inform-receiver").checked;f=f.replace(/\//g,"-");c=c.replace(/\//g,"-");f=f.replace(/ AM| PM/,":00.000");c=c.replace(/ AM| PM/,":00.000");console.log("going to addorgdata inform-receiver "+g+" start "+f+" end "+c);h.send(JSON.stringify({group:"org-secure",section:"org-credentials",data:e,ownerflake:orgownerflake,orgid:a,createdate:d.createdate,startdate:f,enddate:c,seq:b,dononotify:!g}))}
function addsharenoticetocred(a,b){for(var c=document.getElementById("orgsharemodal-sites-siteurl").value,d=document.getElementById("orgsharemodal-sites-siteuser").value,e="",f=document.getElementsByClassName("user-org"),g=0;g<f.length;g++)if(f[g].getAttribute("data-orgid")==a&&f[g].getAttribute("data-orgownerflake")==b){e=f[g].getAttribute("data-orgname");break}a=JSON.parse(userdatainsystem);for(b=0;b<a.length;b++)if(1===a[b].sequence){f=document.getElementById("securedata-sites").innerHTML;try{var h=
decryptwithstretchedkey("sites",vaultkey,a[b].data);a[b].data=h;var k=JSON.parse(a[b].data);for(g=0;g<k.length;g++)k[g].siteUrl==c&&k[g].siteuser==d&&("undefined"==typeof k[g].sharedwith&&(k[g].sharedwith=[]),k[g].sharedwith.push(e),console.log("Orgname "+e+" tagged with the credential"));0<k.length&&(document.getElementById("sites-data").value=JSON.stringify(k),a[b].data=JSON.stringify(k),submitencuserdata("sites",!1),$("#orgsharemodal").modal("hide"))}catch(l){document.getElementById("securedata-sites").innerHTML=
f;vaultkey="";displaykeyalert("The key you entered is incorrect. Most users use their username as the key here. You need to provide the same key you entered while adding data here. ");$("#changesitepwdmodal").modal("hide");break}}return!1}function changepasswordmodal(a,b,c){document.getElementById("chgmodal-sites-siteUrl").value=a;document.getElementById("chgmodal-sites-siteuser").value=b;$("#changesitepwdmodal").modal("show")}
function copyusernametocb(a,b,c,d){d=document.createElement("input");document.body.appendChild(d);d.setAttribute("value",c);d.select();document.execCommand("copy");document.body.removeChild(d);c=document.getElementById("sitesettingnotification");cleardiv(c);copyclickmap[a+b]=2;c.appendChild(document.createTextNode("Password for user "+b+" @ "+a+" copied to clipboard."));console.log("Copied password to Clipboard")}
function changesitepassword(){for(var a=document.getElementById("chgmodal-sites-siteUrl").value,b=document.getElementById("chgmodal-sites-siteuser").value,c=document.getElementById("chgmodal-sites-sitepwd").value,d=JSON.parse(userdatainsystem),e=0;e<d.length;e++)if(1===d[e].sequence){var f=document.getElementById("securedata-sites").innerHTML;try{var g=decryptwithstretchedkey("sites",vaultkey,d[e].data);d[e].data=g;for(var h=JSON.parse(d[e].data),k=0;k<h.length;k++)if(h[k].siteUrl==a&&h[k].siteuser==
b){if(0==c.length||c==h[k].sitepwd)return alert("Invalid new password. It is either blank or same as old password."),$("#changesitepwdmodal").modal("hide"),!1;var l="Do you want to change the password for "+b+" @ "+a;"undefined"!=typeof h[k].source&&0<h[k].source.length&&(l="This credential was imported from "+h[k].source+". You may want to update this password in the file first. Click OK to update the password in the vault first.");if(confirm(l)&&("undefined"==typeof h[k].oldpwds&&(h[k].oldpwds=
[]),h[k].oldpwds.push({password:h[k].sitepwd,changed:new Date}),h[k].sitepwd=c,1==copyclickmap[a+b]))for(var m in copyclickmap)delete copyclickmap[m]}0<h.length&&(document.getElementById("sites-data").value=JSON.stringify(h),d[e].data=JSON.stringify(h),submitencuserdata("sites",!1));$("#changesitepwdmodal").modal("hide")}catch(n){document.getElementById("securedata-sites").innerHTML=f;vaultkey="";displaykeyalert("The key you entered is incorrect. Most users use their username as the key here. You need to provide the same key you entered while adding data here. ");
$("#changesitepwdmodal").modal("hide");break}}$("#changesitepwdmodal").modal("hide");return!1}
function deletesiteinfo(a,b,c){if(confirm("Do you want to delete credentials stored for "+b+" @ "+a)){var d={};d="undefined"==typeof c?JSON.parse(userdatainsystem):JSON.parse(orgdatainsystem);for(var e=0;e<d.length;e++)if(1===d[e].sequence){var f="";"undefined"==typeof c||null==c?f=document.getElementById("securedata-sites").innerHTML:"Org"==c&&(f=document.getElementById("org-credentials").innerHTML);try{var g=decryptwithstretchedkey("sites",vaultkey,d[e].data);d[e].data=g;for(var h=JSON.parse(d[e].data),
k=0;k<h.length;k++)h[k].siteUrl==a&&h[k].siteuser==b&&delete h[k];var l=h.filter(function(a){return null!=a});0<l.length?(document.getElementById("sites-data").value=JSON.stringify(l),d[e].data=JSON.stringify(l),submitencuserdata("sites",!1)):clearAll("sites")}catch(m){null!=document.getElementById("securedata-sites")?document.getElementById("securedata-sites").innerHTML=f:document.getElementById("org-credentials").innerHTML=f;vaultkey="";displaykeyalert("The key you entered is incorrect. Most users use their username as the key here. You need to provide the same key you entered while adding data here. ");
break}}}}function findnumberofchidrennodes(a,b){for(var c=0,d=0;d<a.children.length;d++)a.children[d].className==b&&c++;return c}
function createcardlayout(a,b){if(0==a.children.length){var c=document.createElement("div");c.classList.add("row");c.appendChild(b);a.appendChild(c)}else for(var d=0;d<a.children.length;d++)"row"==a.children[d].className&&(c=a.children[d],6>findnumberofchidrennodes(c,"col-xs-2")?c.appendChild(b):d==a.children.length-1&&(c=document.createElement("div"),c.classList.add("row"),c.appendChild(b),a.appendChild(c)))}
function addFinDataToSecurePage(){var a=document.getElementById("fin-institution").value;var b=document.getElementById("fin-acctNum").value;var c=document.getElementById("fin-accType").value;var d=document.createElement("div");d.classList.add("col-xs-2");var e=document.createElement("div");e.classList.add("text-center");var f=document.createElement("p");f.classList.add("lead");f.style.wordWrap="break-word";f.style.maxWidth="80%";f.style.display="inline-block";a=document.createTextNode(a);f.appendChild(a);
e.appendChild(f);f=document.createElement("br");e.appendChild(f);f=document.createElement("p");f.style.wordWrap="break-word";f.style.maxWidth="80%";f.style.display="inline-block";a=document.createTextNode(c);f.appendChild(a);e.appendChild(f);f=document.createElement("br");e.appendChild(f);f=document.createElement("p");f.style.wordWrap="break-word";f.style.maxWidth="50%";f.style.display="inline-block";a=document.createTextNode(b);f.appendChild(a);e.appendChild(f);d.appendChild(e);createcardlayout(document.getElementById("securedata-fin"),
d)}
function addFileDataToSecurePage(a){var b=a.filename,c=a.filetype,d=a.filesize,e=a.fileseq,f=a.createtime;filedatamap[b+e]=a;a=document.createElement("div");a.classList.add("row");var g=document.createElement("div");g.classList.add("col-xs-4");var h=document.createElement("a");h.classList.add("filecontentlink");0==c.length&&(c="text");c.startsWith("image");h.href="javascript:loadfilecontentonmodal('"+b+"','"+e+"');";h.innerHTML=b;g.appendChild(h);a.appendChild(g);g=document.createElement("div");g.classList.add("col-xs-4");
b=document.createElement("p");b.style.wordWrap="break-word";b.style.maxWidth="50%";b.style.display="inline-block";d=document.createTextNode(getReadableFileSizeString(d));b.appendChild(d);g.appendChild(b);a.appendChild(g);g=document.createElement("div");g.classList.add("col-xs-4");b=document.createElement("p");b.style.wordWrap="break-word";b.style.maxWidth="50%";b.style.display="inline-block";d=document.createTextNode((new Date(f)).toLocaleString());b.appendChild(d);g.appendChild(b);a.appendChild(g);
document.getElementById("securedata-oth").insertBefore(a,document.getElementById("securedata-oth").firstChild)}
function getuserdatafromdb(a,b){var c=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");c.open("POST","/secure/getuserdata",!1);c.withCredentials=!0;c.setRequestHeader("Content-Type","application/json");c.onreadystatechange=function(){if(4==c.readyState&&200==c.status)if(null!=c.responseText&&0<c.responseText.length){var a=JSON.parse(c.responseText),e="ERROR";try{e=sjcl.decrypt(vaultkey,a.data)}catch(f){console.log("Could not decrypt payload based on vault key. Error \x3e "+
f)}b(e)}else console.log("There was NO key data in DB for this User, generating fresh userkey"),generatenewuserkey(),b("ERROR")};c.send(JSON.stringify({sequence:a}))}
function getsecureuserdatafromdb(a,b){null==userkey||0==userkey.length?getuserdatafromdb(0,function(c){if("ERROR"!=c){if("string"===typeof c&&0>c.indexOf('"'))userkey=c;else{c=JSON.parse(c);userkey=c[0];for(var d=1;d<c.length;d++)c[d].org&&otherkeys.push(c[d])}null!=userkey&&0<userkey.length&&readsecuredataforuserbytag(a,b)}else console.log("Invalid Keydata received for user "+c)}):readsecuredataforuserbytag(a,b)}
function readsecuredataforuserbytag(a,b){if(null==userkey||0==userkey.length)console.log("No user key found. Can not read secure data");else{var c=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");c.open("POST","/secure/getsecureuserdata",!1);c.withCredentials=!0;c.setRequestHeader("Content-Type","application/json");c.onreadystatechange=function(){if(4==c.readyState&&200==c.status)if(null!=c.responseText&&0<c.responseText.length){var a=JSON.parse(c.responseText),e="ERROR";
try{var f=new sjcl.ecc.elGamal.secretKey(sjcl.ecc.curves.c384,sjcl.ecc.curves.c384.field.fromBits(sjcl.codec.base64.toBits(userkey)));e=JSON.parse(sjcl.decrypt(f,a.data))}catch(g){console.log("Could not decrypt payload based on user key. Error \x3e "+g)}b(e)}else console.log("There was NO secure message with that tag for this User")};c.send(JSON.stringify({tag:a}))}}
function generatenewuserkey(){var a=sjcl.ecc.elGamal.generateKeys(384),b=a.pub.get();a=a.sec.get();b=sjcl.codec.base64.fromBits(b.x.concat(b.y));a=sjcl.codec.base64.fromBits(a);a=encryptdatawithstretchedkey(a,vaultkey,"",0);var c=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");c.open("POST","/secure/rotateuserkeys",!1);c.withCredentials=!0;c.setRequestHeader("Content-Type","application/json");c.onreadystatechange=function(){};c.send(JSON.stringify({publicKey:b,encprivatekey:a}))}
function getfilecontentfromdb(a,b){var c=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");c.open("POST","/secure/getuserdata",!1);c.withCredentials=!0;c.setRequestHeader("Content-Type","application/json");c.onreadystatechange=function(){if(4==c.readyState&&200==c.status){var d=JSON.parse(c.responseText);null!=d&&(d=decryptwithstretchedkey("oth",vaultkey,d.data),document.getElementById("secure-file-content").value=JSON.parse(d).content,filedatamap[a+b].content=JSON.parse(d).content,
updatefilecontentmodal(a,b))}};c.send(JSON.stringify({sequence:b,createdate:document.getElementById("oth-crdate").value}))}
function updatefilecontentmodal(a,b){var c=filedatamap[a+b].filetype,d=filedatamap[a+b].filesize;b=filedatamap[a+b].fileseq;b=filedatamap[a+b].content;filenametodownload=a;document.getElementById("file-header").innerHTML=a+" Size:["+getReadableFileSizeString(d)+"] Created:[ "+document.getElementById("oth-crdate").value+"]";a="data:"+c+";base64,"+b;c.startsWith("image")?document.getElementById("filedisplayarea").innerHTML='\x3cimg src\x3d"'+a+'" class\x3d"modal-image-display"/\x3e':document.getElementById("filedisplayarea").innerHTML=
'\x3cobject width\x3d"100%" data\x3d"'+a+'"\x3e';$("#fileContentModal").modal("show")}function loadfilecontentonmodal(a,b){document.getElementById("filedisplayarea").innerHTML="";var c=null;"undefined"!=typeof filedatamap[a+b]&&(c=filedatamap[a+b].content);"undefined"===typeof c||null==c||0==c.length?getfilecontentfromdb(a,b):updatefilecontentmodal(a,b)}
function decryptwithstretchedkey(a,b,c){var d=""==document.getElementById(a+"-slt").value?sjcl.codec.hex.toBits("cf7488cd1e48e84990f51b3f121e161318ba2098aa6c993ded1012c955d5a3e8"):sjcl.codec.hex.toBits(document.getElementById(a+"-slt").value);"0"==document.getElementById(a+"-itns").value?(document.getElementById(a+"-itns").value=1E4,sjcl.misc.pbkdf2(b,d,100,256)):sjcl.misc.pbkdf2(b,d,document.getElementById(a+"-itns").value,256);try{var e=sjcl.decrypt(b,c)}catch(f){throw f;}return e}
function encryptwithstretchedkey(a,b){""==document.getElementById(a+"-slt").value&&(document.getElementById(a+"-slt").value="cf7488cd1e48e84990f51b3f121e161318ba2098aa6c993ded1012c955d5a3e8");var c=sjcl.codec.hex.toBits(document.getElementById(a+"-slt").value);0==document.getElementById(a+"-itns").value?(document.getElementById(a+"-itns").value=1E4,sjcl.misc.pbkdf2(b,c,1E4,256)):sjcl.misc.pbkdf2(b,c,document.getElementById(a+"-itns").value,256);return encryptdatawithstretchedkey(document.getElementById(a+
"-data").value,b,document.getElementById(a+"-slt").value,document.getElementById(a+"-itns").value)}
function fileUpload(){var a=document.getElementById("secure-file"),b="";if("files"in a)if(0==a.files.length)b="Select one or more files.";else for(var c=0;c<a.files.length;c++){b+="\x3cbr\x3e\x3cstrong\x3e"+(c+1)+". file\x3c/strong\x3e\x3cbr\x3e";var d=a.files[c];"name"in d&&(b+="name: "+d.name+"\x3cbr\x3e");"size"in d&&(b+="size: "+d.size+" bytes \x3cbr\x3e")}else b=""==a.value?b+"Select one or more files.":b+"The files property is not supported by your browser!\x3cbr\x3eThe path of the selected file: "+
a.value;document.getElementById("filedisplay").innerHTML=b}
function fileImport(){var a=document.getElementById("import-file"),b="";if("files"in a)if(0==a.files.length)b="Select a file";else for(var c=0;c<a.files.length;c++){b+="\x3cbr\x3e\x3cstrong\x3e"+(c+1)+". file\x3c/strong\x3e\x3cbr\x3e";var d=a.files[c];"name"in d&&(b+="name: "+d.name+"\x3cbr\x3e");"size"in d&&(b+="size: "+d.size+" bytes \x3cbr\x3e")}else b=""==a.value?b+"Select a file":b+"The files property is not supported by your browser!\x3cbr\x3eThe path of the selected file: "+a.value;document.getElementById("csvfiledisplay").innerHTML=
b}function downloadfile(){datatodownload=document.getElementById("secure-file-content").value;var a=b64toBlob(datatodownload,ftypetodownload);if(window.navigator.msSaveOrOpenBlob)window.navigator.msSaveBlob(a,filenametodownload);else{var b=window.document.createElement("a");b.href=window.URL.createObjectURL(a);b.download=filenametodownload;document.body.appendChild(b);b.click();document.body.removeChild(b)}$("#fileContentModal").modal("hide");clearFilecontent();return!1}
function clearFilecontent(){document.getElementById("secure-file-content").value=null;document.getElementById("filedisplayarea").innerHTML="";filenametodownload=null}function b64toBlob(a,b,c){b=b||"";c=c||512;a=atob(a);for(var d=[],e=0;e<a.length;e+=c){for(var f=a.slice(e,e+c),g=Array(f.length),h=0;h<f.length;h++)g[h]=f.charCodeAt(h);f=new Uint8Array(g);d.push(f)}return new Blob(d,{type:b})}
function clearAll(a){0==vaultkey.length&&createvaultkeyoverlay();var b="";"sites"===a&&(b="Websites");"fin"===a&&(b="Accounts");"oth"===a&&(b="Files");if(confirm("Do you want to remove all "+b+" in this view?. Click OK to continue.")){var c=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");c.open("POST","/secure/clearuserdata",!0);c.withCredentials=!0;c.setRequestHeader("Content-Type","application/json");c.onreadystatechange=function(){4==c.readyState&&200==c.status&&
(showPrivateDataPage(),lastfileseq=100)};c.send(JSON.stringify({sequence:document.getElementById(a+"-seq").value,createdate:document.getElementById(a+"-crdate").value}))}return!1}
function createvaultpagekeyoverlay(a){var b=document.getElementById("vault-page-key-overlay");if(null==b){b=document.createElement("div");b.setAttribute("id","vault-page-key-overlay");document.body.appendChild(b);var c=document.createElement("div");c.classList.add("container");c.classList.add("v-center");var d=document.createElement("div");d.classList.add("row");var e=document.createElement("div");e.classList.add("col-md-8");e.classList.add("col-md-offset-2");var f=document.createElement("div");f.classList.add("panel");
f.classList.add("panel-default");var g=document.createElement("h3");g.appendChild(document.createTextNode(""));g.style.color="#737373";g.style.fontWeight="900";f.appendChild(g);g=document.createElement("span");g.innerHTML="\x26times;";g.style.float="right";g.style.padding="2px 7px";g.style.fontSize="2em";g.style.top="0px";g.style.display="inline-block";g.style.color="#a2a2a2";g.style.cursor="default";g.addEventListener("mouseover",function(a){a.target.style.color="#d3d3d3"});g.addEventListener("mouseout",
function(a){a.target.style.color="#a2a2a2"});g.addEventListener("click",function(){$("#vault-page-key-overlay").fadeOut(500)});e.appendChild(g);g=document.createElement("p");g.classList.add("lead");g.setAttribute("id","createuser-flake-text-header");var h="";h=null==userdatainsystem?"Please enter a Vault Key":"Please enter your Vault Key";g.appendChild(document.createTextNode(h));g.style.color="#737373";g.style.fontWeight="700";f.appendChild(g);g=document.createElement("div");g.classList.add("row");
h=document.createElement("div");h.classList.add("col-sm-8");h.classList.add("col-sm-offset-2");var k=document.createElement("p");k.classList.add("text-muted");k.setAttribute("id","createuser-flake-text");k.appendChild(document.createTextNode("Enter your secret username as your vault key."));k.style.color="#878787";k.style.fontWeight="600";h.appendChild(k);g.appendChild(h);f.appendChild(g);g=document.createElement("div");g.classList.add("panel-body");g.classList.add("panel-word-wrap");h=document.createElement("div");
h.classList.add("row");k=document.createElement("div");k.classList.add("col-sm-8");k.classList.add("col-sm-offset-2");h.appendChild(k);g.appendChild(h);var l=document.createElement("input");l.setAttribute("type","password");l.setAttribute("id","vault-page-key-input");l.setAttribute("autofocus","true");l.classList.add("form-control");l.classList.add("input-md");l.addEventListener("input",function(a){6<=document.getElementById("vault-page-key-input").value.length?$("#page-cde-send-button").fadeIn("slow"):
document.getElementById("page-cde-send-button").style.display="none"},!1);l.addEventListener("keyup",function(b){13===b.keyCode&&(vaultkey=document.getElementById("vault-page-key-input").value,getuserdatafromdb(0,function(b){if("ERROR"!=b){if("string"===typeof b&&0>b.indexOf('"'))userkey=b;else{b=JSON.parse(b);userkey=b[0];for(var c=1;c<b.length;c++)otherkeys.push(b[c])}a&&a();$("#vault-page-key-overlay").fadeOut("slow")}else document.getElementById("vault-page-key-input").style.borderColor="red",
vaultkey=""}))});l.style.color="#646464";var m=document.createElement("input");m.setAttribute("id","page-cde-send-button");m.classList.add("btn");m.classList.add("btn-primary");m.classList.add("btn-md");m.conversationID="";m.changestarttime="";m.type="button";m.value="Submit";m.style.display="none";m.addEventListener("click",function(){vaultkey=document.getElementById("vault-page-key-input").value;getuserdatafromdb(0,function(b){if("ERROR"!=b){if("string"===typeof b&&0>b.indexOf('"'))userkey=b;else{b=
JSON.parse(b);userkey=b[0];for(var c=1;c<b.length;c++)otherkeys.push(b[c])}a&&a();$("#vault-page-key-overlay").fadeOut("slow")}else document.getElementById("vault-page-key-input").style.borderColor="red",vaultkey=""})},!1);var n=document.createElement("div");n.classList.add("col-sm-2");h.appendChild(n);k.appendChild(l);n.appendChild(m);g.appendChild(h);f.appendChild(g);e.appendChild(f);d.appendChild(e);c.appendChild(d);b.appendChild(c);$("#vault-page-key-input").focus()}settimeoutid=setTimeout(function(){$("#vault-page-key-overlay").fadeIn("slow")},
500)};var orgdatainsystem,orgownerflake,orgpublickey,orgID,orgkey="";
function submitencorgdata(a,b,c){if(c){if("org-secure"===b&&(0==document.getElementById("org-secure-sitepwd").value.length||0==document.getElementById("org-secure-siteuser").value.length||0==document.getElementById("org-secure-siteUrl").value.length)||"fin"===b&&0==document.getElementById("fin-institution").value.length)return!1;createOrgData(b)}"fin"===b&&(document.getElementById(b+"-seq").value="2");"oth"===b&&(document.getElementById(b+"-seq").value="3");c=document.getElementById(b+"-data").value;
c=getEncMessageUsingPublickey(c,orgpublickey);var d="",e="";null!=document.getElementById("datetimepickerst")&&(d=document.getElementById("datetimepickerst").getElementsByTagName("INPUT")[0].value,e=document.getElementById("datetimepickeren").getElementsByTagName("INPUT")[0].value);console.log("about to add org data start date being set "+d);var f=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");f.open("POST","/secure/addorgdata",!1);f.withCredentials=!0;f.setRequestHeader("Content-Type",
"application/json");f.send(JSON.stringify({group:b,salt:document.getElementById(b+"-slt").value,iterations:document.getElementById(b+"-itns").value,section:"org-credentials",seq:0,startdate:d,enddate:e,data:c,ownerflake:orgownerflake,orgid:a,publicKey:"",privateKey:"",createdate:document.getElementById(b+"-crdate").value,lastupdatedate:document.getElementById(b+"-upddate").value,dononotify:!0}));"oth"===b&&(document.getElementById(b+"-data").value=JSON.stringify(filecontentobject),document.getElementById(b+
"-data"),c=encryptwithstretchedkey(b,vaultkey),f.open("POST","/secure/addorgdata",!1),f.withCredentials=!0,f.setRequestHeader("Content-Type","application/json"),f.send(JSON.stringify({group:b,salt:document.getElementById(b+"-slt").value,iterations:document.getElementById(b+"-itns").value,data:c,sequence:filecontentobject.fileseq,createdate:document.getElementById(b+"-crdate").value,lastupdatedate:document.getElementById(b+"-upddate").value})));$("#"+b+"Modal").modal("hide");$("#orgcredscollapse").collapse("show");
return!1}
function createOrgData(a){var b="";"org-secure"===a&&(b='"key": "publickey of the user", "credential": {"siteUrl":"'+document.getElementById("org-secure-siteUrl").value+'", "sitedesc":"'+document.getElementById("org-secure-sitedesc").value+'", "siteuser":"'+document.getElementById("org-secure-siteuser").value+'", "sitepwd":"'+document.getElementById("org-secure-sitepwd").value+'"}, ',addCredentialToOrgPage());"fin"===a&&(b='"institution":"'+document.getElementById("fin-institution").value+'", "accType":"'+
document.getElementById("fin-accType").value+'", "acctNum":"'+document.getElementById("fin-acctNum").value+'", ',addFinDataToSecurePage());if("oth"===a)for(var c=document.getElementById("secure-file").files,d=0;d<c.length;d++){var e=c[d];if(1<e.size/1024/1024)alert("Files greater than 1 MB not supported right now.");else{var f={"secure-file":e.name,filetype:e.type,filesize:e.size,fileseq:lastfileseq+1};document.getElementById("secure-file-content");filecontentobject={"secure-file":e.name,filetype:e.type,
filesize:e.size,fileseq:lastfileseq+1,content:document.getElementById("secure-file-content").value};b+=JSON.stringify(f);d<c.length-1&&(b+=", ");addFileDataToSecurePage(e.name,e.type,e.size,lastfileseq+1)}}if(0<orgdatainsystem.trim().length)if(c=JSON.parse(orgdatainsystem.trim()),0<c.length){if("org-secure"===a){e="";for(f=0;f<c.length;f++)if("org-credentials"===c[f].section&&0==parseInt(c[f].seq)){d=new sjcl.ecc.elGamal.secretKey(sjcl.ecc.curves.c384,sjcl.ecc.curves.c384.field.fromBits(sjcl.codec.base64.toBits(orgkey)));
var g=JSON.parse(sjcl.decrypt(d,c[f].data));for(d=0;d<g.length;d++)e+=JSON.stringify(g[d]),d<g.length&&(e+=", ")}if(null==document.getElementById("inform-receiver"))console.log("in 1 existingsites "+e),document.getElementById("org-secure-data").value="["+e+"{"+b.substring(0,b.length-2)+"}]";else for(f=document.getElementsByName("infoshareoption"),d=0,g=f.length;d<g;d++)f[d].checked&&("T"==f[d].value&&(console.log("in 2 existingsites "+e),document.getElementById(a+"-seq").value="0",document.getElementById("org-secure-data").value=
"{"+b.substring(0,b.length-2)+"}"),"R"==f[d].value&&(console.log("in 3 existingsites "+e),document.getElementById("org-secure-data").value="["+e+"{"+b.substring(0,b.length-2)+"}]"))}if("fin"===a){e="";for(f=0;f<c.length;f++)if(2===c[f].sequence)for(g=JSON.parse(decryptwithstretchedkey("fin",vaultkey,c[f].data)),d=0;d<g.length;d++)e+=JSON.stringify(g[d]),d<g.length&&(e+=", ");document.getElementById("fin-data").value="["+e+"{"+b.substring(0,b.length-2)+"}]"}if("oth"===a){a=b;for(f=0;f<c.length;f++)if(3===
c[f].sequence)for(g=JSON.parse(decryptwithstretchedkey("oth",vaultkey,c[f].data)),d=0;d<g.length;d++)a+=", "+JSON.stringify(g[d]),lastfileseq=g[d].fileseq;document.getElementById("oth-data").value="["+a+"]"}}else"oth"===a?document.getElementById(a+"-data").value="["+b+"]":document.getElementById(a+"-data").value="[{"+b.substring(0,b.length-2)+"}]";else"oth"===a?document.getElementById(a+"-data").value="["+b+"]":document.getElementById(a+"-data").value="[{"+b.substring(0,b.length-2)+"}]"}
function addCredentialNotificationToOrgPage(){var a=document.getElementById("org-secure-notification").value;var b=document.getElementById("org-secure-startdate").value;var c=document.getElementById("org-secure-endate").value;var d="Coming in";if(null!=a&&0<a.length){var e=document.createElement("div");a=Date.now();var f="";a<parseInt(b)?f=gettimedifference(parseInt(b),!0):null!=c&&0<c.length?a<parseInt(c)&&(d="Visible for",f=gettimedifference(parseInt(c),!0)):(d="Shared Credential",e.style.backgroundColor=
"#ededed");e.classList.add("col-md-2");e.classList.add("col-xs-4");e.classList.add("website-cred-display");e.style.height="100px";b=document.createElement("div");b.classList.add("center-block");b.classList.add("text-center");b.style.height="80px";c=document.createElement("img");c.setAttribute("src","https://www.google.com/s2/favicons?domain\x3dhttps://newauth.io");c.setAttribute("height","24");c.setAttribute("width","24");c.classList.add("center-block");a=document.createElement("div");a.style.textAlign=
"center";var g=document.createElement("p");g.classList.add("font-weight-bold");g.style.maxWidth="100px";g.style.margin="auto";f=document.createTextNode(f);g.appendChild(f);a.appendChild(g);f=document.createElement("p");f.style.maxWidth="100px";f.style.margin="auto";null!=d&&0<d.trim().length&&(d=d.charAt(0).toUpperCase()+d.substring(1,d.length),d=document.createTextNode(d),g=document.createElement("strong"),g.appendChild(d),f.appendChild(g),b.appendChild(f),b.appendChild(document.createElement("br")));
b.appendChild(c);b.appendChild(a);e.addEventListener("mouseover",function(a){e.style.border="1px solid #828282"},!1);e.addEventListener("mouseout",function(a){e.style.border="none";clearTimeout(copytimer)},!1);d=document.getElementById("org-credentials");e.appendChild(b);createcardlayout(d,e)}}
function addCredentialToOrgPage(){var a=document.getElementById("org-secure-siteUrl").value;var b=document.getElementById("org-secure-siteuser").value;var c=document.getElementById("org-secure-sitepwd").value;var d=document.getElementById("org-secure-sitedesc").value;if("undefined"!==a){if(null==d||0==d.length){var e=getDomain(a);null!=e&&(d=e.split(".")[0])}var f=document.createElement("div");f.classList.add("col-md-2");f.classList.add("col-xs-4");f.classList.add("website-cred-display");f.style.height=
"100px";e=document.createElement("div");e.classList.add("center-block");e.classList.add("text-center");e.style.height="80px";var g=document.createElement("img");g.setAttribute("src","https://www.google.com/s2/favicons?domain\x3d"+a);g.setAttribute("height","24");g.setAttribute("width","24");g.setAttribute("alt",a);g.classList.add("center-block");var h=document.createElement("div");h.style.textAlign="center";h.style.backgroundColor="inherit";var k=document.createElement("p");k.classList.add("font-weight-bold");
k.style.maxWidth="100px";k.style.margin="auto";var l=document.createTextNode(b);k.appendChild(l);h.appendChild(k);k=document.createElement("p");k.style.maxWidth="100px";k.style.margin="auto";null!=d&&0<d.trim().length&&(d.trim().startsWith("Shared")&&(e.style.backgroundColor="#ededed"),d=d.charAt(0).toUpperCase()+d.substring(1,d.length),d=document.createTextNode(d),l=document.createElement("strong"),l.appendChild(d),k.appendChild(l),e.appendChild(k),e.appendChild(document.createElement("br")));e.appendChild(g);
e.appendChild(h);f.addEventListener("mouseover",function(a){f.style.border="1px solid #828282"},!1);f.addEventListener("mouseout",function(a){f.style.border="none";clearTimeout(copytimer)},!1);f.addEventListener("click",function(d){var e=document.getElementsByClassName("website-cred-display"),f;for(f=0;f<e.length;f++)e[f].style.background="transparent",makeallchildrentransparent(e[f]);if(d.target.classList.contains("website-cred-display"))d.target.style.background="#e2e2e2";else{for(e=d.target;!e.classList.contains("website-cred-display");)e=
e.parentElement;e.classList.contains("website-cred-display")&&(e.style.background="#e2e2e2")}copyInfoToClipboard(d,a,b,c)},!1);g=document.getElementById("org-credentials");f.appendChild(e);createcardlayout(g,f)}}
function displayOrgDataClear(){if(null==otherkeys||0==otherkeys.length)getsecureuserdatafromdb("ORGKEY",function(a){extractOrgKeysFromsecuredata(a);decryptandlayoutorgdata()});else{for(var a=0;a<otherkeys.length;a++)if(otherkeys[a].org&&orgownerflake==otherkeys[a].org.split(":\x3d")[0]&&orgID==otherkeys[a].org.split(":\x3d")[1]){orgkey=otherkeys[a].privkey;decryptandlayoutorgdata();break}null!=orgkey&&0!=orgkey.length||getsecureuserdatafromdb("ORGKEY",function(a){extractOrgKeysFromsecuredata(a);decryptandlayoutorgdata()})}}
function decryptandlayoutorgdata(){var a=document.getElementById("org-credentials");a.removeEventListener("mouseenter",unblur,!1);a.removeEventListener("mouseleave",blur,!1);a.classList.remove("blur");if(0<orgdatainsystem.trim().length&&0<JSON.parse(orgdatainsystem).length){a=JSON.parse(orgdatainsystem);document.getElementById("org-credentials").innerHTML="";for(var b=0;b<a.length;b++){"org-credentials"===a[b].section&&(null!=document.getElementById("clear-sites-btn")&&(document.getElementById("clear-sites-btn").style.display=
"inline-block"),document.getElementById("org-credentials"));var c=new sjcl.ecc.elGamal.secretKey(sjcl.ecc.curves.c384,sjcl.ecc.curves.c384.field.fromBits(sjcl.codec.base64.toBits(orgkey)));if(null!=a[b].data){c=JSON.parse(sjcl.decrypt(c,a[b].data));for(var d=0;d<c.length;d++)"org-credentials"===a[b].section&&(document.getElementById("org-secure-siteUrl").value=c[d].credential.siteUrl,document.getElementById("org-secure-siteuser").value=c[d].credential.siteuser,document.getElementById("org-secure-sitepwd").value=
c[d].credential.sitepwd,document.getElementById("org-secure-sitedesc").value=c[d].credential.sitedesc,document.getElementById("org-secure-seq").value=a[b].seq,document.getElementById("org-secure-slt").value=a[b].salt,document.getElementById("org-secure-itns").value=a[b].iterations,document.getElementById("org-secure-crdate").value=a[b].createdate,document.getElementById("org-secure-stdate").value=a[b].startdate,document.getElementById("org-secure-upddate").value=a[b].lastupdatedate,addCredentialToOrgPage())}else null!=
a[b].notification&&0<a[b].notification.length&&"org-credentials"===a[b].section&&(document.getElementById("org-secure-notification").value=a[b].notification,document.getElementById("org-secure-startdate").value=a[b].startdate,document.getElementById("org-secure-endate").value=a[b].enddate,addCredentialNotificationToOrgPage())}document.getElementById("org-secure-siteUrl").value="";document.getElementById("org-secure-siteuser").value="";document.getElementById("org-secure-sitepwd").value=""}}
function extractOrgKeysFromsecuredata(a){null!=a&&"ERROR"!==a&&(otherkeys.push(a),addOrgPrivateKeytoUserData(a.org,a.privkey));for(a=0;a<otherkeys.length;a++)if(otherkeys[a].org&&orgownerflake==otherkeys[a].org.split(":\x3d")[0]&&orgID==otherkeys[a].org.split(":\x3d")[1]){orgkey=otherkeys[a].privkey;break}}
function displayorgdata(){document.getElementById("org-credentials").classList.add("blur");if(0<orgdatainsystem.trim().length&&0<JSON.parse(orgdatainsystem).length){for(var a=JSON.parse(orgdatainsystem),b=0;b<a.length;b++){var c=JSON.parse(a[b].data);if("org-credentials"===a[b].section){null!=document.getElementById("clear-sites-btn")&&(document.getElementById("clear-sites-btn").style.display="inline-block");var d=document.createElement("p");d.style.wordWrap="break-word";d.style.maxWidth="90%";d.style.display=
"inline-block";d.style.fontSize="16px";c=null!=c?300<c.ct.length?c.ct.substr(0,300)+"...":c.ct:a[b].notification;c=document.createTextNode(c);d.appendChild(c);document.getElementById("org-credentials").appendChild(d)}}document.getElementById("org-secure-siteUrl").value="";document.getElementById("org-secure-siteuser").value="";document.getElementById("org-secure-sitepwd").value=""}}
function clearsecureuserdatafromdb(a){var b=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");b.open("POST","/secure/clearsecureuserdata",!0);b.withCredentials=!0;b.setRequestHeader("Content-Type","application/json");b.send(JSON.stringify({flake:orgownerflake,tag:a}))}
function clearAllOrgCredentials(a){if(confirm("Do you want to remove all credentials in this view?. Click OK to continue.")){var b=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");b.open("POST","/secure/clearorgdata",!0);b.withCredentials=!0;b.setRequestHeader("Content-Type","application/json");b.send(JSON.stringify({ownerflake:orgownerflake,section:"org-credentials",orgid:a,createdate:document.getElementById("org-secure-crdate").value}));showOrgPage(orgownerflake,a)}return!1}
function displaymembersindiv(a,b){var c=document.createElement("ul"),d=function(){document.getElementById(a).innerHTML="";b.forEach(function(a){var b=document.createElement("li"),d=document.createElement("p");d.classList.add("text-muted");d.appendChild(document.createTextNode(a));b.appendChild(d);c.appendChild(b)});document.getElementById(a).appendChild(c)};if(null!=b&&0<b.length)d();else{var e=new XMLHttpRequest;e.open("GET","/newauth/api/getOrgMembers/"+orgownerflake+"/"+orgID,!1);e.setRequestHeader("Content-Type",
"application/json");e.onreadystatechange=function(){4==e.readyState&&200==e.status&&(b=e.responseText,d())};e.send(null)}};var avatartoinvite,flaketoinvite,publicpagelinkclicked=!1,userGraph,sigma_ins,declinesenderid,declinesenderflake,tracktypingtimeoutid,notypingtime=1E4,nodeidflakemap={},nodeidnamemap={},nodeidconvmap={},convmsgtimemap={},convparticipants={},inviteout=0,invitein=0,conversations=0,entityMap={"\x26":"\x26amp;","\x3c":"\x26lt;","\x3e":"\x26gt;",'"':"\x26quot;","'":"\x26#39;","/":"\x26#x2F;","`":"\x26#x60;","\x3d":"\x26#x3D;"};
function escapeHtml(a){return String(a).replace(/[&<>"'`=\/]/g,function(a){return entityMap[a]})}function inviteOthers(){$("#inviteOthersModal").modal("show");return!1}
function searchnewauth(){var a=document.getElementById("searchresults");null!=a&&cleardiv(a);var b=new XMLHttpRequest;b.onreadystatechange=function(){if(4==b.readyState&&200==b.status){var a=b.responseText,d={};null!=a&&0<a.length&&(d=JSON.parse(a));if(0<d.length)for(a=0;a<d.length;a++)displaysearchresult(d[a]);else displayerror("No results matching search criteria.")}};b.open("POST","/newauth/api/search",!1);b.setRequestHeader("Content-Type","application/json");a=document.getElementById("search-text").value;
a=JSON.stringify({username:a});b.send(a);return!1}
function displaysearchresult(a){var b=document.getElementById("searchresults"),c="NAME HIDDEN",d="NO ALIAS",e="AVATAR UNKNOWN",f="UNKNOWN FLAKE";null!=a.firstname&&(c=a.firstname);null!=a.middleinitial&&(c+=" "+a.middleinitial);null!=a.lastname&&(c+=" "+a.lastname);null!=a.alias&&(d=a.alias);null!=a.currentavatar&&(e=a.currentavatar);null!=a.flake&&(f=a.flake);a=document.createElement("div");a.classList.add("panel-thin");a.classList.add("panel-body");a.classList.add("panel-word-wrap");var g=document.createElement("div");
g.classList.add("col-xs-12");g.classList.add("text-center");var h=document.createElement("div");h.classList.add("row");var k=document.createElement("div");k.classList.add("col-xs-3");var l=document.createElement("div");l.classList.add("col-xs-3");var m=document.createElement("div");m.classList.add("col-xs-3");var n=document.createElement("div");n.classList.add("col-xs-3");k.appendChild(getpanelfortext(c,"name"));l.appendChild(getpanelfortext(d,"alias"));h.appendChild(k);h.appendChild(l);h.appendChild(m);
h.appendChild(n);d=document.createElement("a");d.href="javascript:loadSearchDetailModal('"+e+"', '"+f+"');";e=document.createElement("p");e.classList.add("lead");c=document.createTextNode(c);e.appendChild(c);d.appendChild(e);n.appendChild(d);g.appendChild(h);a.appendChild(g);b.appendChild(a)}
function getpanelfortext(a,b){var c=document.createElement("div");c.classList.add("panel-thin");var d=document.createElement("div");d.classList.add("panel-body-thin");c.appendChild(d);var e=document.createElement("div");e.classList.add("row");var f=document.createElement("div");f.classList.add("col-xs-12");f.classList.add("center-block");f.setAttribute("align","center");e.appendChild(f);var g=document.createElement("p");g.classList.add("lead");g.classList.add("text-center");a=document.createTextNode(a);
b&&("name"==b&&d.classList.add("panel-semi-dark"),"alias"==b&&d.classList.add("panel-alias-display"),"avatar"==b&&(g.classList.remove("lead"),g.classList.add("text-muted")));g.appendChild(a);f.appendChild(g);d.appendChild(e);return c}
function displayerror(a){var b=document.getElementById("searchresults"),c=document.createElement("div");c.classList.add("panel");c.classList.add("panel-body");c.classList.add("panel-word-wrap");var d=document.createElement("div");d.classList.add("col-xs-12");var e=document.createElement("p");e.classList.add("lead");a=document.createTextNode(a);e.appendChild(a);d.appendChild(e);c.appendChild(d);b.appendChild(c)}
function loadSearchDetailModal(a,b){var c,d=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");d.onreadystatechange=function(){if(4==d.readyState&&200==d.status){var a=d.responseText;0<a.length&&(c=JSON.parse(a),null!=c.firstname&&(a=c.firstname,null!=c.middleinitial&&(a+=" "+c.middleinitial),null!=c.lastname&&(a+=" "+c.lastname),document.getElementById("searchedentityname").innerHTML=a),null!=c.alias&&(document.getElementById("searchedentityalias").innerHTML="\x3cem\x3e"+
c.alias+"\x3c/em\x3e"),null!=c.homepagesectiondata&&(document.getElementById("searched-entity-description").innerHTML=c.homepagesectiondata),flaketoinvite=b)}};d.open("POST","/newauth/api/searchbyflake",!1);d.withCredentials=!0;d.setRequestHeader("Content-Type","application/json");d.send(JSON.stringify({currentavatar:a,flake:b}));$("#searchResultDetailModal").modal("show")}
function invitebyemailorphone(){var a=document.getElementById("inviteemailinput").value;if(0==a.length)return document.getElementById("emailinputerror").innerHTML="No email address or phone number provided",!1;ValidateEmail(a)?($("#inviteOthersModal").modal("hide"),sendInvite(a,"")):ValidatePhone(a)?(document.getElementById("emailinputerror").innerHTML="",$("#inviteOthersModal").modal("hide"),sendInvite("",a)):document.getElementById("emailinputerror").innerHTML="Does not appear to be a phone number or an email address";
return!1}
function sendInvite(a,b){var c=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");c.onreadystatechange=function(){4==c.readyState&&200==c.status&&(userGraph=JSON.parse(atob(c.responseText)),clearexistinggraph(),convertanddrawgraphdata())};c.open("POST","/newauth/api/invite/externalbyphoneemail",!1);c.withCredentials=!0;c.setRequestHeader("Content-Type","application/json");var d=escapeHtml(document.getElementById("invitemessage").value),e;0<a.length&&(e={emails:a});0<b.length&&
(e={phones:'{"number":"'+b+'"}'});a=JSON.stringify({sender:{flake:loggedinuserflake},receiver:e,message:d});c.send(a)}
function sendInternalInvite(){if(null==flaketoinvite||0==flaketoinvite.length)return!1;var a=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");a.onreadystatechange=function(){4==a.readyState&&200==a.status&&(userGraph=JSON.parse(atob(a.responseText)),clearexistinggraph(),convertanddrawgraphdata())};a.open("POST","/newauth/api/invite/internaluser",!1);a.withCredentials=!0;a.setRequestHeader("Content-Type","application/json");var b=JSON.stringify({sender:{flake:loggedinuserflake},
receiver:{currentavatar:avatartoinvite,flake:flaketoinvite}});a.send(b)}
function convertanddrawgraphdata(){nodeidflakemap={};nodeidnamemap={};nodeidconvmap={};convmsgtimemap={};convparticipants={};var a={nodes:[],edges:[]},b=conversations=invitein=inviteout=0;debugappui&&console.log(JSON.stringify(userGraph));for(var c=0;c<userGraph.length;c++)if(void 0===userGraph[c]["@type"]){if("user"==userGraph[c].label){var d=userGraph[c].id["@value"];if(void 0===nodeidnamemap[d]){var e="#eee";var f=userGraph[c];var g=getavatarname(f);var h=getusername(f);if(null!=g||null!=h)e="#090";
if(0==c){h=g=0;var k=8;f="You";var l=d}else g=Math.random(),h=Math.random(),k=2,f=getnamelabel(f);nodeidflakemap[d]=userGraph[c].flake[0];nodeidnamemap[d]=f;a.nodes.push({id:d,label:f,x:g,y:h,size:k,color:e});debugappui&&console.log("node added: "+d+" "+f)}}else debugappui&&console.log("nodeidnamemap contained "+d+" did not add");"conversation"==userGraph[c].label&&(d=userGraph[c].id["@value"],void 0===nodeidconvmap[d]&&(nodeidconvmap[d]=userGraph[c].convid["0"]["@value"]))}else-1!=userGraph[c]["@type"].indexOf("Edge")&&
(e=null,debugappui&&console.log("processing edge: "+JSON.stringify(userGraph[c])),"invited"==userGraph[c]["@value"].label&&(e=userGraph[c]["@value"].inV["@value"],userGraph[c]["@value"].inV["@value"]==l&&(invitein++,f=userGraph[c]["@value"].properties.message["@value"].value,g=userGraph[c]["@value"].outV["@value"],h=find_vertex_flake_in_JSON_graph(g),populateInvitationOnPanel(g,h,f)),userGraph[c]["@value"].outV["@value"]==l&&inviteout++),"joined"==userGraph[c]["@value"].label&&(userGraph[c]["@value"].outV["@value"]==
l&&conversations++,g=userGraph[c]["@value"].inV["@value"],f=userGraph[c]["@value"].outV["@value"],debugappui&&console.log("processing edge: "+JSON.stringify(userGraph[c])),f!=l&&(e=l,g=find_conv_id_in_JSON_graph(g),f=find_chat_name_in_JSON_graph(f),null==convparticipants?(convparticipants={},convparticipants[g]=[],convparticipants[g].push(f),populateConversationOnPanel(g,f)):void 0===convparticipants[g]?(convparticipants[g]=[],convparticipants[g].push(f),populateConversationOnPanel(g,f)):convparticipants[g].push(f))),
null!=e&&(debugappui&&console.log("adding edge "+b+" : "+userGraph[c]["@value"].id["@value"].relationId+" between "+e+" - "+userGraph[c]["@value"].outV["@value"]),a.edges.push({id:userGraph[c]["@value"].id["@value"].relationId,source:e,target:userGraph[c]["@value"].outV["@value"],size:Math.random(),color:"#ccc",type:"curve",count:b}),b++));sigma_ins=new sigma({graph:a,renderer:{container:document.getElementById("publicpageusergraph"),type:"canvas"},settings:{defaultNodeColor:"#ec5148"}});l="";0<inviteout&&
(l+="Sent invites: "+inviteout);0<invitein&&(displayInvitations(),0<l.length&&(l+="\x3cbr\x3e"),l+='\x3cbutton type\x3d"button" class\x3d"btn btn-sm btn-default" onclick\x3d"return displayInvitations();"\x3eInvitations:'+invitein+"\x3c/button\x3e");0<conversations&&(displayConversations(),0<l.length&&(l+="\x3cbr\x3e"),l+='\x3cbutton type\x3d"button" class\x3d"btn btn-sm btn-default" onclick\x3d"return displayConversations();"\x3eConversations:'+conversations+"\x3c/button\x3e");document.getElementById("graphsummary").innerHTML=
"\x3cp\x3e"+l+"\x3c/p\x3e";return a}function find_vertex_flake_in_JSON_graph(a){return nodeidflakemap[a]}function find_chat_name_in_JSON_graph(a){return nodeidnamemap[a]}function find_conv_id_in_JSON_graph(a){return nodeidconvmap[a]}function displayInvitations(){document.getElementById("invitations-panel").style.display="inline"}function displayConversations(){document.getElementById("conversations-panel").style.display="inline"}
function populateInvitationOnPanel(a,b,c){var d=document.createElement("div");d.classList.add("panel");d.classList.add("panel-thin");d.setAttribute("id","invite-"+a);var e=document.createElement("div");e.classList.add("panel-body");e.style.backgroundColor="#7283a7";var f=document.createElement("p");f.style.color="#fff";f.appendChild(document.createTextNode(c));e.appendChild(f);d.appendChild(e);c=document.createElement("div");c.classList.add("panel");c.classList.add("panel-thin");e=document.createElement("input");
e.classList.add("btn");e.classList.add("btn-primary");e.classList.add("btn-xs");e.type="button";e.value="Accept";e.addEventListener("click",acceptInvitation,!1);e.senderID=a;e.senderFlake=b;f=document.createElement("input");f.classList.add("btn");f.classList.add("btn-primary");f.classList.add("btn-xs");f.classList.add("pull-right");f.type="button";f.value="Decline";f.setAttribute("data-toggle","modal");f.setAttribute("data-target","#declineInviteModal");f.setAttribute("data-sendernodeid",a);f.setAttribute("data-senderflake",
b);c.appendChild(f);c.appendChild(e);e.style.marginRight="3px";d.appendChild(c);document.getElementById("invitations-panel-body").appendChild(d)}
function populateConversationOnPanel(a,b){if(null==document.getElementById("conversation-"+a)){var c=document.createElement("div");c.classList.add("panel");c.classList.add("panel-default");c.setAttribute("id","conversation-"+a);var d=document.createElement("div");d.classList.add("panel-heading");var e=document.createElement("h5");e.classList.add("panel-title");e.appendChild(document.createTextNode(b+" "));e.setAttribute("id","conv-header-"+a);b=document.createElement("img");b.classList.add("user-icon");
1==convparticipants[a].length&&(b.src="/static/icons/one-user-grey-16.png");1<convparticipants[a].length&&(b.src="/static/icons/multiple-users-grey-16.png");e.appendChild(b);d.appendChild(e);c.appendChild(d);d=document.createElement("div");d.classList.add("panel-body");d.classList.add("panel-word-wrap");d.classList.add("pre-scrollable");d.setAttribute("id","conv-data-"+a);d.style.backgroundColor="#cacaca";c.appendChild(d);document.getElementById("conversations-panel-body").appendChild(c);joinconversation(a);
loadconversation(a);e=document.createElement("div");e.classList.add("panel-body");e.classList.add("panel-word-wrap");e.style.backgroundColor="#c2c2c2";e.setAttribute("id","conv-message-"+a);b=document.createElement("div");b.classList.add("row");var f=document.createElement("div");f.classList.add("col-sm-9");b.appendChild(f);e.appendChild(b);var g=document.createElement("input");g.setAttribute("type","text");g.setAttribute("id","conv-message-input-"+a);g.classList.add("form-control");g.classList.add("input-md");
g.addEventListener("input",prepareSendButton,!1);g.addEventListener("change",trackTyping,!1);g.conversationID=a;g.style.color="#454545";g.size="50";var h=document.createElement("input");h.setAttribute("id","conv-send-button-"+a);h.classList.add("btn");h.classList.add("btn-primary");h.classList.add("btn-sm");h.classList.add("pull-right");h.conversationID="";h.changestarttime="";h.type="button";h.value="Send";h.addEventListener("click",sendConversationMessage,!1);a=document.createElement("div");a.classList.add("col-sm-3");
b.appendChild(a);f.appendChild(g);a.appendChild(h);e.appendChild(b);c.appendChild(e);d.scrollTop=d.scrollHeight}}function trackTyping(a){window.clearTimeout(tracktypingtimeoutid);startTrackTypingTimer(a.target.conversationID)}
function prepareSendButton(a){var b=new Date,c=document.getElementById("conv-send-button-"+a.target.conversationID);c.conversationID=a.target.conversationID;c.changestarttime=b.toUTCString();sendTypingEventForConversation(a.target.conversationID);a.target.removeEventListener("input",prepareSendButton,!1);startTrackTypingTimer(a.target.conversationID)}
function startTrackTypingTimer(a){debugappui&&console.log("in startTrackTypingTimer convid: "+a);tracktypingtimeoutid=window.setTimeout(sendNoTypingEventForConversation,notypingtime,a)}
function sendTypingEventForConversation(a){var b=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");b.onreadystatechange=function(){};b.open("POST","/newauth/api/addtypingeventtoconversation",!1);b.withCredentials=!0;b.setRequestHeader("Content-Type","application/json");a=JSON.stringify({sender:{flake:loggedinuserflake},typing:"true",conversationID:a});b.send(a)}
function sendNoTypingEventForConversation(a){debugappui&&console.log("in sendNoTypingEventForConversation convid: "+a);var b=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");b.onreadystatechange=function(){};b.open("POST","/newauth/api/addtypingeventtoconversation",!1);b.withCredentials=!0;b.setRequestHeader("Content-Type","application/json");var c=JSON.stringify({sender:{flake:loggedinuserflake},typing:"false",conversationID:a});b.send(c);window.clearTimeout(tracktypingtimeoutid);
document.getElementById("conv-message-input-"+a).addEventListener("input",prepareSendButton,!1)}
function sendConversationMessage(a){var b=a.target.conversationID;a=document.getElementById("conv-message-input-"+b).value;var c=document.getElementById("conv-send-button-"+b).changestarttime,d=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");d.onreadystatechange=function(){if(4==d.readyState&&200==d.status){var a=document.getElementById("conv-data-"+b);addconversationmessagetopanel(a,document.getElementById("conv-message-input-"+b).value,0,c,fullname);document.getElementById("conv-message-input-"+
b).value=""}};d.open("POST","/newauth/api/addmessagetoconversation",!1);d.withCredentials=!0;d.setRequestHeader("Content-Type","application/json");a=JSON.stringify({message:a,messagecreatetime:c,conversationID:b,permanent:"false"});d.send(a)}
function acceptInvitation(a){var b=a.target.senderFlake,c=a.target.senderID;clearexistinggraph();if(null==b||0==b.length)return!1;var d=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");d.onreadystatechange=function(){if(4==d.readyState&&200==d.status){userGraph=JSON.parse(atob(d.responseText));convertanddrawgraphdata();var a=document.getElementById("invite-"+c);removediv(a);populateConversationOnPanel()}};d.open("POST","/newauth/api/acceptinvite",!1);d.withCredentials=
!0;d.setRequestHeader("Content-Type","application/json");a=JSON.stringify({sender:{flake:b},receiver:{flake:loggedinuserflake}});d.send(a)}
function declineInvitation(a){clearexistinggraph();a=document.getElementById("dontinviteagaincheck").checked;if(null==declinesenderflake||0==declinesenderflake.length)return!1;var b=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");b.onreadystatechange=function(){if(4==b.readyState&&200==b.status){userGraph=JSON.parse(atob(b.responseText));convertanddrawgraphdata();var a=document.getElementById("invite-"+declinesenderid);removediv(a)}};b.open("POST","/newauth/api/declineinvite",
!1);b.withCredentials=!0;b.setRequestHeader("Content-Type","application/json");a=JSON.stringify({sender:{flake:declinesenderflake},receiver:{flake:loggedinuserflake},blocknewinvites:a});b.send(a)}function dismissInvitations(){document.getElementById("invitations-panel").style.display="none";return!1}function dismissConversations(){document.getElementById("conversations-panel").style.display="none";return!1}
function getnamelabel(a){if("fullName"in a)return a.fullName["0"];if("phone"in a)return a.phone["0"];if("email"in a)return a.email["0"]}function getavatarname(a){return"avatar"in a?a.avatar[0]:null}function getusername(a){return"userName"in a?a.userName[0]:null}function clearexistinggraph(){sigma_ins.graph.clear();sigma_ins.refresh()};var radius=20,linewidth=3,iintervalid,ointervalid,otimeoutid,x,y,clickevt,confirmedclicks,boxedimages,serversentclkdata,nextimgid,imgcanvas,img,context;function getMousePos2(a,b){var c=a.getBoundingClientRect();return{x:Math.round((b.clientX-c.left)/(c.right-c.left)*a.width),y:Math.round((b.clientY-c.top)/(c.bottom-c.top)*a.height)}}
function drawInwardCircle(){var a=document.getElementById("incircleCanvas");null==a&&(a=document.createElement("canvas"),a.id="incircleCanvas",document.body.appendChild(a));var b=a.getContext("2d");a.style.position="absolute";a.width=40;a.height=40;a.style.left=x+imgcanvas.getBoundingClientRect().left-20+"px";a.style.top=y+imgcanvas.getBoundingClientRect().top-20+"px";b.clearRect(0,0,a.width,a.height);b.save();b.beginPath();b.arc(20,20,radius,0,4*Math.PI,!1);b.lineWidth=3;b.strokeStyle="#ffffff";
b.stroke();radius-=3;b.restore();2>radius&&(radius=20,clearInterval(iintervalid))}
function DrawOutwardCircle(a,b){if(!confirmedclicks||3>confirmedclicks)clearTimeout(otimeoutid);else{var c=document.getElementById("outcircleCanvas");null==c&&(c=document.createElement("canvas"),c.id="outcircleCanvas",document.body.appendChild(c));var d=c.getContext("2d");c.style.position="absolute";c.width=2*b;c.height=2*b;c.style.left=x+imgcanvas.getBoundingClientRect().left-b+"px";c.style.top=y+imgcanvas.getBoundingClientRect().top-b+"px";d.clearRect(0,0,c.width,c.height);d.save();d.beginPath();
d.arc(b,b,radius,0,4*Math.PI,!1);d.lineWidth=linewidth;d.strokeStyle="#ffffff";d.stroke();radius+=2;d.restore();18==radius&&(d.lineWidth=linewidth+4);radius>b-2&&(radius=a,linewidth=3,clearTimeout(otimeoutid));setTimeout(clearAllBoxImageCanvas,5E3)}}
function drawGridAroundClick(){var a=document.getElementById("partialGridCanvas");null==a&&(a=document.createElement("canvas"),a.id="partialGridCanvas",document.body.appendChild(a));var b=a.getContext("2d");a.style.position="absolute";a.width=60;a.height=60;a.style.left=x+imgcanvas.getBoundingClientRect().left-20+"px";a.style.top=y+imgcanvas.getBoundingClientRect().top-20+"px";b.clearRect(0,0,a.width,a.height);b.strokeStyle="#ffffff";for(var c=0;5>c;c++)b.save(),b.beginPath(),b.moveTo(0,20*c),b.lineTo(a.width,
20*c),b.closePath(),b.stroke(),b.restore();for(c=0;5>c;c++)b.save(),b.beginPath(),b.moveTo(20*c,0),b.lineTo(20*c,a.height),b.closePath(),b.stroke(),b.restore()}function startDrawingOutwardCircle(){ointervalid=setInterval(function(){DrawOutwardCircle(4,20)},200)}
function clearAllBoxImageCanvas(){iintervalid&&clearInterval(iintervalid);ointervalid&&(clearInterval(ointervalid),clearTimeout(otimeoutid));var a=document.getElementById("partialGridCanvas");a&&a.parentNode.removeChild(a);(a=document.getElementById("incircleCanvas"))&&a.parentNode.removeChild(a);(a=document.getElementById("outcircleCanvas"))&&a.parentNode.removeChild(a)}
function showBoxNotificationDialog(a,b){var c=document.getElementById("app-notify-dialog");if(null==c){c=document.createElement("div");c.setAttribute("id","app-notify-dialog");document.body.appendChild(c);var d=document.createElement("div");d.classList.add("container");d.classList.add("v-center");var e=document.createElement("div");e.classList.add("row");var f=document.createElement("div");f.classList.add("col-md-8");f.classList.add("col-md-offset-2");var g=document.createElement("div");g.classList.add("panel");
g.classList.add("panel-default");var h=document.createElement("h3");"undefined"!=typeof b?h.appendChild(document.createTextNode(b)):h.appendChild(document.createTextNode("Success"));h.style.color="#737373";h.style.fontWeight="400";g.appendChild(h);b=document.createElement("p");b.classList.add("lead");b.setAttribute("id","createuser-flake-text-header");b.appendChild(document.createTextNode(a));b.style.color="#737373";b.style.fontWeight="150";g.appendChild(b);f.appendChild(g);e.appendChild(f);d.appendChild(e);
c.appendChild(d)}setTimeout(function(){$("#app-notify-dialog").fadeIn("fast")},100)}function clearBoxNotificationDialog(){$("#app-notify-dialog").fadeOut("fast");removediv(document.getElementById("app-notify-dialog"));clearTimeout(settimeoutid)}
function showBoxingInstructions(a){var b="minboxed"==a?document.getElementById("minbox-instruct-overlay"):"closeclicks"==a?document.getElementById("app-notifications-overlay"):document.getElementById("box-instruct-overlay");if(null==b){b=document.createElement("div");"closeclicks"==a?b.setAttribute("id","app-notifications-overlay"):"minboxed"==a?b.setAttribute("id","minbox-instruct-overlay"):b.setAttribute("id","box-instruct-overlay");document.body.appendChild(b);var c=document.createElement("div");
c.classList.add("container");c.classList.add("v-center");var d=document.createElement("div");d.classList.add("row");var e=document.createElement("div");e.classList.add("col-md-8");e.classList.add("col-md-offset-2");var f=document.createElement("div");f.classList.add("panel");f.classList.add("panel-default");var g=document.createElement("h3");"minboxed"==a?g.appendChild(document.createTextNode("You have boxed minimum required images.")):"closeclicks"==a&&g.appendChild(document.createTextNode("You seem to be clicking at the same location on every image."));
g.style.color="#737373";g.style.fontWeight="900";f.appendChild(g);g=document.createElement("p");g.classList.add("lead");g.setAttribute("id","createuser-flake-text-header");"minboxed"==a?g.appendChild(document.createTextNode("You can continue boxing more images or start using the profile.")):"closeclicks"==a?g.appendChild(document.createTextNode(" This is similar to setting 'password' as your password. Please choose locations that are not nearly identical.")):g.appendChild(document.createTextNode("You need to box at least 6 images before you can begin using Newauth."));
g.style.color="#737373";g.style.fontWeight="700";f.appendChild(g);g=document.createElement("div");g.classList.add("row");var h=document.createElement("div");h.classList.add("col-sm-8");h.classList.add("col-sm-offset-2");var k=document.createElement("p");k.classList.add("text-muted");k.setAttribute("id","createuser-flake-text");"minboxed"==a?k.appendChild(document.createTextNode("If you are done boxing images for now, Log out now. To log out, click On your Name in the top right of the screen in the header and then select Log Out. You will be taken to Welcome page. Once there, click on the Pending Setup tab. This will start your authentication process, the Newauth Way. You will need to click on the secret location on each image presented there. ")):
"closeclicks"==a?k.appendChild(document.createTextNode("Please restart boxing your images and make sure that the locations you choose on the images  are not the same.")):(k.appendChild(document.createTextNode("In order to box an image, you need to choose and click on a location on that image four times.  You will click on the same location during login. To help you track your progress, each click draws one side of a box around the image.  If you click on a different location any time before completing the box, you get a choice to reset your location.")),
k.appendChild(document.createElement("br")),k.appendChild(document.createElement("br")),k.appendChild(document.createTextNode("Try to choose a location on each image, which is not very obvious for someone to guess.")),k.appendChild(document.createElement("br")),k.appendChild(document.createElement("br")),k.appendChild(document.createTextNode("Here is how the clicks draw the border, the border is visible at the top of the page.")));k.style.color="#878787";k.style.fontWeight="600";h.appendChild(k);
g.appendChild(h);f.appendChild(g);a||f.appendChild(getvisualinstructions());g=document.createElement("div");g.classList.add("row");g.classList.add("text-center");h=document.createElement("div");h.setAttribute("id","cu-flake-can");g.appendChild(h);f.appendChild(g);g=document.createElement("div");g.classList.add("panel-body");g.classList.add("panel-word-wrap");h=document.createElement("div");h.classList.add("row");g.appendChild(h);k=document.createElement("input");k.setAttribute("id","clr-box-instructions");
k.classList.add("btn");k.classList.add("btn-primary");k.classList.add("btn-md");k.conversationID="";k.changestarttime="";k.type="button";k.value="Got it";"minboxed"==a?k.addEventListener("click",clearMinBoxingInstructions,!1):"closeclicks"==a?k.addEventListener("click",clearCloseclickInstructions,!1):k.addEventListener("click",clearBoxingInstructions,!1);var l=document.createElement("div");l.classList.add("col-sm-2");h.appendChild(l);l.appendChild(k);g.appendChild(h);f.appendChild(g);e.appendChild(f);
d.appendChild(e);c.appendChild(d);b.appendChild(c);setTimeout(function(){"closeclicks"==a?$("#app-notifications-overlay").fadeIn("slow"):"minboxed"==a?$("#minbox-instruct-overlay").fadeIn("slow"):$("#box-instruct-overlay").fadeIn("slow")},300)}}
function getvisualinstructions(){var a=document.createElement("div");a.classList.add("row");var b=document.createElement("div");b.classList.add("col-md-8");b.classList.add("col-md-offset-2");var c=document.createElement("div");c.classList.add("row");var d=document.createElement("div");d.classList.add("col-md-3");d.classList.add("text-center");var e=document.createElement("p");e.style.float="none";e.style.display="inline-block";e.style.verticalAlign="middle";e.style.width=20;e.style.height=20;e.style.borderLeft=
"solid #a2a2a2 2px";e.appendChild(document.createTextNode("1"));d.appendChild(e);e=document.createElement("div");e.classList.add("col-md-3");e.classList.add("text-center");var f=document.createElement("p");f.style.float="none";f.style.display="inline-block";f.style.verticalAlign="middle";f.style.width=20;f.style.height=20;f.style.borderLeft="solid #a2a2a2 2px";f.style.borderBottom="solid #a2a2a2 2px";f.appendChild(document.createTextNode("2"));e.appendChild(f);f=document.createElement("div");f.classList.add("col-md-3");
f.classList.add("text-center");var g=document.createElement("p");g.style.float="none";g.style.display="inline-block";g.style.verticalAlign="middle";g.style.width=20;g.style.height=20;g.style.borderLeft="solid #a2a2a2 2px";g.style.borderBottom="solid #a2a2a2 2px";g.style.borderRight="solid #a2a2a2 2px";g.appendChild(document.createTextNode("3"));f.appendChild(g);g=document.createElement("div");g.classList.add("col-md-3");g.classList.add("text-center");var h=document.createElement("p");h.style.float=
"none";h.style.display="inline-block";h.style.verticalAlign="middle";h.style.width=20;h.style.height=20;h.style.borderLeft="solid #a2a2a2 2px";h.style.borderBottom="solid #a2a2a2 2px";h.style.borderRight="solid #a2a2a2 2px";h.style.borderTop="solid #a2a2a2 2px";h.appendChild(document.createTextNode("4"));g.appendChild(h);c.appendChild(d);c.appendChild(e);c.appendChild(f);c.appendChild(g);b.appendChild(c);a.appendChild(b);return a}
function showImageClickResetInstruction(){var a=document.getElementById("image-reset-overlay");if(null==a){a=document.createElement("div");a.setAttribute("id","image-reset-overlay");document.body.appendChild(a);var b=document.createElement("div");b.classList.add("container");b.classList.add("v-center");var c=document.createElement("div");c.classList.add("row");var d=document.createElement("div");d.classList.add("col-md-8");d.classList.add("col-md-offset-2");var e=document.createElement("div");e.classList.add("panel");
e.classList.add("panel-default");var f=document.createElement("h3");f.appendChild(document.createTextNode("Do you want to select a new location?"));f.style.color="#737373";f.style.fontWeight="900";e.appendChild(f);f=document.createElement("p");f.classList.add("lead");f.setAttribute("id","createuser-flake-text-header");f.appendChild(document.createTextNode("Your last click location did not match your earlier clicks."));f.style.color="#737373";f.style.fontWeight="700";e.appendChild(f);f=document.createElement("div");
f.classList.add("row");var g=document.createElement("div");g.classList.add("col-sm-8");g.classList.add("col-sm-offset-2");var h=document.createElement("p");h.classList.add("text-muted");h.setAttribute("id","createuser-flake-text");h.appendChild(document.createTextNode(" Click 'No', if you want to keep the earlier location and try again.Click 'Reset Location' if you want to use the new location."));h.style.color="#878787";h.style.fontWeight="600";g.appendChild(h);f.appendChild(g);e.appendChild(f);
f=document.createElement("div");f.classList.add("row");f.classList.add("text-center");g=document.createElement("div");g.setAttribute("id","cu-flake-can");f.appendChild(g);e.appendChild(f);f=document.createElement("div");f.classList.add("panel-body");f.classList.add("panel-word-wrap");g=document.createElement("div");g.classList.add("row");f.appendChild(g);var k=document.createElement("input");k.setAttribute("id","clr-box-instructions");k.classList.add("btn");k.classList.add("btn-primary");k.classList.add("btn-md");
k.conversationID="";k.changestarttime="";k.type="button";k.value="No";k.addEventListener("click",clearImageClickResetInstruction,!1);var l=document.createElement("div");l.classList.add("col-sm-3");h=document.createElement("div");h.classList.add("col-sm-3");var m=document.createElement("input");m.setAttribute("id","reset-box-instructions");m.classList.add("btn");m.classList.add("btn-primary");m.classList.add("btn-md");m.type="button";m.value="Reset Location";m.addEventListener("click",resetImageClick,
!1);l.appendChild(k);h.appendChild(m);g.appendChild(l);k=document.createElement("div");k.classList.add("col-sm-6");g.appendChild(k);g.appendChild(h);f.appendChild(g);e.appendChild(f);d.appendChild(e);c.appendChild(d);b.appendChild(c);a.appendChild(b);setTimeout(function(){$("#image-reset-overlay").fadeIn("slow")},200)}}
function showHotspotInstruction(){var a=document.getElementById("image-hotspot-overlay");if(null==a){a=document.createElement("div");a.setAttribute("id","image-hotspot-overlay");document.body.appendChild(a);var b=document.createElement("div");b.classList.add("container");b.classList.add("v-center");var c=document.createElement("div");c.classList.add("row");var d=document.createElement("div");d.classList.add("col-md-8");d.classList.add("col-md-offset-2");var e=document.createElement("div");e.classList.add("panel");
e.classList.add("panel-default");var f=document.createElement("h3");f.appendChild(document.createTextNode("Could you select a different location?"));f.style.color="#737373";f.style.fontWeight="900";e.appendChild(f);f=document.createElement("p");f.classList.add("lead");f.setAttribute("id","createuser-flake-text-header");f.appendChild(document.createTextNode("The system suggests that you select a different location."));f.style.color="#737373";f.style.fontWeight="700";e.appendChild(f);f=document.createElement("div");
f.classList.add("row");var g=document.createElement("div");g.classList.add("col-sm-8");g.classList.add("col-sm-offset-2");var h=document.createElement("p");h.classList.add("text-muted");h.setAttribute("id","createuser-flake-text");h.appendChild(document.createTextNode(" Click 'No', if you want to keep the previous location. Click 'I will choose a different spot' if you want to choose a new location."));h.style.color="#878787";h.style.fontWeight="600";g.appendChild(h);f.appendChild(g);e.appendChild(f);
f=document.createElement("div");f.classList.add("row");f.classList.add("text-center");g=document.createElement("div");g.setAttribute("id","cu-flake-can");f.appendChild(g);e.appendChild(f);f=document.createElement("div");f.classList.add("panel-body");f.classList.add("panel-word-wrap");g=document.createElement("div");g.classList.add("row");f.appendChild(g);var k=document.createElement("input");k.setAttribute("id","clr-box-instructions");k.classList.add("btn");k.classList.add("btn-primary");k.classList.add("btn-md");
k.conversationID="";k.changestarttime="";k.type="button";k.value="No";k.addEventListener("click",forcehotspotclick,!1);var l=document.createElement("div");l.classList.add("col-sm-3");h=document.createElement("div");h.classList.add("col-sm-3");var m=document.createElement("input");m.setAttribute("id","reset-box-instructions");m.classList.add("btn");m.classList.add("btn-primary");m.classList.add("btn-md");m.type="button";m.value="Sure I will choose a different spot.";m.addEventListener("click",clearImageHotspotClick,
!1);l.appendChild(k);g.appendChild(l);k=document.createElement("div");k.classList.add("col-sm-6");k.appendChild(m);g.appendChild(h);g.appendChild(k);f.appendChild(g);e.appendChild(f);d.appendChild(e);c.appendChild(d);b.appendChild(c);a.appendChild(b);setTimeout(function(){$("#image-hotspot-overlay").fadeIn("slow")},200)}}
function showPostMinBoxedInstruction(){var a=document.getElementById("minbox-instruct-overlay");if(null==a){a=document.createElement("div");a.setAttribute("id","minbox-instruct-overlay");document.body.appendChild(a);var b=document.createElement("div");b.classList.add("container");b.classList.add("v-center");var c=document.createElement("div");c.classList.add("row");var d=document.createElement("div");d.classList.add("col-md-8");d.classList.add("col-md-offset-2");var e=document.createElement("div");
e.classList.add("panel");e.classList.add("panel-default");var f=document.createElement("h3");f.appendChild(document.createTextNode("You have boxed minimum required images."));f.style.color="#737373";f.style.fontWeight="900";e.appendChild(f);f=document.createElement("p");f.classList.add("lead");f.setAttribute("id","createuser-flake-text-header");f.appendChild(document.createTextNode("You can continue boxing more images or start using Newauth."));f.style.color="#737373";f.style.fontWeight="700";e.appendChild(f);
f=document.createElement("div");f.classList.add("row");var g=document.createElement("div");g.classList.add("col-sm-8");g.classList.add("col-sm-offset-2");var h=document.createElement("p");h.classList.add("text-muted");h.setAttribute("id","createuser-flake-text");h.appendChild(document.createTextNode(" Click 'Box some more', if you want to continue boxing more images. The more images you box, the more secure your profile."));h.appendChild(document.createElement("br"));h.appendChild(document.createElement("br"));
h.appendChild(document.createTextNode("Click 'Start using Newauth' if you are done boxing images for now and want to start using Newauth. You will be taken to Welcome page. Once there, click on the Pending Setup tab. This will start your authentication process, the Newauth Way. You will need to click on the secret location on each image presented there. You can come back to Setup tab any time and box more images."));h.style.color="#878787";h.style.fontWeight="600";g.appendChild(h);f.appendChild(g);
e.appendChild(f);f=document.createElement("div");f.classList.add("row");f.classList.add("text-center");g=document.createElement("div");g.setAttribute("id","cu-flake-can");f.appendChild(g);e.appendChild(f);f=document.createElement("div");f.classList.add("panel-body");f.classList.add("panel-word-wrap");g=document.createElement("div");g.classList.add("row");f.appendChild(g);var k=document.createElement("input");k.setAttribute("id","clr-box-instructions");k.classList.add("btn");k.classList.add("btn-primary");
k.classList.add("btn-md");k.conversationID="";k.changestarttime="";k.type="button";k.value="Box some more";k.addEventListener("click",clearPostMinBoxedInstruction,!1);var l=document.createElement("div");l.classList.add("col-sm-3");h=document.createElement("div");h.classList.add("col-sm-3");var m=document.createElement("input");m.setAttribute("id","reset-box-instructions");m.classList.add("btn");m.classList.add("btn-primary");m.classList.add("btn-md");m.type="button";m.value="Start using Newauth";
m.addEventListener("click",startUsingNewauth,!1);l.appendChild(k);h.appendChild(m);g.appendChild(l);k=document.createElement("div");k.classList.add("col-sm-6");g.appendChild(k);g.appendChild(h);f.appendChild(g);e.appendChild(f);d.appendChild(e);c.appendChild(d);b.appendChild(c);a.appendChild(b);setTimeout(function(){$("#minbox-instruct-overlay").fadeIn("slow")},200)}}function clearBoxingInstructions(){$("#box-instruct-overlay").fadeOut(300)}
function clearMinBoxingInstructions(){$("#minbox-instruct-overlay").fadeOut(300);null!=document.getElementById("minbox-instruct-overlay")&&document.getElementById("minbox-instruct-overlay").remove()}function clearCloseclickInstructions(){$("#app-notifications-overlay").fadeOut(300);destroyBoxingInstructions()}function destroyBoxingInstructions(){null!=document.getElementById("app-notifications-overlay")&&document.getElementById("app-notifications-overlay").remove()}
function clearImageClickResetInstruction(){$("#image-reset-overlay").fadeOut(500);cleardiv(document.getElementById("image-reset-overlay"));document.getElementById("image-reset-overlay").remove()}function clearImageHotspotClick(){$("#image-hotspot-overlay").fadeOut(500);cleardiv(document.getElementById("image-hotspot-overlay"));document.getElementById("image-hotspot-overlay").remove()}
function clearPostMinBoxedInstruction(){$("#minbox-instruct-overlay").fadeOut(500);cleardiv(document.getElementById("minbox-instruct-overlay"))}function startUsingNewauth(){clearPostMinBoxedInstruction();logOut()}
function resetImageClick(){if(null==serversentclkdata)return console.log("Nothing to reset click to."),!1;var a=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");a.open("POST","/newauth/postRegisterClickData",!1);a.setRequestHeader("Content-Type","application/json");a.onreadystatechange=function(){if(4==a.readyState)if(200==a.status)clearImageHotspotClick(),boxNextImage(nextimgid);else if(500==a.status)return showBoxNotificationDialog("Our servers seems temporarily busy. Please try again after some time.",
"ERROR"),setTimeout(function(){clearBoxNotificationDialog()},5E3),!1};a.send(JSON.stringify({imgID:serversentclkdata.imgID,delay:serversentclkdata.delay,reset:"Y",clickX:serversentclkdata.clickX,clickY:serversentclkdata.clickY,imgWidth:serversentclkdata.imgWidth,imgHeight:serversentclkdata.imgHeight}))}
function forcehotspotclick(){if(null==serversentclkdata)return console.log("Nothing to reset click to."),!1;var a=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");a.open("POST","/newauth/postRegisterClickData",!1);a.setRequestHeader("Content-Type","application/json");a.onreadystatechange=function(){if(4==a.readyState)if(200==a.status)clearImageHotspotClick(),boxNextImage(nextimgid);else if(500==a.status)return showBoxNotificationDialog("Our servers seems temporarily busy. Please try again after some time.",
"ERROR"),setTimeout(function(){clearBoxNotificationDialog()},5E3),!1};a.send(JSON.stringify({imgID:serversentclkdata.imgID,delay:serversentclkdata.delay,forcehotspot:"true",clickX:serversentclkdata.clickX,clickY:serversentclkdata.clickY,imgWidth:serversentclkdata.imgWidth,imgHeight:serversentclkdata.imgHeight}))};var sseconnecturl="/newauth/api/joinFlakeConf/",confpostmsgurl="/newauth/api/sendmessagetoflakeconfuser/";navigator.getUserMedia=navigator.getUserMedia||navigator.mozGetUserMedia||navigator.webkitGetUserMedia;window.RTCPeerConnection=window.RTCPeerConnection||window.mozRTCPeerConnection||window.webkitRTCPeerConnection;window.RTCIceCandidate=window.RTCIceCandidate||window.mozRTCIceCandidate||window.webkitRTCIceCandidate;
window.RTCSessionDescription=window.RTCSessionDescription||window.mozRTCSessionDescription||window.webkitRTCSessionDescription;var confflake,confusername,localStream=null,confpostmsgconnection=null,confsseeventsource=null,localUser;const configuration={iceServers:[{urls:"stun:stun.l.google.com:19302"}]};let room,pc;
function findconfusers(){var a=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");a.open("POST","/newauth/api/getflakeconfusers/"+confflake+"/"+confusername,!1);a.withCredentials=!0;a.setRequestHeader("Content-Type","application/json");a.onreadystatechange=function(){if(4==a.readyState&&200==a.status){var b=a.responseText;null!=b&&0<b.length&&(b=JSON.parse(b).length,startWebRTC(2===b))}};a.send(null)}function onSuccess(){}function onError(a){console.error(a)}
function loadconfstartbutton(a){var b=document.getElementById("flakeconfmodallaunchbutton"),c=document.createElement("a");c.setAttribute("data-toggle","modal");c.setAttribute("href","#flake-conf-start-modal");var d=document.createElement("img");d.src="/static/icons/video-call-64.png";d.width="40";d.height="40";c.appendChild(d);b.appendChild(c);"undefined"!==typeof a&&(document.getElementById("auto-join-conf").value=a,b.classList.add("fadeInOut"),a=document.createElement("p"),a.setAttribute("id","JoinConfNotification"),
a.appendChild(document.createTextNode("Conference in progress. Click to join.")),b.appendChild(a))}
function joinflakeconference(a){var b=document.createElement("input");document.body.appendChild(b);b.setAttribute("value",newauthurl+"/f/"+a);b.select();document.execCommand("copy");document.body.removeChild(b);b=document.getElementById("conferencecontainerRow");var c=document.getElementById("confmodalbody");null!=c&&null!=b&&(c.innerHTML="",c.appendChild(b),b.style.display="block");establishFlakeConfSSEConnection(findconfusers,a)}
function exitflakeconference(){null!=localStream&&(localStream.getTracks().forEach(function(a){console.log("stopping track "+a.id);a.stop()}),console.log("stopped local video"));var a=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");a.open("GET","/newauth/api/dropfromFlakeConf/"+confflake+"/"+confusername,!1);a.withCredentials=!0;a.send(null);null!=confsseeventsource&&(confsseeventsource.close(),confsseeventsource=null,console.log("conf SSE event source closed"));$("#flake-conf-start-modal").modal("hide")}
function establishFlakeConfSSEConnection(a,b){confflake=b;null!=confusername?localUser=confusername:(confusername=Math.floor(1E3*Math.random()),console.log("passing a random username "+confusername),localUser=confusername,null!=document.getElementById("localstreamnamedisplay")&&(document.getElementById("localstreamnamedisplay").innerText=confusername));null==confpostmsgconnection&&(confpostmsgconnection=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP"),confpostmsgconnection.open("POST",
confpostmsgurl+confflake+"/"+confusername,!1),confpostmsgconnection.withCredentials=!0,confpostmsgconnection.setRequestHeader("Content-Type","application/json"));"undefined"!==typeof EventSource?null==confsseeventsource?(confsseeventsource=new EventSource(sseconnecturl+confflake+"/"+confusername),confsseeventsource.onerror=function(){console.log("EventSource "+sseconnecturl+confflake+"/"+confusername+" failed to connect.");document.getElementById("flake-conf-updates").innerText="EventSource "+sseconnecturl+
confflake+"/"+confusername+" failed to connect."},confsseeventsource.addEventListener("open",a),console.log("Connected to conf SSE event source"),document.getElementById("flake-conf-updates").innerText="Waiting for Peer.."):(console.log("Conf SSE event source is aleady connected"),a()):document.getElementById("flake-conf-updates").innerText="This browser does not support EventSource API. Instant messsaging will not work."}
function sendMessage(a){confpostmsgconnection=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");confpostmsgconnection.open("POST",confpostmsgurl+confflake+"/"+confusername,!1);confpostmsgconnection.withCredentials=!0;confpostmsgconnection.setRequestHeader("Content-Type","application/json");confpostmsgconnection.send(JSON.stringify(a))}
function startWebRTC(a){pc=new RTCPeerConnection(configuration);pc.onicecandidate=function(a){a.candidate&&sendMessage({candidate:a.candidate})};a&&(pc.onnegotiationneeded=function(){pc.createOffer().then(localDescCreated).catch(onError)});pc.ontrack=function(a){console.log("gotRemotetrack",a.track);var b=document.getElementById("remoteVideo");if(null==b){var d=document.getElementById("conferenceRow");b=document.createElement("video");b.setAttribute("id","remoteVideo");b.autoplay=!0;b.playsinline=
!0;d.appendChild(b)}try{if(null==b.srcObject){b.srcObject=new MediaStream;b.srcObject.addTrack(a.track,b.srcObject);console.log("remote stream attached to remotevideo.srcobject ID "+a.track.id+" muted "+a.track.muted);b.style.height="60%";b.style.width="100%";b.style.zIndex=0;var e=document.getElementById("localVideo");e.style.position="absolute";e.style.height="100px";e.style.width="100px";e.style.bottom="5px";e.style.right="5px";e.style.zIndex=b.style.zIndex+1}else b.srcObject.addTrack(a.track,
b.srcObject)}catch(f){console.log("exception in remote stream attached to remotevideo.srcbj, setting remotevideo.src instead ",f),b.src=window.URL.createObjectURL(a.stream)}};navigator.mediaDevices.getUserMedia({audio:!0,video:!0}).then(function(a){var b=document.getElementById("localVideo");localStream=a;b.srcObject=a;a.getTracks().forEach(function(b){pc.addTrack(b,a)});document.getElementById("callhangupbutton").style.display="block"},onError);confsseeventsource.onmessage=function(a){if(0!=a.data.length){a=
JSON.parse(a.data);if("undefined"!==typeof a.message&&"undefined"!==typeof a.message.type&&"user_left"===a.message.type&&null!=document.getElementById("JoinConfNotification")){var b=document.getElementById("flakeconfmodallaunchbutton");null!=b&&(b.style.display="none")}a.sdp?(console.log("sdp event data received "+JSON.stringify(a)),pc.setRemoteDescription(new RTCSessionDescription(a.sdp),function(){"offer"===pc.remoteDescription.type&&pc.createAnswer().then(localDescCreated).catch(onError)},onError)):
a.candidate&&pc.addIceCandidate(new RTCIceCandidate(a.candidate),onSuccess,onError)}}}function localDescCreated(a){pc.setLocalDescription(a,function(){sendMessage({sdp:pc.localDescription})},onError)}function displayflakechatmodal(a){$("#display-flake-messages-modal").modal("show")};var clickstarttime,posts=[],topictype,topicdisplayname,topichits,closepopuptimeoutmap={},crtimetoidxmap={},loctoidxmap={},topiceventsource,startsize=10,maxdotsize=48,playidx,playtimeoutids=[],searchtimeoutid,remaintime=0,topiccurrentdepth=0,topicjsonschema,sortfield,sortvalues,currentsubtopic=null,splitschemas;const screenWidth=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,screenHeight=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight;
let sidecontainer,totalViews=0,totalComments=0,totalRecords=0;const sqrt2=Math.sqrt(2);let currentPage,maxPage,minPage=0,scrollTimer;
var addpostfunction=function(a){return posttoflakemodal(event)},reduceprivacyfunction=function(a){displaybuttonbehavior(a,"Reduce privacy - Available only to flake owner.")},launchvltpopupfunction=function(a,b){return function(b){"undefined"!==typeof b&&b.stopPropagation();b=document.getElementById("dot-desc-"+a);null!=b&&(b.style.display="none");b=document.getElementById("dot-popup-vlt-"+a);null!=b?b.style.display="block":null!=posts&&posts.length>=a&&createVaultPopup(posts[a],a)}},drageventinstance=
0,setofhashes=new Set,dotsizemap=new Map,thisdeviceid="",fileattachments=[],isowner=!1,iscloselooptopic=!1,originaldata,rndsalt,rnditer,rndseq,rndcrdate,rnd=function(a,b){a=Math.ceil(a);b=Math.floor(b);return Math.floor(Math.random()*(b-a+1)+a)};
function attachtransitionstyles(a,b){"undefined"==typeof b&&(b="0.6");a.style.WebkitTransition="all "+b+"s";a.style.MozTransition="all "+b+"s";a.style.mozTransition="all "+b+"s";a.style.MsTransition="all "+b+"s";a.style.OTransition="all "+b+"s";a.style.transition="all "+b+"s"}function clearprevioustransitionstyles(a){a.style.WebkitTransition="none";a.style.MozTransition="none";a.style.mozTransition="none";a.style.MsTransition="none";a.style.OTransition="none";a.style.transition="none"}
function toggletopicsearch(a){a.stopPropagation();searchtimeoutid;if("none"==document.getElementById("input-search-post").style.display){document.getElementById("input-search-post").style.display="block";document.getElementById("input-search-post").style.zIndex="1";a=document.getElementsByClassName("dot-popup");for(var b=0;b<a.length;b++)a[b].classList.remove("expand-open"),a[b].style.display="none";document.getElementById("post-search-input").addEventListener("input",function(a){stopDefaultBackspaceBehaviour(a);
null!=searchtimeoutid&&clearTimeout(searchtimeoutid);searchtimeoutid=setTimeout(function(a){displaypostsasdots(posts,!1,document.getElementById("post-search-input").value)},200)});document.getElementById("post-search-input").addEventListener("click",function(a){a.stopPropagation()})}else document.getElementById("input-search-post").style.display="none"}
function cleanString(a){if("undefined"!=typeof a)return a.replace(/[^\x20-\x7E\n]/g,"").replace(/[?]/g,"").replace(/\\+/g,"\\").replace(/\.+/g,".").replace(/^[^a-zA-Z0-9]+|[^a-zA-Z0-9]+$|(?<=\s)[^a-zA-Z0-9]+(?=\s)/g,"")}
function topicdocumentclick(a){"undefined"!=typeof a&&(console.log("document click fired"),a.stopPropagation(),null!=document.getElementById("input-search-post")&&"none"!=document.getElementById("input-search-post").style.display&&"input-search-post"!=a.target.id&&(document.getElementById("input-search-post").style.display="none"));a=100;null!=clickstarttime&&(a=new Date-clickstarttime);if(100>=a){var b=document.getElementsByClassName("dot-popup");if(null!=b)for(a=b.length;0<b.length&&0<a;)b[0].classList.remove("expand-open"),
setTimeout(function(){removediv(b[0])},400),a--;a=document.getElementsByClassName("dot-desc");if(null!=a){null!=document.getElementById("showdescbtn")&&(document.getElementById("showdescbtn").onclick=function(a){displayallpostdescription(event)});for(var c=a.length;0<a.length&&0<c;)removediv(a[0]),c--}c=document.getElementsByClassName("expanded-dot");if(null!=c&&0<c.length)for(a=0;a<c.length;a++)shrinkdot(c[a])}else setTimeout(function(){clickstarttime=null},1E3)}
function displayemptypostsmessage(){var a=document.createElement("div");a.id="notification-div";a.style.position="fixed";a.style.bottom="25px";a.style.width="80%";a.style.left="10%";a.style.right="10%";a.style.backgroundColor="#fafafa";a.style.color="#787878";a.style.textAlign="center";a.style.fontSize="18px";a.style.padding="10px";a.style.border="1px solid #ccc";a.style.borderRadius="20px";a.innerHTML="No data exists for this page. You can add content by clicking the + button on the menu.";document.body.appendChild(a);
setTimeout(function(){var b=1,c=setInterval(function(){.1>=b&&(clearInterval(c),a.style.display="none");a.style.opacity=b;a.style.filter="alpha(opacity\x3d"+100*b+")";b-=.1*b},50)},5E3)}
function displaypostsasdots(a,b,c,d){dotsizemap=new Map;if("undefined"!=typeof c&&0<c.length)for(var e=document.getElementsByClassName("dot"),f=0;f<e.length;f++)if(0<c.indexOf(":::")){if(0<=c.indexOf("PREVIEW::")?0<=c.indexOf(sortfield+"::")&&"undefined"!=typeof e[f].dataset[sortfield.toLowerCase()]&&("ALL"==c.split(":::")[2]?(e[f].style.backgroundColor=e[f].dataset.savedBgClr,scaledotsize(e[f],2)):e[f].dataset[sortfield.toLowerCase()]!=c.split(":::")[2]&&(e[f].style.backgroundColor="#f2f2f2",scaledotsize(e[f],
1))):"ALL"==c.split(":::")[1]?(e[f].style.display="flex",e[f].style.justifyContent="center",e[f].style.alignItems="center",scaledotsize(e[f],2),null!=document.getElementById("dot-sidepanel-"+f)&&(document.getElementById("dot-sidepanel-"+f).style.display="block")):0<=c.indexOf(sortfield+"::")&&"undefined"!=typeof e[f].dataset[sortfield.toLowerCase()]&&(e[f].dataset[sortfield.toLowerCase()]!=c.split(":::")[1]?(e[f].style.display="none",null!=document.getElementById("dot-sidepanel-"+f)&&(document.getElementById("dot-sidepanel-"+
f).style.display="none")):(e[f].style.display="flex",e[f].style.justifyContent="center",e[f].style.alignItems="center",scaledotsize(e[f],2),null!=document.getElementById("dot-sidepanel-"+f)&&(document.getElementById("dot-sidepanel-"+f).style.display="block"))),0<=c.indexOf("PREVIEW::")&&f==e.length-1)return}else 0<c.length?e[f].style.display="none":(e[f].style.display="flex",e[f].style.justifyContent="center",e[f].style.alignItems="center");console.log(a.length+" justadded: "+b+" startingdot: "+d);
"undefined"==typeof b||0==b?postlocationmap=[]:0<a.length&&null!=a[0].location&&(e=document.getElementById("dot-"+loctoidxmap[a[0].location]),removediv(e));"undefined"!=typeof topicjsonschema&&0<topicjsonschema.length&&1==a.length&&(document.getElementById("singlepost-crtime").value=a[0].crtime);maxdotsize=parseInt(Math.sqrt((window.innerWidth*window.innerHeight-Math.pow(350,2))/a.length)/4);console.log("max dot size [theoretical] "+maxdotsize+" postlen "+a.length);console.log("screenWidth screenHeight"+
screenWidth+" "+screenHeight);maxdotsize>250/3&&(maxdotsize=250/3);e=document.getElementById("topic-app");null==e&&(e=document.getElementById("app-flk"));f=0;if(null!=a){var g=displayRadialText(a,!1);null!=g&&0<g.length&&(maxdotsize=g[0].dotmaxsize);let p=Array(a.length);for(var h=0;h<a.length;h++){let r=null,q=null;if("undefined"!=typeof c&&0<c.length)if("undefined"!=typeof a[h].tags&&null!=a[h].tags&&0<a[h].tags.length){console.log("Looking for "+c+" in tags "+h+"th post");for(var k=0;k<a[h].tags.length;k++)if(a[h].tags[k].toLowerCase().startsWith(c.toLowerCase())){document.getElementById("dot-"+
h).style.display="flex";document.getElementById("dot-"+h).style.justifyContent="center";document.getElementById("dot-"+h).style.alignItems="center";f++;break}}else{k="";"undefined"!=typeof a[h].text&&null!=a[h].text&&(k=a[h].text.toLowerCase());var l="";"undefined"!=typeof a[h].data&&null!=a[h].data&&null!=a[h].data.text&&(l=a[h].data.text.toLowerCase());if(0<=k.indexOf(c.toLowerCase())||0<=l.indexOf(c.toLowerCase())){document.getElementById("dot-"+h).style.display="flex";document.getElementById("dot-"+
h).style.justifyContent="center";document.getElementById("dot-"+h).style.alignItems="center";showpostdescription(null,h);f++;break}}else{var m=checkifalreadyseen(a[h].crtime);k=checkifdeleted(a[h].crtime);"undefined"!=typeof a[h].data&&null!=a[h].data&&null!=a[h].data.text&&(l=a[h].data.text.toLowerCase());l=document.createElement("div");null==d?l.setAttribute("id","dot-"+h):l.setAttribute("id","sub-"+d+"-"+h);l.classList.add("circle-to-rect");l.classList.add("dot");attachtransitionstyles(l,1);l.style.top=
g[h].top;l.style.left=g[h].left;"undefined"!=typeof b&&1==b&&(document.getElementById("dot-0"),console.log("adding inposts to post"),[a[0]].concat(posts),posts=a,shiftdotandpopupids());0!=h||m||k||"undefined"!=typeof b&&1==b&&document.getElementById("dot-popup-"+h);l.setAttribute("data-long-press-delay",500);null!=sortfield&&1<sortvalues.length&&"undefined"!=typeof a[h].data[sortfield]&&l.setAttribute("data-"+sortfield,a[h].data[sortfield]);let c,f=!1;const u=document.createElement("div");u.className=
"concentric-square";m=parseInt(g[h].width,10);u.style.position="absolute";u.style.top="50%";u.style.left="50%";u.style.width=`${m}px`;u.style.height=`${m}px`;u.style.transform="translate(-50%, -50%)";u.style.backgroundColor="transparent";u.style.zIndex=6;600<screenWidth&&600<screenHeight&&null==d&&u.addEventListener("mouseenter",function(b,d){return function(b){c=Date.now();let e=!0;if(!f){f=!0;var g=isdotafolder(a[d].tags);e=!g;p[d]=setTimeout(()=>{null==r&&(r=document.getElementById("dot-"+d));
null==q&&(q=r.getBoundingClientRect());e&&null==posts[d].data&&(null==r.querySelector("#displayloadingcontainer")&&r.insertBefore(createloadingdiv(),r.firstChild),retrievepostsummaryandshowinpopup(posts[d],d,b));var c=r.querySelector(".text-container");if(null!=c&&null!=c.innerText&&null==c.querySelector(".url-preview")){let a=extractURLFromText(c.innerText);"undefined"!=typeof a&&0<a.length&&(console.log("Extracted URL from text "+a[0].text),0==a[0].text.indexOf(window.location.href)?e=!1:setTimeout(function(){e&&
(null==r.querySelector("#displayloadingcontainer")&&r.insertBefore(createloadingdiv(),r.firstChild),console.log("querying url after mouseneter "+a[0].text),queryURLforpreview(a[0].text,d))},150))}console.log("dotexpandtimeout "+d+" "+p[d]);highlightAndScroll(d);if(e)expandDot(r,q,!0);else{if(g){c=a[d].text;if(a[d].data)try{console.log(`Raw data for post ${d}:`,a[d].data);const b=a[d].data;b&&b.text&&(c=b.text)}catch(F){console.error(`Error parsing data for post ${d}:`,F),console.log("Problematic data:",
a[d].data)}previewsubtopic(`${a[d].topic}/${c}`,`dot-${d}`)}showpostdescription(b,d)}},150)}}}(event,h));null==d&&u.addEventListener("mousedown",function(a,b){return function(a){a.stopPropagation();a.preventDefault();console.log("expandtimeout before clear "+p[b]);clearTimeout(p[b]);console.log("expandtimeout cleared. now "+p[b])}}(event,h));(600>screenWidth||600>screenHeight&&null==d)&&u.addEventListener("click",function(a,b){return function(a){a.stopPropagation();a.preventDefault();c=Date.now();
let d=!0;d=!isdotafolder(posts[b].tags);null==r&&(r=document.getElementById("dot-"+b));null==q&&(q=r.getBoundingClientRect());d&&null==posts[b].data&&(null==r.querySelector("#displayloadingcontainer")&&r.insertBefore(createloadingdiv(),r.firstChild),retrievepostsummaryandshowinpopup(posts[b],b,a));var e=r.querySelector(".text-container");if(null!=e&&null!=e.innerText&&null==e.querySelector(".url-preview")){let a=extractURLFromText(e.innerText);"undefined"!=typeof a&&0<a.length&&(0==a[0].text.indexOf(window.location.href)?
d=!1:setTimeout(function(){null==r.querySelector("#displayloadingcontainer")&&r.insertBefore(createloadingdiv(),r.firstChild);console.log("querying url after mouseneter "+a[0].text);queryURLforpreview(a[0].text,b)},600))}d?expandDot(r,q,!0):showpostdescription(a,b)}}(event,h));600<screenWidth&&600<screenHeight&&null==d&&l.addEventListener("mouseleave",function(a,b){return function(a){var d=Date.now();if(null!=c&&0<c&&200>d-c)return clearTimeout(p[b]),p[b]=null,f=!1;d=!isdotafolder(posts[b].tags);
f=!1;r=document.getElementById("dot-"+b);console.log("came in  mouseout event on dot "+b+" left "+r.left+" top "+r.top+" doexpand "+d);d?shrinkdot(r):(showpostdescription(a,b,!0),removeDotConnections("dot-"+b))}}(event,h));k||u.addEventListener("long-press",function(a,b){return function(a){handlelongpress(a,b)}}(event,h));if(0==h&&null==d){document.body.addEventListener("click",topicdocumentclick);var n;null!=document.getElementById("topic-page-id")&&(n=document.getElementById("topic-page-id"));null!=
document.getElementById("flake-page-id")&&(n=document.getElementById("flake-page-id"));n.addEventListener("unload",function(a){document.body.removeEventListener("click",topicdocumentclick)})}"undefined"!=typeof a[h].hit&&0<a[h].hit.length&&0<parseInt(a[h].hit)||("undefined"==typeof d||null==d?(m=g[h].pcolor,l.style.backgroundColor=m,l.savedpastel=m,l.setAttribute("data-saved-bg-clr",m)):l.style.backgroundColor="#d2d2d2");k&&(l.style.display="none");l.style.position="absolute";l.style.zIndex="5";null!=
d&&(l.style.zIndex="4");isdotafolder(a[h].tags)&&(l.style.borderRadius="35%");l.style.width=g[h].width;l.style.height=g[h].width;setTimeout(function(b,c,e){return function(){b.appendChild(c);c.appendChild(u);var f=isdotafolder(a[e].tags),g=null;try{g=a[e].data}catch(H){}var h=null;h=null==g||null==g.text||0==g.text.length?a[e].text:g.text;var k=document.createElement("div");k.classList.add("dot-disp-text");k.style.display="flex";k.style.justifyContent="center";k.style.alignItems="center";k.style.fontSize=
"min(14px, 0.9vw)";k.style.width="100%";k.style.height="100%";k.style.whiteSpace="nowrap";k.style.overflow="hidden";k.style.textAlign="center";k.style.position="absolute";k.style.top="0";k.style.left="0";if(f){var l=null;"undefined"!=typeof a[e].summary&&null!=a[e].summary&&(l=!isBase64JSON(a[e].summary)&&isValidBase64(a[e].summary)?atob(a[e].summary):a[e].summary);null==d&&u.addEventListener("click",function(){showpostdescription(null,e,!0);removeDotConnections("dot-"+e);loadsubtopic(a[e].topic+
"/"+h,l)});if(null!=h&&null==d){var m=getDisplayLetters(h);document.getElementById("dot-"+e).style.color="#f3f3f3";k.innerText=m;document.getElementById("dot-"+e).appendChild(k);document.getElementById("dot-"+e).style.cursor="pointer"}}else null!=h&&null==d&&(m=getDisplayLetters(h),null!=g&&null!=g.abbr&&(m=g.abbr),document.getElementById("dot-"+e).style.color="#f3f3f3",k.innerText=m,document.getElementById("dot-"+e).appendChild(k)),createpopupdiv(a[e],e,null,!1,void 0+startsize,void 0+startsize);
if(e==a.length-1)if("undefined"!=typeof d&&null!=d){g=[];for(f=0;f<a.length;f++)g.push("sub-"+d+"-"+f);0<g.length&&connectDots(d,g)}else{var n=function(a){return new Promise(b=>setTimeout(b,a))};g=document.getElementById("dot-0");isdotafolder(posts[0].tags)||null!=a[0].data||(console.log("No summary data found in post "+e+" pulling from server"),g.insertBefore(createloadingdiv(),g.firstChild),retrievepostsummaryandshowinpopup(posts[0],0,null));k=g.querySelector(".text-container");if(null!=k&&null!=
k.innerText&&null==k.querySelector(".url-preview")){let a=extractURLFromText(k.innerText);"undefined"!=typeof a&&0<a.length&&(null==g.querySelector("#displayloadingcontainer")&&(console.log("Line 812 insert loader in dot "+g.id),g.insertBefore(createloadingdiv(),g.firstChild)),setTimeout(function(){a[0].text.startsWith("https://newauth.io/")||queryURLforpreview(a[0].text,0)},1200))}f?showpostdescription(null,e,!0):increasesizesoftopdots();(async function(){isdotafolder(posts[0].tags)&&(await n(400),
expandDot(document.getElementById("dot-0")),await n(2500),shrinkdot(document.getElementById("dot-0")));await n(300)})()}}}(e,l,h),50);l.style.opacity=window.getComputedStyle(l).getPropertyValue("opacity");l.style.transform=window.getComputedStyle(l).getPropertyValue("transform");k=0;"undefined"!=typeof a[h].week&&null!=a[h].week&&0<a[h].week.length&&(k=parseInt(moment().week())-parseInt(a[h].week));0!=k?0<k?(l.style.opacity=Math.max(.04,1-.15*k),console.log("setting lower opacity for weekdiff "+k+
" "+(1-.15*k))):(l.style.opacity=Math.max(.04,1-.1*(52+k)),console.log("setting lower opacity for weekdiff "+k+" "+(1-.15*(52+k)))):l.style.opacity=1}}"undefined"!=typeof c&&0<c.length&&0==f&&displaybuttonbehavior(null,"No match found")}console.log("total unique values in hashset "+setofhashes.size);console.log("dot sizes",dotsizemap)}
function toggleFullScreenLoadingOverlay(a){var b=document.getElementById("loading-overlay");const c=document.getElementById("loading-overlay-style");if(a){var d=function(){const a=document.createElement("div"),b=`move-${Math.random().toString(36).substr(2,6)}`,c=Math.floor(40*Math.random()-20),k=Math.floor(40*Math.random()-20),l=Math.floor(40*Math.random()-20),m=Math.floor(40*Math.random()-20),n=Math.floor(40*Math.random()-20),p=Math.floor(40*Math.random()-20),r=document.createElement("style");r.textContent=
`
                @keyframes ${b} {
                    0% { transform: translate(0, 0); }
                    25% { transform: translate(${c}px, ${k}px); }
                    50% { transform: translate(${l}px, ${m}px); }
                    75% { transform: translate(${n}px, ${p}px); }
                    100% { transform: translate(0, 0); }
                }
            `;document.head.appendChild(r);a.className="loading-dot";Object.assign(a.style,{position:"absolute",width:"26px",height:"26px",borderRadius:"50%",backgroundColor:"#888",left:`${100*Math.random()}%`,top:`${100*Math.random()}%`,animation:`fadeInOutOnce 3s ease-in-out forwards, ${b} 2s ease-in-out infinite`});e.appendChild(a);setTimeout(()=>{a.remove();r.remove();d()},3E3)};if(!b){c||(a=document.createElement("style"),a.id="loading-overlay-style",a.textContent="\n                @keyframes fadeInOutOnce {\n                    0% { opacity: 0; }\n                    50% { opacity: 1; }\n                    100% { opacity: 0; }\n                }\n            ",
document.head.appendChild(a));var e=document.createElement("div");e.id="loading-overlay";Object.assign(e.style,{position:"fixed",top:0,left:0,width:"100vw",height:"100vh",background:"rgba(255, 255, 255, 0.9)",zIndex:9999,pointerEvents:"none",overflow:"hidden"});document.body.appendChild(e);a=Math.floor(11*Math.random())+10;for(b=0;b<a;b++)setTimeout(d,1E3*Math.random())}}else b&&b.remove(),c&&c.remove()}
function getDisplayLetters(a){if(isJSON(a)){a=JSON.parse(JSON.parse(a));const b=Object.keys(a);a=a[b[0]]}a=a.split(" ");return 1==a.length&&5>a[0].length?a[0].toUpperCase():a.map((a,c)=>2>c?a.charAt(0).toUpperCase():"").join("")}function isBase64JSON(a){if(!isValidBase64(a))return!1;try{const b=atob(a),c=JSON.parse(b);if("object"===typeof c&&null!==c)return!0}catch(b){}return!1}function isValidBase64(a){try{return btoa(atob(a))===a}catch(b){return!1}}
function isdotafolder(a){if("undefined"!=typeof a&&null!=a)for(var b=0;b<a.length;b++)if(a[b].toLowerCase().startsWith("folder"))return!0;return!1}function loadcontentlocally(a){if("undefined"!==typeof Storage){if(null!=localStorage.getItem("CONTENT::"+a)){let b=JSON.parse(localStorage.getItem("CONTENT::"+a));b.hits="undefined"!=typeof b.hits?b.hits+1:1;localStorage.setItem("CONTENT::"+a,JSON.stringify(b));return b.items}return[]}console.warn("Local storage not supported ")}
function loadsubtopic(a,b){posts=[];var c=document.getElementsByClassName("dot");removediv(document.getElementById("summary-text-container"));Array.from(c).forEach(function(a){a.parentNode.removeChild(a)});var d=a.split("/");if(null!=topicstorage&&0<=topicstorage.indexOf("client"))setheaderbasedonsubtopic(a),posts=loadcontentlocally(a),console.log("about to display "+posts.length+" in loadsubtopic"),displaypostsasdots(posts),"undefined"!=typeof b&&null!=b&&(document.getElementById("infomodalbodycontent").innerText=
b,displaysubtopicsummary(b)),topiccurrentdepth=d.length-1;else{var e=new XMLHttpRequest;e.open("GET","/newauth/api/getpostsbytopic/"+a,!1);e.setRequestHeader("Content-Type","application/json");e.onreadystatechange=function(){if(4==e.readyState&&200==e.status){setheaderbasedonsubtopic(a);"undefined"!=typeof b&&null!=b&&(document.getElementById("infomodalbodycontent").innerText=b,displaysubtopicsummary(b));var c=e.responseText;null!=c&&10<c.length&&(posts=JSON.parse(c),console.log("about to display "+
posts.length+" in loadsubtopic 2"),displaypostsasdots(posts));topiccurrentdepth=d.length-1}};e.send(null)}}
function previewsubtopic(a,b){if(null!=topicstorage&&0<=topicstorage.indexOf("client"))a=loadcontentlocally(a),console.log("about to display "+a.length+" in previewsubtopic"),displaypostsasdots(a,void 0,void 0,b);else{var c=new XMLHttpRequest;c.open("GET","/newauth/api/getpostsbytopic/"+a,!1);c.setRequestHeader("Content-Type","application/json");c.onreadystatechange=function(){if(4==c.readyState&&200==c.status){var a=c.responseText;null!=a&&10<a.length&&(a=JSON.parse(a),console.log("about to display "+
posts.length+" in previewsubtopic 2"),displaypostsasdots(a,void 0,void 0,b))}};c.send(null)}}
function connectDots(a,b){var c=document.getElementById(a);if(c){c=c.getBoundingClientRect();var d=c.left+c.width/2,e=c.top+c.height/2,f=document.createElementNS("http://www.w3.org/2000/svg","svg");f.style.position="absolute";f.style.top="0";f.style.left="0";f.style.width="100%";f.style.height="100%";f.style.pointerEvents="none";f.class="connector-"+a;document.body.appendChild(f);b.forEach(b=>{function c(a){a=Math.min((a-n)/200,1);const b=e+(l-e)*a;m.setAttribute("x2",(d+(g-d)*a).toString());m.setAttribute("y2",
b.toString());1>a&&requestAnimationFrame(c)}if(b=document.getElementById(b)){b=b.getBoundingClientRect();var g=b.left+b.width/2,l=b.top+b.height/2,m=document.createElementNS("http://www.w3.org/2000/svg","line");m.setAttribute("x1",d.toString());m.setAttribute("y1",e.toString());m.setAttribute("x2",d.toString());m.setAttribute("y2",e.toString());m.setAttribute("stroke","rgba(200, 200, 200, 0.5)");m.setAttribute("stroke-width","2");f.appendChild(m);window.dotConnections||(window.dotConnections=new Map);
window.dotConnections.has(a)||window.dotConnections.set(a,[]);window.dotConnections.get(a).push(m);var n=performance.now();requestAnimationFrame(c)}})}}
function removeDotConnections(a){if(window.dotConnections&&window.dotConnections.has(a)){var b=document.querySelectorAll(`div[id^="sub-${a}-"]`);Array.from(b).forEach(a=>a.remove());window.dotConnections.get(a).forEach(a=>{function b(d){d=Math.min((d-c)/300,1);const e=k+(g-k)*d;a.setAttribute("x2",(h+(f-h)*d).toString());a.setAttribute("y2",e.toString());1>d?requestAnimationFrame(b):(a.parentNode&&a.parentNode.removeChild(a),0===window.dotConnections.size&&(d=document.querySelector("svg"))&&d.parentNode&&
d.parentNode.removeChild(d))}const c=performance.now(),f=parseFloat(a.getAttribute("x1")),g=parseFloat(a.getAttribute("y1")),h=parseFloat(a.getAttribute("x2")),k=parseFloat(a.getAttribute("y2"));requestAnimationFrame(b)});window.dotConnections.delete(a)}}
function displaysubtopicsummary(a){const b=document.createElement("div");b.id="summary-text-container";b.title=a;b.style.position="fixed";b.style.bottom="0";b.style.right="10";b.style.width="40vw";b.style.maxHeight="20vh";b.style.overflow="hidden";b.style.zIndex=1;b.style.padding="10px";b.style.boxSizing="border-box";b.style.color="#d9d9d9";let c="",d=2;a.split(" ").forEach(a=>{if(c.length+a.length>calculateCharactersFit(d,35)){const a=document.createElement("span");a.style.display="block";a.style.fontSize=
d+"vw";a.textContent=c;b.appendChild(a);c="";d-=.2}c+=a+" "});c&&(a=document.createElement("span"),a.style.display="block",a.style.fontSize=d+"vw",a.textContent=c,b.appendChild(a));document.body.appendChild(b)}function calculateCharactersFit(a,b){const c=document.createElement("span");c.style.fontSize=a+"vw";c.style.visibility="hidden";c.textContent="v";document.body.appendChild(c);a=c.offsetWidth;document.body.removeChild(c);return Math.floor(b/100*window.innerWidth/a)}
function setheaderbasedonsubtopic(a){const b=a.split("/");var c=b[0],d="";document.getElementById("topic-header-main").innerHTML="";var e=0;b.forEach(function(a){0==e?d+='\x3ca href\x3d"/t/'+a+"\" style\x3d'color:#858585; '\x3e"+a+"\x3c/a\x3e":(c+="/"+a,d=e==b.length-1?d+(" | \x3ca href\x3d\"javascript:loadsubtopic('"+c+"');\" style\x3d'color:#656565; text-shadow:0px 1px 1px #858585'\x3e"+a+"\x3c/a\x3e"):d+(" | \x3ca href\x3d\"javascript:loadsubtopic('"+c+"');\" style\x3d'color:#858585;'\x3e"+a+"\x3c/a\x3e"));
e++});topicname=c;document.getElementById("topic-header-main").innerHTML=d}
function increasesizesoftopdots(){if(null!=sortfield&&2<sortvalues.length&&"undefined"!=typeof posts[0].data[sortfield])for(var a=0;a<posts.length;a++)posts[a].data[sortfield]==sortvalues[0]&&scaledotsize("dot-"+parseInt(a),2),posts[a].data[sortfield]==sortvalues[1]&&scaledotsize("dot-"+parseInt(a),1.618);else{for(a=0;a<.2*posts.length;a++)scaledotsize("dot-"+parseInt(a),2);for(a=.2*posts.length;a<posts.length/2;a++)scaledotsize("dot-"+parseInt(a),1.618);for(a=posts.length/2;a<posts.length;a++)scaledotsize("dot-"+
parseInt(a),.5),document.getElementById("dot-"+parseInt(a)).style.opacity=.6}}
function scaledotsize(a,b){if(a=document.getElementById(a)){if(a.data&&"undefined"!=typeof a.data.resize&&null!=a.data.resize){var c=a.data.resize;if(2<c*b){console.log("Already "+c+" times original. Cant expand to "+c*b);return}}"undefined"===typeof a.savedRect&&(a.savedRect=a.getBoundingClientRect());if(1===b)a.classList.remove("resized"),a.setAttribute("data-resize",b),a.style.transition="none",a.style.width=a.savedRect.width+"px",a.style.height=a.savedRect.height+"px",a.style.left=a.savedRect.left+
"px",a.style.top=a.savedRect.top+"px";else{a.classList.add("resized");a.data&&null!=a.data.resize?a.setAttribute("data-resize",a.data.resize*b):a.setAttribute("data-resize",b);c=parseFloat(getComputedStyle(a).width);b*=c;var d=parseFloat(getComputedStyle(a).left),e=parseFloat(getComputedStyle(a).top);a.style.transition="all 0.6s";a.style.width=b+"px";a.style.height=b+"px";a.style.left=d-(b-c)/2+"px";a.style.top=e-(b-c)/2+"px"}}}
function expandDot(a,b,c){if(null!=a){if("undefined"==typeof a.savedRect)if(null!=b)a.savedRect=b;else return;b=a.savedRect;var d=document.getElementsByClassName("expanded-dot");if(null!=d&&0<d.length)for(var e=0;e<d.length;e++)shrinkdot(d[e]);d=a.querySelector(".text-container");e=null;null!=a.getElementsByTagName("img")&&(e=a.getElementsByTagName("img")[0]);var f=window.innerWidth/2,g=window.innerHeight/2,h=b.left+b.width/2,k=b.top+b.height/2,l=Math.min(window.innerWidth,window.innerHeight)/(4*
b.width),m=parseFloat((window.innerWidth/window.innerHeight).toFixed(4));a.style.transition="all 0.7s cubic-bezier(.42,.97,.52,1.29)";var n=a.querySelector(".concentric-square");h>f&&(a.style.left=`${b.left-b.width*(l-1)}px`);k>g&&(a.style.top=`${b.top-b.width*(l-1)}px`);n.style.width=`${b.width*l*m}px`;n.style.height=`${b.height*l}px`;n.style.borderRadius="10px";a.style.width=`${b.width*l*m}px`;a.style.height=`${b.height*l}px`;a.style.borderRadius="10px";a.style.zIndex=7;a.style.backgroundColor=
"#DAA520";a.style.backgroundColor="#008080";a.style.backgroundColor="#FF6F61";a.style.backgroundColor="#BB8610";a.style.backgroundImage="";a.style.opacity=1;a.style.boxShadow="2px 2px 5px rgba(0, 0, 0, 0.3)";null!=d&&(d.style.opacity=1,d.style.font="12px Lato, sans-serif; color: #d3d3d3",d.style.display="flex",d.style.flexDirection="column",d.style.visibility="visible",d.style.height="100%",d.style.width="90%",d.style.transition="opacity 0.3s cubic-bezier(.42,.97,.52,1.29)");null!=e&&(e.style.opacity=
1,e.style.transitionDelay="0.5s",e.style.zIndex=3,0>e.src.indexOf("/static/icons/file.png")&&(e.style.minWidth="100%",e.style.top="0",e.style.left="0",e.style.maxHeight="50%"));console.log("new expanded style applied to id "+a.id);b=a.getElementsByClassName("dot-disp-text");null!=b&&0<b.length&&b[0]&&(b[0].style.display="none");a.classList.add("expanded-dot");(b=a.querySelector(".play-button"))?(b.style.display="flex",console.log("autoplay "+c),c&&setTimeout(()=>{playytvideo(a)},500)):addPlayButtonAndVideo(a);
if(c=a.querySelector(".open-icon"))a.querySelector(".dot-popup").style.zIndex="7",c.style.display="flex";if(c=a.querySelector(".copy-icon"))a.querySelector(".dot-popup").style.zIndex="7",c.style.display="flex"}}function loadNextPage(){currentPage<maxPage?(currentPage++,fetchPage(currentPage-1),toggleFullScreenLoadingOverlay(!0)):(document.getElementById("next-btn-id").style.backgroundColor="#c2c2c2",toggleFullScreenLoadingOverlay(!1),displayNoMoreDataMessage())}
function loadPreviousPage(){currentPage>minPage?(currentPage--,fetchPage(currentPage-1),toggleFullScreenLoadingOverlay(!0)):document.getElementById("prev-btn-id").style.backgroundColor="#c2c2c2"}function fetchPage(a){2>=a?window.location.href="/t/earnings/"+a:displayNoMoreDataMessage();toggleFullScreenLoadingOverlay(!1)}
function displayPageAttributes(a,b){const c=document.createElement("span");c.id="infoBox";Object.assign(c.style,{position:"absolute",top:"2px",right:"5px",padding:"4px",backgroundColor:"rgb(248, 249, 250)",border:"1px solid rgb(204, 204, 204)",borderRadius:"4px",boxShadow:"rgba(0, 0, 0, 0.1) 2px 2px 10px",display:"flex",alignItems:"center",zIndex:"9999",gap:"8px"});const d=document.createElement("span");d.innerHTML=`<strong>${a}</strong> | ${b}`;c.appendChild(d);a=createNavButton("\u2039",loadPreviousPage,
"prev-btn-id");b=createNavButton("\u203a",loadNextPage,"next-btn-id");a.disabled=1===currentPage;b.disabled=currentPage===maxPage;a.disabled&&(a.style.backgroundColor="#c2c2c2");b.disabled&&(b.style.backgroundColor="#c2c2c2");c.appendChild(a);c.appendChild(b);document.body.appendChild(c)}
function createNavButton(a,b,c){const d=document.createElement("button");d.innerHTML=a;d.id=c;Object.assign(d.style,{padding:"3px 8px",border:"none",backgroundColor:"rgb(0, 123, 255)",color:"white",cursor:"pointer",borderRadius:"3px",fontSize:"16px",transition:"background-color 0.3s ease"});d.onclick=b;d.onmouseover=()=>d.style.backgroundColor="rgb(0, 100, 200)";d.onmouseleave=()=>d.style.backgroundColor="rgb(0, 123, 255)";return d}
function displayNoMoreDataMessage(){const a=document.getElementById("topic-app"),b=document.createElement("div");b.textContent="No more data available";b.style.fontWeight="bold";b.id="noMoreDataMessage";a.appendChild(b);setTimeout(()=>{b.remove()},1E4)}
function shrinkdot(a){var b="undefined"!=typeof a.savedRect?a.savedRect:a.getBoundingClientRect();var c=a.querySelector(".text-container"),d=null;null!=a.getElementsByTagName("img")&&(d=a.getElementsByTagName("img")[0]);var e=window.getComputedStyle(a).getPropertyValue("width").replace("px",""),f=e/maxdotsize;null!=a.querySelector("#displayloadingcontainer")&&removediv(a.querySelector("#displayloadingcontainer"));const g=a.querySelector(".concentric-square");a.style.transition="all 0.5s cubic-bezier(.42,.97,.52,1.29)";
a.style.top=`${b.top}px`;a.style.left=`${b.left}px`;a.style.bottom="";a.style.right="";a.style.width=maxdotsize+"px";a.style.opacity="";a.style.height=maxdotsize+"px";g.style.width=maxdotsize+"px";g.style.height=maxdotsize+"px";g.style.top="50%";g.style.left="50%";g.style.transform="translate(-50%, -50%)";g.style.zIndex=6;a.style.backgroundColor=a.savedpastel;a.style.borderRadius="50%";a.style.zIndex=5;a.style.fontSize=e/(3*f);null!=c&&(c.style.opacity="0");null!=d&&0>d.src.indexOf("/static/icons/file.png")&&
(d.style.maxHeight="100%");b=a.getElementsByClassName("dot-disp-text");null!=b&&0<b.length&&b[0]&&(b[0].style.display="flex");a.classList.remove("expanded-dot");console.log(" new width now "+a.style.width);b=a.querySelector("iframe");c=a.querySelector(".play-button");d=a.querySelector("img");b&&(b.src="about:blank",b.remove());c&&(c.style.display="none");d&&(d.style.display="block");if(b=a.querySelector(".open-icon"))a.querySelector(".dot-popup").style.zIndex="4",b.style.display="none";if(b=a.querySelector(".copy-icon"))a.querySelector(".dot-popup").style.zIndex=
"4",b.style.display="none"}function checkTopicContext(a){console.error("input URL, checking topic: "+a);try{return(new URL(a)).pathname.startsWith("/t/")}catch(b){return console.error("Invalid URL:",b),!1}}
function handlelongpress(a,b){function c(a){"touchstart"===a.type?(v=a.touches[0].clientX-p,w=a.touches[0].clientY-r):(v=a.detail.clientX-p,w=a.detail.clientY-r);a.target===g&&(l=!0)}function d(a){if(l){v=m;w=n;a=document.getElementsByClassName("attention-word-vertical");if(null!=a)for(var b=0;b<a.length;b++)a[b].style.opacity=0;g.style.cursor="default";drageventinstance=0;l=!1;document.removeEventListener("touchstart",c,!1);document.removeEventListener("touchend",d,!1);document.removeEventListener("touchmove",
e,!1);document.removeEventListener("mousedown",c,!1);document.removeEventListener("mouseup",d,!1);document.removeEventListener("mousemove",e,!1);clearAllSelection()}}function e(a){l&&0==drageventinstance%5&&(a.preventDefault(),"touchmove"===a.type?(m=a.touches[0].clientX-v,n=a.touches[0].clientY-w,console.log("currentx currenty "+m+" "+n)):(m=a.clientX-v,n=a.clientY-w),p=m,r=n,25<m+v&&m+v<window.innerWidth-25?g.style.transform="translate3d("+m+"px, "+n+"px, 0)":25>m+v?(0!=q&&clearTimeout(q),q=setTimeout(function(){addposttosaved(f,
g,inposts[b].crtime);"touchmove"===a.type&&(g.style.transform="scale(1)")},400)):(0!=q&&clearTimeout(q),q=setTimeout(function(){displaybuttonbehavior(f,"Deleted");addposttodeleted(posts[b].crtime);null!=topicstorage&&0<=topicstorage.indexOf("client")&&addposttodeleted(posts[b].crTime);removediv(g)},400)));drageventinstance++}console.log("in longpress handler idx "+b);var f=a;topicdocumentclick();var g=document.getElementById("dot-"+b);a.preventDefault();g.style.cursor="move";var h=document.getElementsByClassName("attention-word-vertical");
if(null!=h)for(var k=0;k<h.length;k++)attachtransitionstyles(h[k],1),h[k].style.opacity="0.9";var l=!1,m,n,p=0,r=0,q=0;h=document.getElementById("dot-desc-"+b);null!=h&&(h.style.opacity=0);document.addEventListener("touchstart",c,!1);document.addEventListener("touchend",d,!1);document.addEventListener("touchmove",e,!1);document.addEventListener("mousedown",c,!1);document.addEventListener("mouseup",d,!1);document.addEventListener("mousemove",e,!1);if("touchstart"===a.detail.type){var v=a.detail.clientX-
p;var w=a.detail.clientY-r;g.style.transform="scale(3)"}else v=a.detail.clientX-p,w=a.detail.clientY-r;l=!0}function clearAllSelection(){window.getSelection?window.getSelection().removeAllRanges():document.selection&&document.selection.empty()}function makelementpulsate(a,b){if("undefined"!=typeof c){var c;setTimeout(function(){a.classList.remove("pulsate")},1E3*b)}a.classList.add("pulsate")}
function pulsatenext(a,b){var c=document.getElementById("dot-"+a);c.classList.remove("pulsate");if(a<posts.length-1){var d=posts.length-1-a;for(a+=1;a<d;a++)if(c=document.getElementById("dot-"+a),!checkifalreadyseen(posts[a].crtime)){if("undefined"!=typeof e){var e=1E3*b;setTimeout(function(){c.classList.remove("pulsate")},e)}c.classList.add("pulsate");console.log("Dot id "+a+" set to pulsate");break}}}
function getrandomdotsize(a,b,c,d){if(0==a)return d;for(var e=[1,2,3,5,8],f=rnd(0,100),g=0,h=0;h<b;h++)g+=e[h];e=0;c=parseInt((d-c)/b);"undefined"!=typeof posts[a].hit&&0<posts[a].hit.length&&0<parseInt(posts[a].hit)&&(parseInt(posts[a].hit)>=topichits/posts.length?f=1:parseInt(posts[a].hit)>=topichits/(2*posts.length)&&(f=100/g+1));for(h=0;h<b;h++){a=100/g*h;var k=100;h<b-1&&(k=100/g*(h+1));if(f>=a&&f<=k){e=d-c*h;break}}return parseInt(e)}
function shiftdotandpopupids(){for(var a=document.getElementsByClassName("dot"),b=0;b<a.length;b++){var c=parseInt(a[b].id.split("-")[a[b].id.split("-").length-1]);a[b].id="dot-"+parseInt(c+1)}b=document.getElementsByClassName("dot-popup");for(a=0;a<b.length;a++)c=parseInt(b[a].id.split("-")[b[a].id.split("-").length-1]),b[a].id="dot-popup-"+parseInt(c+1);b=document.getElementsByClassName("dot-desc");for(a=0;a<b.length;a++)c=parseInt(b[a].id.split("-")[b[a].id.split("-").length-1]),b[a].id="dot-desc-"+
parseInt(c+1);console.log("shifted all dot, popup and desc ids")}function splitschema(a){console.log("About to parse "+a);const b=JSON.parse(a),c=Object.keys(b).filter(a=>a.startsWith("---"));a=[];let d={};for(var e of Object.keys(b))c.includes(e)?(a.push(d),d={}):d[e]=b[e];a.push(d);for(e=0;e<a.length;e++)console.log(`Object ${e+1}:`,a[e]);return a}
function retrievepostsummaryandshowinpopup(a,b,c,d,e,f,g){var h=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");h.onreadystatechange=function(){if(4==h.readyState&&200==h.status){if(null!=document.getElementById("dot-"+b)&&null!=document.getElementById("dot-"+b).querySelector("#displayloadingcontainer")){var k=document.getElementById("dot-"+b).querySelector("#displayloadingcontainer");removediv(k)}k=JSON.parse(h.responseText);a.data=k.data;showpostdatainpopup(a,b,c,
d,e,f,g,!0)}};"undefined"==typeof a.crtime&&"undefined"!=typeof a.crTime&&(a.crtime=a.crTime);var k="/newauth/api/getpostsummarybytopicandtime/"+btoa(a.topic)+"/"+a.crtime;console.log("calling uriencoded url "+k);h.open("GET",k,!1);h.withCredentials=!0;h.setRequestHeader("Content-Type","application/json");h.send(null)}
function showpostdatainpopup(a,b,c,d,e,f,g,h){null!=document.getElementById("dot-"+b)&&(document.getElementById("dot-"+b).style.backgroundColor="#676767");if("undefined"==typeof g||0==g)for(var k=document.getElementsByClassName("dot-popup"),l=0;l<k.length;l++)k[l].id!="dot-popup-"+b&&(k[l].classList.remove("expand-open"),k[l].style.display="none");k=document.getElementById("dot-"+b).querySelector("#dot-popup-"+b);null==k?(k=createpopupdiv(a,b,c,d,e,f,g),console.log("non existing div :created now "+
b+" "+k)):"undefined"!=typeof h&&1==h&&(createpopupdiv(a,b,c,d,e,f,g),console.log("existing div "+b+" reloaded"))}
function createpopupdiv(a,b,c,d,e,f,g){c=!1;let h;d=null;null==document.getElementById("dot-"+b).querySelector("#dot-popup-"+b)?(h=document.createElement("div"),h.setAttribute("id","dot-popup-"+b),h.classList.add("text-container"),h.classList.add("dot-popup"),h.style.zIndex=7,h.style.position="relative",h.style.display="flex",h.style.flexDirection="column",h.style.whiteSpace="pre-wrap",c=!0):h=document.getElementById("dot-"+b).querySelector("#dot-popup-"+b);let k,l;"undefined"!=typeof a.crtime&&null!=
a.crtime&&(l=converttimediffmstocalendar(1E3*gettimedifferenceinsec(a.crtime)));"undefined"!=typeof a.text&&null!=a.text&&20<a.text.length&&a.text.substring(0,20);var m=null;"undefined"!==typeof a.data&&null!==a.data&&(isJSON(a.data)?(m=JSON.parse(a.data),"string"===typeof m.text&&50<m.text.length&&m.text.substring(0,50)):m=a.data);if(null!=m){e=extractimagefromfiles(m.files);null!=e&&null!=e.getElementsByTagName("img")&&0<e.getElementsByTagName("img").length&&(0>e.getElementsByTagName("img")[0].src.indexOf("/static/icons/file.png")&&
(f=document.getElementById("dot-"+b),null!=f&&null!=e.getElementsByTagName("img")[0]&&f.appendChild(e.getElementsByTagName("img")[0])),h.style.top="50%");null!=e&&null!=e.querySelector('[id^\x3d"obj-filename"]')&&(console.log("obj-heading extracted "+e.querySelector('[id^\x3d"obj-heading"]')),console.log("obj-filename extracted "+e.querySelector('[id^\x3d"obj-filename"]')),f=document.createElement("div"),f.style.width="100%",f.style.minHeight="40%",f.style.display="flex",f.style.flexDirection="column",
f.style.alignItems="center",f.style.justifyContent="center",f.appendChild(e),d=document.createElement("input"),d.setAttribute("id","file-view-button"),d.classList.add("btn"),d.style.marginBottom="20px",d.style.marginTop="20px",d.classList.add("btn-primary"),d.classList.add("btn-sm"),d.type="button",d.value="View",d.addEventListener("click",function(b){b=null;null!=m&&(b=m.text);getfullpost(topicname,a.crtime,a.lastseq,b,a.ownerflake,a.convid)},!1),f.appendChild(d),h.style.top="5%",(e=h.querySelector(".pop-footer"))?
h.insertBefore(f,e):h.appendChild(f));if("undefined"!=typeof m.thumbnailurl&&null!=m.thumbnailurl&&0<m.thumbnailurl.length){e=document.createElement("img");e.position="absolute";e.top="50%";e.left="50%";e.transform="translate(-50%, -50%)";e.minWidth="100%";e.minHeight="100%";e.width="auto";e.height="auto";if(m.thumbnailurl.includes("youtube")||m.thumbnailurl.includes("ytimg"))m.thumbnailurl=m.thumbnailurl.replace("/default.jpg","/maxresdefault.jpg");e.src=m.thumbnailurl;h.style.top="50%";f=document.getElementById("dot-"+
b);null!=f&&f.appendChild(e)}"undefined"!=typeof m.videourl&&null!=m.videourl&&0<m.videourl.length&&(e=document.createElement("img"),e.style.position="absolute",e.style.top="50%",e.style.left="50%",e.style.transform="translate(-50%, -50%)",e.width="25%",e.height="25%",e.src="/static/icons/play-64.png",f=document.getElementById("dot-"+b),null!=f&&f.appendChild(e));k=extractURLFromText(m.text);if(null!=k&&0<k.length&&4<m.text.length/k.length)e=document.createElement("div"),e.style.marginTop="5px",e.appendChild(document.createTextNode(cleanString(m.text))),
(f=h.querySelector(".pop-footer"))?h.insertBefore(e,f):h.appendChild(e),0==b&&setTimeout(function(){queryURLforpreview(k[0].text,b)},600);else if(e=document.createElement("div"),e.style.flexGrow=1,e.style.overflowY="auto",e.style.padding="8px",m.category){if("undefined"==typeof m.thumbnailurl||null==m.thumbnailurl){const a=document.createElement("ul");Object.entries(m).forEach(([b,c])=>{if(!["text","abbr","category"].includes(b)){const d=document.createElement("li");d.textContent=`${b.charAt(0).toUpperCase()+
b.slice(1)}: ${c}`;a.appendChild(d)}});e.appendChild(a);(f=h.querySelector(".pop-footer"))?h.insertBefore(e,f):h.appendChild(e)}displaysidepanel({id:b,text:cleanString(m.text),sent:l,views:a.hit,comments:a.comments})}else f=document.createElement("p"),f.style.marginTop="4px",f.appendChild(document.createTextNode(cleanString(m.text))),e.appendChild(f),(f=h.querySelector(".pop-footer"))?h.insertBefore(e,f):h.appendChild(e)}else null!=a.text&&0<a.text.length&&(isJSON(a.text)?h.appendChild(createStyledTextDiv(JSON.parse(JSON.parse(a.text)))):
(h.appendChild(document.createTextNode(a.text)),displaysidepanel({id:b,text:cleanString(a.text),sent:l,views:a.hit,comments:a.comments})));if(c&&"undefined"!=typeof a.crtime&&0<a.crtime){e=document.createElement("div");e.style.marginTop="auto";e.classList.add("pop-footer");e.style.padding="8px 12px";e.style.width="100%";f=document.createElement("hr");f.style.marginBottom="4px";e.appendChild(f);f=document.createElement("div");f.classList.add("row");f.style.display="flex";f.style.alignItems="center";
var n=document.createElement("div");n.classList.add("col-xs-8");n.classList.add("text-left");g=document.createElement("div");g.classList.add("col-xs-4");g.classList.add("text-right");f.appendChild(n);f.appendChild(g);null==a.giveout&&(a.giveout="");null!=a.comments&&(a.giveout+=" "+toApproximateWords(a.comments)+" comments");null!=a.hit&&(a.giveout+=" "+toApproximateWords(a.hit)+" views");var p=document.createElement("p");p.style.margin="0px";p.style.color="#f4f4f4";p.style.fontSize=12;if(600>screenWidth||
600>screenHeight)p.style.fontSize=8;p.style.overflow="hidden";p.appendChild(document.createTextNode(a.giveout));n.appendChild(p);n=document.createElement("p");n.style.color="#f4f4f4";n.style.margin="0px";n.style.fontSize=11;if(600>screenWidth||600>screenHeight)n.style.fontSize=8;n.classList.add("pull-right");n.appendChild(document.createTextNode(l));g.appendChild(n);e.appendChild(f);h.appendChild(e)}null!=k&&0<k.length&&!k[0].text.startsWith("https://newauth.io/")&&(c=!1);c||null!=d||h.addEventListener("click",
function(c){c.stopPropagation();console.log("popup click fired");c=100;null!=clickstarttime&&(c=new Date-clickstarttime,console.log("starttime "+clickstarttime+" "+c));if(100>=c){null!=document.getElementById("topic-app")?fadeoutelement("topic-app"):fadeoutelement("app-flk");null!=document.getElementById("dot-"+b)&&(document.getElementById("dot-"+b).style.backgroundColor="#a7a7a7");c=null;null!=m&&(c=m.text);if(null!=k&&0<k.length){if(k[0].text.startsWith("https://newauth.io/t")||canLoadInApp(k[0].text))getfullpost(topicname,
a.crtime,a.lastseq,c,a.ownerflake,a.convid,k[0].text);else{clearTimeout(appcalltimeoutid);appcalltimeoutid=null;c=document.querySelector("#displayloadingcontainer");console.log("loading div after url preview in createpopupdiv"+c);null!=c&&removediv(c);window.open(k[0].text,"_blank","noopener,noreferrer");return}addurlopenlinktopopup(m.text,h)}else getfullpost(topicname,a.crtime,a.lastseq,c,a.ownerflake,a.convid);c=document.createElement("div");c.setAttribute("id","post-comments");c.classList.add("panel-body");
c.classList.add("panel-word-wrap");c.classList.add("pre-scrollable");c.style.position="absolute";c.style.top="50px";c.style.right="5px";c.style.width="200px";c.style.maxHeight="60%";c.style.maxWidth="20%";c.style.overflowY="auto";c.style.overflowX="hidden";null!=document.getElementById("full-post-display")&&(600<window.innerWidth&&600<window.innerHeight&&document.getElementById("full-post-display").appendChild(c),null!=a.convid&&loadpostcommmentsontopicpage(a.convid,null,0,topicname))}else setTimeout(function(){clickstarttime=
null},1E3)});null!=k&&0<k.length&&(c=!0);c&&(null!=document.getElementById("dot-"+b)?document.getElementById("dot-"+b).appendChild(h):null!=document.getElementById("topic-app")?document.getElementById("topic-app").appendChild(h):document.getElementById("app-flk").appendChild(h),t);addcopylinktopopup(h);addPlayButtonAndVideo(document.getElementById("dot-"+b));return h}
function addcopylinktopopup(a){if(a)if(a.querySelector(".copy-icon"))console.log("Copy Icon Already exists for dot ");else{var b=document.createElement("span");b.className="copy-icon";if(!a.querySelector('.img-icon[src\x3d"/static/icons/copy-96.png"]')){var c=document.createElement("img");c.className="img-icon";c.src="/static/icons/copy-96.png";c.style.width="18px";c.style.height="18px";c.style.objectFit="contain";c.style.display="block";b.appendChild(c);c.title="Copy the dot"}Object.assign(b.style,
{margin:"2px",padding:"4px",color:"rgb(221, 221, 221)",cursor:"pointer",position:"absolute",width:"18px",height:"18px",fontSize:"18px",zIndex:"7",display:"none",alignItems:"center",justifyContent:"center",top:"10px",right:"10px"});a.querySelector(".open-icon")?(c=parseInt(a.querySelector(".open-icon").style.right||"10",10),console.log("right value of open icon "+c),b.style.right=`${c+24}px`):b.style.right="10px";b.addEventListener("click",()=>{alert("handle copy of dot.. ")});a.appendChild(b)}}
function addurlopenlinktopopup(a,b){let c=null;if(b.querySelector(".open-icon"))console.log("Open Icon Already exists for text "+a);else{var d=b.querySelector(".copy-icon"),e=extractURLFromText(a);null!=e&&0<e.length&&(c=document.createElement("span"),c.classList.add("open-icon"),b.querySelector('.img-icon[src\x3d"/static/icons/open-window-128.png"]')||(a=document.createElement("img"),a.className="img-icon",a.src="/static/icons/open-window-128.png",a.style.width="48",a.style.height="48",a.style.objectFit=
"contain",a.style.display="block",c.appendChild(a),a.title="Open in new window"),Object.assign(c.style,{margin:"2px",padding:"4px",color:"#ddd",cursor:"pointer",position:"absolute",width:"36px",height:"36px",fontSize:"18px",zIndex:"7",pointerEvents:"auto",display:"none",alignItems:"center",justifyContent:"center",top:"7px",right:"10px"}),c.addEventListener("click",function(a,b){return function(a){a.target.style.opacity=.7;e[0].text.startsWith("https://newauth.io/t")||canLoadInApp(e[0].text)?(c.title=
"Read full post",getfullpost(topicname,info.crtime,info.lastseq,txt,info.ownerflake,info.convid,e[0].text),setTimeout(function(){a.target.style.opacity=1},5E3)):window.open(e[0].text,"_blank","noopener,noreferrer")}}(event,e)));null!=c&&(c.style.top="10px",c.style.right="10px",d?(b.insertBefore(c,d),b=parseInt(d.style.right||"10",10),console.log("right value of copy icon "+b),c.style.right=`${b+24}px`):(b.appendChild(c),c.style.right="10px"))}}
function addPlayButtonAndVideo(a){var b=a.querySelector("img");if(b)var c=extractVideoId(b.src);c&&(b=document.createElement("div"),b.className="play-button",b.innerHTML='\n\t        \x3csvg height\x3d"100%" version\x3d"1.1" viewBox\x3d"0 0 68 48" width\x3d"100%"\x3e\n\t            \x3cpath class\x3d"ytp-large-play-button-bg" d\x3d"M66.52,7.74c-0.78-2.93-2.49-5.41-5.42-6.19C55.79,.13,34,0,34,0S12.21,.13,6.9,1.55 C3.97,2.33,2.27,4.81,1.48,7.74C0.06,13.05,0,24,0,24s0.06,10.95,1.48,16.26c0.78,2.93,2.49,5.41,5.42,6.19 C12.21,47.87,34,48,34,48s21.79-0.13,27.1-1.55c2.93-0.78,4.64-3.26,5.42-6.19C67.94,34.95,68,24,68,24S67.94,13.05,66.52,7.74z" fill\x3d"#f00"\x3e\x3c/path\x3e\n\t            \x3cpath d\x3d"M 45,24 27,14 27,34" fill\x3d"#fff"\x3e\x3c/path\x3e\n\t        \x3c/svg\x3e\n\t    ',
b.style.cssText="\n\t        position: absolute;\n\t        top: 25%;\n\t        left: 50%;\n\t        transform: translate(-50%, -50%);\n\t\t\twidth: min(68px, 10vw);\n\t\t    height: min(48px, 7vw);\n\t\t    min-width: 40px;\n\t\t    min-height: 28px;\n\t        cursor: pointer;\n\t\t\tdisplay: none;\n\t        z-index: 4;\n\t    ",a.appendChild(b),b.addEventListener("click",b=>playytvideo(a,c,b)))}
function playytvideo(a,b,c){c&&c.stopPropagation();c=a.querySelector("img");b||(b=extractVideoId(c.src));const d=document.createElement("iframe");d.src=`https://www.youtube.com/embed/${b}?rel=0&autoplay=1&mute=1&autohide=1&border=0&wmode=opaque&enablejsapi=1&modestbranding=1&showinfo=0&controls=1`;d.style.cssText="\n            position: absolute;\n            top: 0;\n            left: 0;\n            width: 100%;\n            height: 50%;\n            border: none;\n            z-index: 6;\n        ";
a.appendChild(d);const e=a.querySelector(".play-button");e.style.transition="opacity 0.5s ease-out";e.style.opacity="0";setTimeout(()=>{e.remove()},500);c.style.display="none"}function extractVideoId(a){return(a=a.match(/\/vi\/([^\/]+)\//))?a[1]:null}
function displaysidepanel(a){const b=Array.isArray(a)?a:[a];sidecontainer||(sidecontainer=document.createElement("div"),sidecontainer.id="object-list-sidecontainer",sidecontainer.style.cssText="\n            position: fixed;\n            right: 20px;\n            top: 50px;\n            bottom: 20px;\n            width: 250px;\n\t\t\topacity: 0.9;\n            overflow-y: auto;\n            background-color: #f0f0f0;\n            border-radius: 10px;\n            box-shadow: 0 0 10px rgba(0,0,0,0.1);\n            padding: 15px;\n            font-family: Arial, sans-serif;\n\t\t\tz-index: 12;\n        ",document.body.appendChild(sidecontainer),
a=document.createElement("style"),a.textContent="\n            #object-list-sidecontainer::-webkit-scrollbar {\n                width: 10px;\n            }\n            #object-list-sidecontainer::-webkit-scrollbar-track {\n                background: #f1f1f1;\n                border-radius: 10px;\n            }\n            #object-list-sidecontainer::-webkit-scrollbar-thumb {\n                background: #888;\n                border-radius: 10px;\n            }\n            #object-list-sidecontainer::-webkit-scrollbar-thumb:hover {\n                background: #555;\n            }\n        ",
document.head.appendChild(a));a=document.getElementById("summary-panel");a||(a=document.createElement("div"),a.id="summary-panel",a.style.cssText="\n\t\t\t\tbackground-color: #e0e0e0;\n\t            padding: 10px;\n\t            margin-bottom: 15px;\n\t            border-radius: 5px;\n\t            font-weight: bold;\n\t            position: fixed;\n\t            top: 0px;\n\t\t\t\twidth: 220px;\n\t            z-index: 4;\n\t        ",sidecontainer.prepend(a));b.forEach(a=>{totalViews+=a.views||0;
totalComments+=a.comments||0;totalRecords+=1});var c=toApproximateWords(totalRecords),d=toApproximateWords(totalViews);let e=toApproximateWords(totalComments);a.innerHTML=`
		  <div id="record-header" style="display: flex; justify-content: space-between; cursor: pointer;">
		    <span>Records: ${c}</span>
		  </div>
		  <div style="display: flex; justify-content: space-between;">
		    <span>Views: ${d}</span>
		    <span>Comments: ${e}</span>
		  </div>
		`;c=sortvalues;let f=document.createElement("div");f.id="sliding-panel";f.style.cssText="\n\t\t  display: none;\n\t\t  margin-top: 10px;\n\t\t  padding: 10px;\n\t\t  border-top: 1px solid #ccc;\n\t\t  animation: slideDown 0.3s ease-out;\n\t\t  display: grid;\n\t\t  grid-template-columns: repeat(4, 1fr);\n\t\t  gap: 8px;\n\t\t";null!=c&&0<c.length&&c.forEach(a=>{const b=document.createElement("a");b.textContent=a;b.classList.add("link-item");b.addEventListener("click",c=>{c.stopPropagation();console.log("filtering "+
sortfield+":::"+a);b.classList.contains("active-filter")?(b.classList.remove("active-filter"),displaypostsasdots(posts,!1,sortfield+":::ALL")):(document.querySelectorAll(".link-item").forEach(a=>a.classList.remove("active-filter")),b.classList.add("active-filter"),displaypostsasdots(posts,!1,sortfield+":::"+a))});b.addEventListener("mouseenter",b=>{b.stopPropagation();console.log("filtering PREVIEW:::"+sortfield+":::"+a);displaypostsasdots(posts,!1,"PREVIEW:::"+sortfield+":::"+a)});b.addEventListener("mouseleave",
b=>{b.stopPropagation();console.log("removing filter PREVIEW:::"+sortfield+":::"+a);displaypostsasdots(posts,!1,"PREVIEW:::"+sortfield+":::ALL")});f.appendChild(b)});c=document.createElement("style");c.textContent="\n\t\t  .link-item {\n\t\t    display: block;\n\t\t    padding: 4px;\n\t\t    background: #f0f0f0;\n\t\t    text-align: center;\n\t\t    text-decoration: none;\n\t\t    border-radius: 4px;\n\t\t    color: #333;\n\t\t    transition: background 0.2s ease, color 0.2s ease;\n\t\t  }\n\n\t\t  .link-item:hover {\n\t\t    background: #e0e0ff;\n\t\t    color: #00008b;\n\t\t  }\n\n\t\t  .link-item:active {\n\t\t    background: #c0c0ff;\n\t\t    color: #000066;\n\t\t  }\n\t\t  .link-item.active-filter {\n\t\t    background: #ffdcdc;\n\t\t    color: #8b0000;\n\t\t    font-weight: bold;\n\t\t  }\n\t\t";
document.head.appendChild(c);a.appendChild(f);document.getElementById("record-header").addEventListener("click",()=>{f.style.display="none"===f.style.display?"grid":"none"});const g=sidecontainer.children;for(c=0;c<g.length;c++)d=g[c],d.style.transition="transform 0.5s ease",d.style.transform=`translateY(${60*b.length}px)`;b.forEach((a,b)=>{const c=document.createElement("div");c.id=`dot-sidepanel-${a.id}`;c.style.cssText="\n            background-color: #ffffff;\n            margin-bottom: 10px;\n            padding: 10px;\n            border-radius: 5px;\n            box-shadow: 0 2px 5px rgba(0,0,0,0.05);\n            transition: transform 0.2s ease, opacity 0.5s ease;\n            opacity: 0;\n\t\t\tz-index: 3;\n            transform: translateY(-20px);\n            position: relative;\n        ";
var d=document.createElement("span");d.textContent=a.text;c.appendChild(d);d=document.createElement("span");d.textContent=a.sent;d.style.cssText="\n            position: absolute;\n            bottom: 5px;\n            right: 5px;\n            font-size: 0.8em;\n            color: #888;\n        ";c.appendChild(d);c.addEventListener("mouseover",((a,b)=>()=>{a.style.transform="scale(1.02) translateY(0)";a.style.backgroundColor="#ffffcc";const c=document.getElementById("dot-"+b.id);c&&expandDot(c,c.getBoundingClientRect())})(c,
a));c.addEventListener("mouseout",((a,b)=>()=>{a.style.transform="scale(1) translateY(0)";a.style.backgroundColor="#ffffff";const c=document.getElementById("dot-"+b.id);c&&shrinkdot(c)})(c,a));sidecontainer.append(c);setTimeout(()=>{c.style.opacity=.9;c.style.transform="translateY(0)"},100*(b+1))});setTimeout(()=>{for(let a=b.length;a<g.length;a++)g[a].style.transition="none",g[a].style.transform="none"},500);(c=sidecontainer.querySelector('[id^\x3d"dot-sidepanel-"]'))&&a&&(c.style.marginTop=`${a.offsetHeight+
15}px`);addSidePanelToggle();updateToggleButtonStyle()}function toggleSidePanel(){const a=document.getElementById("object-list-sidecontainer"),b=document.getElementById("side-panel-toggle");a&&b&&("250px"===a.style.width?(a.style.width="0",a.style.padding="0",a.style.right="-20px",b.textContent="\x3c",b.style.right="0"):(a.style.width="250px",a.style.padding="15px",a.style.right="20px",b.textContent="\x3e"))}
function addSidePanelToggle(){const a=document.getElementById("object-list-sidecontainer");var b=document.getElementById("side-panel-toggle");a&&!b&&(b=document.createElement("button"),b.id="side-panel-toggle",b.textContent="\x3e",b.style.position="fixed",b.style.top="50%",b.style.right="0",b.style.transform="translateY(-50%)",b.style.zIndex="1000",b.style.padding="10px 5px",b.style.fontSize="18px",b.style.backgroundColor="#f0f0f0",b.style.border="none",b.style.borderLeft="1px solid #ccc",b.style.cursor=
"pointer",b.addEventListener("click",toggleSidePanel),a.style.transition="width 0.3s ease-in-out",a.style.overflow="hidden",document.body.appendChild(b),a.style.width="250px",a.style.padding="15px",a.style.right="20px",a.style.overflowY="auto")}
function updateToggleButtonStyle(){const a=document.getElementById("side-panel-toggle");a&&(a.style.borderRadius="20px 0 0 20px",a.style.boxShadow="0 2px 5px rgba(0, 0, 0, 0.2)",a.style.background="linear-gradient(to right, #f0f0f0, #e0e0e0)",a.style.color="#333",a.style.transition="all 0.3s ease",a.addEventListener("mouseover",()=>{a.style.background="linear-gradient(to right, #e0e0e0, #d0d0d0)";a.style.boxShadow="0 4px 8px rgba(0, 0, 0, 0.3)"}),a.addEventListener("mouseout",()=>{a.style.background=
"linear-gradient(to right, #f0f0f0, #e0e0e0)";a.style.boxShadow="0 2px 5px rgba(0, 0, 0, 0.2)"}))}
function highlightAndScroll(a){var b=document.getElementById("object-list-sidecontainer");const c=document.getElementById(`dot-sidepanel-${a}`);b&&c&&(Array.from(b.children).forEach(a=>{a.style.backgroundColor="#ffffff"}),c.style.backgroundColor="#ffffcc",a=b.getBoundingClientRect(),b=c.getBoundingClientRect(),(b.top<a.top||b.bottom>a.bottom)&&c.scrollIntoView({behavior:"smooth",block:"center"}),setTimeout(()=>{c.style.backgroundColor="#ffffff"},6E3))}
function createStyledTextDiv(a){var b=Object.keys(a);const c=document.createElement("div");c.classList.add("dot-text-container");var d=0;b.forEach(b=>{if(b=a[b]){const a=document.createElement("div");a.style.display="flex";a.style.alignItems="center";const e=document.createElement("span");e.classList.add("copy-icon");e.innerHTML="\ud83d\udccb";e.title="Copy to clipboard";e.style.cursor="pointer";e.addEventListener("click",function(a,b){return function(a){copytexttocbandhighlight(b,"Data copied",a);
a.target.style.opacity=.7;setTimeout(function(){a.target.style.opacity=1},5E3)}}(event,b));const h=document.createElement("p");h.textContent=b;h.title=b;switch(d){case 0:h.style.fontWeight="bold";h.style.fontSize="1.2em";h.style.margin=0;break;case 1:h.style.fontStyle="italic";h.style.fontSize="1em";h.style.margin=0;break;case 2:h.style.fontFamily="Arial, sans-serif";h.style.fontSize="0.9em";h.style.margin=0;break;default:h.style.fontSize="1em",h.style.margin=0}d++;a.appendChild(e);a.appendChild(h);
c.appendChild(a)}});c.style.border="1px solid #ccc";c.style.padding="5px";c.style.margin="5px";document.querySelector("style.dot-text-container")||(b=document.createElement("style"),b.textContent="\n            .dot-text-container p {\n                white-space: nowrap;\n                overflow: hidden;\n                text-overflow: ellipsis;\n                max-width: 80%; /* Adjust the maximum width */\n            }\n            .dot-text-container p:hover {\n                \n            }\n        ",
b.classList.add("dot-text-container"),document.head.appendChild(b));return c}function canLoadInApp(a){try{fetch(a).then(a=>!0).catch(a=>!1)}catch(b){}return!1}function toApproximateWords(a){const b=["","k","m","b","t"];let c=0;for(;1E3<=a&&c<b.length-1;)a/=1E3,c++;return Math.floor(a)+b[c]}
function createloadingdiv(){var a=document.createElement("div");a.classList.add("row");var b=document.createElement("div");b.classList.add("col-xs-12");a.setAttribute("id","displayloadingcontainer");var c=document.createElement("div");c.classList.add("loader");var d=document.createElement("h5");d.appendChild(document.createTextNode("Loading..."));c.appendChild(d);b.appendChild(c);a.appendChild(b);a.style.display="inline-block";a.style.position="absolute";a.style.top="10px";return a}
function extractimagefromfiles(a){var b=!1,c=!1,d=null,e=0;if(null==a)return d;d=document.createElement("div");a.forEach(function(a,c){0>a.type.indexOf("image")&&(b=!0)});b&&a.forEach(function(a,b){if(0<=a.type.indexOf("image")||0<=a.type.indexOf("video"))c=!0});if(b)if(c)d=document.createElement("div"),d.style.height="100%",a.forEach(function(a,b){if(0<=a.type.indexOf("image")||0<=a.type.indexOf("video"))b=document.createElement("img"),b.style.maxHeight="50%",b.classList.add("img-responsive"),b.classList.add("center-block"),
b.src=a.thumbnail,null!=document.getElementById("topic-main-image")&&(document.getElementById("topic-main-image").src=a.thumbnail),d.appendChild(b);if(0>a.type.indexOf("image")){b=document.createElement("div");b.setAttribute("id","obj-heading-"+e);b.style.top="0px";b.style.maxWidth="90%";b.style.width="90%";b.style.color="#323232";b.style.textAlign="center";b.style.backgroundColor="#d2d2d2";b.style.opacity="0.8";b.style.position="absolute";b.style.top="0px";b.style.margin="0 auto";b.style.display=
"block";b.appendChild(document.createTextNode(a.type.replace("application/","")));b=document.createElement("div");b.setAttribute("id","obj-filename-"+e);b.style.color="#323232";b.style.marginRight="5px";b.style.backgroundColor="#d2d2d2";b.style.opacity="1";b.style.minWidth="60%";b.style.overflow="hidden";document.createElement("img").src="/static/icons/file.png";var c=document.createElement("div");a=document.createTextNode(a.name.split(".")[1]);if("undefined"==typeof a||null==a||0==a.length)a=document.createTextNode("unknown");
c.appendChild(a);b.appendChild(c);d.appendChild(b);e++}});else{var f=document.createElement("div");f.style.height="100%";var g=document.createElement("div");g.setAttribute("id","obj-heading-"+e);g.style.top="0px";g.style.maxWidth="90%";g.style.width="90%";g.style.color="#323232";g.style.textAlign="center";g.style.backgroundColor="#d2d2d2";g.style.opacity="0.8";g.style.position="absolute";g.style.top="0px";g.style.margin="0 auto";g.style.display="block";g.appendChild(document.createTextNode(a[0].type.replace("application/",
"")));g=document.createElement("div");g.setAttribute("id","obj-filename-"+e);g.style.color="#323232";g.style.display="flex";g.style.flexDirection="column";g.style.alignItems="center";g.style.justifyContent="center";g.style.opacity="1";var h=document.createElement("img");h.style.width="64px";h.style.height="64px";500>window.innerWidth&&(h.style.width="40px",h.style.height="40px");h.style.zIndex="5";h.src="/static/icons/file.png";g.appendChild(h);h=document.createElement("div");h.style.width="100%";
h.style.zIndex="6";var k=document.createElement("p");k.style.fontSize="25px";500>window.innerWidth&&(k.style.fontSize="15px");k.style.textTransform="uppercase";a=document.createTextNode(a[0].name.split(".")[1]);if("undefined"==typeof a||null==a||0==a.length)a=document.createTextNode("unknown");k.appendChild(a);h.appendChild(k);g.appendChild(h);f.appendChild(g);return f}else d.style.padding="0px",d.style.position="relative",a.forEach(function(a,b){var c=document.createElement("img");c.style.top="0";
c.style.width="100%";c.style.objectFit="cover";c.src=a.thumbnail;null!=document.getElementById("topic-main-image")&&(document.getElementById("topic-main-image").src=a.thumbnail);0<parseInt(b)?c.style.display="none":(c.classList.add("img-responsive"),c.classList.add("center-block"));d.appendChild(c)});return d}
function extractURLFromText(a){for(var b=[],c=new RegExp(/\b(https?:\/\/)([\w\-~]+(\.[\w\-~]+)+|localhost)(:\d+)?(\/[\w\-~@:%]*)*(#[\w\-]*)?(\?[^\s]*)?\b/gi),d;null!==(d=c.exec(a));)b.push({text:d[0],type:"link"});return b}function removeloader(a){a=document.getElementById("dot-"+a);null!=a&&(a=a.querySelector("#displayloadingcontainer"),null!=a&&(a.querySelector("h5").innerHTML="Preview Load failed...",null!=a.querySelector(".loader")&&a.querySelector(".loader").classList.remove("loader")))}
function queryURLforpreview(a,b){var c=new Worker("/static/js/siteload-worker.js");c.onerror=function(a){console.log("in error handler of worker "+a.data);removeloader(b)};c.onmessage=function(c){if("siteread"==c.data.action)if(c.data.error)console.log("in error from data returned by worker "+c.data),removeloader(b);else{var d=JSON.parse(c.data.response),f=(new DOMParser).parseFromString(d.contents,"text/html");c=(new URL(a)).hostname;d={"finance.yahoo.com":"div.caas-body","www.bbc.com":"article",
"www.cnn.com":"div.article__content","www.nytimes.com":'section[name\x3d"articleBody"]',"www.theguardian.com":"div.article-body-viewer-selector","www.reuters.com":"div.article-body__content__17Yit"}[c];if(!d){const a=["article","main",".article-content",".post-content"];for(var g of a)if(f.querySelector(g)){d=g;break}}d||(f.body?d="body":(g=document.getElementById("dot-"+b),null!=g&&(g=g.querySelector("#displayloadingcontainer"),null!=g&&(g.querySelector("h5").innerHTML="Site data can not be read...",
null!=g.querySelector(".loader")&&g.querySelector(".loader").classList.remove("loader")))));(f=f.querySelector(d))?(g=f.querySelectorAll("p"),d="",g&&(d=Array.from(g).map(a=>a.textContent.trim()).filter(a=>0<a.length).join("\n\n")),d&&0!==d.length||(f=f.querySelectorAll("div"))&&0<f.length&&(d=Array.from(f).map(a=>a.textContent.trim()).filter(a=>0<a.length).join("\n\n")),f={},f.desc=d,f.domain=c,createurlpreviewdiv(f,b)):(removeloader(b),console.log("Article content not found. Selector: "+d))}else console.log("id "+
b+" "+a+" sitelad worker "+JSON.stringify(d)),null!=d&&0<d.length?(f=JSON.parse(d),createurlpreviewdiv(f,b)):removeloader(b)};c.postMessage({action:"siteread",url:a})}
function createurlpreviewdiv(a,b){var c=document.getElementById("dot-popup-"+b);if(null!=a&&null!=c&&null==c.querySelector(".url-preview")){b=document.createElement("div");b.classList.add("row");b.style.margin="2px";b.classList.add("url-preview");b.style.overflowY="scroll";b.style.boxSizing="border-box";b.style.flex="1 1 auto";var d=document.createElement("div");d.classList.add("col-xs-12");var e=document.createElement("div");e.classList.add("row");d.appendChild(e);var f=document.createElement("div");
f.classList.add("col-xs-12");e.appendChild(f);if("undefined"!=typeof a.image&&null!=a.image&&0<a.image.length)e=document.createElement("img"),e.src=a.image,e.style.maxWidth="100%",null!=c&&c.parentNode.appendChild(e,c.firstChild);else if("undefined"!=typeof a.title&&null!=a.title&&0<a.title.length)f.classList.add("first-line-bold"),f.appendChild(document.createTextNode(a.title));else{var g="https://www.google.com/s2/favicons?sz\x3d64\x26domain\x3d"+a.domain;fetch(g,{method:"HEAD"}).then(a=>{200===
a.status?(a=document.createElement("img"),a.src=g,a.style.maxWidth="100%",a.style.maxHeight="50%",null!=c&&c.parentNode.appendChild(a,c.firstChild)):console.log("Favicon not found or inaccessible: "+a.status)}).catch(a=>{console.log("Error fetching favicon: ",a)})}e=document.createElement("div");e.classList.add("row");f=document.createElement("div");f.classList.add("col-xs-12");e.appendChild(f);d.appendChild(e);0<a.desc.length&&(f.style.overflowY="auto",f.appendChild(document.createTextNode(a.desc)));
b.appendChild(d);a=document.createElement("br");b.appendChild(a);null!=c&&(a=c.parentNode.querySelector("#displayloadingcontainer"),console.log("loading div after url preview in createurlpreviewdiv"+a),null!=a&&removediv(a),c.insertBefore(b,c.firstChild))}}
function mindthegaps(a,b,c){var d="";d=a<window.innerHeight/2?d+"N":d+"S";d=b<window.innerWidth/2?d+"W":d+"E";d=document.querySelectorAll(".dot-ui-gap, .quad-"+d);for(var e=0;e<d.length;e++){var f=d[e].getBoundingClientRect(),g=f.top,h=f.left;f=f.bottom-g;if(b<h+f&&b+c>h&&a<g+f&&c+a>g)return console.log("Collision detected"),!0}return!1}
function playall(a){a.stopPropagation();a.target.onclick=null;a.target.src="/static/icons/pause-120.png";a.target.onclick=function(a){return stopplay(a)};document.getElementsByClassName("dot-popup");for(var b=0;b<posts.length;b++)playtimeoutids[b]=setTimeout(function(b){return function(){var c=postlocationmap[b].x,e=postlocationmap[b].y;null!=posts[b].data?showpostdatainpopup(posts[b],b,null,!1,c,e,!1):retrievepostsummaryandshowinpopup(posts[b],b,null,!1,c,e,!1);playidx=b;b==posts.length-1&&(a.target.src=
"/static/icons/play-64.png")}}(b),2E3*b);return!1}function stopplay(a){a.stopPropagation();a.target.onclick=null;a.target.src="/static/icons/play-64.png";a.target.onclick=function(a){return playall(a)};for(a=playidx;a<playtimeoutids.length;a++)clearTimeout(playtimeoutids[a]);playtimeoutids=[];playidx=0;return!1}
function dragElement(a){function b(a){null==clickstarttime&&(clickstarttime=new Date);500>window.innerWidth?(g=a.clientX,h=a.clientY,document.ontouchend=d,document.ontouchmove=c):(a=a||window.event,a.preventDefault(),a.stopPropagation(),g=a.clientX,h=a.clientY,document.onmouseup=d,document.onmousemove=c);return!1}function c(b){500>window.innerWidth?(b=b.targetTouches[0],b.pageX>=window.innerWidth-25||25>=b.pageX?(a.classList.remove("expand-open"),removediv(a)):(a.style.left=b.pageX+"px",a.style.top=
b.pageY+"px")):(b=b||window.event,b.preventDefault(),e=g-b.clientX,f=h-b.clientY,g=b.clientX,h=b.clientY,a.style.top=a.offsetTop-f+"px",a.style.left=a.offsetLeft-e+"px")}function d(b){b.stopPropagation();b.stopImmediatePropagation();document.onmouseup=null;document.onmousemove=null;document.ontouchend=null;document.ontouchmove=null;a.setAttribute("data-dragged",!0);"undefined"!=typeof b.target.id&&(b=b.target.id.split("-")[2],console.log("will stop the close of "+b+" "+closepopuptimeoutmap[b]),null!=
closepopuptimeoutmap[b]&&clearTimeout(closepopuptimeoutmap[b]));return!1}a.style.cursor="move";var e=0,f=0,g=0,h=0;a.onmousedown=b;a.ontouchstart=b}
function posttotopicmodal(a){a.stopPropagation();null!=splitschemas&&0<splitschemas.length?(document.getElementById("topic-post-data-input-holder").innerHTML="",1<splitschemas.length?(document.getElementById("create-sub-topic-select").style.visibility="hidden",a=topiccurrentdepth==splitschemas.length-1,document.getElementById("topic-post-data-input-holder").appendChild(generateformbasedonschema(splitschemas[topiccurrentdepth],a))):document.getElementById("topic-post-data-input-holder").appendChild(generateformbasedonschema(splitschemas[0],
!0))):topiccurrentdepth>=topicmaxdepth?document.getElementById("create-sub-topic-select").style.visibility="hidden":document.getElementById("create-sub-topic-select").style.visibility="visible";$("#topic-post-modal").modal("show");return!1}
function generateformbasedonschema(a,b){let c=document.createElement("div");c.className="col-xs-12";let d=0;var e=document.createElement("input");e.type="hidden";e.id="post-tags-input";c.appendChild(e);for(const b in a)if(a.hasOwnProperty(b)){e=document.createElement("div");e.className="row";const f=document.createElement("div");f.className="col-xs-12";const h=document.createElement("input");h.type="text";h.name=b;h.id=0<d?"post-json-data-"+b:"post-text-input-2";h.placeholder=b;"numeric"==a[b].type&&
h.addEventListener("input",function(a,b){return function(a){if("numeric"==b)var c=a.target.value;isNaN(c)?a.target.style.borderColor="red":a.target.style.borderColor="lightgray"}}(event,a[b].type));f.appendChild(h);e.appendChild(f);c.appendChild(e);c.appendChild(document.createElement("br"));d++}a=document.createElement("button");a.id="subtopicbtn-2";a.classList.add("btn");a.classList.add("btn-primary");a.classList.add("btn-sm");"undefined"==typeof b||0==b?a.addEventListener("click",function(a){a=
document.getElementById("post-text-input-2").value;createsubtopic(a)}):a.addEventListener("click",function(a){a=collectjsoninput();postcontentdirecttotopic(JSON.stringify(a))});a.textContent="Create";c.appendChild(a);return c}
function collectjsoninput(){const a={};var b=document.querySelectorAll('[id^\x3d"post-json-data-"]');let c=document.getElementById("post-text-input-2");null==c&&(c=document.getElementById("post-text-input"));a.text=c.value;b.forEach(b=>{const c=b.id.replace("post-json-data-","");a[c]=b.value});b=JSON.stringify(a);console.log("jsonData "+b);return b}function posttoflakemodal(a){a.stopPropagation();$("#flake-post-modal").modal("show");return!1}
function savecontentlocally(a,b){if("undefined"!==typeof Storage){null===localStorage.getItem("CONTENT::"+a)&&localStorage.setItem("CONTENT::"+a,JSON.stringify({items:[]}));if(null!=b){const c=JSON.parse(localStorage.getItem("CONTENT::"+a));c.items.push(b);localStorage.setItem("CONTENT::"+a,JSON.stringify(c))}console.log("Topic data updated for "+a)}else console.warn("Local storage not supported")}
function removecontentlocally(a,b){if("undefined"!==typeof Storage){if(null!==localStorage.getItem("CONTENT::"+a)){if("undefined"!=typeof b&&0<b){var c=JSON.parse(localStorage.getItem("CONTENT::"+a)),d=c.items;const e=d.findIndex(a=>a.crTime===b);-1!==e&&d.splice(e,1);c.items=d;localStorage.setItem("CONTENT::"+a,JSON.stringify(c))}console.log("Topic data removed for crtime "+b)}}else console.warn("Local storage not supported")}
function postcontentdirecttotopic(a,b){null!=document.getElementById("topic-post-status")&&(document.getElementById("topic-post-status").innerHTML="");null!=document.getElementById("topic-post-button")&&(document.getElementById("topic-post-button").disabled=!0);null==postcontenthome&&(postcontenthome={files:[]});var c="";c=null!=document.getElementById("post-text-input")&&null!=document.getElementById("post-text-input").value&&0<document.getElementById("post-text-input").value.length?document.getElementById("post-text-input").value:
a;a="";a=null!=document.getElementById("post-tags-input")&&0<document.getElementById("post-tags-input").value.length?document.getElementById("post-tags-input").value:b;b=null;null!=document.getElementById("sub-topic-desc-text-input")&&(b=document.getElementById("sub-topic-desc-text-input").value);if(null==a||0==a.length)a="[]";if(null!=topicstorage&&0<=topicstorage.indexOf("client")){var d=collectjsoninput(),e={topic:topicname,text:c,data:JSON.parse(d),tags:JSON.parse(a),summary:b,expires:document.getElementById("postexpirysettingsselect").value};
e=1E3<e.length?sjcl.hash.sha256.hash(JSON.stringify(e).substring(0,1E3)):sjcl.hash.sha256.hash(JSON.stringify(e));e=sjcl.codec.hex.fromBits(e);var f=parseInt(e.substring(e.length-12,e.length),16);f=f.toString().substring(0,4)+","+f.toString().substring(4,8)+","+f.toString().substring(8,12);e={topic:topicname,text:c,crTime:Date.now(),data:JSON.parse(d),tags:JSON.parse(a),datahash:e,summary:b,location:f,expires:document.getElementById("postexpirysettingsselect").value};savecontentlocally(topicname,
e);null==posts&&(posts=[]);$("#topic-post-modal").modal("hide");null!=document.getElementById("topic-post-button")&&(document.getElementById("topic-post-button").disabled=!1);JSON.parse("["+JSON.stringify(e)+"]");loadsubtopic(topicname,null)}else{postcontenthome.text=c;console.log("postcontenthome.text "+postcontenthome.text);if(0==postcontenthome.text.length&&(!postcontenthome.files||0==postcontenthome.files.length))return console.log("nothing to post"),document.getElementById("topic-post-status").appendChild(document.createTextNode("Nothing to post.")),
!1;var g=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");g.onreadystatechange=function(){console.log("xhr.readyState xhr.status"+g.readyState+" "+g.status);if(4==g.readyState)if(200==g.status){var a=JSON.parse("["+g.responseText+"]");document.getElementById("topic-post-status").innerHTML="Post successful";setTimeout(function(){null==posts&&(posts=[]);$("#topic-post-modal").modal("hide");null!=document.getElementById("topic-post-button")&&(document.getElementById("topic-post-button").disabled=
!1);null!=document.getElementById("post-tags-input")&&(document.getElementById("post-tags-input").value="");null!=document.getElementById("post-text-input")&&(document.getElementById("post-text-input").value="");null!=document.getElementById("sub-topic-text-input")&&(document.getElementById("sub-topic-text-input").value="");null!=document.getElementById("sub-topic-desc-text-input")&&(document.getElementById("sub-topic-desc-text-input").value="");a[0].crtime=a[0].crTime;console.log("crtime before displaying new post "+
a[0].crtime);displaypostsasdots(a,!0)},400)}else document.getElementById("topic-post-status").innerHTML="Post failed. Please try again later."};g.open("POST","/newauth/api/postcontenttotopic",!1);g.withCredentials=!0;c=JSON.stringify({text:postcontenthome.text,files:postcontenthome.files,closelooptopic:"closelooptopic"==topictype});e=1E3<c.length?sjcl.hash.sha256.hash(c.substring(0,1E3)):sjcl.hash.sha256.hash(c);e=sjcl.codec.hex.fromBits(e);f=parseInt(e.substring(e.length-12,e.length),16);f=f.toString().substring(0,
4)+","+f.toString().substring(4,8)+","+f.toString().substring(8,12);c=new FormData;for(d=0;d<postcontenthome.files.length;d++)c.append("attachments",fileattachments[d]),postcontenthome.files[d].content=null;c.append("postdata",new Blob([JSON.stringify({topic:topicname,text:postcontenthome.text,files:postcontenthome.files,crTime:Date.now(),expires:document.getElementById("postexpirysettingsselect").value,closelooptopic:"closelooptopic"==topictype,datahash:e,location:f,tags:JSON.parse(a),summary:b,
giveout:""})],{type:"application/json"}));g.send(c)}}
function createsubtopic(a){var b="";b=null!=document.getElementById("sub-topic-text-input")&&0<document.getElementById("sub-topic-text-input").value.length?document.getElementById("sub-topic-text-input").value:a;a="";null!=document.getElementById("sub-topic-desc-text-input")&&0<document.getElementById("sub-topic-desc-text-input").length&&(a=document.getElementById("sub-topic-desc-text-input").value);if(3<b.length){var c=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");
c.onreadystatechange=function(){if(4==c.readyState)if(200==c.status){if(c.responseText){var a=c.responseText;null!=a&&0<a.length&&($("#topic-post-modal").modal("hide"),enabledisableelemswithid("subtopicbtn",!1),postcontentdirecttotopic(b,JSON.stringify(["folder"])))}}else document.getElementById("sub-topic-status").innerText=c.responseText,enabledisableelemswithid("subtopicbtn",!1),document.getElementById("post-text-input").value="",document.getElementById("post-tags-input").value="",document.getElementById("sub-topic-text-input").style.border=
"1px solid red"};c.open("POST","/newauth/api/createtopic",!0);c.withCredentials=!0;c.setRequestHeader("Content-Type","application/json");a=JSON.stringify({topic:topicname+"/"+b,crTime:Date.now(),display:a});null!=topicstorage&&0<=topicstorage.indexOf("client")?(collectjsoninput(),savecontentlocally(topicname+"/"+b,null),postcontentdirecttotopic(b,JSON.stringify(["folder"])),null!=document.getElementById("sub-topic-text-input")&&(document.getElementById("sub-topic-text-input").value=""),null!=document.getElementById("sub-topic-desc-text-input")&&
(document.getElementById("sub-topic-desc-text-input").value="")):(c.send(a),enabledisableelemswithid("subtopicbtn",!0))}else document.getElementById("sub-topic-text-input").style.border="1px solid red",document.getElementById("sub-topic-text-input").value="",setTimeout(function(){document.getElementById("sub-topic-text-input").style.border="none"},2E3)}function enabledisableelemswithid(a,b){document.querySelectorAll('[id^\x3d"'+a+'"]').forEach(a=>{a.disabled=b})}
function postcontentdirecttoflake(a){document.getElementById("flake-post-status").innerHTML="";null==postcontenthome&&(postcontenthome={files:[]});var b=document.getElementById("post-text-input").value;postcontenthome.text=b;if(0==postcontenthome.text.length&&(!postcontenthome.files||0==postcontenthome.files.length))return console.log("nothing to post"),document.getElementById("flake-post-status").appendChild(document.createTextNode("Nothing to post.")),!1;var c=window.XMLHttpRequest?new XMLHttpRequest:
new ActiveXObject("Microsoft.XMLHTTP");c.onreadystatechange=function(){if(4==c.readyState&&200==c.status){var a=JSON.parse("["+c.responseText+"]");$("#flake-post-modal").modal("hide");setTimeout(function(){null==posts&&(posts=[]);displaypostsasdots(a,!0)},400)}};c.open("POST","/newauth/api/postcontenttoflake",!1);c.withCredentials=!0;c.setRequestHeader("Content-Type","application/json");b=JSON.stringify({text:postcontenthome.text,files:postcontenthome.files});b=1E3<b.length?sjcl.hash.sha256.hash(b.substring(0,
1E3)):sjcl.hash.sha256.hash(b);b=sjcl.codec.hex.fromBits(b);var d=parseInt(b.substring(b.length-12,b.length),16);d=d.toString().substring(0,4)+","+d.toString().substring(4,8)+","+d.toString().substring(8,12);c.send(JSON.stringify({flake:a,text:postcontenthome.text,files:postcontenthome.files,datahash:b,location:d,giveout:""}))}
function getfullpost(a,b,c,d,e,f,g){var h=new XMLHttpRequest,k=document.getElementById("post-seq-"+c),l=null;null!=k&&(k=k.querySelector('div[name\x3d"post-tags"]'),null!=k&&(l=k.innerText));c+="";0<=c.indexOf("-")&&(c=c.split("-")[0]);k="";0==c||null==e?(k="/newauth/api/getfullpostbytopicandtime/"+a+"/"+b,c=-1):k="/newauth/api/getpostfullimage/"+e+"/"+c;"undefined"!=typeof g&&0<g.length&&(k=g);h.open("GET",k,!1);h.setRequestHeader("Content-Type","application/json");h.onreadystatechange=function(){if(4==
h.readyState&&200==h.status){var a=h.responseText;null!=a&&0<a.length&&(addposttoalreadyseen(b),loadfulluserpost(JSON.parse(a),d,l,f,e,c))}};h.send(null)}
function increasesiteusage(a){if(null!=a&&0!=a.length&&"undefined"!==typeof Storage){var b=localStorage.getItem("SITEUSAGE");"undefined"==b||null==b||"null"==b||0==b.length?(b={},b[a]=1):(b=JSON.parse(b),b[a]=b[a]?b[a]+1:1);console.log("site "+a+" added to usage");console.log("Setting SITEUSAGE in local storage");localStorage.setItem("SITEUSAGE",JSON.stringify(b))}}
function getsiteusage(a){if(null==a||0==a.length)return 0;if("undefined"!==typeof Storage){var b=localStorage.getItem("SITEUSAGE");if("undefined"!=b&&null!=b&&"null"!=b&&0!=b.length&&(b=JSON.parse(b),b[a]))return b[a]}}
function addposttoalreadyseen(a){if(null!=a&&0!=a.length&&"undefined"!==typeof Storage){var b=localStorage.getItem("TOPICVIEWS");"undefined"==b||null==b||"null"==b||0==b.length?(b={},b[topicname]=[],b[topicname].push(a)):(b=JSON.parse(b),b[topicname]||(b[topicname]=[]),b[topicname].includes(a)||b[topicname].push(a));console.log("post "+a+" added to already seen");console.log("Setting TOPICVIEWS in local storage");localStorage.setItem("TOPICVIEWS",JSON.stringify(b))}}
function addposttodeleted(a){if(null!=a&&0!=a.length&&"undefined"!==typeof Storage){var b=localStorage.getItem("TOPICDELETES");"undefined"==b||null==b||"null"==b||0==b.length?(b={},b[topicname]=[],b[topicname].push(a)):(b=JSON.parse(b),b[topicname]||(b[topicname]=[]),b[topicname].includes(a)||b[topicname].push(a));console.log("post "+a+" added to deleted");console.log("Setting TOPICDELETES in local storage");localStorage.setItem("TOPICDELETES",JSON.stringify(b));isowner&&(console.log("isowner "+isowner+
" removing post from database also"),removepostfromtopic(topicname,a));null!=topicstorage&&0<=topicstorage.indexOf("client")&&(console.log("removing post locally"),removecontentlocally(topicname,a))}}
function addposttosaved(a,b,c){if(null!=c&&0!=c.length){var d=new XMLHttpRequest;c="/newauth/api/savepost/"+topicname+"/"+c;d.onreadystatechange=function(){4==d.readyState&&200==d.status&&(b.style.transform="translate3d(0px, 0px, 0)",displaybuttonbehavior(a,"Saved"))};d.open("GET",c,!0);d.withCredentials=!0;d.setRequestHeader("Content-Type","application/json");d.send(null)}}
function removepostfromalreadyseen(a){if(null!=a&&0!=a.length&&"undefined"!==typeof Storage){var b=localStorage.getItem("TOPICVIEWS");null!=b&&"null"!=b&&0<b.length&&(b=JSON.parse(b),b[topicname]&&b.includes(a)&&(b[topicname]=b[topicname].splice(b.indexOf(a),1),localStorage.setItem("TOPICVIEWS",JSON.stringify(b)),console.log("post "+a+" removed from already seen")))}}
function removepostfromtopic(a,b){if(null!=b&&0!=b.length){var c=new XMLHttpRequest;c.open("POST","/newauth/api/removepostfromtopic",!1);c.setRequestHeader("Content-Type","application/json");c.onreadystatechange=function(){};var d=JSON.stringify({topic:a,crTime:b});c.send(d);alert("removing this post "+d);null!=topicstorage&&0<=topicstorage.indexOf("client")&&removecontentlocally(a,b)}}
function checkifalreadyseen(a){var b=!1;if(null==a||0==a.length)return b;if("undefined"!==typeof Storage){var c=localStorage.getItem("TOPICVIEWS");"undefined"!=c&&null!=c&&"null"!=c&&0<c.length&&(c=JSON.parse(c),c[topicname]&&c[topicname].includes(a)&&(b=!0))}return b}
function checkifdeleted(a){var b=!1;if(null==a||0==a.length)return b;if("undefined"!==typeof Storage){var c=localStorage.getItem("TOPICDELETES");"undefined"!=c&&null!=c&&"null"!=c&&0<c.length&&(c=JSON.parse(c),c[topicname]&&c[topicname].includes(a)&&(b=!0))}return b}
function attachedfilechangeeventhandlerfortopic(){var a="attachedfiles";if(500>window.innerWidth||500>window.innerHeight)a="attachedfilesxs";a=document.getElementById(a);null!=a&&(debugappui&&console.log("attaching eventlistener for change on attachedfiles"),a.addEventListener("change",function(a){displaypreviewfortopic(a);debugappui&&console.log("changed again")},!1))}
function displaypreviewfortopic(a,b){var c=a.target.files,d="fileprogress";if(500>window.innerWidth||500>window.innerHeight)d="fileprogressxs";document.getElementById(d).style.display="block";null==postcontenthome&&(postcontenthome={files:[]});postcontenthome.files||(postcontenthome.files=[]);debugappui&&console.log("onchange event fired for attachedfiles");for(var e=0;e<c.length;e++){fileattachments.push(c[e]);var f=new FileReader;f.onloadstart=()=>document.getElementById("contentpostbtn").disabled=
!0;f.onloadend=()=>{document.getElementById("contentpostbtn").disabled=!1};f.onload=function(a){return function(b){document.getElementById(d).value=100;processloadedattachedfilefortopic(b,a)}}(c[e]);f.onprogress=function(a){return function(a){a=100*a.loaded/a.total;document.getElementById(d).value=a}}(c[e]);f.readAsDataURL(c[e])}b&&b(a.target.imgcount,postcontenthome.files)}
function displayallpostdescription(a,b){a.stopPropagation();for(var c=0;c<posts.length;c++)showpostdescription(a,c,b);return!1}
function showpostdescription(a,b,c){var d=function(a){displayallpostdescription(a,!0)},e=function(a){displayallpostdescription(a)},f=document.getElementById("dot-desc-"+b);if(null!=f||"undefined"!=typeof c&&1==c)null!=f&&(f.style.opacity="0.3",removediv(f),null!=a&&(a.target.onclick=null,a.target.onclick=e));else if("undefined"==typeof c||0==c||null==f)if(c=document.getElementById("dot-"+b),null!=c){null!=a&&(a.target.onclick=null,a.target.onclick=d);a=document.createElement("div");a.style.textAlign=
"center";a.style.borderRadius="4px";a.style.display="flex";a.style.alignItems="center";a.style.justifyContent="center";d="";if("undefined"!=typeof posts[b].tags&&null!=posts[b].tags)for(e=0;e<posts[b].tags.length;e++)0>posts[b].tags[e].indexOf("flake:")&&0>posts[b].tags[e].indexOf("ip:")&&0>posts[b].tags[e].indexOf("name:")&&0>posts[b].tags[e].indexOf("folder")&&0>posts[b].tags[e].indexOf("jwt:")&&(d+=posts[b].tags[e],0<d.length&&e<posts[b].tags.length-1&&(d+=" "));else d=null!=posts[b].data?posts[b].data.text:
posts[b].text;0!=d.length||"undefined"==typeof posts[b].summary||null==posts[b].summary||isBase64JSON(posts[b].summary)||(d=posts[b].summary);e=document.createElement("p");e.style.fontSize="1.4em";e.appendChild(document.createTextNode(d));a.appendChild(e);a.setAttribute("id","dot-desc-"+b);a.classList.add("dot-desc");a.style.backgroundColor="#989898";a.style.position="absolute";a.style.pointerEvents="none";parseFloat(c.style.left.split("%")[0])*parseInt(window.innerWidth)/100<parseInt(window.innerWidth)-
100?a.style.left="5px":a.style.right="5px";a.style.top=window.scrollY+c.getBoundingClientRect().top+parseInt(c.style.height)+"px";a.style.maxWidth=3*parseInt(c.style.width)+"px";a.style.lineHeight="1.8em";a.style.height="auto";a.style.whiteSpace="normal";a.style.maxHeight="3.6em";a.style.overflow="hidden";a.style.left=window.scrollX+c.getBoundingClientRect().left-10+"px";a.style.color="white";a.style.paddingLeft="2px";a.style.zIndex=10;document.body.appendChild(a);attachtransitionstyles(a,1);a.style.setProperty("opacity",
.9,"important")}}
function showpostcomment(a,b){if(null!=a.crTime&&0!=a.crTime&&0<a.newcomment.length)if(removepostfromalreadyseen(a.crTime),null!=document.getElementById("conv-data-"+a.convid)){if(600>window.innerWidth||600>window.innerHeight)b=document.getElementById("conv-data-"+a.convid),document.getElementById("post-comments-mobile").appendChild(b);addconversationmessagetopanel(document.getElementById("conv-data-"+a.convid),a.newcomment,0,a.crTime,a.giveout,!1)}else{b=-2;var c=document.getElementsByClassName("dot-cmt");if(null!=
c)for(var d=0;d<c.length;d++)removediv(c[d]);null!=a.crTime&&(b=crtimetoidxmap[a.crTime]);c=document.getElementById("dot-"+b);null!=posts[b].datahash&&(d="000000000000000000000000000000000000000000000",d=parseInt(posts[b].datahash.substring(posts[b].datahash.length-12,posts[b].datahash.length),16),c.style.backgroundColor="#"+d.toString().substring(0,6));c=document.createElement("div");c.classList.add("marquee");c.setAttribute("id","dot-cmt-"+b);c.classList.add("dot-cmt");c.style.backgroundColor="#efefef";
c.style.position="absolute";c.style.boxShadow="2px 3px 2px #afafaf";c.style.borderTop="1px solid #afafaf";c.style.paddingTop="2px";b=document.getElementById("dot-"+b);.9>b.style.opacity&&(b.style.opacity=.9);c.style.bottom="2px";c.style.width="240px";c.style.left="50%";c.style.transform="translateX(-50%)";c.style.lineHeight="1.2em";c.style.whiteSpace="nowrap";c.style.overflow="hidden";c.style.fontColor="#121212";c.style.zIndex=10;d=document.createElement("span");d.appendChild(document.createTextNode(a.giveout));
var e=document.createElement("div");e.classList.add("marquee-text-drop");50>a.newcomment.length?e.appendChild(document.createTextNode(a.newcomment)):e.appendChild(document.createTextNode(a.newcomment.substring(0,50)));setTimeout(function(){e.classList.remove("marquee-text");e.innerHTML="";e.appendChild(document.createTextNode(a.newcomment))},7E3);c.appendChild(d);c.appendChild(e);d=document.getElementById("topic-app");null==d&&(d=document.getElementById("app-flk"));d.appendChild(c);makelementpulsate(b,
20);attachtransitionstyles(c,2);c.style.opacity=.9}else console.log("No crtime in response, can not locate the post to attach comment to.")}
function processloadedattachedfilefortopic(a,b){imageExists(a.target.result,function(c){var d=document.getElementById("attached-file-preview");if(500>window.innerWidth||500>window.innerHeight)d=document.getElementById("attached-file-preview-xs");if(c){c=document.createElement("img");c.src=window.URL.createObjectURL(b);var e=window.screen.availWidth,f=window.screen.availHeight;800<e&&(e=800);600<f&&(f=600);e=getresizedimage(c,b.type,e,f);f=document.createElement("IMG");f.classList.add("fade-in");f.style.objectFit=
"cover";f.style.top="0px";f.style.left="0px";500>window.innerWidth||500>window.innerHeight?(f.width="50",f.height="50"):(f.width="64",f.height="64",f.style.padding="5px",d.innerHTML="");f.src=e;d.style.backgroundColor="#ffffff";d.appendChild(f);postcontenthome.files.push({name:b.name,size:b.size,type:b.type,content:a.target.result,thumbnail:getresizedimage(c,b.type,300,300)})}else videoExists(a.target.result,function(c){c?document.getElementById("topic-post-status").innerHTML='\x3cdiv style\x3d"color:red"\x3eVideo uploads not enabled\x3c/div\x3e':
(console.log("No image or video "),d.style.backgroundColor="#989898",d.innerHTML="\x3ch5\x3e"+b.type+" File\x3c/h5\x3e",postcontenthome.files.push({name:b.name,size:b.size,type:b.type,content:a.target.result}))});1<postcontenthome.files.length&&(c=document.createElement("div"),c.classList.add("fade-in"),c.style.width="64",c.style.height="64",c.style.opacity="0.6",c.style.overflow="none",e=document.createElement("h4"),e.style.background="#515151",e.classList.add("text-center"),e.style.width="100%",
e.appendChild(document.createTextNode("+"+(postcontenthome.files.length-1))),c.appendChild(e),d.appendChild(c))})}function closeSSEConnection(){null!=topiceventsource&&(topiceventsource.close(),topiceventsource=null,console.log("SSE connection stopped -- was started in topic page."))}
function jointopic(){null==topiceventsource?(openSSEConnection(),console.log("created new SSE connection from topic page "+topiceventsource.url)):topiceventsource.url.endsWith(topicname)?console.log("SSE connection existed from topic page "+topiceventsource.url):(closeSSEConnection(),openSSEConnection(),console.log("created new SSE connection from topic page "+topiceventsource.url))}
function openSSEConnection(){"undefined"!==typeof EventSource?(topiceventsource=new EventSource("/newauth/api/monitorTopic/"+topicname),topiceventsource.addEventListener("message",function(a){a=JSON.parse("["+a.data+"]");var b=new Date(posts[0].crtime),c=new Date(a[0].crTime);if(0<parseInt(a[0].comments)&&null==a[0].summary)showpostcomment(a[0],!0);else if("undefined"==typeof posts[0].crtime||c>b)a[0].crtime=a[0].crTime,displaypostsasdots(a,!0)})):alert("This browser does not support the technology required to monitor the topic in realtime. You can refresh the page periodically to see the latest posts.")}
function displayflakeconfstartmodal(a){$("#flake-conf-start-modal").modal("show")}
function increasePrivacy(a){a.stopPropagation();var b=new XMLHttpRequest;b.onreadystatechange=function(){if(4==b.readyState&&200==b.status){var c=b.responseText;document.getElementById("identity-display").innerText=c.split(":")[1];null!=document.getElementById("header-identity-display")&&(document.getElementById("header-identity-display").innerText=c.split(":")[1]);"F"==c.split(":")[0]?(document.getElementById("inc-privacy-button").src="/static/icons/user-dark-gray.png",document.getElementById("inc-privacy-button").title=
"Already set at maximum privacy",document.getElementById("inc-privacy-button").onclick=function(a){displaybuttonbehavior(a,"Already set at maximum privacy")}):(document.getElementById("red-privacy-button").src="/static/icons/user.png",document.getElementById("red-privacy-button").title="Less Privacy",document.getElementById("red-privacy-button").onclick=function(a){reducePrivacy(a)});"A"==c.split(":")[0]&&displaybuttonbehavior(a,"Giving out Alias now");"F"==c.split(":")[0]&&displaybuttonbehavior(a,
"Giving out flake now")}4==b.readyState&&400==b.status&&displaybuttonbehavior(a,b.responseText)};b.open("POST","/newauth/api/increaseprivacyforflake",!0);b.withCredentials=!0;b.setRequestHeader("Content-Type","application/json");b.send(null)}
function reducePrivacy(a){a.stopPropagation();var b=new XMLHttpRequest;b.onreadystatechange=function(){if(4==b.readyState&&200==b.status){var c=b.responseText;document.getElementById("identity-display").innerText=c.split(":")[1];null!=document.getElementById("header-identity-display")&&(document.getElementById("header-identity-display").innerText=c.split(":")[1]);"N"==c.split(":")[0]?(document.getElementById("red-privacy-button").src="/static/icons/user-gray.png",document.getElementById("red-privacy-button").title=
"Already giving out full name",document.getElementById("red-privacy-button").onclick=function(a){displaybuttonbehavior(a,"Already giving out full name")}):(document.getElementById("inc-privacy-button").src="/static/icons/user-dark.png",document.getElementById("inc-privacy-button").title="More Privacy",document.getElementById("inc-privacy-button").onclick=function(a){increasePrivacy(a)});"A"==c.split(":")[0]&&displaybuttonbehavior(a,"Giving out Alias now");"N"==c.split(":")[0]&&displaybuttonbehavior(a,
"Giving out full name now")}4==b.readyState&&400==b.status&&displaybuttonbehavior(a,b.responseText)};b.open("POST","/newauth/api/reduceprivacyforflake",!0);b.withCredentials=!0;b.setRequestHeader("Content-Type","application/json");b.send(null)}
function loadvaultinflakepage(){document.getElementById("flake-main-image-2").src="/static/icons/vault-256.png";document.getElementById("flake-main-image-2").style.opacity=.2;document.getElementById("displayloadingcontainer").style.display="block";if(null!=originaldata&&0<originaldata.length)displayvaultdataasdots(originaldata);else{let a=new XMLHttpRequest;a.open("POST","/secure/getuserdata",!0);a.withCredentials=!0;a.setRequestHeader("Content-Type","application/json");a.onreadystatechange=function(){if(4==
a.readyState&&200==a.status)if(null!=a.responseText&&0<a.responseText.length){var b=JSON.parse(a.responseText);originaldata="ERROR";try{originaldata=sjcl.decrypt(vaultkey,b.data),displayvaultdataasdots(originaldata)}catch(c){console.log("Exception while decrypt vault data "+c),null!=document.getElementById("newauth-notification")&&(document.getElementById("newauth-notification").innerHTML="",document.getElementById("newauth-notification").innerHTML="Invalid Vault key. Please try again"),setTimeout(function(){createVaultKeyInputOnForeGroundDiv(b.data)},
1500)}rndsalt=b.salt;rnditer=b.iterations;rndseq=b.sequence;rndcrdate=b.createdate}else console.log("ERROR")};a.send(JSON.stringify({sequence:1}))}}
function displayvaultdataasdots(a){removediv(document.getElementById("vaultkeyinputholder"));var b=document.getElementById("vault-search-input").value,c=JSON.parse(a);a=[];for(var d=0;d<c.length;d++){var e=a.find(a=>a.name===c[d].siteUrl);null!=e?e.description.push(c[d].siteuser+":#:#:"+c[d].sitepwd):(e={name:c[d].siteUrl,description:[c[d].siteuser+":#:#:"+c[d].sitepwd],text:c[d].siteuser,relevance:getsiteusage(c[d].siteUrl)},null!=b&&0<b.length?(0<=c[d].siteUrl.toLowerCase().indexOf(b.toLowerCase())||
0<=c[d].siteuser.toLowerCase().indexOf(b.toLowerCase())||0<=c[d].sitepwd.toLowerCase().indexOf(b.toLowerCase()))&&a.push(e):a.push(e))}if(null!=b&&0<b.length&&(b=document.getElementsByClassName("dot-vault"),null!=b&&0<b.length))for(d=0;d<b.length;d++)b.length>=a.length?b[d].style.display="none":removediv(b[d]);renderdataasdots(a)}
function renderdataasdots(a,b,c){function d(a){if("undefined"===typeof a.relevance||null==a.relevance||""==a.relevance)a.relevance=1;return a.relevance}function e(a,b){for(var c,d=c=0;d<a.length;d++)a[b]>a[d]&&c++;return parseInt(100*c/(a.length-1))}document.getElementById("displayloadingcontainer").style.display="none";if(null!=a&&0!=a.length){posts=a;b=Math.sqrt(parseInt(window.innerWidth*window.innerHeight)/Math.max(20,posts.length));startsize=parseInt(b)/9;maxdotsize=parseInt(b)/4;b=document.getElementById("topic-app");
null==b&&(b=document.getElementById("app-flk"));for(c=0;c<a.length;c++){var f=document.querySelector('[data-name\x3d"'+a[c].name+'"]');if(null!=f&&f.getAttribute("data-name")===a[c].name)f.style.display="block",f.style.opacity=1;else{f=document.createElement("div");f.setAttribute("id","dot-"+c);f.setAttribute("data-name",a[c].name);f.classList.add("dot-vault");f.style.width=Math.min(2*startsize,maxdotsize);var g=e(a.map(d),c);80<=g&&(f.style.width=maxdotsize);50>=g&&(f.style.width=startsize);f.style.opacity=
"0.1";f.style.transform="scale(1.2)";attachtransitionstyles(f,1);g=1E3<a[c].name.length?sjcl.hash.sha256.hash(a[c].name.substring(0,1E3)):sjcl.hash.sha256.hash(a[c].name);var h=sjcl.codec.hex.fromBits(g);f.style.backgroundColor="#"+h.substring(0,6);f.style.boxShadow="0px 0px 2px #"+h.substring(0,6);g="000000000000000000000000000000000000000000000";null!=h&&(g=parseInt(h.substring(h.length-15,h.length),16));h=parseFloat(g.toString().substring(0,2)+"."+g.toString().substring(2,5));g=parseFloat(g.toString().substring(5,
7)+"."+g.toString().substring(7,10));g=parseInt(window.innerHeight*g/100);h=parseInt(window.innerWidth*h/100);for(var k=0;mindthegaps(g,h,maxdotsize);){if(5<k){console.log("Done shifting this dot "+g+":"+h+" "+a[c].name);break}g=g<window.innerHeight/2&&g>50+startsize?g-startsize:g+startsize;h=h<window.innerWidth/2&&0<h?h-startsize:h+startsize;k++}10>h&&(h+=10);h>window.innerWidth-maxdotsize-10&&(h-=3*maxdotsize);60>g&&(g+=60);g>window.innerHeight-maxdotsize-10&&(g-=maxdotsize+10);2>=c&&console.log("randleft "+
h+" randtop "+g);k="";k=g<window.innerHeight/2?k+"N":k+"S";k=h<window.innerWidth/2?k+"W":k+"E";f.classList.add("quad-"+k);f.style.top=100*g/parseInt(window.innerHeight)+"%";f.style.left=100*h/parseInt(window.innerWidth)+"%";f.style.height=f.style.width;f.style.position="absolute";f.style.borderRadius="50%";f.style.zIndex="2";f.style.transform=window.getComputedStyle(f).getPropertyValue("transform");f.style.transform="scale(1)";g=document.createElement("div");h="";if("undefined"!=typeof a[c].tags&&
null!=a[c].tags)for(k=0;k<a[c].tags.length;k++)0>a[c].tags[k].indexOf("flake:")&&0>a[c].tags[k].indexOf("ip:")&&0>a[c].tags[k].indexOf("name:")&&0>a[c].tags[k].indexOf("jwt:")&&(h+=a[c].tags[k]),k<a[c].tags.length-1&&(h+=" ");else try{var l=a[c].name;l.trim().startsWith("http")||(l="http://"+l.trim());let b=(new URL(l)).hostname.split(".");for(k=0;k<b.length;k++)"com de org net us co edu gov biz za info cc ca cn fr ch au in jp be it nl uk mx no ru br se es at dk eu il io".split(" ").includes(b[k].toLowerCase())||
(h=b[k]+" "+h);f.style.backgroundColor="#fefefe";var m=document.createElement("img");m.setAttribute("height",f.style.height);m.setAttribute("width",f.style.width);m.setAttribute("alt",h);m.style.objectFit="cover";m.style.borderRadius="50%";var n=new Image;n.onload=function(a){return function(){a.src=16<this.naturalHeight?this.src:"/static/icons/blankfavicon.ico"}}(m);n.src="https://www.google.com/s2/favicons?sz\x3d64\x26domain\x3d"+l;f.appendChild(m)}catch(p){console.log("error creating url from "+
a[c].name+" : "+p),h=a[c].name}g.appendChild(document.createTextNode(h));g.setAttribute("id","dot-desc-"+c);g.classList.add("dot-desc");g.style.borderRadius="3px";g.style.position="absolute";g.style.backgroundColor="#eaeaea";g.style.pointerEvents="none";h=parseFloat(f.style.left.split("%")[0]);k=parseFloat(f.style.top.split("%")[0]);h*parseInt(window.innerWidth)/100>parseInt(window.innerWidth)/2&&(g.style.right="5px",g.style.textAlign="right");k*parseInt(window.innerHeight)/100>parseInt(window.innerHeight)/
2&&(g.style.bottom="5px");g.style.width="100px";g.style.lineHeight="1.8em";g.style.whiteSpace="nowrap";g.style.overflow="hidden";g.style.color="#262626";g.style.fontSize="1.2em";g.style.paddingLeft="2px";g.style.zIndex=10;f.appendChild(g);attachtransitionstyles(g,1);g.style.setProperty("opacity",.9,"important");b.appendChild(f);setTimeout(function(a){return function(){let b=document.getElementById("dot-"+a);null!=b&&(b.style.opacity=1)}}(c),300);setTimeout(function(a){return function(){let b=document.getElementById("dot-desc-"+
a);null!=b&&(b.style.display="none")}}(c),3E3);f.addEventListener("mouseenter",function(a,b){return function(a){a=document.getElementById("dot-desc-"+b);null!=a&&(a.style.display="block",a.style.opacity=.9)}}(event,c),!1);f.addEventListener("mouseleave",function(a,b){return function(a){a=document.getElementById("dot-desc-"+b);null!=a&&(a.style.display="none")}}(event,c),!1);f.addEventListener("click",launchvltpopupfunction(c,event),!1)}}setvaultpagebehaviour();0>parseInt(remaintime)&&(remaintime=
60);setTimeout(function(){for(var a=document.getElementsByClassName("dot-popup-vault"),b=0;b<a.length;b++)removediv(a[b]);a=document.getElementsByClassName("dot-vault");for(b=0;b<a.length;b++)posts=null,a[b].addEventListener("click",function(a,b){return function(a){displaybuttonbehavior(a,"Vault content expired, please login again.")}}(event,b),!1)},1E3*parseInt(remaintime))}}
function getcolorandlocationbasedondata(a,b){function c(a){if(null==g){g={};for(var b=0;b<f.length;b++){var c=e(f[b].trim());null!=c&&(g[f[b].trim()]=c)}}return d(a)}function d(a){a=a.replace("#","");var b=e(a),c=-1,d;Object.keys(g).forEach((a,e)=>{e=g[a];e=Math.pow(b.r-e.r,2)+Math.pow(b.g-e.g,2)+Math.pow(b.b-e.b,2);if(0>c||e<c)0<c&&(d="#"+a),c=e});return d}function e(a){return(a=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(a))?{r:parseInt(a[1],16),g:parseInt(a[2],16),b:parseInt(a[3],16)}:null}
var f=" F7F6CF ; B6D8F2 ; F4CFDF ; 5784BA ; 9AC8EB ; CCD4BF ; E7CBA9 ; EEBAB2 ; F5F3E7 ; F5E2E4 ; F5BFD2 ; E5DB9C ; D0BCAC ; BEB4C5 ; E6A57E ; 218B82 ; 9AD9DB ; E5DBD9 ; 98D4BB ; EB96AA ; C6C9D0 ; C54B6C ; E5B3BB ; C47482 ; D5E4C3 ; F9968B ; F27348 ; 26474E ; 76CDCD ; 2CCED2 ; B8E0F6 ; A4CCE3 ; 37667E ; DEC4D6 ; 7B92AA ; DDF2F4 ; 84A6D6 ; 4382BB ; E4CEE0 ; A15D98 ; DC828F ; F7CE76 ; E8D6CF ; 8C7386 ; 9C9359 ; F4C815 ; F9CAD7 ; A57283 ; C1D5DE ; DEEDE6 ; E9BBB5 ; E7CBA9 ; AAD9CD ; E8D595 ; 8DA47E ; CAE7E3 ; B2B2B2 ; EEB8C5 ; DCDBD9 ; FEC7BC ; FBECDB ; F3CBBD ; 90CDC3 ; AF8C72 ; 938F43 ; B8A390 ; E6D1D2 ; DAD5D6 ; B2B5B9 ; 8FA2A6 ; 8EA4C8 ; C3B8AA ; DEDCE4 ; DB93A5 ; C7CDC5 ; 698396 ; A9C8C0 ; DBBC8E ; AE8A8C ; 7C98AB ; C2D9E1 ; D29F8C ; D9D3D2 ; 81B1CC ; FFD9CF ; C6AC85 ; ; D9C2BD ; A2C4C6 ; 82B2B8 ; 874741 ; CA9C95 ; 40393E ; E5E4E5 ; 897C87 ; 46302B ; 76504E ; D3CCCA ; A37E7E ; 86736C ; ; AD192A ; E4B78F ; F1E8EA ; D88D96 ; EAB1B9 ; F38C10 ; A7763B ; CCD7D8 ; 4C482E ; D2B6BA ; BE3F12 ; 7DB0CD ; C0B5AB ; 79553F ; 91BA96 ; A65111 ; DDAA00 ; 7C5D3D ; 85AAAA ; 173F4E ; D82315 ; 2F1710 ; 425164 ; DABB96 ; 899FB6 ; DBB657 ; 86553F ; C8C2D0 ; E45C54 ; 90A375 ; F9BB9D ; FFDA43 ; 756382 ; E2C274 ; 9CA8B5 ; FFE75D ; D24970 ; 32657C ; 669BB7 ; CF8145 ; 753516 ; AF6F33 ; 9DB4BA ; 210E0D ; E2D2C1 ; CA8459 ; DDB396 ; DDDFE3 ; 422523 ; 954D34 ; 843619 ; B87730 ; 1B2625 ; DAD0CE ; 748991 ; 64A532 ; B09647 ; 450309 ; DEE2E3 ; 7B5536 ; 446C04 ; F8DF96 ; 977D77 ; 301F1A ; 5E301F ; 8E3229 ; AEBB35 ; 2F1D16 ; D0BDAA ; A37537 ; FF415B ; BC7F37 ; 352C20 ; EAE8E8 ; 64AA71 ; F64900 ; CB8A2D ; 262416 ; DDDDDE ; 90B274 ; B08D7E ; 6C74A4 ; BBB9BC ; 5E2424 ; 95BB9A ; 652F20 ; 74C85D ; 2D3538 ; 57818A ; D54C2E ; D09150 ; DEBD9B ; 3C2320 ; 955132 ; EBEBEF ; B08138 ; 784928 ; 382918 ; DDD4D3 ; AE8A75 ; F08E88 ; 422D09 ; 468F5E ; AC7C36 ; E3E2DF ; E1A624 ; 317AC1 ; 384454 ; D4D3DC ; AD956B ; F38C10 ; A7763B ; CCD7D8 ; 4C482E ; D2B6BA ; C5853D ; 99372E ; DAD4D9 ; 391C19 ; B27E83 ; 4F3B2B ; 7C6619 ; B8B5AD ; BE0309 ; 93C1D5 ".split(";"),
g;var h=1E3<a.length?sjcl.hash.sha256.hash(a.substring(0,1E3)):sjcl.hash.sha256.hash(a);h=sjcl.codec.hex.fromBits(h);a="000000000000000000000000000000000000000000000";var k="1";null!=h&&(a=BigInt("0x"+h));"undefined"!=typeof b&&0<b.length?(h=1E3<b.length?sjcl.hash.sha256.hash(b.substring(0,1E3)):sjcl.hash.sha256.hash(b),h=sjcl.codec.hex.fromBits(h),null!=h&&(k=BigInt("0x"+h)),h=a*k):h=a;b=parseFloat(h.toString(10).substring(0,2)+"."+h.toString(10).substring(2,5));a=parseFloat(h.toString(10).substring(5,
7)+"."+h.toString(10).substring(7,10));k="";10<h.toString(10).length&&(k=parseFloat(h.toString(10).substring(10,12)+"."+h.toString(10).substring(12,15)));h="#"+h.toString(16).substring(0,6);var l=c(h);return{xpc:b,ypc:a,zpc:k,origcol:h,col:l,boxShadow:"0px 0px 2px "+l,getpastelcolor:c}}
function createVaultPopup(a,b){increasesiteusage(a.name);var c=document.createElement("div");c.setAttribute("id","dot-popup-vlt-"+b);c.classList.add("dot-popup-vault");c.style.width="25vw";c.style.backgroundColor="rgba(256, 256, 256, 0.8)";c.style.zIndex=5;c.style.display="none";c.style.lineHeight="";c.style.position="absolute";c.style.padding="5px";c.style.boxShadow="3px 5px 4px #aeaeae";var d=document.createElement("div");d.classList.add("row");var e=document.createElement("div");e.classList.add("col-xs-12");
d.appendChild(e);for(var f=0;f<a.description.length;f++){let c=document.createElement("div");c.classList.add("row");let d=document.createElement("div");d.classList.add("col-xs-6");let l=a.description[f].split(":#:#:");d.innerHTML=JSON.stringify(l[0]);d.title="Click to launch site in separate Tab";d.addEventListener("click",function(a,b){return function(a){loadExtUrl(b)}}(event,a.name));let m=document.createElement("div");m.classList.add("col-xs-3");var g=document.createElement("IMG");g.src="/static/icons/copy.png";
g.height="14";g.title="Copy Password";g.addEventListener("click",function(c,d){return function(c){copytexttocbandhighlight(d,"Password copied",c);c.target.src="/static/icons/copied.png";let e=document.getElementById("dot-"+b);null!=e&&1==a.description.length&&(e.style.display="none");setTimeout(function(){c.target.src="/static/icons/copy.png"},6E4)}}(event,l[1]));m.appendChild(g);g=document.createElement("div");g.classList.add("col-xs-3");let n=document.createElement("IMG");n.src="/static/icons/eye-close-up.png";
n.height="14";n.title="Show Password";n.addEventListener("click",function(a,b){return function(a){displaybuttonbehavior(a,b)}}(event,l[1]));g.appendChild(n);c.appendChild(d);c.appendChild(m);c.appendChild(g);e.appendChild(c)}c.appendChild(d);d=document.getElementById("dot-"+b);null!=d&&(e=parseFloat(d.style.left.split("%")[0])*parseInt(window.innerWidth)/100,f=parseFloat(d.style.top.split("%")[0])*parseInt(window.innerHeight)/100,e>window.innerWidth/2&&(c.style.right="5px"),f>window.innerHeight/2&&
(c.style.bottom="5px"),c.style.display="block",d.appendChild(c));document.addEventListener("click",function(a){a.stopPropagation();a=document.getElementsByClassName("dot-popup-vault");for(var b=0;b<a.length;b++)"none"!=a[b].style.display&&(a[b].style.display="none")})}
function setvaultpagebehaviour(){document.getElementById("post-button").title="Add credential to vault";document.getElementById("vault-button").onclick=null;document.getElementById("vault-button").title="";document.getElementById("red-privacy-button").src="/static/icons/search-40.png";document.getElementById("red-privacy-button").onclick=null;document.getElementById("red-privacy-button").title="Search vault";document.getElementById("red-privacy-button").addEventListener("click",function(a){a.stopPropagation();
document.getElementById("vault-search-input").style.zIndex=10;document.getElementById("vault-search-input").style.visibility="visible";a=function(){document.getElementById("vault-search-input").style.visibility="hidden"};document.body.removeEventListener("click",a);document.body.addEventListener("click",a)});document.getElementById("vault-search-input").addEventListener("input",function(a){stopDefaultBackspaceBehaviour(a);null!=searchtimeoutid&&clearTimeout(searchtimeoutid);searchtimeoutid=setTimeout(function(a){displayvaultdataasdots(originaldata)},
200)});document.getElementById("vault-search-input").addEventListener("click",function(a){a.stopPropagation()});document.getElementById("post-button").onclick=null;document.getElementById("post-button").removeEventListener("click",addpostfunction);document.getElementById("post-button").addEventListener("click",function(){createAddInputOnForeGroundDiv()})}
function createVaultKeyInputOnForeGroundDiv(a,b){console.log("will show vault key input. clearing splash timeout");document.getElementById("displayloadingcontainer").style.display="none";b=document.getElementById("app-flk");var c=document.createElement("div");c.setAttribute("id","vaultkeyinputholder");c.style.position="fixed";c.style.zIndex="5000";c.style.left="50%";c.style.top="50%";c.style.width="50%";c.style.height="50%";c.style.backgroundColor="#dbdbdb";c.style.boxShadow="2px 3px 1px #cecece";
c.style.opacity=.9;c.style.transform="translate(-50%, -50%)";var d=document.createElement("span");d.style.position="fixed";d.style.left="50%";d.style.top="50%";d.style.width="400px";d.style.transform="translate(-50%, -50%)";b.style.backgroundColor="#c2c2c2";var e=document.createElement("input");e.type="password";e.id="newauthvaultkey";e.style.height="35px";e.style.margin="2px";e.style.border="0px";e.style.width="250px";600>window.innerWidth&&(e.style.width="130px");e.style.padding="5px";e.style.fontSize=
"16px";e.style.color="#494949";e.style.position="fixed";e.style.left="50%";e.style.top="50%";e.style.transform="translate(-50%, -50%)";e.style.backgroundColor="#ffffff";e.placeholder="Vault Key";e.autocomplete="off";e.addEventListener("input",function(){document.getElementById("newauth-notification").innerHTML="";5<document.getElementById("newauthvaultkey").value.length?document.getElementById("newauthvksubmitbtn").style.visibility="visible":document.getElementById("newauthvksubmitbtn").style.visibility=
"hidden"});var f=document.createElement("input");f.type="button";f.id="newauthvksubmitbtn";f.value="Enter";f.style.visibility="hidden";f.style.display="inline-block";f.style.height="35px";f.style.margin="2px";f.style.float="right";f.style.padding="5px";f.style.color="#efefef";f.style.backgroundColor="#3498db";var g=document.createElement("div");g.style.position="fixed";g.id="newauth-notification";g.style.left="50%";g.style.top="80%";g.style.transform="translate(-50%)";g.innerHTML="Please enter your vault key.";
null==document.getElementById("newauthvaultkey")&&(f.addEventListener("click",function(){vaultkey=document.getElementById("newauthvaultkey").value;try{originaldata=sjcl.decrypt(vaultkey,a),displayvaultdataasdots(originaldata)}catch(h){null!=document.getElementById("newauth-notification")&&(document.getElementById("newauthvaultkey").value="",document.getElementById("newauthvaultkey").borderColor="red",document.getElementById("newauth-notification").innerHTML="",document.getElementById("newauth-notification").innerHTML=
"Invalid Vault key. Please try again")}}),e.addEventListener("keydown",function(b){if(13===b.keyCode||9===b.keyCode){vaultkey=document.getElementById("newauthvaultkey").value;try{originaldata=sjcl.decrypt(vaultkey,a),displayvaultdataasdots(originaldata)}catch(k){null!=document.getElementById("newauth-notification")&&(document.getElementById("newauthvaultkey").value="",document.getElementById("newauthvaultkey").borderColor="red",document.getElementById("newauth-notification").innerHTML="",document.getElementById("newauth-notification").innerHTML=
"Invalid Vault key. Please try again")}}}),d.appendChild(e),d.appendChild(f),c.appendChild(d),c.appendChild(g),b.appendChild(c))}
function createAddInputOnForeGroundDiv(){var a=[{name:"siteUrl",description:"Site URL or name"},{name:"siteuser",description:"User name or public key"},{name:"sitepwd",description:"Password or private key",type:"password"},{name:"sitedesc",description:"Details about this entry (optional)"},{name:"sitename",description:"Name to use for this entry (optional)"}],b=document.getElementById("app-flk"),c=document.createElement("div");c.setAttribute("id","vaultaddinputholder");c.style.position="fixed";c.style.zIndex=
"5000";c.style.left="50%";c.style.top="50%";if(600>window.innerWidth||600>window.innerHeight)c.style.width="90%";c.style.width="50%";c.style.height="50%";c.style.backgroundColor="#dbdbdb";c.style.boxShadow="2px 3px 1px #cecece";c.style.transform="translate(-50%, -50%)";var d=document.createElement("h4");d.style.position="fixed";d.style.left="50%";d.style.transform="translate(-50%)";d.appendChild(document.createTextNode("Add Credential to vault"));c.appendChild(d);d=document.createElement("span");
d.innerHTML='\x3cimg width\x3d"16" height\x3d"16" src\x3d"/static/icons/cross-sign.png"/\x3e';d.style.float="right";d.style.padding="8px";d.style.opacity=.5;d.style.top="0px";d.style.display="inline-block";d.style.cursor="default";d.addEventListener("mouseover",function(a){a.target.style.opacity=.8});d.addEventListener("mouseout",function(a){a.target.style.opacity=.5});d.addEventListener("click",function(a){a.stopPropagation();a.preventDefault();$("#vaultaddinputholder").fadeOut(500);removediv(document.getElementById("vaultaddinputholder"))});
c.appendChild(d);d=document.createElement("div");d.style.position="fixed";d.id="newauth-notification";d.style.display="none";d.style.left="50%";d.style.top="80%";d.style.transform="translate(-50%)";d.innerHTML="Please check your input.";var e=document.createElement("div");e.classList.add("container");e.style.position="fixed";e.style.left="50%";e.style.top="50%";e.style.width="60%";if(600>window.innerWidth||600>window.innerHeight)e.style.width="90%";e.style.transform="translate(-50%, -50%)";for(var f=
0;f<a.length;f++){var g=document.createElement("div");g.classList.add("row");var h=document.createElement("div");h.classList.add("col-xs-12");var k=document.createElement("input");k.classList.add("form-control");k.classList.add("input-md");k.setAttribute("type","undefined"===typeof a[f].type||null==a[f].type?"text":a[f].type);k.setAttribute("id",a[f].name);k.setAttribute("placeholder",a[f].description);k.setAttribute("width","50%");h.appendChild(k);g.appendChild(h);e.appendChild(g)}g=document.createElement("div");
g.classList.add("row");h=document.createElement("div");h.classList.add("col-xs-12");h.classList.add("text-center");f=document.createElement("input");f.setAttribute("id","vlt-add-button");f.classList.add("btn");f.style.marginTop="15px";f.classList.add("btn-primary");f.classList.add("btn-md");f.type="button";f.value="Submit";f.addEventListener("click",function(b){addnewcredentialtovault(a)},!1);h.appendChild(f);g.appendChild(h);e.appendChild(g);c.appendChild(e);c.appendChild(d);b.appendChild(c)}
function addnewcredentialtovault(a){for(var b="{",c=0;c<a.length;c++){var d=document.getElementById(a[c].name).value;null!=d&&0<d.length&&(b+='"'+a[c].name+'": "'+d+'"',b+=",")}b=(b+"}").replace(",}","}");var e=JSON.parse(originaldata);e.push(JSON.parse(b));a=encryptdatawithstretchedkey(JSON.stringify(e),vaultkey,rndsalt,rnditer);var f=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");f.open("POST","/secure/adduserdata",!1);f.withCredentials=!0;f.setRequestHeader("Content-Type",
"application/json");f.onreadystatechange=function(){if(4==f.readyState&&200==f.status){$("#vaultaddinputholder").fadeOut(500);removediv(document.getElementById("vaultaddinputholder"));var a=document.getElementsByClassName("dot-vault");if(null!=a&&0<a.length)for(var b=0;b<a.length;b++)removediv(a[b]);displayvaultdataasdots(JSON.stringify(e))}};f.send(JSON.stringify({group:"sites",salt:rndsalt,iterations:rnditer,data:a,sequence:rndseq,createdate:rndcrdate}))}
function populatetopicowner(a){var b=new XMLHttpRequest;b.onreadystatechange=function(){if(4==b.readyState&&200==b.status){var a=b.responseText;document.getElementById("topic-admin").innerText="This page created by: "+a}};b.open("GET","/newauth/api/gettopicowner/"+a,!0);b.withCredentials=!0;b.setRequestHeader("Content-Type","application/json");b.send(null)}
function rotatetopicdemoimage(a){var b=a.getAttribute("data-img-index");if("1"==b){a.setAttribute("data-img-index","100");var c=document.getElementById("dot-img-spinner-label").innerHTML;c=c.replace("15","100");document.getElementById("dot-img-spinner-label").innerHTML=c;document.getElementById("dot-img-spinner").src="/static/icons/d-ui-100-1.png"}"100"==b&&(a.setAttribute("data-img-index","500"),c=document.getElementById("dot-img-spinner-label").innerHTML,c=c.replace("100","500"),document.getElementById("dot-img-spinner-label").innerHTML=
c,document.getElementById("dot-img-spinner").src="/static/icons/d-ui-500-1.png");"500"==b&&(a.setAttribute("data-img-index","1"),c=document.getElementById("dot-img-spinner-label").innerHTML,c=c.replace("500","15"),document.getElementById("dot-img-spinner-label").innerHTML=c,document.getElementById("dot-img-spinner").src="/static/icons/d-ui-1.png");return!1}
function displaytopicnewmemberpopup(){var a=document.getElementById("topic-welcome-overlay");if(null==a){a=document.createElement("div");a.setAttribute("id","topic-welcome-overlay");document.body.appendChild(a);var b=document.createElement("div");b.classList.add("container");b.classList.add("v-center");var c=document.createElement("div");c.classList.add("row");var d=document.createElement("div");d.classList.add("col-md-8");d.classList.add("col-md-offset-2");var e=document.createElement("div");e.classList.add("panel");
e.classList.add("panel-default");e.setAttribute("id","createuser-overlay-content");var f=document.createElement("h3");f.appendChild(document.createTextNode(""));f.style.color="#737373";f.style.fontWeight="900";e.appendChild(f);f=document.createElement("span");f.innerHTML='\x3cimg width\x3d"16" height\x3d"16" src\x3d"/static/icons/cross-sign.png"/\x3e';f.style.float="right";f.style.padding="8px";f.style.opacity=.5;f.style.top="0px";f.style.display="inline-block";f.style.cursor="default";f.addEventListener("mouseover",
function(a){a.target.style.opacity=.8});f.addEventListener("mouseout",function(a){a.target.style.opacity=.5});f.addEventListener("click",function(a){a.stopPropagation();a.preventDefault();$("#topic-welcome-overlay").fadeOut(500);removediv(document.getElementById("topic-welcome-overlay"))});d.appendChild(f);f=document.createElement("p");f.classList.add("lead");f.setAttribute("id","createuser-flake-text-header");f.appendChild(document.createTextNode(topicname+" page on Newauth"));f.style.color="#737373";
f.style.fontWeight="700";e.appendChild(f);f=document.createElement("div");f.classList.add("row");var g=document.createElement("div");g.classList.add("col-sm-8");g.classList.add("col-sm-offset-2");var h=document.createElement("p");h.classList.add("text-muted");h.setAttribute("id","createuser-flake-text");h.appendChild(document.createTextNode("Welcome to the "+topicname+" dots page. Dots UI is a unique way to interact with people and ideas. There is no need to install any app or create a Newauth account to use its basic features."));
h.style.color="#878787";h.style.paddingLeft="8px";h.style.paddingRight="8px";h.style.fontWeight="600";var k=document.createElement("p");k.classList.add("text-muted");k.setAttribute("id","createuser-flake-text");k.appendChild(document.createTextNode("Enter your name or an alias to start."));k.style.color="#878787";k.style.fontWeight="500";g.appendChild(h);g.appendChild(k);f.appendChild(g);e.appendChild(f);f=document.createElement("div");f.classList.add("row");f.classList.add("text-center");document.createElement("div").setAttribute("id",
"cu-flake-can");e.appendChild(f);f=document.createElement("div");f.classList.add("panel-body");f.classList.add("panel-word-wrap");g=document.createElement("div");g.classList.add("row");h=document.createElement("div");h.classList.add("col-md-8");h.classList.add("col-xs-9");h.classList.add("col-md-offset-2");h.setAttribute("id","create-flk-input-holder");g.appendChild(h);f.appendChild(g);k=document.createElement("input");k.setAttribute("type","text");k.setAttribute("id","topic-user-name-input");k.setAttribute("placeholder",
"Name or Alias");k.setAttribute("autofocus","true");k.classList.add("form-control");k.classList.add("input-md");k.addEventListener("click",function(a){a.stopPropagation()});k.addEventListener("input",function(a){a.stopPropagation();2<document.getElementById("topic-user-name-input").value.length?"none"==document.getElementById("flk-send-button").style.display&&(document.getElementById("flk-send-button").style.display="block"):document.getElementById("flk-send-button").style.display="none"},!1);k.style.color=
"#646464";var l=document.createElement("input");l.setAttribute("id","flk-send-button");l.classList.add("btn");l.classList.add("btn-primary");l.classList.add("btn-md");l.conversationID="";l.changestarttime="";l.type="button";l.value="Join";l.addEventListener("click",function(a){addnametotopicmembers(a)},!1);var m=document.createElement("div");m.classList.add("col-sm-2");m.classList.add("col-xs-3");g.appendChild(m);h.appendChild(k);m.appendChild(l);f.appendChild(g);e.appendChild(f);d.appendChild(e);
c.appendChild(d);b.appendChild(c);a.appendChild(b);$("#topic-user-name-input").focus()}settimeoutid=setTimeout(function(){$("#topic-welcome-overlay").fadeIn("slow")},300)}function displayjointimeclock(a){a=1E3*parseInt(a);document.getElementById("jointimeleftdisplay").innerHTML=converttimediffmstocalendar(a)+" left to join";document.getElementById("jointimeleftdisplay").style.display="block"}
function addnametotopicmembers(a){a.stopPropagation();var b=document.getElementById("topic-user-name-input").value,c=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");c.onreadystatechange=function(){if(4==c.readyState&&200==c.status){$("#topic-welcome-overlay").fadeOut(500);removediv(document.getElementById("topic-welcome-overlay"));posts[0].text=b;posts[0].tags=[b,"joined"];if("undefined"!=typeof posts[0].data){var a=JSON.parse(posts[0].data);null!=a&&"undefined"!=typeof a.text&&
(a.text=b+" joined",a.tags[0]=b,posts[0].data=JSON.stringify(a))}null!=document.getElementById("dot-popup-0")?document.getElementById("dot-popup-text-0").innerHTML=b+" joined":(a=document.getElementById("dot-0"),null!=a&&showpostdatainpopup(posts[0],0,null,!1,a.style.left,a.style.top))}};c.open("POST","/newauth/api/addnameoftopicmember",!1);c.withCredentials=!0;c.setRequestHeader("Content-Type","application/json");c.send(JSON.stringify({topic:topicname,giveout:b,crTime:posts[0].crtime}))}
function displayRadialText(a,b){function c(a){360<a&&(a-=360);var b,c=Math.PI/180*a;a<=D&&(b=(g-u)/Math.cos(c));a>D&&a<=180-D&&(b=Math.abs((h-65)/Math.sin(c)));a>180-D&&a<=180+D&&(b=Math.abs((g-u)/Math.cos(c)));a>180+D&&a<=360-D&&(b=Math.abs((h-u)/Math.sin(c)));a>360-D&&360>=a&&(b=Math.abs((g-u)/Math.cos(c)));return b}function d(a){document.getElementsByClassName("dot");var b=u;console.log("realdotsz "+b);for(var d=0,e=0,f=p;f<=A;f+=1.618*b){var g=[];g.push("processing radius "+f);for(var h=Math.ceil(180/
Math.PI*Math.atan(1.8*b/f))+1,k=a;k<a+360;k+=1.1*h){var m=f+1.8*b,n=k,q=k+1.1*h;360<n&&(n-=360);if(360<q)break;c(n);c(q);var v=c((n+q)/2);(f+m)/2<v?(l.push(parseInt(n)+":"+parseInt(q)+"::"+parseInt(f)+":"+parseInt(m)),m=parseInt(f),r[m]="undefined"!=typeof r[m]?r[m]+1:1,d++):e++}g.push("processed ")}console.log("no of cells "+d+" skipped "+e)}function e(a,b){var c=document.getElementsByClassName("dot");setTimeout(function(){c[a].classList.contains("centerdot")||(c[a].style.backgroundColor=b)},500)}
function f(a){var b=document.getElementsByClassName("dot");setTimeout(function(){b[a].classList.contains("centerdot")||b[a].classList.remove("shake")},1E3)}var g=window.innerWidth/2,h=window.innerHeight/2,k=[],l=[],m=2*a.length;new Set;new Map;var n=180;n=parseInt(1.2/3.6*Math.min(window.innerHeight,window.innerWidth));var p=n/2+.06*n;console.log("Computed centerdot size "+n+" minradiius "+p);var r={},q=0,v=new Set,w=0;20>a.length&&(w=20);20<=a.length&&50>a.length&&(w=50);50<=a.length&&(w=parseInt(a.length+
50));var u=parseInt(Math.sqrt((window.innerWidth*window.innerHeight-Math.pow(2*p,2))/w)/3.2);console.log("max dot size [theoretical] "+u);u>n/8&&(u=parseInt(n/8));console.log("max dot size [practical] "+u);var D=parseInt(180*Math.atan((h-2*u)/(g-2*u))/Math.PI);console.log("max diagonal at degree "+D);var A=parseInt((g-2*u)/Math.cos(Math.atan((h-2*u)/(g-2*u))));console.log("max diagonal "+A);w=document.createElement("div");w.innerHTML="center";w.style.color="white";w.style.fontSize="9px";w.style.position=
"absolute";w.style.left=g-n/2+"px";w.style.top=h-n/2+"px";w.style.maxWidth=n+"px";w.style.width=n+"px";w.id="100000";w.style.backgroundColor="#565656";w.style.zIndex=m-B;w.classList.add("dot");w.classList.add("centerdot");b&&document.body.appendChild(w);for(var B=0;B<a.length;B++){let A;if("undefined"!=typeof a[B].data&&null!=a[B].data&&0<a[B].data.length)try{var I=JSON.parse(a[B].data);a[B].data=I}catch(H){console.error(" Exception caught while parsing JSON:",info.data),console.error(" Error details:",
H)}null!=a[B].category?A=a[B].category:null!=a[B].data?A=null!=a[B].data.category?a[B].data.category:JSON.stringify(a[B].data):null!=a[B].summary?A=a[B].summary:null!=a[B].text&&(A=a[B].text);w=A;n=document.createElement("div");n.style.color="white";n.style.fontSize="9px";w="undefined"!=typeof a[B].datahash&&null!=a[B].datahash&&0<a[B].datahash.length?hashCodeSHA(a[B].datahash,!0):"undefined"!=typeof w?hashCodeSHA(w):hashCodeSHA(Math.floor(1E16*Math.random()).toString());var z=w.num,C=z%360;q=Math.PI/
180*C;var F=u/2;q=Math.sqrt(Math.pow(g-F,2)+Math.pow(h-F,2));F=[];q=c(C);0==Object.keys(l).length&&(d(0),console.log("safelocations size "+Object.keys(l).length+" dots per radius "+JSON.stringify(r)));q=parseInt(Object.keys(l).length/2);0<q%2&&q++;var E=z%parseInt(Object.keys(l).length/3),G=0;6<z%10&&(E+=parseInt(q/2));for(E>=Object.keys(l).length&&(E=Object.keys(l).length-2);v.has(E);){console.log(B+" conflict with locidx ");if(5<G)break;E=l.length-G;G++}0>E&&(E=l.length-1);"undefined"!=typeof l[E]?
(C=l[E].split("::")[0],z=l[E].split("::")[1],q=parseInt(C.split(":")[1]),parseInt(C.split(":")[1])<parseInt(C.split(":")[0])&&(q+=360),C=(parseInt(C.split(":")[0])+q)/2,360<C&&(C-=360),parseInt(z.split(":")[1]),parseInt(z.split(":")[0]),radius=(parseInt(z.split(":")[1])+parseInt(z.split(":")[0]))/2,z=Math.pow(10,E/l.length),E<r[Object.keys(r)[0]]?(C-=z,radius-=z):radius+z<c(C+z)?(C+=z,radius+=z):radius+z/2<c(C+z)&&(C+=z/2,radius+=z/2)):(console.log("locidx "+E+" is  undefined .. safelocations size "+
Object.keys(l).length),q=z%360,0<q&&90>=q&&(C=D),90<q&&180>=q&&(C=180-D),180<q&&270>=q&&(C=180+D),270<q&&360>=q&&(C=360-D),q=c(C),radius=parseInt(Math.max(p,z%q)),radius<1.3*p&&(radius+z%(3*u)<q?radius+=z%(3*u):radius+z%(2*u)<q?radius+=z%(2*u):radius+z%u<q&&(radius+=z%u)),console.log(B+" hardcoded location angle "+C+" rad "+radius));q=Math.PI/180*C;z=l.slice(0,E);G=l.slice(E+1);l=z.concat(G);z=parseInt(g+radius*Math.cos(q));q=parseInt(h-radius*Math.sin(q));n.style.position="absolute";n.style.left=
parseInt(z-u/2)+"px";n.style.top=parseInt(q-u/2)+"px";n.id=B;n.style.maxWidth=u+"px";n.style.backgroundColor="#565656";n.style.zIndex=m-B;n.classList.add("dot");F.push("locidx angle radius -- "+E+" ::"+parseInt(C)+":"+parseInt(radius));n.title=n.id+JSON.stringify(F);F=getpastelcolor("#"+w.hex.substring(0,6));"undefined"!=typeof b&&b&&(document.body.appendChild(n),document.getElementById("elemcount").innerHTML=a.length,B==a.length-1&&document.addEventListener("click",function(){for(var a=document.getElementsByClassName("dot"),
b=0;b<a.length;b++)a[b].classList.contains("centerdot")||(a[b].classList.add("shake"),f(b))}),e(B,F));k.push({left:parseInt(z-u/2)+"px",top:parseInt(q-u/2)+"px",width:u+"px",dotmaxsize:u,pcolor:F,color:"#"+w.hex.substring(0,6)})}l=[];console.log("safe positions map cleared. new size "+l.length);return k}function hashCode(a){for(var b=0,c=0;c<a.length;c++)b=(b<<5)-b+a.charCodeAt(c),b&=b;return b}
function hashCodeSHA(a,b){var c;if("undefined"==typeof b||0==b)a=1E3<a.length?sjcl.hash.sha256.hash(a.substring(0,1E3)):sjcl.hash.sha256.hash(a),a=sjcl.codec.hex.fromBits(a);null!=a&&(c=parseInt(a.substring(a.length-10,a.length),16));return{hex:a,num:c}}var rgbmap;function getpastelcolor(a){null==rgbmap&&creatergbmapofpastels();return findclosestrgbfrommap(a)}
function creatergbmapofpastels(){rgbmap={};for(var a=" F7F6CF ; B6D8F2 ; F4CFDF ; 5784BA ; 9AC8EB ; CCD4BF ; E7CBA9 ; EEBAB2 ; F5F3E7 ; F5E2E4 ; F5BFD2 ; E5DB9C ; D0BCAC ; BEB4C5 ; E6A57E ; 218B82 ; 9AD9DB ; E5DBD9 ; 98D4BB ; EB96AA ; C6C9D0 ; C54B6C ; E5B3BB ; C47482 ; D5E4C3 ; F9968B ; F27348 ; 26474E ; 76CDCD ; 2CCED2 ; B8E0F6 ; A4CCE3 ; 37667E ; DEC4D6 ; 7B92AA ; DDF2F4 ; 84A6D6 ; 4382BB ; E4CEE0 ; A15D98 ; DC828F ; F7CE76 ; E8D6CF ; 8C7386 ; 9C9359 ; F4C815 ; F9CAD7 ; A57283 ; C1D5DE ; DEEDE6 ; E9BBB5 ; E7CBA9 ; AAD9CD ; E8D595 ; 8DA47E ; CAE7E3 ; B2B2B2 ; EEB8C5 ; DCDBD9 ; FEC7BC ; FBECDB ; F3CBBD ; 90CDC3 ; AF8C72 ; 938F43 ; B8A390 ; E6D1D2 ; DAD5D6 ; B2B5B9 ; 8FA2A6 ; 8EA4C8 ; C3B8AA ; DEDCE4 ; DB93A5 ; C7CDC5 ; 698396 ; A9C8C0 ; DBBC8E ; AE8A8C ; 7C98AB ; C2D9E1 ; D29F8C ; D9D3D2 ; 81B1CC ; FFD9CF ; C6AC85 ; D9C2BD ; A2C4C6 ; 82B2B8 ; 874741 ; CA9C95 ; 40393E ; E5E4E5 ; 897C87 ; 46302B ; 76504E ; D3CCCA ; A37E7E ; 86736C ; AD192A ; E4B78F ; F1E8EA ; D88D96 ; EAB1B9 ; F38C10 ; A7763B ; CCD7D8 ; 4C482E ; D2B6BA ; BE3F12 ; 7DB0CD ; C0B5AB ; 79553F ; 91BA96 ; A65111 ; DDAA00 ; 7C5D3D ; 85AAAA ; 173F4E ; D82315 ; 2F1710 ; 425164 ; DABB96 ; 899FB6 ; DBB657 ; 86553F ; C8C2D0 ; E45C54 ; 90A375 ; F9BB9D ; FFDA43 ; 756382 ; E2C274 ; 9CA8B5 ; FFE75D ; D24970 ; 32657C ; 669BB7 ; CF8145 ; 753516 ; AF6F33 ; 9DB4BA ; 210E0D ; E2D2C1 ; CA8459 ; DDB396 ; DDDFE3 ; 422523 ; 954D34 ; 843619 ; B87730 ; 1B2625 ; DAD0CE ; 748991 ; 64A532 ; B09647 ; 450309 ; DEE2E3 ; 7B5536 ; 446C04 ; F8DF96 ; 977D77 ; 301F1A ; 5E301F ; 8E3229 ; AEBB35 ; 2F1D16 ; D0BDAA ; A37537 ; FF415B ; BC7F37 ; 352C20 ; EAE8E8 ; 64AA71 ; F64900 ; CB8A2D ; 262416 ; DDDDDE ; 90B274 ; B08D7E ; 6C74A4 ; BBB9BC ; 5E2424 ; 95BB9A ; 652F20 ; 74C85D ; 2D3538 ; 57818A ; D54C2E ; D09150 ; DEBD9B ; 3C2320 ; 955132 ; EBEBEF ; B08138 ; 784928 ; 382918 ; DDD4D3 ; AE8A75 ; F08E88 ; 422D09 ; 468F5E ; AC7C36 ; E3E2DF ; E1A624 ; 317AC1 ; 384454 ; D4D3DC ; AD956B ; F38C10 ; A7763B ; CCD7D8 ; 4C482E ; D2B6BA ; C5853D ; 99372E ; DAD4D9 ; 391C19 ; B27E83 ; 4F3B2B ; 7C6619 ; B8B5AD ; BE0309 ; 93C1D5 ".split(";"),b=
0;b<a.length;b++){var c=hexToRgb1(a[b].trim());null!=c&&(rgbmap[a[b].trim()]=c)}}function findclosestrgbfrommap(a){a=a.replace("#","");var b=hexToRgb1(a),c=-1,d;Object.keys(rgbmap).forEach((a,f)=>{f=calculatedistance(b,rgbmap[a]);if(0>c||f<c)0<c&&(d="#"+a),c=f});return d}function calculatedistance(a,b){return Math.pow(a.r-b.r,2)+Math.pow(a.g-b.g,2)+Math.pow(a.b-b.b,2)}
function hexToRgb1(a){return(a=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(a))?{r:parseInt(a[1],16),g:parseInt(a[2],16),b:parseInt(a[3],16)}:null};