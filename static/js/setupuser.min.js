'use strict';var currentfinalizeduserimagecount,totalimagecount,verificationcode,avatartimerinterval,loggedinusername,typingTimer,inmanage=!1;const doneTypingInterval=1500;function minimumentropy(){var a=factorial(6);a=getBaseLog(2,Math.pow(16384,6)*a);return parseFloat(Math.round(100*a)/100).toFixed(2)}
function currententropy(){if(2>currentfinalizeduserimagecount)return"--";var a=6<currentfinalizeduserimagecount?factorial(totalimagecount)/factorial(totalimagecount-currentfinalizeduserimagecount):factorial(currentfinalizeduserimagecount);a=getBaseLog(2,Math.pow(16384,currentfinalizeduserimagecount)*a);return parseFloat(Math.round(100*a)/100).toFixed(2)}
function maximumentropy(){var a=factorial(totalimagecount)/factorial(totalimagecount-6);a=getBaseLog(2,Math.pow(16384,6)*a);return parseFloat(Math.round(100*a)/100).toFixed(2)}function getBaseLog(a,b){return Math.log(b)/Math.log(a)}function factorial(a){return 0===a?1:a*factorial(a-1)}
function displayAuthScale(){var a=document.querySelector("#canvasdiv"),b=createHiDPICanvas("600","200");a.appendChild(b);a=b.getContext("2d");b.style.position="relative";a.clearRect(0,0,b.width,b.height);a.beginPath();a.moveTo(20,b.height-40);a.lineTo(b.width-20,b.height-40);a.lineTo(b.width-20,40);a.fillStyle="#c2c2c2";a.fillStyle="#c2c2c2";a.fill();a.beginPath();a.moveTo(20,b.height-40);a.quadraticCurveTo(b.width-20,b.height-40,b.width-20,40);a.fillStyle="#ffffff";a.fillStyle="#ffffff";a.fill();
a.font="9px Arial";a.fillStyle="#737373";for(var c=1;17>c;c++)a.fillText(c,20+c*(b.width-20)/16,b.height-80/3);a.font="9px Arial";a.fillText("16",b.width-20,b.height-80/3);a.fillText("6.3 M",b.width-20-5,40);a.fillStyle="#d00";6==currentfinalizeduserimagecount?a.fillText("You are here",20+currentfinalizeduserimagecount*(b.width-20)/16,b.height-40/7):a.fillText("You are here",20+currentfinalizeduserimagecount*(b.width-20)/16,b.height-40/3);a.font="9px Arial";a.fillText("Min",20+6*(b.width-20)/16,b.height-
40/3);a.fillText("Max",b.width-20-5,b.height-40/3);a.font="12px Arial";a.fillStyle="#0a0a0a";a.fillText("Boxed images",20+7.2*(b.width-20)/16,b.height-5)}
function togglesearchbyalias(){if(confirm("Are you sure you want to allow others to search you by your alias? ")){var a=new XMLHttpRequest;a.onreadystatechange=function(){4==a.readyState&&200==a.status?(document.getElementById("aliasvisiblecheck").checked=!0,document.getElementById("fullnamevisiblecheck").checked=!1,document.getElementById("giveoutspan").innerText="Alias",setupUser()):alert(a.responseText)};a.open("POST","/newauth/api/search/addalias",!1);a.setRequestHeader("Content-Type","application/json");
var b=JSON.stringify({username:document.getElementById("usernameinput").value,alias:document.getElementById("aliasinput").value,firstname:document.getElementById("firstnameinput").value,lastname:document.getElementById("lastnameinput").value});a.send(b);return!0}return!1}
function togglesearchbyflake(){if(confirm("Are you sure you want to go dark? No one will be able to search you by your name or alias.")){var a=new XMLHttpRequest;a.onreadystatechange=function(){4==a.readyState&&200==a.status?(document.getElementById("aliasvisiblecheck").checked=!1,document.getElementById("fullnamevisiblecheck").checked=!1,document.getElementById("giveoutspan").innerText="Flake",setupUser()):alert(a.responseText)};a.open("POST","/newauth/api/search/removenameandalias",!1);a.setRequestHeader("Content-Type",
"application/json");var b=JSON.stringify({username:document.getElementById("usernameinput").value,alias:document.getElementById("aliasinput").value,firstname:document.getElementById("firstnameinput").value,lastname:document.getElementById("lastnameinput").value});a.send(b);return!0}return!1}
function togglesearchbyfullname(){if(confirm("Are you sure you want to allow others to search you by your name?")){var a=new XMLHttpRequest;a.onreadystatechange=function(){4==a.readyState&&200==a.status?(document.getElementById("fullnamevisiblecheck").checked=!0,document.getElementById("giveoutspan").innerText="Full Name",setupUser()):alert(a.responseText)};a.open("POST","/newauth/api/search/addname",!1);a.setRequestHeader("Content-Type","application/json");var b=JSON.stringify({username:document.getElementById("usernameinput").value,
alias:document.getElementById("aliasinput").value,firstname:document.getElementById("firstnameinput").value,lastname:document.getElementById("lastnameinput").value});a.send(b);return!0}return!1}
function togglesearchbyemailphone(){if(confirm("Are you sure you want to allow others to search you by your email and phone?")){var a=new XMLHttpRequest;a.open("POST","/newauth/api/search/addrecoveryoptions",!1);var b=[],c=document.getElementsByClassName("current-recovery-email");if(c)for(var d=0;d<c.length;d++)b.push(c[d].getElementsByTagName("p")[0].innerText.trim());c=[];var e=document.getElementsByClassName("current-recovery-phone");if(e)for(d=0;d<e.length;d++){var g=JSON.parse('{"number":"'+
e[d].getElementsByTagName("p")[0].innerText.trim()+'"}');c.push(g)}a.setRequestHeader("Content-Type","application/json");b=JSON.stringify({username:document.getElementById("usernameinput").value,emails:b,phones:c});document.getElementById("emailphonevisiblecheck").checked=!0;a.send(b);setupUser();return!0}return!1}
function addemail(){var a=document.getElementById("emailinput").value;if(ValidateEmail(a)){document.getElementById("verificationModeDetail").innerHTML="email: "+a;var b=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");b.onreadystatechange=function(){4==b.readyState&&200==b.status&&(verificationcode=JSON.parse(b.responseText).vercode,$("#verifyModal").modal("show"))};b.open("POST","/newauth/api/addemail",!0);b.setRequestHeader("Content-Type","application/json");a=JSON.stringify({username:document.getElementById("usernameinput").value,
emails:document.getElementById("emailinput").value});b.send(a)}return!1}function deleterecoveryemail(a){alert("Not implemented "+a)}
function addphone(){var a=document.getElementById("phoneinput").value;if(ValidatePhone(a)){document.getElementById("verificationModeDetail").innerHTML="SMS: "+phone;var b=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");b.onreadystatechange=function(){4==b.readyState&&200==b.status&&(verificationcode=JSON.parse(b.responseText).vercode,$("#verifyModal").modal("show"))};b.open("POST","/newauth/api/addphone",!0);b.setRequestHeader("Content-Type","application/json");a=JSON.stringify({username:document.getElementById("usernameinput").value,
phones:'{[{"number":"'+document.getElementById("phoneinput").value+'"}]}'});b.send(a)}return!1}
function verifyCode(){document.getElementById("verificationcodeinput").classList.remove("error");var a=document.getElementById("verificationcodeinput").value,b=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");b.onreadystatechange=function(){if(4==b.readyState&&200==b.status){var a=JSON.parse(b.responseText);"VERIFIED"===a.status.statuscode?($("#verifyModal").modal("hide"),setupUser()):document.getElementById("verifyerror").innerHTML="\x3cp class\x3derror\x3e"+a.status.detail+
"\x3c/p\x3e"}};b.open("POST","/newauth/api/verifycode",!0);b.setRequestHeader("Content-Type","application/json");a=JSON.stringify({username:document.getElementById("usernameinput").value,email:document.getElementById("emailinput").value,phone:document.getElementById("phoneinput").value,verificationKeyCode:verificationcode,verificationKeyInput:a});b.send(a);return!1}
function updateUsername(){var a=hashUserForAuthentication(document.getElementById("unu-currentusername").value),b=hashUserForAuthentication(document.getElementById("unu-newusername").value);if(a!==loggedinusername)return console.log("loggedinusername"+loggedinusername+" input user hash "+a),document.getElementById("updateuserfeedback").innerText="Please check the current username entered.",!1;var c=new XMLHttpRequest;c.open("POST","/newauth/api/oktocreateusername",!1);c.setRequestHeader("Content-Type",
"application/json");c.onreadystatechange=function(){if(4==c.readyState&&200==c.status){var d=c.responseText;if(null!=d&&0<d.length){if("DONOTCREATE"==d)return document.getElementById("updateuserfeedback").innerText="This username is already taken. Please choose a different username",!1;if(confirm("You are about to change your username for Newauth. Your new user name is  '"+document.getElementById("unu-newusername").value+"'  Please make a note of this if you need to.")){document.getElementById("updateuserfeedback").innerHTML=
"";var e=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");e.onreadystatechange=function(){if(4==e.readyState&&200==e.status){var a=e.responseText;document.getElementById("updateuserfeedback").innerHTML=a}};e.open("POST","/newauth/api/updateusername",!0);e.setRequestHeader("Content-Type","application/json");d=JSON.stringify({currentusername:a,newusername:b,processcode:document.getElementById("updateuserprocesscode").value});e.send(d)}else document.getElementById("updateuserfeedback").innerText=
"Your username has not been changed."}}};c.send(JSON.stringify({username:b,clientip:""}));return!1}
function populateDeviceDisplayPanel(){var a=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");a.onreadystatechange=function(){if(4==a.readyState&&200==a.status){var b=a.responseText;if(0<b.length){b=JSON.parse(b);0<b.length?document.getElementById("deviceinfodisplaypanel").innerHTML+='\x3cp class\x3d"lead"\x3eYou can restore your device settings to any of the previous settings.\x3c/p\x3e\x3cp\x3e Age is in number of days. Users is the number of Users which have successfully authenticated from this device.\x3c/p\x3e\t\x3chr\x3e':document.getElementById("deviceinfodisplaypanel").innerHTML+=
'\x3cp class\x3d"lead"\x3eNo devices found\x3c/p\x3e';for(var d=0;d<b.length;d++)document.getElementById("deviceinfodisplaypanel").innerHTML+=b[d].useragent,navigator.userAgent.substring(0,45)==b[d].useragent.substring(0,45)&&(b[d].activeJWTId?document.getElementById("deviceinfodisplaypanel").innerHTML+="\x3cp\x3e\x3cmark\x3eCurrent device : Age: "+b[d].ageindays+" Users: "+b[d].attachedusers+"\x3c/mark\x3e\x3c/p\x3e":document.getElementById("deviceinfodisplaypanel").innerHTML+=' \x3cbutton type\x3d"button" class\x3d"btn btn-sm btn-default" onclick\x3d"return swapJWT(\''+
b[d].jwtid+"');\"\x3eID:"+b[d].jwtid.substring(0,8)+" Age: "+b[d].ageindays+" Users: "+b[d].attachedusers+"\x3c/button\x3e"),document.getElementById("deviceinfodisplaypanel").innerHTML+=" \x3chr\x3e"}}};a.open("POST","/newauth/api/devicedataforuser",!0);a.setRequestHeader("Content-Type","application/json");var b=JSON.stringify({flake:loggedinuserflake});a.send(b);document.getElementById("deviceinfodisplaypanel").innerHTML="";return!1}
function swapJWT(a){var b=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");b.onreadystatechange=function(){if(4==b.readyState&&200==b.status){var a=b.responseText;document.getElementById("deviceinfodisplaypanel").innerHTML+=a}};b.open("POST","/newauth/api/changedeviceid",!0);b.setRequestHeader("Content-Type","application/json");a=JSON.stringify({newid:a,flake:loggedinuserflake});b.send(a);return!1}
function manageOrg(a){if(a){var b=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");b.onreadystatechange=function(){if(4==b.readyState&&200==b.status&&b.responseText){var a=b.responseText;null!=a&&0<a.length&&(a=JSON.parse(a),null!=a&&(document.getElementById("orgid").value=a.orgid,document.getElementById("orgtabname").value=a.orgtabname,document.getElementById("orgname").value=a.orgname),$("#manageorgmodal").modal("show"))}};b.open("POST","/newauth/api/getorganizationinfo",
!0);b.setRequestHeader("Content-Type","application/json");var c="";null!=document.getElementById("orgownerflake")&&(c=document.getElementById("orgownerflake").value);a=JSON.stringify({orgid:a,ownerflake:c});b.send(a)}else document.getElementById("orgid").value="",document.getElementById("orgtabname").value="",document.getElementById("orgname").value="",$("#manageorgmodal").modal("show")}
function removeOrg(a,b){if(a){var c=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");c.onreadystatechange=function(){if(4==c.readyState&&200==c.status){var d=c.responseText;if(null!=d&&0<d.length&&(d=JSON.parse(d),null!=d&&(document.getElementById("orgid").value=d.orgid,document.getElementById("orgtabname").value=d.orgtabname,document.getElementById("orgname").value=d.orgname,confirm("Are you sure you want to delete organization "+document.getElementById("orgname").value)))){var g=
window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");g.onreadystatechange=function(){4==g.readyState&&200==g.status&&(removeorgfromsetuppage(a),removeorgfromheader(a))};g.open("POST","/newauth/api/removeorg",!0);g.setRequestHeader("Content-Type","application/json");d=JSON.stringify({orgid:a,orgtabname:document.getElementById("orgtabname").value,status:"Inactive",ownerflake:b});g.send(d)}}};c.open("POST","/newauth/api/getorganizationinfo",!0);c.setRequestHeader("Content-Type",
"application/json");var d=JSON.stringify({orgid:a,ownerflake:b});c.send(d)}}
function updateorg(){if(null==vaultkey||0==vaultkey.length)return createvaultkeyoverlay(),!1;var a=document.getElementById("orgid").value,b=document.getElementById("orgtabname").value,c=document.getElementById("orgname").value;if(null==a||0==a.length)for(var d=document.getElementsByClassName("user-org"),e=0;e<d.length;e++)if(d[e].getAttribute("data-orgname")==c||d[e].innerText==b)return document.getElementById("updateorg-err-message").innerText="Duplicate Org name or tabname not allowed",!1;e=sjcl.ecc.elGamal.generateKeys(384);
d=e.pub.get();var g=e.sec.get();d=sjcl.codec.base64.fromBits(d.x.concat(d.y));g=sjcl.codec.base64.fromBits(g);var f=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");f.onreadystatechange=function(){if(4==f.readyState&&200==f.status){var d=f.responseText,c=d.split(":\x3d")[1];if(null==a||0==a.length)addorgtoheader(c,b),addorgtosetuppage(c,b),addOrgPrivateKeytoUserData(d,g);$("#manageorgmodal").modal("hide")}};f.open("POST","/newauth/api/updateorg",!0);f.setRequestHeader("Content-Type",
"application/json");e="";null!=document.getElementById("orgownerflake")&&(e=document.getElementById("orgownerflake").value);c=JSON.stringify({orgid:a,orgname:c,orgtabname:b,publicKey:d,ownerflake:e,status:"active"});f.send(c);return!1}
function addOrgPrivateKeytoUserData(a,b){null!=b&&0<b.length&&getuserdatafromdb(0,function(c){var d=[];if(null!=c&&0<c.length){if("string"===typeof c&&0>c.indexOf('"'))d.push(c);else if(c=JSON.parse(c),Array.isArray(c))for(var e=0;e<c.length;e++)d.push(c[e]);else d.push(c);c={org:a,privkey:b};pushUniqueToArray(d,c)?otherkeys.push(c):d=[]}if(0<d.length){var g=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");g.open("POST","/secure/adduserdata",!1);g.withCredentials=!0;
g.setRequestHeader("Content-Type","application/json");d=encryptdatawithstretchedkey(JSON.stringify(d),vaultkey,"",0);g.onreadystatechange=function(){4==g.readyState&&200==g.status&&(clearsecureuserdatafromdb("ORGKEY"),console.log("New orgkey successfully updated to userdata."))};g.send(JSON.stringify({data:d,sequence:0}))}else console.log("The Orgkey already existed in user data, not updating...");null!=document.getElementById("vault-key-overlay")&&$("#vault-key-overlay").fadeOut("slow")})}
function pushUniqueToArray(a,b){if(-1===a.findIndex(a=>a.org===b.org))return a.push(b),!0;console.warn("Tried to add duplicate entry to array "+JSON.stringify(b));return!1}
function checkUniqueUsername(a){var b=document.getElementById("cu-username-input").value;if(6>b.length)return document.getElementById("flk-send-button").style.display="block",document.getElementById("flk-send-button").disabled="true",!1;var c=displaybuttonbehavior(a,"Wait ... checking username");fetch("/newauth/api/oktocreateusername",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:hashUserForAuthentication(b),clientip:""})}).then(a=>{if(!a.ok)throw Error("Network response was not ok");
return a.text()}).then(d=>{"OK"==d?(removediv(c),document.getElementById("cu-username-input").value=b,document.getElementById("cu-username-input").placeholder="Minimum 6 symbols",document.getElementById("cu-username-input").style.border="",document.getElementById("flk-send-button").removeAttribute("disabled"),displaybuttonbehavior(a,"Click Create button now.")):(document.getElementById("cu-username-input").style.border="2px solid red",displaybuttonbehavior(a,"Please choose a different username"),
document.getElementById("cu-username-input").value="",document.getElementById("flk-send-button").disabled="true")}).catch(a=>{console.error("Error:",a);document.getElementById("cu-username-input").style.border="2px solid red";document.getElementById("cu-username-input").value="";document.getElementById("cu-username-input").placeholder="Please try later. Network error"})}
function mobileusercreate(a){var b=document.getElementById("createuser-mobile-overlay");if(null==b){var c=function(a){typingTimer=setTimeout(function(){checkUniqueUsername(a)},doneTypingInterval)},d=function(a){clearTimeout(typingTimer)};b=document.createElement("div");b.setAttribute("id","createuser-mobile-overlay");document.body.appendChild(b);var e=document.createElement("div");e.classList.add("container");e.style.marginTop="5px";var g=document.createElement("div");g.classList.add("row");var f=
document.createElement("div");f.classList.add("col-md-8");f.classList.add("col-md-offset-2");var l=document.createElement("div");l.classList.add("panel");l.classList.add("panel-default");l.setAttribute("id","createuser-overlay-content");var h=document.createElement("h3");h.appendChild(document.createTextNode(""));h.style.color="#737373";h.style.fontWeight="900";h=document.createElement("div");h.classList.add("row");h.classList.add("text-center");var m=document.createElement("div");m.classList.add("col-xs-12");
var k=document.createElement("p");k.style.fontSize="18px";k.style.fontFamily="Arial Black";k.appendChild(document.createTextNode("Create newauth Account"));m.appendChild(k);h.appendChild(m);l.appendChild(h);h=document.createElement("div");h.classList.add("row");h.classList.add("text-center");m=document.createElement("div");m.classList.add("col-xs-4");m.classList.add("col-xs-offset-4");k=document.createElement("img");k.src="/static/icons/vlt-aniim-gif.gif";k.classList.add("center-block");k.width="65";
k.height="65";k.style.borderRadius="4px";k.setAttribute("id","cu-flake-can");m.appendChild(k);h.appendChild(m);l.appendChild(h);h=document.createElement("span");h.innerHTML="\x26times;";h.style.float="right";h.style.padding="0px 8px";h.style.fontSize="3em";h.style.top="0px";h.style.display="inline-block";h.style.color="#a2a2a2";h.style.cursor="default";h.addEventListener("mouseover",function(a){a.target.style.color="#d3d3d3"});h.addEventListener("mouseout",function(a){a.target.style.color="#a2a2a2"});
h.addEventListener("click",function(){$("#createuser-mobile-overlay").fadeOut(500);removediv(document.getElementById("createuser-mobile-overlay"))});f.appendChild(h);h=document.createElement("p");h.classList.add("lead");h.setAttribute("id","createuser-flake-text-header");h.appendChild(document.createTextNode("Choose your username"));h.style.color="#737373";h.style.fontWeight="700";h.style.paddingTop="5px";l.appendChild(h);h=document.createElement("div");h.classList.add("row");m=document.createElement("div");
m.classList.add("col-sm-8");m.classList.add("col-sm-offset-2");k=document.createElement("p");k.classList.add("text-muted");k.setAttribute("id","createuser-flake-text");k.appendChild(document.createTextNode("Your username is for your eyes only. Newauth doesn't store it. Don't share."));k.style.color="#878787";k.style.fontWeight="600";var n=document.createElement("p");n.classList.add("text-muted");n.setAttribute("id","createuser-flake-text");n.appendChild(document.createTextNode("Avoid using your full name. Other than that, choose anything you can remember and type easily."));
n.style.color="#878787";n.style.paddingLeft="8px";n.style.paddingRight="8px";n.style.paddingTop="2px";n.style.fontWeight="500";m.appendChild(k);m.appendChild(n);h.appendChild(m);l.appendChild(h);h=document.createElement("div");h.classList.add("panel-body");h.classList.add("panel-word-wrap");m=document.createElement("div");m.classList.add("row");k=document.createElement("div");k.classList.add("col-xs-8");k.setAttribute("id","create-user-input-holder");m.appendChild(k);h.appendChild(m);n=document.createElement("input");
n.setAttribute("type","password");n.setAttribute("id","cu-username-input");n.style.fontSize="18px";n.setAttribute("placeholder","At least 6 characters");n.setAttribute("autofocus","true");n.setAttribute("data-toggle","password");n.setAttribute("data-message","Show/hide username");n.classList.add("form-control");n.classList.add("input-md");n.addEventListener("input",function(a){d(a);c(a)},!1);n.style.color="#646464";var p=document.createElement("input");p.setAttribute("id","flk-send-button");p.classList.add("btn");
p.classList.add("btn-primary");p.classList.add("btn-md");p.conversationID="";p.changestarttime="";p.type="button";p.disabled="true";p.value="Create";p.style.display="block";p.addEventListener("click",function(){createaccountfrommobile(a)},!1);var q=document.createElement("div");q.classList.add("col-xs-4");m.appendChild(q);k.appendChild(n);q.appendChild(p);h.appendChild(m);l.appendChild(h);f.appendChild(l);g.appendChild(f);e.appendChild(g);b.appendChild(e);$("#cu-username-input").focus()}settimeoutid=
setTimeout(function(){$("#createuser-mobile-overlay").fadeIn("slow")},500)}
function createaccountfrommobile(a){confirm('Please confirm the username  "'+document.getElementById("cu-username-input").value+'"  . Your Newauth username should be kept private and only known to you. Newauth does not store it in a readable format. If you need to make a note of your username, do so now before continuing. Click OK to confirm and create your account.')&&(document.getElementById("flk-send-button").disabled="true",createusershell(document.getElementById("cu-username-input").value,a),
document.getElementById("createuser-mobile-overlay").style.opacity="0.6");return!1}
function createusershell(a,b){var c=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");c.onreadystatechange=function(){if(4==c.readyState&&200==c.status){var a=c.responseText;10<a.length&&(addCollageCSS(),createCollage(a),$("#createuser-mobile-overlay").fadeOut(500),removediv(document.getElementById("createuser-mobile-overlay")))}};c.open("POST","/newauth/api/addusername",!0);c.setRequestHeader("Content-Type","application/json");a=hashUserForAuthentication(a);b=JSON.stringify({username:a,
refflake:b,type:0});c.send(b);return!1}
function addCollageCSS(){const a=document.createElement("style");a.innerHTML="\n    .collage-container {\n\t\t  background-color: #545454;\n\t\t   z-index: 9998;\n      \t\tposition: fixed;\n      \t\ttop: 0;\n      \t\tleft: 0;\n      \t\twidth: 100%;\n      \t\theight:100%;\n\t\t}\n    \n    .collage {\n      display: flex;\n      align-items: flex-start; \n      justify-content: center;\n      flex-wrap: wrap;\n      top: 50%; \n      position:fixed;\n      max-height: 60%;\n\t  width: 90%;  \n\t  margin-left: auto;\n  \tmargin-right: auto;\n      transform: translateY( -50%);\n      object-fit: cover;\n      overflow: hidden;\n    }\n    \n    .collage img {\n      width: 30%;\n      opacity: 0.1;\n  \t\theight: auto;\n  \t\tmax-height: 20%;\n  \t\t\n    }\n    \n    \n  ";document.head.appendChild(a)}
function createCollage(a){var b=JSON.parse(a);a=[];for(var c=0;c<b.length;c++)a.push("/image/"+b[c].imageid);b=document.createElement("div");b.style.position="fixed";b.style.top="20px";b.style.zIndex="9999";b.style.left="50%";b.style.transform="translate(-50%, 0)";c=document.createElement("img");c.width="28";c.height="28";c.src="/static/icons/lock-64.png";b.appendChild(c);document.body.appendChild(b);b=document.createElement("div");b.classList.add("collage-container");const d=document.createElement("div");
d.classList.add("collage");var e=0;a.forEach(a=>{const b=document.createElement("img");b.src=a;15>e&&d.appendChild(b);e++});b.appendChild(d);document.body.appendChild(b);a=document.createElement("div");a.id="acct-cr-notice";a.style.position="fixed";a.style.top="50%";a.style.left="50%";a.style.width="80%";a.style.display="none";a.style.backgroundColor="#454545";a.style.opacity="0.9";a.style.zIndex="9999";a.style.textAlign="center";a.style.fontSize="18px";a.style.transform="translate(-50%, -50%)";a.style.color=
"#838383";a.innerHTML='\x3ch4 style\x3d"font-size: 18; font-family:Arial black; color: #f5f5f5;"\x3eAccount setup pending!\x3c/h4\x3e\x3cbr\x3e \x3cp style\x3d"font-size: 14; padding-left:5px; padding-right: 5px; color: #d6d6d6;"\x3eTo complete setup, you must visit our website from a Desktop or Laptop computer. Their larger screens allow us to precisely track actions during setup for improved security.\x3c/p\x3e \x3cp style\x3d"font-size: 12; padding-left:5px; padding-right: 5px;color: #bababa;"\x3eFrom a \x3cstrong\x3eDesktop or Laptop\x3c/strong\x3e, go to: \x3c/p\x3e\x3cp style\x3d"font-size: 13;padding-left:5px; padding-right: 5px;font-family:Arial black; color: #bababa;"\x3e\x3cstrong\x3ehttps://newauth.io\x3c/strong\x3e\x3c/p\x3e\x3cp style\x3d"font-size: 12; padding-left:5px; padding-right: 5px;color: #bababa;"\x3eEnter your username and follow the instructions provided. \x3c/p\x3e';
setTimeout(function(){$("#acct-cr-notice").fadeIn("slow")},2E3);document.body.appendChild(a);a=document.createElement("div");a.style.position="fixed";a.style.bottom="15px";a.style.right="15px";a.style.zIndex="9999";a.style.fontSize="18px";a.style.color="#a3a3a3";a.appendChild(document.createTextNode("n e w a u t h"));document.body.appendChild(a);const g=document.querySelectorAll(".collage img");g.forEach(a=>{a.style.transition="opacity 2s"});let f=[];setInterval(()=>{g.forEach(a=>{f.includes(a)||
(f.push(a),a.style.transition="opacity 1.2s",a.style.opacity=.8<Math.random()?1:.3,setTimeout(()=>{f=f.filter(b=>b!==a)},800))})},500)}
function createvaultkeyoverlay(a){var b=document.getElementById("vault-key-overlay");if(null==b){b=document.createElement("div");b.setAttribute("id","vault-key-overlay");document.body.appendChild(b);var c=document.createElement("div");c.classList.add("container");c.classList.add("v-center");var d=document.createElement("div");d.classList.add("row");var e=document.createElement("div");e.classList.add("col-md-8");e.classList.add("col-md-offset-2");var g=document.createElement("div");g.classList.add("panel");
g.classList.add("panel-default");var f=document.createElement("h3");f.appendChild(document.createTextNode(""));f.style.color="#737373";f.style.fontWeight="900";g.appendChild(f);f=document.createElement("span");f.innerHTML="\x26times;";f.style.float="right";f.style.padding="2px 7px";f.style.fontSize="1.6em";f.style.top="0px";f.style.display="inline-block";f.style.color="#a2a2a2";f.style.cursor="default";f.addEventListener("mouseover",function(a){a.target.style.color="#d3d3d3"});f.addEventListener("mouseout",
function(a){a.target.style.color="#a2a2a2"});f.addEventListener("click",function(){$("#vault-key-overlay").fadeOut(500)});e.appendChild(f);f=document.createElement("p");f.classList.add("lead");f.setAttribute("id","createuser-flake-text-header");f.appendChild(document.createTextNode("This operation requires data from your vault in order to proceed."));f.style.color="#737373";f.style.fontWeight="700";g.appendChild(f);f=document.createElement("div");f.classList.add("row");var l=document.createElement("div");
l.classList.add("col-sm-8");l.classList.add("col-sm-offset-2");var h=document.createElement("p");h.classList.add("text-muted");h.setAttribute("id","createuser-flake-text");h.appendChild(document.createTextNode("Please enter your Vault Key below. Your username is your vault key if you have not changed it."));h.style.color="#878787";h.style.fontWeight="600";l.appendChild(h);f.appendChild(l);g.appendChild(f);f=document.createElement("div");f.classList.add("panel-body");f.classList.add("panel-word-wrap");
l=document.createElement("div");l.classList.add("row");h=document.createElement("div");h.classList.add("col-sm-8");h.classList.add("col-sm-offset-2");l.appendChild(h);f.appendChild(l);var m=document.createElement("input");m.setAttribute("type","password");m.setAttribute("id","vault-key-input");m.setAttribute("autofocus","true");m.classList.add("form-control");m.classList.add("input-md");m.addEventListener("input",function(){6<=document.getElementById("vault-key-input").value.length?$("#cde-send-button").fadeIn("slow"):
document.getElementById("cde-send-button").style.display="none"},!1);m.style.color="#646464";m.addEventListener("keyup",function(){13===event.keyCode&&(vaultkey=document.getElementById("vault-key-input").value,getuserdatafromdb(0,function(b){if("ERROR"!=b){if("string"===typeof b&&0>b.indexOf('"'))userkey=b;else{b=JSON.parse(b);userkey=b[0];for(var d=1;d<b.length;d++)otherkeys.push(b[d])}a&&a();$("#vault-key-overlay").fadeOut("slow")}else document.getElementById("vault-key-input").style.borderColor=
"red",document.getElementById("vault-key-input").value}))},!1);var k=document.createElement("input");k.setAttribute("id","cde-send-button");k.classList.add("btn");k.classList.add("btn-primary");k.classList.add("btn-md");k.conversationID="";k.changestarttime="";k.type="button";k.value="Submit";k.style.display="none";k.addEventListener("click",function(){vaultkey=document.getElementById("vault-key-input").value;getuserdatafromdb(0,function(b){if("ERROR"!=b){if("string"===typeof b&&0>b.indexOf('"'))userkey=
b;else{b=JSON.parse(b);userkey=b[0];for(var d=1;d<b.length;d++)otherkeys.push(b[d])}a&&a();$("#vault-key-overlay").fadeOut("slow")}else document.getElementById("vault-key-input").style.borderColor="red",document.getElementById("vault-key-input").value})},!1);var n=document.createElement("div");n.classList.add("col-sm-2");l.appendChild(n);h.appendChild(m);n.appendChild(k);f.appendChild(l);g.appendChild(f);e.appendChild(g);d.appendChild(e);c.appendChild(d);b.appendChild(c);$("#vault-key-input").focus()}settimeoutid=
setTimeout(function(){$("#vault-key-overlay").fadeIn("slow")},500)}function addorgtoheader(a,b){var c=document.getElementById("hdr-right-list"),d=document.createElement("li");d.setAttribute("id","user-org-header-"+a);var e=document.createElement("a");e.onclick=function(){return loadOrgPage(loggedinuserflake,a)};e.classList.add("na-header-anchor");b=document.createTextNode(b);e.appendChild(b);d.appendChild(e);c.insertBefore(d,c.childNodes[0])}
function addorgtosetuppage(a,b){var c=document.getElementById("user-org-list"),d=document.createElement("div");d.classList.add("row");d.setAttribute("id","user-org-"+a);var e=document.createElement("div");e.classList.add("col-md-4");var g=document.createElement("p");g.classList.add("text-right");var f=document.createElement("a");f.onclick="javascript:return manageOrg('"+a+"', '"+loggedinuserflake+"');";b=document.createTextNode(b);f.appendChild(b);g.appendChild(f);e.appendChild(g);d.appendChild(e);
e=document.createElement("div");e.classList.add("col-md-4");g=document.createElement("BUTTON");g.classList.add("btn");g.classList.add("btn-xs");g.classList.add("btn-default");g.onclick=function(b){addmembertoOrgModal(a,loggedinuserflake)};g.innerHTML="Add member";e.appendChild(g);d.appendChild(e);e=document.createElement("div");e.classList.add("col-md-4");g=document.createElement("BUTTON");g.classList.add("btn");g.classList.add("btn-xs");g.classList.add("btn-default");g.onclick=function(b){removeOrg(a,
loggedinuserflake)};g.innerHTML="Remove";e.appendChild(g);d.appendChild(e);c.appendChild(d)}function removeorgfromsetuppage(a,b){a=document.getElementById("user-org-"+a);a.parentNode.removeChild(a)}function removeorgfromheader(a){a=document.getElementById("user-org-header-"+a);a.parentNode.removeChild(a)}
function addmembertoOrgModal(a,b){null!=vaultkey&&0!=vaultkey.length||createvaultkeyoverlay();if(a){var c=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");c.onreadystatechange=function(){if(4==c.readyState&&200==c.status){var a=c.responseText;null!=a&&0<a.length&&(a=JSON.parse(a),null!=a&&(document.getElementById("orgid").value=a.orgid,document.getElementById("orgtabname").value=a.orgtabname,document.getElementById("orgname").value=a.orgname,document.getElementById("orgownerflake").value=
b,document.getElementById("org-fullname-title").innerHTML=a.orgname,$("#manageorgmembermodal").modal("show")))}};c.open("POST","/newauth/api/getorganizationinfo",!0);c.setRequestHeader("Content-Type","application/json");a=JSON.stringify({orgid:a,ownerflake:b});c.send(a)}}
function exitmemberfromOrg(a,b){if("undefined"===typeof a||null==a||0==a.length)a=document.getElementById("orgid").value;"undefined"!==typeof b&&null!=b&&0!=b.length||null==document.getElementById("orgownerflake")||(b=document.getElementById("orgownerflake").value);if(a){var c=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");c.onreadystatechange=function(){if(4==c.readyState&&200==c.status){var b=c.responseText;null!=b&&0<b.length&&(removeorgfromheader(a),$("#manageorgmembermodal").modal("hide"),
loadHome())}};c.open("POST","/newauth/api/exitmemberfromorg",!0);c.setRequestHeader("Content-Type","application/json");b=JSON.stringify({orgid:a,memberflake:loggedinuserflake,ownerflake:b,isOwner:!1});c.send(b)}}
function addmembertoOrg(a,b){if("undefined"===typeof a||null==a||0==a.length)a=document.getElementById("orgid").value;var c=document.getElementById("orgmemberflake").value;"undefined"!==typeof b&&null!=b&&0!=b.length||null==document.getElementById("orgownerflake")||(b=document.getElementById("orgownerflake").value);if(null==c||15>c.length)return document.getElementById("orgmemberflake").style.border.color="#a20000",document.getElementById("memberadderror").value="Please enter new member's flake",
!1;if(a){var d=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");d.onreadystatechange=function(){if(4==d.readyState)if(200==d.status){var e=d.responseText;null!=e&&0<e.length&&0<=e.indexOf("publickey")&&(e=JSON.parse(e).publickey,null!=e&&0<e.length&&sendOrgKeyToNewMember(a,b,c,e),$("#manageorgmembermodal").modal("hide"))}else e=d.responseText,0<e.length&&(document.getElementById("orgmemberflake").style.borderColor="#a20000",document.getElementById("memberadderror").innerHTML=
e)};var e=document.getElementById("ismemberowner").checked;d.open("POST","/newauth/api/addmembertoorg",!0);d.setRequestHeader("Content-Type","application/json");e=JSON.stringify({orgid:a,memberflake:c,ownerflake:b,isOwner:e});d.send(e)}}
function sendOrgKeyToNewMember(a,b,c,d){for(var e=0;e<otherkeys.length;e++)if(otherkeys[e].org&&otherkeys[e].org.split(":\x3d")[1]==a&&otherkeys[e].org.split(":\x3d")[0]==b){var g=new sjcl.ecc.elGamal.publicKey(sjcl.ecc.curves.c384,sjcl.codec.base64.toBits(d));g=sjcl.encrypt(g,JSON.stringify(otherkeys[e]));new sjcl.ecc.elGamal.secretKey(sjcl.ecc.curves.c384,sjcl.ecc.curves.c384.field.fromBits(sjcl.codec.base64.toBits(userkey)));var f=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");
f.onreadystatechange=function(){4==f.readyState&&200==f.status&&console.log("Org keys sent to the new member")};document.getElementById("ismemberowner");f.open("POST","/newauth/api/sendsecuremessagetoflake",!0);f.setRequestHeader("Content-Type","application/json");g=JSON.stringify({flake:c,data:g,tag:"ORGKEY",publickey:d});alert(g);f.send(g)}}
function showvianaref(a){"one"==a&&(document.getElementById("mode-one-reference").style.display="block",document.getElementById("mode-two-reference").style.display="none");"two"==a&&(document.getElementById("mode-one-reference").style.display="none",document.getElementById("mode-two-reference").style.display="block")}function setupDomainForAuth(a){$("#domainsetupModal").modal("show");document.getElementById("managedomainforauth").value=a}
function updateJsonSchema(a){for(var b={},c=0;c<a.length;c++)b[a[c].name]={type:a[c].type,hashed:a[c].hashed};document.getElementById("json-schema").value=JSON.stringify(b,null,2);document.getElementById("jsoncontentstructure").value=document.getElementById("json-schema").value}
function createTopic(a){if(a){if(1==document.getElementById("jsoncontentcheck").checked){var b=[];"function"===typeof document.getElementById("add-json-field-btn").onclick?console.log("Event handler already set."):(document.getElementById("add-json-field-btn").addEventListener("click",function(){var a=document.getElementById("json-field-type").value,c=document.getElementById("json-field-name").value,g=document.getElementById("json-field-hashed").checked;c&&(b.push({name:c,type:a,hashed:g}),updateJsonSchema(b),
document.getElementById("json-field-name").value="",document.getElementById("json-field-type").value="")}),document.getElementById("json-schema").addEventListener("change",function(){document.getElementById("jsoncontentstructure").value=document.getElementById("json-schema").value}));if(0==document.getElementById("jsoncontentstructure").value.length)return 0<document.getElementById("json-schema").value.length&&(document.getElementById("jsoncontentstructure").value=document.getElementById("json-schema").value),
$("#setjsonschemamodal").modal("show"),document.getElementById("topicupdatebtn").disabled=!0,!1}var c=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");c.onreadystatechange=function(){if(4==c.readyState)if(200==c.status){if(c.responseText){var a=c.responseText;null!=a&&0<a.length&&(document.getElementById("topic-create-status").innerHTML=a,document.getElementById("createtopicname").value="",document.getElementById("createtopicname").value="",document.getElementById("topic_invite_message").value=
"",document.getElementById("inviteaddress").value="",document.getElementById("idmembersbydevice").checked=!1,document.getElementById("daystojoin").value="",document.getElementById("transferoncreatecheck").checked=!1,document.getElementById("jsoncontentcheck").checked=!1,document.getElementById("json-schema").value="",document.getElementById("jsoncontentstructure").value="",document.getElementById("hashedcontentcheck").checked=!1,document.getElementById("topicmaxdepthinput").value="",document.getElementById("topiccrtime").value=
"",document.getElementById("topicupdatebtn").disabled=!1,setTimeout(function(){$("#managetopicmodal").modal("hide")},2E3))}}else document.getElementById("createtopicname").value="",document.getElementById("createtopicname").placeholder="Please choose a different topic name",document.getElementById("createtopicname").focus(),document.getElementById("topic-create-status").style.color="darkred",document.getElementById("topic-create-status").innerHTML=c.responseText,document.getElementById("topicupdatebtn").disabled=
!1};c.open("POST","/newauth/api/createtopic",!0);c.withCredentials=!0;c.setRequestHeader("Content-Type","application/json");a=JSON.stringify({topic:document.getElementById("createtopicname").value,commentoption:document.getElementById("commentsettingsselect").value,postoption:document.getElementById("postsettingsselect").value,storeoption:document.getElementById("storagesettingsselect").value,display:document.getElementById("createtopicname").value,invitemessage:document.getElementById("topic_invite_message").value,
inviteaddress:document.getElementById("inviteaddress").value,idbydevice:document.getElementById("idmembersbydevice").checked,daystojoin:document.getElementById("daystojoin").value,transferownership:document.getElementById("transferoncreatecheck").checked,jsoncontent:document.getElementById("jsoncontentcheck").checked,jsonschema:document.getElementById("json-schema").value,hashedcontent:document.getElementById("hashedcontentcheck").checked,topicmaxdepth:document.getElementById("topicmaxdepthinput").value,
crTime:document.getElementById("topiccrtime").value});c.send(a);document.getElementById("topicupdatebtn").disabled=!0}else document.getElementById("inviteaddress").value="",document.getElementById("createtopicname").value="",document.getElementById("createtopicname").addEventListener("change",function(){var a=document.getElementById("createtopicname").value,b=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");b.onreadystatechange=function(){4==b.readyState&&200==b.status&&
b.responseText&&"EXISTS"==b.responseText&&(document.getElementById("createtopicname").value="",document.getElementById("createtopicname").placeholder="Please choose a different topic name",document.getElementById("createtopicname").focus(),document.getElementById("topic-create-status").style.fontColor="darkred",document.getElementById("topic-create-status").innerHTML="The topic name '"+a+"' is already taken.")};b.open("GET","/newauth/api/doestopicexist/"+a,!0);b.setRequestHeader("Content-Type","application/json");
b.send(null)}),document.getElementById("inviteaddress").addEventListener("input",function(){0<document.getElementById("inviteaddress").value.indexOf("@")&&(document.getElementById("transferoncreatecheck").checked=!0)}),document.getElementById("createtopicname").removeAttribute("readonly")}
function loadusertopics(){var a=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");a.onreadystatechange=function(){if(4==a.readyState&&200==a.status&&a.responseText){var b=JSON.parse(a.responseText),c=document.getElementById("user-topic-list");c.innerHTML="";for(var d=0;d<b.length;d++){var e=document.createElement("div");e.classList.add("row");e.setAttribute("id","topic-row-"+b[d].topic);var g=document.createElement("div");g.classList.add("col-xs-4");g.appendChild(document.createTextNode(b[d].topic+
" ["+b[d].hits+"]"));var f=document.createElement("div");f.classList.add("col-xs-4");var l=document.createElement("button");l.classList.add("btn");l.classList.add("btn-xs");l.classList.add("btn-default");l.appendChild(document.createTextNode("Manage"));l.addEventListener("click",function(a){return function(){manageTopic(a)}}(b[d]));f.appendChild(l);l=document.createElement("div");l.classList.add("col-xs-4");var h=document.createElement("button");h.classList.add("btn");h.classList.add("btn-xs");h.classList.add("btn-default");
h.appendChild(document.createTextNode("Remove"));h.addEventListener("click",function(a){return function(){removeTopic(a)}}(b[d]));l.appendChild(h);e.appendChild(g);e.appendChild(f);e.appendChild(l);c.appendChild(e)}}};a.open("GET","/newauth/api/gettopicsbyuser",!0);a.setRequestHeader("Content-Type","application/json");a.send(null)}
function manageTopic(a){var b=new XMLHttpRequest;b.onreadystatechange=function(){if(4==b.readyState&&200==b.status){inmanage=!0;var a=JSON.parse(b.responseText),d=parseJsonWithFallback(a.settings);null!=d&&(document.getElementById("createtopicname").value=a.topic,document.getElementById("createtopicname").setAttribute("readonly","readonly"),d.idbydevice&&(document.getElementById("idmembersbydevice").checked=!0),document.getElementById("daystojoin").value=a.daystojoin,document.getElementById("inviteaddress").value=
a.inviteaddress,d.transferownership&&(document.getElementById("transferoncreatecheck").checked=!0),document.getElementById("topic_invite_message").value=d.invitemessage,document.getElementById("commentsettingsselect").value=d.comments,document.getElementById("storagesettingsselect").value=d.storage,document.getElementById("postsettingsselect").value=d.posts,d.jsoncontent&&(document.getElementById("jsoncontentcheck").checked=!0),d.hashedcontent&&(document.getElementById("hashedcontentcheck").checked=
!0),"undefined"!=typeof d.maxdepth&&(document.getElementById("topicmaxdepthinput").value=d.maxdepth),document.getElementById("topicupdatebtn").value="Update",document.getElementById("topiccrtime").value=a.crTime,document.getElementById("json-schema").value=d.jsonschema)}};b.open("GET","/newauth/api/gettopicbyname/"+a.topic,!1);b.send(null);$("#managetopicmodal").modal("show")}
function activatetopicdeadline(a){1==a.checked?(document.getElementById("topic-join-deadline").style.display="block",document.getElementById("daystojoin").value="1"):document.getElementById("daystojoin").value="0";document.getElementById("topic-join-deadline").style.display="none";return!1}function launchmanagetopicdialog(){$("#managetopicmodal").modal("show")}
function updatetopic(){if(3<document.getElementById("createtopicname").value.length){let a=document.getElementById("createtopicname").value;if(null!=document.getElementById("topic-row-"+a.toLowerCase())&&!inmanage)return document.getElementById("topic-create-status").style.color="darkred",document.getElementById("topic-create-status").innerHTML="You have created this topic already. Please use the manage button to change its settings",!1;createTopic(document.getElementById("createtopicname").value)}else document.getElementById("topic-create-status").innerHTML=
"Topic name must be longer than 3 characters"}function removeTopic(a){var b=new XMLHttpRequest;b.onreadystatechange=function(){4==b.readyState&&200==b.status&&(document.getElementById("topic-row-"+a.topic).style.display="none")};b.open("POST","/newauth/api/removetopic",!1);b.setRequestHeader("Content-Type","application/json");var c=JSON.stringify({topic:a.topic});b.send(c)};