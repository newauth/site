'use strict';self.addEventListener("message",function(b){console.log("calling siteload worker  "+JSON.stringify(b.data));if("undefined"==typeof b.data.action||"loadsite"==b.data.action){var c=b.data.url,a=new XMLHttpRequest;a.open("GET",c,!1);a.onreadystatechange=function(){4==a.readyState&&200==a.status&&self.postMessage({action:b.data.action,response:a.responseText})};a.send(null)}"sitepreview"==b.data.action&&(a=new XMLHttpRequest,a.open("POST","/newauth/api/urlpreview",!1),a.setRequestHeader("Content-Type",
"application/json"),c=b.data.url,a.onreadystatechange=function(){4==a.readyState&&200==a.status&&self.postMessage({action:b.data.action,response:a.responseText})},c=JSON.stringify({url:c}),a.send(c));"siteread"===b.data.action&&getArticleText(b.data.url).then(a=>{self.postMessage({action:b.data.action,response:a})}).catch(a=>{self.postMessage({action:b.data.action,error:a.message});throw a;})});
const fetchWithTimeout=async(b,c=5E3)=>{const a=new AbortController,e=setTimeout(()=>a.abort(),c);try{const d=await fetch(b,{signal:a.signal});clearTimeout(e);const f=setTimeout(()=>{a.abort();throw Error("Response processing timed out after 5 seconds.");},c),g=await d.text();clearTimeout(f);return g}catch(d){if("AbortError"===d.name)throw Error("Request timed out after 5 seconds.");throw d;}};
async function getArticleText(b){if(!b||"string"!==typeof b)throw Error("Invalid URL provided");try{const c="https://api.allorigins.win/get?url\x3d"+encodeURIComponent(b);return await fetchWithTimeout(c)}catch(c){throw console.error("Error fetching article:",c),c;}};