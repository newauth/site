'use strict';var responsedata=[],imagecounter=0,authimagecontainerdivelem,imgs,images,attemptdiv,collagex=0,collagey=0,maxzoom=2,currentzoom=0,succgrid,impliedx=0,impliedy=0,gridSize=2,zoomfurther=!0;
function displayrecoverybutton(){attemptdiv=document.querySelector("#auth-progress-display");var c=document.createElement("BUTTON");c.classList.add("btn");c.classList.add("btn-xs");c.classList.add("btn-default");c.classList.add("pull-right");c.onclick=function(a){sendrecoverycode(vaultkey)};c.innerHTML="Recover Account";null!=attemptdiv&&attemptdiv.appendChild(c)}
function displayAttemptIndicator(c){if(attemptdiv=document.querySelector("#auth-progress-display")){attemptdiv.classList.add("animated");attemptdiv.classList.add("flash");attemptdiv.classList.add("v-center");attemptdiv.innerHTML="";var a=document.createElement("p");a.classList.add("lead");a.style.maxWidth="80%";a.style.display="inline-block";a.style.textDecoration="line-through";a.style.color="#600102";c=document.createTextNode(" "+c+" ");a.appendChild(c);attemptdiv.appendChild(a)}}
function displayauthenticatingicon(){document.getElementById("displayauthenticatingcontainer").style.display="inline-block";appcalltimeoutid=setTimeout(announceapptimeouterror,1E4)}
function postCollageSelection(c){var a=document.getElementById("auth-photos");null!==a&&(a.style.display="none");collageimagesloaded=0;c="/newauth/postAuthColClickData/"+c;displayloadingicon();loadUrlAjax(c,"app");document.title="Newauth - Authenticate";loadUrlAjax("/newauth/header?page\x3dauthenticate","app-header");return!1}
function sendrecoverycode(c){var a=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");a.onreadystatechange=function(){if(4==a.readyState&&200==a.status){var b=a.responseText;console.log("response out of sendrecoverycode "+b);var f=JSON.parse(b).emaildisplay;b=JSON.parse(b).vercode;createRecoverAccountOverlay(c,f,b)}};a.open("POST","/newauth/api/sendrecoverycode",!1);a.withCredentials=!0;a.setRequestHeader("Content-Type","application/json");var b=JSON.stringify({username:hashUserForAuthentication(c)});
a.send(b)}function displayFirstImage(){hideloadingicon();null!==document.getElementById("auth-photos")&&(document.getElementById("auth-image-main-container-id").style.top="50px",document.getElementById("auth-image-main-container-id").style.left="12px",$("#auth-photos").fadeIn(500),restartTimer())}
function displayfirstimageoncanvas(){hideloadingicon();clearTimeout(appcalltimeoutid);null!==document.getElementById("auth-images")&&(imgs=document.querySelectorAll("img"),null!==imgs&&(drawimgbyindex(imgs,0),restartTimer()))}
function drawimgbyindex(c,a){document.getElementById("auth-image-main-container-id");var b=document.getElementById("imdata"+a);null!=b&&(b.style.display="block");b=document.getElementById("imgholder");b.addEventListener("click",handleauthimgclickevent,!1);var d=getnewimagesize(c[a]);b.width=d.width;b.height=d.height;b.top=0;d=b.getContext("2d");0<a&&d.clearRect(0,0,b.width,b.height);d.drawImage(c[a],0,0,b.width,b.height)}
function hideAuthImage(){document.getElementById("auth-image-main-container-id").style.display="none"}function showAuthImage(){document.getElementById("auth-image-main-container-id").style.display="table-cell"}
function getnewimagesize(c){var a=c.width,b=c.height,d=c.width/c.height;(window.innerWidth-12)/(window.innerHeight-94)<=d?window.innerWidth<c.width&&(a=window.innerWidth-12,b=a/d):window.innerHeight-94<c.height&&(b=window.innerHeight-94,a=b*d);return{width:a.toFixed(2),height:b.toFixed(2)}}
function handleauthimgclickevent(c){clearauthheadermessage();var a=gettimetoclick();null!==document.getElementById("auth-images")&&(imgs=document.querySelectorAll("img"));var b=document.getElementById("imgholder");var d=getMousePos2(b,c);x=d.x;y=d.y;if(600>window.innerWidth&&currentzoom<maxzoom&&zoomfurther){var f=document.getElementById("imgholder"),k=0,g=0,l=getgridclicked(x,y,b.width,b.height,gridSize);0<currentzoom&&(k=collagex+d.x/Math.pow(gridSize,currentzoom)-impliedx,g=collagey+d.y/Math.pow(gridSize,
currentzoom)-impliedy);impliedx=collagex+d.x/Math.pow(gridSize,currentzoom);impliedy=collagey+d.y/Math.pow(gridSize,currentzoom);if(0==currentzoom||Math.abs(k)>.1*b.width||Math.abs(g)>.1*b.height){collagex+=b.width*(l.col-1)/Math.pow(gridSize,currentzoom+1);collagey+=b.height*(l.row-1)/Math.pow(gridSize,currentzoom+1);drawGridOverImage(f,gridSize);zoomimagegrid(l,imgs[imagecounter],f);return}zoomfurther=!1}600>window.innerWidth&&(x=collagex+d.x/Math.pow(gridSize,currentzoom),y=collagey+d.y/Math.pow(gridSize,
currentzoom),collageimagesloaded=collagey=collagex=0);0<=parseInt(x)&&parseInt(x)<=b.width&&0<=parseInt(y)&&parseInt(y)<=b.height&&(a=JSON.stringify({imgID:images[imagecounter],delay:a,clickX:parseInt(x),clickY:parseInt(y),imgWidth:b.width,imgHeight:b.height}),responsedata.push(a),a=document.getElementsByClassName("auth-image-main"),a[imagecounter].style.display="none",b=document.getElementById("imdata"+imagecounter),null!=b&&(b.style.display="none"),imagecounter<a.length-1?(imagecounter++,drawimgbyindex(imgs,
imagecounter),currentzoom=0,zoomfurther=!0,restartTimer()):(attemptdiv&&(attemptdiv.classList.remove("animated"),attemptdiv.classList.remove("flash"),attemptdiv.innerHTML=""),null!=document.getElementById("imgholder")&&(document.getElementById("imgholder").style.display="none",cleardiv(document.getElementById("imgholder"))),displayauthenticatingicon(),document.getElementById("authResponseForm").responsedata.value="["+responsedata+"]",authimagecontainerdivelem.removeEventListener("click",handleauthimgclickevent,
!0),console.log("submitting auth form. counter "+imagecounter+" length "+a.length),submitFormAjax("/newauth/postAuthClickData","authResponseForm"),currentzoom=collageimagesloaded=0,zoomfurther=!0,responsedata=[],images=[]));c.stopPropagation()}
function drawcircleoverimage(c,a,b,d,f){c=c.getContext("2d");c.beginPath();c.globalAlpha=.4;c.arc(a,b,d,0,2*Math.PI,!1);c.fillStyle="white";50>f&&(c.fillStyle="darkred");70<=f&&(c.fillStyle="orange");89<=f&&(c.globalAlpha=.1,c.fillStyle="green");100==f&&(c.globalAlpha=0,c.fillStyle="black");100!=f&&c.fill();c.lineWidth=5;100!=f&&c.fill()}
function drawrectangleoverimage(c,a,b,d,f,k){var g=a.getContext("2d");g.clearRect(0,0,a.width,a.height);g.globalAlpha=1;g.drawImage(c,0,0,a.width,a.height);g.globalAlpha=.5;g.beginPath();g.rect(b,d,f,k);g.fillStyle="gray";g.fill()}
function drawGridOverImage(c,a){null==a&&(a=4);var b=a,d=c.getContext("2d");d.strokeStyle="#dddddd";for(var f=0;f<b;f++)d.save(),d.beginPath(),d.moveTo(0,c.height/b*f),d.lineTo(c.width,c.height/b*f),d.closePath(),d.stroke(),d.restore();for(b=0;b<a;b++)d.save(),d.beginPath(),d.moveTo(c.width/a*b,0),d.lineTo(c.width/a*b,c.height),d.closePath(),d.stroke(),d.restore()}function getgridclicked(c,a,b,d,f){null==f&&(f=4);var k={};k.col=parseInt((c-1)*f/b+1);k.row=parseInt((a-1)*f/d+1);k.size=f;return k}
function zoomimagegrid(c,a,b){var d=b.width,f=b.height;b.getContext("2d");var k=parseInt(d/c.size*(c.col-1));2<k&&(k-=2);var g=parseInt(f/c.size*(c.row-1));2<g&&(g-=2);k=parseInt(a.width/d*collagex);g=parseInt(a.height/f*collagey);var l=parseInt(a.width/(c.size*(currentzoom+1))),e=parseInt(a.height/(c.size*(currentzoom+1)));setTimeout(function(){zoomimagecliponcanvasinsteps(a,b,c,k,g,l,e,15);currentzoom++},200)}
async function zoomimagecliponcanvasinsteps(c,a,b,d,f,k,g,l){var e=a.width,n=a.height;a=a.getContext("2d");for(var h=0;h<l;h++){var m=1+(h+1)/l;a.clearRect(0,0,e,n);var p=0,q=0,r=e*m/2;m=n*m/2;1<b.col&&(p=e*(1-(h+1)/l)/2);1<b.row&&(q=n*(1-(h+1)/l)/2);a.drawImage(c,d,f,k,g,p,q,r,m);(new Date).getTime();await sleep(parseInt(600/l))}}function sleep(c){return new Promise(a=>setTimeout(a,c))}
function imagedata_to_image(c){var a=document.createElement("canvas"),b=a.getContext("2d");a.width=c.width;a.height=c.height;b.putImageData(c,0,0);c=new Image;c.src=a.toDataURL();return c}
function getMousePos2OLD(c,a){var b=c.getBoundingClientRect();debugappui&&console.log("mouseposition getBoundingClientRect "+b.right+","+b.left+","+b.bottom+","+b.top);return 0==b.right-b.left||0==b.bottom-b.top?{x:Math.round(a.clientX),y:Math.round(a.clientY)}:{x:Math.round((a.clientX-b.left)/(b.right-b.left)*c.width),y:Math.round((a.clientY-b.top)/(b.bottom-b.top)*c.height)}}
function getMousePos2(c,a){var b=c.getBoundingClientRect();return{x:Math.round((a.clientX-b.left)/(b.right-b.left)*c.width),y:Math.round((a.clientY-b.top)/(b.bottom-b.top)*c.height)}}function gradientBackground(){return!1}function clearauthheadermessage(){$("#authmessagedisplay").fadeOut(100)}
function createRecoverAccountOverlay(c,a,b){var d=document.getElementById("recover-account-overlay");if(null==d){d=document.createElement("div");d.setAttribute("id","recover-account-overlay");document.body.appendChild(d);var f=document.createElement("div");f.classList.add("container");f.classList.add("v-center");var k=document.createElement("div");k.classList.add("row");var g=document.createElement("div");g.classList.add("col-md-8");g.classList.add("col-md-offset-2");var l=document.createElement("div");
l.classList.add("panel");l.classList.add("panel-default");var e=document.createElement("h3");e.appendChild(document.createTextNode(""));e.style.color="#737373";e.style.fontWeight="900";l.appendChild(e);e=document.createElement("span");e.innerHTML="\x26times;";e.style.float="right";e.style.padding="2px 7px";e.style.fontSize="1.6em";e.style.top="0px";e.style.display="inline-block";e.style.color="#a2a2a2";e.style.cursor="default";e.addEventListener("mouseover",function(a){a.target.style.color="#d3d3d3"});
e.addEventListener("mouseout",function(a){a.target.style.color="#a2a2a2"});e.addEventListener("click",function(){$("#recover-account-overlay").fadeOut(500);loadWelcome()});g.appendChild(e);e=document.createElement("p");e.classList.add("lead");e.setAttribute("id","createuser-flake-text-header");e.appendChild(document.createTextNode("Please enter the recovery code you received in your email."));e.style.color="#737373";e.style.fontWeight="700";l.appendChild(e);e=document.createElement("div");e.classList.add("row");
var n=document.createElement("div");n.classList.add("col-sm-8");n.classList.add("col-sm-offset-2");var h=document.createElement("p");h.classList.add("text-muted");h.setAttribute("id","createuser-flake-text");h.appendChild(document.createTextNode("We just sent a recovery code to your email address "+a+" Please enter it below"));h.style.color="#878787";h.style.fontWeight="600";n.appendChild(h);e.appendChild(n);l.appendChild(e);a=document.createElement("div");a.classList.add("panel-body");a.classList.add("panel-word-wrap");
e=document.createElement("div");e.classList.add("row");n=document.createElement("div");n.classList.add("col-sm-8");n.classList.add("col-sm-offset-2");e.appendChild(n);a.appendChild(e);h=document.createElement("input");h.setAttribute("type","text");h.setAttribute("id","recovery-code-input");h.setAttribute("autofocus","true");h.classList.add("form-control");h.classList.add("input-md");h.addEventListener("input",function(){40<document.getElementById("recovery-code-input").value.length?$("#cde-send-button").fadeIn("slow"):
document.getElementById("cde-send-button").style.display="none"},!1);h.style.color="#646464";var m=document.createElement("input");m.setAttribute("id","cde-send-button");m.classList.add("btn");m.classList.add("btn-primary");m.classList.add("btn-md");m.conversationID="";m.changestarttime="";m.type="button";m.value="Recover";m.style.display="none";m.addEventListener("click",function(){verifyrecoverycode(c,b)},!1);var p=document.createElement("div");p.classList.add("col-sm-2");e.appendChild(p);n.appendChild(h);
p.appendChild(m);a.appendChild(e);l.appendChild(a);g.appendChild(l);k.appendChild(g);f.appendChild(k);d.appendChild(f);$("#recovery-code-input").focus()}settimeoutid=setTimeout(function(){$("#recover-account-overlay").fadeIn("slow")},500)}
function verifyrecoverycode(c,a){var b=document.getElementById("recovery-code-input").value;if(null!=b&&0<b.length){var d=new XMLHttpRequest;d.open("POST","/newauth/api/verifycode",!1);d.setRequestHeader("Content-Type","application/json");d.onreadystatechange=function(){4==d.readyState&&200==d.status&&("VERIFIED"===JSON.parse(d.responseText).status.statuscode?($("#recover-account-overlay").fadeOut("slow"),loadUrlAjax("/newauth/header?page\x3dhome","app-header"),loadUrlAjax("/newauth/welcome","app")):
document.getElementById("createuser-flake-text").innerHTML='\x3cfont color\x3d"red"\x3eInvalid code. Please check \x3c/font\x3e')};c=JSON.stringify({username:hashUserForAuthentication(c),verificationKeyCode:a,verificationKeyInput:b});d.send(c)}};