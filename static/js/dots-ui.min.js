'use strict';var clickstarttime,posts=[],topictype,topicdisplayname,topichits,closepopuptimeoutmap={},crtimetoidxmap={},loctoidxmap={},topiceventsource,startsize=10,maxdotsize=48,playidx,playtimeoutids=[],searchtimeoutid,remaintime=0,topiccurrentdepth=0,topicjsonschema,sortfield,sortvalues,currentsubtopic=null,splitschemas;const screenWidth=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,screenHeight=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight;
let sidecontainer,totalViews=0,totalComments=0,totalRecords=0;const sqrt2=Math.sqrt(2);let currentPage,maxPage,minPage=0,scrollTimer;
var addpostfunction=function(a){return posttoflakemodal(event)},reduceprivacyfunction=function(a){displaybuttonbehavior(a,"Reduce privacy - Available only to flake owner.")},launchvltpopupfunction=function(a,b){return function(b){"undefined"!==typeof b&&b.stopPropagation();b=document.getElementById("dot-desc-"+a);null!=b&&(b.style.display="none");b=document.getElementById("dot-popup-vlt-"+a);null!=b?b.style.display="block":null!=posts&&posts.length>=a&&createVaultPopup(posts[a],a)}},drageventinstance=
0,setofhashes=new Set,dotsizemap=new Map,thisdeviceid="",fileattachments=[],isowner=!1,iscloselooptopic=!1,originaldata,rndsalt,rnditer,rndseq,rndcrdate,rnd=function(a,b){a=Math.ceil(a);b=Math.floor(b);return Math.floor(Math.random()*(b-a+1)+a)};
function attachtransitionstyles(a,b){"undefined"==typeof b&&(b="0.6");a.style.WebkitTransition="all "+b+"s";a.style.MozTransition="all "+b+"s";a.style.mozTransition="all "+b+"s";a.style.MsTransition="all "+b+"s";a.style.OTransition="all "+b+"s";a.style.transition="all "+b+"s"}function clearprevioustransitionstyles(a){a.style.WebkitTransition="none";a.style.MozTransition="none";a.style.mozTransition="none";a.style.MsTransition="none";a.style.OTransition="none";a.style.transition="none"}
function toggletopicsearch(a){a.stopPropagation();searchtimeoutid;if("none"==document.getElementById("input-search-post").style.display){document.getElementById("input-search-post").style.display="block";document.getElementById("input-search-post").style.zIndex="1";a=document.getElementsByClassName("dot-popup");for(var b=0;b<a.length;b++)a[b].classList.remove("expand-open"),a[b].style.display="none";document.getElementById("post-search-input").addEventListener("input",function(a){stopDefaultBackspaceBehaviour(a);
null!=searchtimeoutid&&clearTimeout(searchtimeoutid);searchtimeoutid=setTimeout(function(a){displaypostsasdots(posts,!1,document.getElementById("post-search-input").value)},200)});document.getElementById("post-search-input").addEventListener("click",function(a){a.stopPropagation()})}else document.getElementById("input-search-post").style.display="none"}
function cleanString(a){if("undefined"!=typeof a)return a.replace(/[^\x20-\x7E\n]/g,"").replace(/[?]/g,"").replace(/\\+/g,"\\").replace(/\.+/g,".").replace(/^[^a-zA-Z0-9]+|[^a-zA-Z0-9]+$|(?<=\s)[^a-zA-Z0-9]+(?=\s)/g,"")}
function topicdocumentclick(a){"undefined"!=typeof a&&(console.log("document click fired"),a.stopPropagation(),null!=document.getElementById("input-search-post")&&"none"!=document.getElementById("input-search-post").style.display&&"input-search-post"!=a.target.id&&(document.getElementById("input-search-post").style.display="none"));a=100;null!=clickstarttime&&(a=new Date-clickstarttime);if(100>=a){var b=document.getElementsByClassName("dot-popup");if(null!=b)for(a=b.length;0<b.length&&0<a;)b[0].classList.remove("expand-open"),
setTimeout(function(){removediv(b[0])},400),a--;a=document.getElementsByClassName("dot-desc");if(null!=a){null!=document.getElementById("showdescbtn")&&(document.getElementById("showdescbtn").onclick=function(a){displayallpostdescription(event)});for(var c=a.length;0<a.length&&0<c;)removediv(a[0]),c--}c=document.getElementsByClassName("expanded-dot");if(null!=c&&0<c.length)for(a=0;a<c.length;a++)shrinkdot(c[a])}else setTimeout(function(){clickstarttime=null},1E3)}
function displayemptypostsmessage(){var a=document.createElement("div");a.id="notification-div";a.style.position="fixed";a.style.bottom="25px";a.style.width="80%";a.style.left="10%";a.style.right="10%";a.style.backgroundColor="#fafafa";a.style.color="#787878";a.style.textAlign="center";a.style.fontSize="18px";a.style.padding="10px";a.style.border="1px solid #ccc";a.style.borderRadius="20px";a.innerHTML="No data exists for this page. You can add content by clicking the + button on the menu.";document.body.appendChild(a);
setTimeout(function(){var b=1,c=setInterval(function(){.1>=b&&(clearInterval(c),a.style.display="none");a.style.opacity=b;a.style.filter="alpha(opacity\x3d"+100*b+")";b-=.1*b},50)},5E3)}
function displaypostsasdots(a,b,c,f){dotsizemap=new Map;if("undefined"!=typeof c&&0<c.length)for(var d=document.getElementsByClassName("dot"),e=0;e<d.length;e++)if(0<c.indexOf(":::")){if(0<=c.indexOf("PREVIEW::")?0<=c.indexOf(sortfield+"::")&&"undefined"!=typeof d[e].dataset[sortfield.toLowerCase()]&&("ALL"==c.split(":::")[2]?(d[e].style.backgroundColor=d[e].dataset.savedBgClr,scaledotsize(d[e],2)):d[e].dataset[sortfield.toLowerCase()]!=c.split(":::")[2]&&(d[e].style.backgroundColor="#f2f2f2",scaledotsize(d[e],
1))):"ALL"==c.split(":::")[1]?(d[e].style.display="flex",d[e].style.justifyContent="center",d[e].style.alignItems="center",scaledotsize(d[e],2),null!=document.getElementById("dot-sidepanel-"+e)&&(document.getElementById("dot-sidepanel-"+e).style.display="block")):0<=c.indexOf(sortfield+"::")&&"undefined"!=typeof d[e].dataset[sortfield.toLowerCase()]&&(d[e].dataset[sortfield.toLowerCase()]!=c.split(":::")[1]?(d[e].style.display="none",null!=document.getElementById("dot-sidepanel-"+e)&&(document.getElementById("dot-sidepanel-"+
e).style.display="none")):(d[e].style.display="flex",d[e].style.justifyContent="center",d[e].style.alignItems="center",scaledotsize(d[e],2),null!=document.getElementById("dot-sidepanel-"+e)&&(document.getElementById("dot-sidepanel-"+e).style.display="block"))),0<=c.indexOf("PREVIEW::")&&e==d.length-1)return}else 0<c.length?d[e].style.display="none":(d[e].style.display="flex",d[e].style.justifyContent="center",d[e].style.alignItems="center");console.log(a.length+" justadded: "+b+" startingdot: "+f);
"undefined"==typeof b||0==b?postlocationmap=[]:0<a.length&&null!=a[0].location&&(d=document.getElementById("dot-"+loctoidxmap[a[0].location]),removediv(d));"undefined"!=typeof topicjsonschema&&0<topicjsonschema.length&&1==a.length&&(document.getElementById("singlepost-crtime").value=a[0].crtime);maxdotsize=parseInt(Math.sqrt((window.innerWidth*window.innerHeight-Math.pow(350,2))/a.length)/4);console.log("max dot size [theoretical] "+maxdotsize+" postlen "+a.length);console.log("screenWidth screenHeight"+
screenWidth+" "+screenHeight);maxdotsize>250/3&&(maxdotsize=250/3);d=document.getElementById("topic-app");null==d&&(d=document.getElementById("app-flk"));e=0;if(null!=a){var h=displayRadialText(a,!1);null!=h&&0<h.length&&(maxdotsize=h[0].dotmaxsize);let w=Array(a.length);for(var g=0;g<a.length;g++){let q=null,p=null;if("undefined"!=typeof c&&0<c.length)if("undefined"!=typeof a[g].tags&&null!=a[g].tags&&0<a[g].tags.length){console.log("Looking for "+c+" in tags "+g+"th post");for(var k=0;k<a[g].tags.length;k++)if(a[g].tags[k].toLowerCase().startsWith(c.toLowerCase())){document.getElementById("dot-"+
g).style.display="flex";document.getElementById("dot-"+g).style.justifyContent="center";document.getElementById("dot-"+g).style.alignItems="center";e++;break}}else{k="";"undefined"!=typeof a[g].text&&null!=a[g].text&&(k=a[g].text.toLowerCase());var l="";"undefined"!=typeof a[g].data&&null!=a[g].data&&null!=a[g].data.text&&(l=a[g].data.text.toLowerCase());if(0<=k.indexOf(c.toLowerCase())||0<=l.indexOf(c.toLowerCase())){document.getElementById("dot-"+g).style.display="flex";document.getElementById("dot-"+
g).style.justifyContent="center";document.getElementById("dot-"+g).style.alignItems="center";showpostdescription(null,g);e++;break}}else{var m=checkifalreadyseen(a[g].crtime);k=checkifdeleted(a[g].crtime);"undefined"!=typeof a[g].data&&null!=a[g].data&&null!=a[g].data.text&&(l=a[g].data.text.toLowerCase());l=document.createElement("div");null==f?l.setAttribute("id","dot-"+g):l.setAttribute("id","sub-"+f+"-"+g);l.classList.add("circle-to-rect");l.classList.add("dot");attachtransitionstyles(l,1);l.style.top=
h[g].top;l.style.left=h[g].left;"undefined"!=typeof b&&1==b&&(document.getElementById("dot-0"),console.log("adding inposts to post"),[a[0]].concat(posts),posts=a,shiftdotandpopupids());0!=g||m||k||"undefined"!=typeof b&&1==b&&document.getElementById("dot-popup-"+g);l.setAttribute("data-long-press-delay",500);null!=sortfield&&1<sortvalues.length&&"undefined"!=typeof a[g].data[sortfield]&&l.setAttribute("data-"+sortfield,a[g].data[sortfield]);let c,e=!1;const r=document.createElement("div");r.className=
"concentric-square";m=parseInt(h[g].width,10);r.style.position="absolute";r.style.top="50%";r.style.left="50%";r.style.width=`${m}px`;r.style.height=`${m}px`;r.style.transform="translate(-50%, -50%)";r.style.backgroundColor="transparent";r.style.zIndex=6;600<screenWidth&&600<screenHeight&&null==f&&r.addEventListener("mouseenter",function(b,d){return function(b){c=Date.now();let f=!0;if(!e){e=!0;var g=isdotafolder(a[d].tags);f=!g;w[d]=setTimeout(()=>{null==q&&(q=document.getElementById("dot-"+d));
null==p&&(p=q.getBoundingClientRect());f&&null==posts[d].data&&(null==q.querySelector("#displayloadingcontainer")&&q.insertBefore(createloadingdiv(),q.firstChild),retrievepostsummaryandshowinpopup(posts[d],d,b));var c=q.querySelector(".text-container");if(null!=c&&null!=c.innerText&&null==c.querySelector(".url-preview")){let a=extractURLFromText(c.innerText);"undefined"!=typeof a&&0<a.length&&(console.log("Extracted URL from text "+a[0].text),0==a[0].text.indexOf(window.location.href)?f=!1:setTimeout(function(){f&&
(null==q.querySelector("#displayloadingcontainer")&&q.insertBefore(createloadingdiv(),q.firstChild),console.log("querying url after mouseneter "+a[0].text),queryURLforpreview(a[0].text,d))},150))}console.log("dotexpandtimeout "+d+" "+w[d]);highlightAndScroll(d);if(f)expandDot(q,p,!0);else{if(g){c=a[d].text;if(a[d].data)try{console.log(`Raw data for post ${d}:`,a[d].data);const b=a[d].data;b&&b.text&&(c=b.text)}catch(C){console.error(`Error parsing data for post ${d}:`,C),console.log("Problematic data:",
a[d].data)}previewsubtopic(`${a[d].topic}/${c}`,`dot-${d}`)}showpostdescription(b,d)}},150)}}}(event,g));null==f&&r.addEventListener("mousedown",function(a,b){return function(a){a.stopPropagation();a.preventDefault();console.log("expandtimeout before clear "+w[b]);clearTimeout(w[b]);console.log("expandtimeout cleared. now "+w[b])}}(event,g));(600>screenWidth||600>screenHeight&&null==f)&&r.addEventListener("click",function(a,b){return function(a){a.stopPropagation();a.preventDefault();c=Date.now();
let d=!0;d=!isdotafolder(posts[b].tags);null==q&&(q=document.getElementById("dot-"+b));null==p&&(p=q.getBoundingClientRect());d&&null==posts[b].data&&(null==q.querySelector("#displayloadingcontainer")&&q.insertBefore(createloadingdiv(),q.firstChild),retrievepostsummaryandshowinpopup(posts[b],b,a));var e=q.querySelector(".text-container");if(null!=e&&null!=e.innerText&&null==e.querySelector(".url-preview")){let a=extractURLFromText(e.innerText);"undefined"!=typeof a&&0<a.length&&(0==a[0].text.indexOf(window.location.href)?
d=!1:setTimeout(function(){null==q.querySelector("#displayloadingcontainer")&&q.insertBefore(createloadingdiv(),q.firstChild);console.log("querying url after mouseneter "+a[0].text);queryURLforpreview(a[0].text,b)},600))}d?expandDot(q,p,!0):showpostdescription(a,b)}}(event,g));600<screenWidth&&600<screenHeight&&null==f&&l.addEventListener("mouseleave",function(a,b){return function(a){var d=Date.now();if(null!=c&&0<c&&200>d-c)return clearTimeout(w[b]),w[b]=null,e=!1;d=!isdotafolder(posts[b].tags);
e=!1;q=document.getElementById("dot-"+b);console.log("came in  mouseout event on dot "+b+" left "+q.left+" top "+q.top+" doexpand "+d);d?shrinkdot(q):(showpostdescription(a,b,!0),removeDotConnections("dot-"+b))}}(event,g));k||r.addEventListener("long-press",function(a,b){return function(a){handlelongpress(a,b)}}(event,g));if(0==g&&null==f){document.body.addEventListener("click",topicdocumentclick);var n;null!=document.getElementById("topic-page-id")&&(n=document.getElementById("topic-page-id"));null!=
document.getElementById("flake-page-id")&&(n=document.getElementById("flake-page-id"));n.addEventListener("unload",function(a){document.body.removeEventListener("click",topicdocumentclick)})}"undefined"!=typeof a[g].hit&&0<a[g].hit.length&&0<parseInt(a[g].hit)||("undefined"==typeof f||null==f?(m=h[g].pcolor,l.style.backgroundColor=m,l.savedpastel=m,l.setAttribute("data-saved-bg-clr",m)):l.style.backgroundColor="#d2d2d2");k&&(l.style.display="none");l.style.position="absolute";l.style.zIndex="5";null!=
f&&(l.style.zIndex="4");isdotafolder(a[g].tags)&&(l.style.borderRadius="35%");l.style.width=h[g].width;l.style.height=h[g].width;setTimeout(function(b,c,d){return function(){b.appendChild(c);c.appendChild(r);var e=isdotafolder(a[d].tags),g=null;try{g=a[d].data}catch(G){}var h=null;h=null==g||null==g.text||0==g.text.length?a[d].text:g.text;var k=document.createElement("div");k.classList.add("dot-disp-text");k.style.display="flex";k.style.justifyContent="center";k.style.alignItems="center";k.style.fontSize=
"min(14px, 0.9vw)";k.style.width="100%";k.style.height="100%";k.style.whiteSpace="nowrap";k.style.overflow="hidden";k.style.textAlign="center";k.style.position="absolute";k.style.top="0";k.style.left="0";if(e){var l=null;"undefined"!=typeof a[d].summary&&null!=a[d].summary&&(l=!isBase64JSON(a[d].summary)&&isValidBase64(a[d].summary)?atob(a[d].summary):a[d].summary);null==f&&r.addEventListener("click",function(){showpostdescription(null,d,!0);removeDotConnections("dot-"+d);loadsubtopic(a[d].topic+
"/"+h,l)});if(null!=h&&null==f){var m=getDisplayLetters(h);document.getElementById("dot-"+d).style.color="#f3f3f3";k.innerText=m;document.getElementById("dot-"+d).appendChild(k);document.getElementById("dot-"+d).style.cursor="pointer"}}else null!=h&&null==f&&(m=getDisplayLetters(h),null!=g&&null!=g.abbr&&(m=g.abbr),document.getElementById("dot-"+d).style.color="#f3f3f3",k.innerText=m,document.getElementById("dot-"+d).appendChild(k)),createpopupdiv(a[d],d,null,!1,void 0+startsize,void 0+startsize);
if(d==a.length-1)if("undefined"!=typeof f&&null!=f){g=[];for(e=0;e<a.length;e++)g.push("sub-"+f+"-"+e);0<g.length&&connectDots(f,g)}else{var q=function(a){return new Promise(b=>setTimeout(b,a))};g=document.getElementById("dot-0");isdotafolder(posts[0].tags)||null!=a[0].data||(console.log("No summary data found in post "+d+" pulling from server"),g.insertBefore(createloadingdiv(),g.firstChild),retrievepostsummaryandshowinpopup(posts[0],0,null));k=g.querySelector(".text-container");if(null!=k&&null!=
k.innerText&&null==k.querySelector(".url-preview")){let a=extractURLFromText(k.innerText);"undefined"!=typeof a&&0<a.length&&(null==g.querySelector("#displayloadingcontainer")&&(console.log("Line 812 insert loader in dot "+g.id),g.insertBefore(createloadingdiv(),g.firstChild)),setTimeout(function(){a[0].text.startsWith("https://newauth.io/")||queryURLforpreview(a[0].text,0)},1200))}e?showpostdescription(null,d,!0):increasesizesoftopdots();(async function(){isdotafolder(posts[0].tags)&&(await q(400),
expandDot(document.getElementById("dot-0")),await q(2500),shrinkdot(document.getElementById("dot-0")));await q(300)})()}}}(d,l,g),50);l.style.opacity=window.getComputedStyle(l).getPropertyValue("opacity");l.style.transform=window.getComputedStyle(l).getPropertyValue("transform");k=0;"undefined"!=typeof a[g].week&&null!=a[g].week&&0<a[g].week.length&&(k=parseInt(moment().week())-parseInt(a[g].week));0!=k?0<k?(l.style.opacity=Math.max(.04,1-.15*k),console.log("setting lower opacity for weekdiff "+k+
" "+(1-.15*k))):(l.style.opacity=Math.max(.04,1-.1*(52+k)),console.log("setting lower opacity for weekdiff "+k+" "+(1-.15*(52+k)))):l.style.opacity=1}}"undefined"!=typeof c&&0<c.length&&0==e&&displaybuttonbehavior(null,"No match found")}console.log("total unique values in hashset "+setofhashes.size);console.log("dot sizes",dotsizemap)}
function toggleFullScreenLoadingOverlay(a){var b=document.getElementById("loading-overlay");const c=document.getElementById("loading-overlay-style");if(a){var f=function(){const a=document.createElement("div"),b=`move-${Math.random().toString(36).substr(2,6)}`,c=Math.floor(40*Math.random()-20),k=Math.floor(40*Math.random()-20),l=Math.floor(40*Math.random()-20),m=Math.floor(40*Math.random()-20),n=Math.floor(40*Math.random()-20),w=Math.floor(40*Math.random()-20),q=document.createElement("style");q.textContent=
`
                @keyframes ${b} {
                    0% { transform: translate(0, 0); }
                    25% { transform: translate(${c}px, ${k}px); }
                    50% { transform: translate(${l}px, ${m}px); }
                    75% { transform: translate(${n}px, ${w}px); }
                    100% { transform: translate(0, 0); }
                }
            `;document.head.appendChild(q);a.className="loading-dot";Object.assign(a.style,{position:"absolute",width:"26px",height:"26px",borderRadius:"50%",backgroundColor:"#888",left:`${100*Math.random()}%`,top:`${100*Math.random()}%`,animation:`fadeInOutOnce 3s ease-in-out forwards, ${b} 2s ease-in-out infinite`});d.appendChild(a);setTimeout(()=>{a.remove();q.remove();f()},3E3)};if(!b){c||(a=document.createElement("style"),a.id="loading-overlay-style",a.textContent="\n                @keyframes fadeInOutOnce {\n                    0% { opacity: 0; }\n                    50% { opacity: 1; }\n                    100% { opacity: 0; }\n                }\n            ",
document.head.appendChild(a));var d=document.createElement("div");d.id="loading-overlay";Object.assign(d.style,{position:"fixed",top:0,left:0,width:"100vw",height:"100vh",background:"rgba(255, 255, 255, 0.9)",zIndex:9999,pointerEvents:"none",overflow:"hidden"});document.body.appendChild(d);a=Math.floor(11*Math.random())+10;for(b=0;b<a;b++)setTimeout(f,1E3*Math.random())}}else b&&b.remove(),c&&c.remove()}
function getDisplayLetters(a){if(isJSON(a)){a=JSON.parse(JSON.parse(a));const b=Object.keys(a);a=a[b[0]]}a=a.split(" ");return 1==a.length&&5>a[0].length?a[0].toUpperCase():a.map((a,c)=>2>c?a.charAt(0).toUpperCase():"").join("")}function isBase64JSON(a){if(!isValidBase64(a))return!1;try{const b=atob(a),c=JSON.parse(b);if("object"===typeof c&&null!==c)return!0}catch(b){}return!1}function isValidBase64(a){try{return btoa(atob(a))===a}catch(b){return!1}}
function isdotafolder(a){if("undefined"!=typeof a&&null!=a)for(var b=0;b<a.length;b++)if(a[b].toLowerCase().startsWith("folder"))return!0;return!1}function loadcontentlocally(a){if("undefined"!==typeof Storage){if(null!=localStorage.getItem("CONTENT::"+a)){let b=JSON.parse(localStorage.getItem("CONTENT::"+a));b.hits="undefined"!=typeof b.hits?b.hits+1:1;localStorage.setItem("CONTENT::"+a,JSON.stringify(b));return b.items}return[]}console.warn("Local storage not supported ")}
function loadsubtopic(a,b){posts=[];var c=document.getElementsByClassName("dot");removediv(document.getElementById("summary-text-container"));Array.from(c).forEach(function(a){a.parentNode.removeChild(a)});var f=a.split("/");if(null!=topicstorage&&0<=topicstorage.indexOf("client"))setheaderbasedonsubtopic(a),posts=loadcontentlocally(a),console.log("about to display "+posts.length+" in loadsubtopic"),displaypostsasdots(posts),"undefined"!=typeof b&&null!=b&&(document.getElementById("infomodalbodycontent").innerText=
b,displaysubtopicsummary(b)),topiccurrentdepth=f.length-1;else{var d=new XMLHttpRequest;d.open("GET","/newauth/api/getpostsbytopic/"+a,!1);d.setRequestHeader("Content-Type","application/json");d.onreadystatechange=function(){if(4==d.readyState&&200==d.status){setheaderbasedonsubtopic(a);"undefined"!=typeof b&&null!=b&&(document.getElementById("infomodalbodycontent").innerText=b,displaysubtopicsummary(b));var c=d.responseText;null!=c&&10<c.length&&(posts=JSON.parse(c),console.log("about to display "+
posts.length+" in loadsubtopic 2"),displaypostsasdots(posts));topiccurrentdepth=f.length-1}};d.send(null)}}
function previewsubtopic(a,b){if(null!=topicstorage&&0<=topicstorage.indexOf("client"))a=loadcontentlocally(a),console.log("about to display "+a.length+" in previewsubtopic"),displaypostsasdots(a,void 0,void 0,b);else{var c=new XMLHttpRequest;c.open("GET","/newauth/api/getpostsbytopic/"+a,!1);c.setRequestHeader("Content-Type","application/json");c.onreadystatechange=function(){if(4==c.readyState&&200==c.status){var a=c.responseText;null!=a&&10<a.length&&(a=JSON.parse(a),console.log("about to display "+
posts.length+" in previewsubtopic 2"),displaypostsasdots(a,void 0,void 0,b))}};c.send(null)}}
function connectDots(a,b){var c=document.getElementById(a);if(c){c=c.getBoundingClientRect();var f=c.left+c.width/2,d=c.top+c.height/2,e=document.createElementNS("http://www.w3.org/2000/svg","svg");e.style.position="absolute";e.style.top="0";e.style.left="0";e.style.width="100%";e.style.height="100%";e.style.pointerEvents="none";e.class="connector-"+a;document.body.appendChild(e);b.forEach(b=>{function c(a){a=Math.min((a-n)/200,1);const b=d+(l-d)*a;m.setAttribute("x2",(f+(h-f)*a).toString());m.setAttribute("y2",
b.toString());1>a&&requestAnimationFrame(c)}if(b=document.getElementById(b)){b=b.getBoundingClientRect();var h=b.left+b.width/2,l=b.top+b.height/2,m=document.createElementNS("http://www.w3.org/2000/svg","line");m.setAttribute("x1",f.toString());m.setAttribute("y1",d.toString());m.setAttribute("x2",f.toString());m.setAttribute("y2",d.toString());m.setAttribute("stroke","rgba(200, 200, 200, 0.5)");m.setAttribute("stroke-width","2");e.appendChild(m);window.dotConnections||(window.dotConnections=new Map);
window.dotConnections.has(a)||window.dotConnections.set(a,[]);window.dotConnections.get(a).push(m);var n=performance.now();requestAnimationFrame(c)}})}}
function removeDotConnections(a){if(window.dotConnections&&window.dotConnections.has(a)){var b=document.querySelectorAll(`div[id^="sub-${a}-"]`);Array.from(b).forEach(a=>a.remove());window.dotConnections.get(a).forEach(a=>{function b(d){d=Math.min((d-c)/300,1);const f=k+(h-k)*d;a.setAttribute("x2",(g+(e-g)*d).toString());a.setAttribute("y2",f.toString());1>d?requestAnimationFrame(b):(a.parentNode&&a.parentNode.removeChild(a),0===window.dotConnections.size&&(d=document.querySelector("svg"))&&d.parentNode&&
d.parentNode.removeChild(d))}const c=performance.now(),e=parseFloat(a.getAttribute("x1")),h=parseFloat(a.getAttribute("y1")),g=parseFloat(a.getAttribute("x2")),k=parseFloat(a.getAttribute("y2"));requestAnimationFrame(b)});window.dotConnections.delete(a)}}
function displaysubtopicsummary(a){const b=document.createElement("div");b.id="summary-text-container";b.title=a;b.style.position="fixed";b.style.bottom="0";b.style.right="10";b.style.width="40vw";b.style.maxHeight="20vh";b.style.overflow="hidden";b.style.zIndex=1;b.style.padding="10px";b.style.boxSizing="border-box";b.style.color="#d9d9d9";let c="",f=2;a.split(" ").forEach(a=>{if(c.length+a.length>calculateCharactersFit(f,35)){const a=document.createElement("span");a.style.display="block";a.style.fontSize=
f+"vw";a.textContent=c;b.appendChild(a);c="";f-=.2}c+=a+" "});c&&(a=document.createElement("span"),a.style.display="block",a.style.fontSize=f+"vw",a.textContent=c,b.appendChild(a));document.body.appendChild(b)}function calculateCharactersFit(a,b){const c=document.createElement("span");c.style.fontSize=a+"vw";c.style.visibility="hidden";c.textContent="v";document.body.appendChild(c);a=c.offsetWidth;document.body.removeChild(c);return Math.floor(b/100*window.innerWidth/a)}
function setheaderbasedonsubtopic(a){const b=a.split("/");var c=b[0],f="";document.getElementById("topic-header-main").innerHTML="";var d=0;b.forEach(function(a){0==d?f+='\x3ca href\x3d"/t/'+a+"\" style\x3d'color:#858585; '\x3e"+a+"\x3c/a\x3e":(c+="/"+a,f=d==b.length-1?f+(" | \x3ca href\x3d\"javascript:loadsubtopic('"+c+"');\" style\x3d'color:#656565; text-shadow:0px 1px 1px #858585'\x3e"+a+"\x3c/a\x3e"):f+(" | \x3ca href\x3d\"javascript:loadsubtopic('"+c+"');\" style\x3d'color:#858585;'\x3e"+a+"\x3c/a\x3e"));
d++});topicname=c;document.getElementById("topic-header-main").innerHTML=f}
function increasesizesoftopdots(){if(null!=sortfield&&2<sortvalues.length&&"undefined"!=typeof posts[0].data[sortfield])for(var a=0;a<posts.length;a++)posts[a].data[sortfield]==sortvalues[0]&&scaledotsize("dot-"+parseInt(a),2),posts[a].data[sortfield]==sortvalues[1]&&scaledotsize("dot-"+parseInt(a),1.618);else{for(a=0;a<.2*posts.length;a++)scaledotsize("dot-"+parseInt(a),2);for(a=.2*posts.length;a<posts.length/2;a++)scaledotsize("dot-"+parseInt(a),1.618);for(a=posts.length/2;a<posts.length;a++)scaledotsize("dot-"+
parseInt(a),.5),document.getElementById("dot-"+parseInt(a)).style.opacity=.6}}
function scaledotsize(a,b){if(a=document.getElementById(a)){if(a.data&&"undefined"!=typeof a.data.resize&&null!=a.data.resize){var c=a.data.resize;if(2<c*b){console.log("Already "+c+" times original. Cant expand to "+c*b);return}}"undefined"===typeof a.savedRect&&(a.savedRect=a.getBoundingClientRect());if(1===b)a.classList.remove("resized"),a.setAttribute("data-resize",b),a.style.transition="none",a.style.width=a.savedRect.width+"px",a.style.height=a.savedRect.height+"px",a.style.left=a.savedRect.left+
"px",a.style.top=a.savedRect.top+"px";else{a.classList.add("resized");a.data&&null!=a.data.resize?a.setAttribute("data-resize",a.data.resize*b):a.setAttribute("data-resize",b);c=parseFloat(getComputedStyle(a).width);b*=c;var f=parseFloat(getComputedStyle(a).left),d=parseFloat(getComputedStyle(a).top);a.style.transition="all 0.6s";a.style.width=b+"px";a.style.height=b+"px";a.style.left=f-(b-c)/2+"px";a.style.top=d-(b-c)/2+"px"}}}
function expandDot(a,b,c){if(null!=a){if("undefined"==typeof a.savedRect)if(null!=b)a.savedRect=b;else return;b=a.savedRect;var f=document.getElementsByClassName("expanded-dot");if(null!=f&&0<f.length)for(var d=0;d<f.length;d++)shrinkdot(f[d]);f=a.querySelector(".text-container");d=null;null!=a.getElementsByTagName("img")&&(d=a.getElementsByTagName("img")[0]);var e=window.innerWidth/2,h=window.innerHeight/2,g=b.left+b.width/2,k=b.top+b.height/2,l=Math.min(window.innerWidth,window.innerHeight)/(4*
b.width),m=parseFloat((window.innerWidth/window.innerHeight).toFixed(4));a.style.transition="all 0.7s cubic-bezier(.42,.97,.52,1.29)";var n=a.querySelector(".concentric-square");g>e&&(a.style.left=`${b.left-b.width*(l-1)}px`);k>h&&(a.style.top=`${b.top-b.width*(l-1)}px`);n.style.width=`${b.width*l*m}px`;n.style.height=`${b.height*l}px`;n.style.borderRadius="10px";a.style.width=`${b.width*l*m}px`;a.style.height=`${b.height*l}px`;a.style.borderRadius="10px";a.style.zIndex=7;a.style.backgroundColor=
"#DAA520";a.style.backgroundColor="#008080";a.style.backgroundColor="#FF6F61";a.style.backgroundColor="#BB8610";a.style.backgroundImage="";a.style.opacity=1;a.style.boxShadow="2px 2px 5px rgba(0, 0, 0, 0.3)";null!=f&&(f.style.opacity=1,f.style.font="12px Lato, sans-serif; color: #d3d3d3",f.style.display="flex",f.style.flexDirection="column",f.style.visibility="visible",f.style.height="100%",f.style.width="90%",f.style.transition="opacity 0.3s cubic-bezier(.42,.97,.52,1.29)");null!=d&&(d.style.opacity=
1,d.style.transitionDelay="0.5s",d.style.zIndex=3,0>d.src.indexOf("/static/icons/file.png")&&(d.style.minWidth="100%",d.style.top="0",d.style.left="0",d.style.maxHeight="50%"));console.log("new expanded style applied to id "+a.id);b=a.getElementsByClassName("dot-disp-text");null!=b&&0<b.length&&b[0]&&(b[0].style.display="none");a.classList.add("expanded-dot");(b=a.querySelector(".play-button"))?(b.style.display="flex",console.log("autoplay "+c),c&&setTimeout(()=>{playytvideo(a)},500)):addPlayButtonAndVideo(a);
if(c=a.querySelector(".open-icon"))a.querySelector(".dot-popup").style.zIndex="7",c.style.display="flex";if(c=a.querySelector(".copy-icon"))a.querySelector(".dot-popup").style.zIndex="7",c.style.display="flex"}}function loadNextPage(){currentPage<maxPage?(currentPage++,fetchPage(currentPage-1),toggleFullScreenLoadingOverlay(!0)):(document.getElementById("next-btn-id").style.backgroundColor="#c2c2c2",toggleFullScreenLoadingOverlay(!1),displayNoMoreDataMessage())}
function loadPreviousPage(){currentPage>minPage?(currentPage--,fetchPage(currentPage-1),toggleFullScreenLoadingOverlay(!0)):document.getElementById("prev-btn-id").style.backgroundColor="#c2c2c2"}function fetchPage(a){2>=a?window.location.href="/t/earnings/"+a:displayNoMoreDataMessage();toggleFullScreenLoadingOverlay(!1)}
function displayPageAttributes(a,b){const c=document.createElement("span");c.id="infoBox";Object.assign(c.style,{position:"absolute",top:"2px",right:"5px",padding:"4px",backgroundColor:"rgb(248, 249, 250)",border:"1px solid rgb(204, 204, 204)",borderRadius:"4px",boxShadow:"rgba(0, 0, 0, 0.1) 2px 2px 10px",display:"flex",alignItems:"center",zIndex:"9999",gap:"8px"});const f=document.createElement("span");f.innerHTML=`<strong>${a}</strong> | ${b}`;c.appendChild(f);a=createNavButton("\u2039",loadPreviousPage,
"prev-btn-id");b=createNavButton("\u203a",loadNextPage,"next-btn-id");a.disabled=1===currentPage;b.disabled=currentPage===maxPage;a.disabled&&(a.style.backgroundColor="#c2c2c2");b.disabled&&(b.style.backgroundColor="#c2c2c2");c.appendChild(a);c.appendChild(b);document.body.appendChild(c)}
function createNavButton(a,b,c){const f=document.createElement("button");f.innerHTML=a;f.id=c;Object.assign(f.style,{padding:"3px 8px",border:"none",backgroundColor:"rgb(0, 123, 255)",color:"white",cursor:"pointer",borderRadius:"3px",fontSize:"16px",transition:"background-color 0.3s ease"});f.onclick=b;f.onmouseover=()=>f.style.backgroundColor="rgb(0, 100, 200)";f.onmouseleave=()=>f.style.backgroundColor="rgb(0, 123, 255)";return f}
function displayNoMoreDataMessage(){const a=document.getElementById("topic-app"),b=document.createElement("div");b.textContent="No more data available";b.style.fontWeight="bold";b.id="noMoreDataMessage";a.appendChild(b);setTimeout(()=>{b.remove()},1E4)}
function shrinkdot(a){var b="undefined"!=typeof a.savedRect?a.savedRect:a.getBoundingClientRect();var c=a.querySelector(".text-container"),f=null;null!=a.getElementsByTagName("img")&&(f=a.getElementsByTagName("img")[0]);var d=window.getComputedStyle(a).getPropertyValue("width").replace("px",""),e=d/maxdotsize;null!=a.querySelector("#displayloadingcontainer")&&removediv(a.querySelector("#displayloadingcontainer"));const h=a.querySelector(".concentric-square");a.style.transition="all 0.5s cubic-bezier(.42,.97,.52,1.29)";
a.style.top=`${b.top}px`;a.style.left=`${b.left}px`;a.style.bottom="";a.style.right="";a.style.width=maxdotsize+"px";a.style.opacity="";a.style.height=maxdotsize+"px";h.style.width=maxdotsize+"px";h.style.height=maxdotsize+"px";h.style.top="50%";h.style.left="50%";h.style.transform="translate(-50%, -50%)";h.style.zIndex=6;a.style.backgroundColor=a.savedpastel;a.style.borderRadius="50%";a.style.zIndex=5;a.style.fontSize=d/(3*e);null!=c&&(c.style.opacity="0");null!=f&&0>f.src.indexOf("/static/icons/file.png")&&
(f.style.maxHeight="100%");b=a.getElementsByClassName("dot-disp-text");null!=b&&0<b.length&&b[0]&&(b[0].style.display="flex");a.classList.remove("expanded-dot");console.log(" new width now "+a.style.width);b=a.querySelector("iframe");c=a.querySelector(".play-button");f=a.querySelector("img");b&&(b.src="about:blank",b.remove());c&&(c.style.display="none");f&&(f.style.display="block");if(b=a.querySelector(".open-icon"))a.querySelector(".dot-popup").style.zIndex="4",b.style.display="none";if(b=a.querySelector(".copy-icon"))a.querySelector(".dot-popup").style.zIndex=
"4",b.style.display="none"}function checkTopicContext(a){console.error("input URL, checking topic: "+a);try{return(new URL(a)).pathname.startsWith("/t/")}catch(b){return console.error("Invalid URL:",b),!1}}
function handlelongpress(a,b){function c(a){"touchstart"===a.type?(B=a.touches[0].clientX-w,u=a.touches[0].clientY-q):(B=a.detail.clientX-w,u=a.detail.clientY-q);a.target===h&&(l=!0)}function f(a){if(l){B=m;u=n;a=document.getElementsByClassName("attention-word-vertical");if(null!=a)for(var b=0;b<a.length;b++)a[b].style.opacity=0;h.style.cursor="default";drageventinstance=0;l=!1;document.removeEventListener("touchstart",c,!1);document.removeEventListener("touchend",f,!1);document.removeEventListener("touchmove",
d,!1);document.removeEventListener("mousedown",c,!1);document.removeEventListener("mouseup",f,!1);document.removeEventListener("mousemove",d,!1);clearAllSelection()}}function d(a){l&&0==drageventinstance%5&&(a.preventDefault(),"touchmove"===a.type?(m=a.touches[0].clientX-B,n=a.touches[0].clientY-u,console.log("currentx currenty "+m+" "+n)):(m=a.clientX-B,n=a.clientY-u),w=m,q=n,25<m+B&&m+B<window.innerWidth-25?h.style.transform="translate3d("+m+"px, "+n+"px, 0)":25>m+B?(0!=p&&clearTimeout(p),p=setTimeout(function(){addposttosaved(e,
h,inposts[b].crtime);"touchmove"===a.type&&(h.style.transform="scale(1)")},400)):(0!=p&&clearTimeout(p),p=setTimeout(function(){displaybuttonbehavior(e,"Deleted");addposttodeleted(posts[b].crtime);null!=topicstorage&&0<=topicstorage.indexOf("client")&&addposttodeleted(posts[b].crTime);removediv(h)},400)));drageventinstance++}console.log("in longpress handler idx "+b);var e=a;topicdocumentclick();var h=document.getElementById("dot-"+b);a.preventDefault();h.style.cursor="move";var g=document.getElementsByClassName("attention-word-vertical");
if(null!=g)for(var k=0;k<g.length;k++)attachtransitionstyles(g[k],1),g[k].style.opacity="0.9";var l=!1,m,n,w=0,q=0,p=0;g=document.getElementById("dot-desc-"+b);null!=g&&(g.style.opacity=0);document.addEventListener("touchstart",c,!1);document.addEventListener("touchend",f,!1);document.addEventListener("touchmove",d,!1);document.addEventListener("mousedown",c,!1);document.addEventListener("mouseup",f,!1);document.addEventListener("mousemove",d,!1);if("touchstart"===a.detail.type){var B=a.detail.clientX-
w;var u=a.detail.clientY-q;h.style.transform="scale(3)"}else B=a.detail.clientX-w,u=a.detail.clientY-q;l=!0}function clearAllSelection(){window.getSelection?window.getSelection().removeAllRanges():document.selection&&document.selection.empty()}function makelementpulsate(a,b){if("undefined"!=typeof c){var c;setTimeout(function(){a.classList.remove("pulsate")},1E3*b)}a.classList.add("pulsate")}
function pulsatenext(a,b){var c=document.getElementById("dot-"+a);c.classList.remove("pulsate");if(a<posts.length-1){var f=posts.length-1-a;for(a+=1;a<f;a++)if(c=document.getElementById("dot-"+a),!checkifalreadyseen(posts[a].crtime)){if("undefined"!=typeof d){var d=1E3*b;setTimeout(function(){c.classList.remove("pulsate")},d)}c.classList.add("pulsate");console.log("Dot id "+a+" set to pulsate");break}}}
function getrandomdotsize(a,b,c,f){if(0==a)return f;for(var d=[1,2,3,5,8],e=rnd(0,100),h=0,g=0;g<b;g++)h+=d[g];d=0;c=parseInt((f-c)/b);"undefined"!=typeof posts[a].hit&&0<posts[a].hit.length&&0<parseInt(posts[a].hit)&&(parseInt(posts[a].hit)>=topichits/posts.length?e=1:parseInt(posts[a].hit)>=topichits/(2*posts.length)&&(e=100/h+1));for(g=0;g<b;g++){a=100/h*g;var k=100;g<b-1&&(k=100/h*(g+1));if(e>=a&&e<=k){d=f-c*g;break}}return parseInt(d)}
function shiftdotandpopupids(){for(var a=document.getElementsByClassName("dot"),b=0;b<a.length;b++){var c=parseInt(a[b].id.split("-")[a[b].id.split("-").length-1]);a[b].id="dot-"+parseInt(c+1)}b=document.getElementsByClassName("dot-popup");for(a=0;a<b.length;a++)c=parseInt(b[a].id.split("-")[b[a].id.split("-").length-1]),b[a].id="dot-popup-"+parseInt(c+1);b=document.getElementsByClassName("dot-desc");for(a=0;a<b.length;a++)c=parseInt(b[a].id.split("-")[b[a].id.split("-").length-1]),b[a].id="dot-desc-"+
parseInt(c+1);console.log("shifted all dot, popup and desc ids")}function splitschema(a){console.log("About to parse "+a);const b=JSON.parse(a),c=Object.keys(b).filter(a=>a.startsWith("---"));a=[];let f={};for(var d of Object.keys(b))c.includes(d)?(a.push(f),f={}):f[d]=b[d];a.push(f);for(d=0;d<a.length;d++)console.log(`Object ${d+1}:`,a[d]);return a}
function retrievepostsummaryandshowinpopup(a,b,c,f,d,e,h){var g=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");g.onreadystatechange=function(){if(4==g.readyState&&200==g.status){if(null!=document.getElementById("dot-"+b)&&null!=document.getElementById("dot-"+b).querySelector("#displayloadingcontainer")){var k=document.getElementById("dot-"+b).querySelector("#displayloadingcontainer");removediv(k)}k=JSON.parse(g.responseText);a.data=k.data;showpostdatainpopup(a,b,c,
f,d,e,h,!0)}};"undefined"==typeof a.crtime&&"undefined"!=typeof a.crTime&&(a.crtime=a.crTime);var k="/newauth/api/getpostsummarybytopicandtime/"+btoa(a.topic)+"/"+a.crtime;console.log("calling uriencoded url "+k);g.open("GET",k,!1);g.withCredentials=!0;g.setRequestHeader("Content-Type","application/json");g.send(null)}
function showpostdatainpopup(a,b,c,f,d,e,h,g){null!=document.getElementById("dot-"+b)&&(document.getElementById("dot-"+b).style.backgroundColor="#676767");if("undefined"==typeof h||0==h)for(var k=document.getElementsByClassName("dot-popup"),l=0;l<k.length;l++)k[l].id!="dot-popup-"+b&&(k[l].classList.remove("expand-open"),k[l].style.display="none");k=document.getElementById("dot-"+b).querySelector("#dot-popup-"+b);null==k?(k=createpopupdiv(a,b,c,f,d,e,h),console.log("non existing div :created now "+
b+" "+k)):"undefined"!=typeof g&&1==g&&(createpopupdiv(a,b,c,f,d,e,h),console.log("existing div "+b+" reloaded"))}
function createpopupdiv(a,b,c,f,d,e,h){c=!1;let g;f=null;null==document.getElementById("dot-"+b).querySelector("#dot-popup-"+b)?(g=document.createElement("div"),g.setAttribute("id","dot-popup-"+b),g.classList.add("text-container"),g.classList.add("dot-popup"),g.style.zIndex=7,g.style.position="relative",g.style.display="flex",g.style.flexDirection="column",g.style.whiteSpace="pre-wrap",c=!0):g=document.getElementById("dot-"+b).querySelector("#dot-popup-"+b);let k,l;"undefined"!=typeof a.crtime&&null!=
a.crtime&&(l=converttimediffmstocalendar(1E3*gettimedifferenceinsec(a.crtime)));"undefined"!=typeof a.text&&null!=a.text&&20<a.text.length&&a.text.substring(0,20);var m=null;"undefined"!==typeof a.data&&null!==a.data&&(isJSON(a.data)?(m=JSON.parse(a.data),"string"===typeof m.text&&50<m.text.length&&m.text.substring(0,50)):m=a.data);if(null!=m){d=extractimagefromfiles(m.files);null!=d&&null!=d.getElementsByTagName("img")&&0<d.getElementsByTagName("img").length&&(0>d.getElementsByTagName("img")[0].src.indexOf("/static/icons/file.png")&&
(e=document.getElementById("dot-"+b),null!=e&&null!=d.getElementsByTagName("img")[0]&&e.appendChild(d.getElementsByTagName("img")[0])),g.style.top="50%");null!=d&&null!=d.querySelector('[id^\x3d"obj-filename"]')&&(console.log("obj-heading extracted "+d.querySelector('[id^\x3d"obj-heading"]')),console.log("obj-filename extracted "+d.querySelector('[id^\x3d"obj-filename"]')),e=document.createElement("div"),e.style.width="100%",e.style.minHeight="40%",e.style.display="flex",e.style.flexDirection="column",
e.style.alignItems="center",e.style.justifyContent="center",e.appendChild(d),f=document.createElement("input"),f.setAttribute("id","file-view-button"),f.classList.add("btn"),f.style.marginBottom="20px",f.style.marginTop="20px",f.classList.add("btn-primary"),f.classList.add("btn-sm"),f.type="button",f.value="View",f.addEventListener("click",function(b){b=null;null!=m&&(b=m.text);getfullpost(topicname,a.crtime,a.lastseq,b,a.ownerflake,a.convid)},!1),e.appendChild(f),g.style.top="5%",(d=g.querySelector(".pop-footer"))?
g.insertBefore(e,d):g.appendChild(e));if("undefined"!=typeof m.thumbnailurl&&null!=m.thumbnailurl&&0<m.thumbnailurl.length){d=document.createElement("img");d.position="absolute";d.top="50%";d.left="50%";d.transform="translate(-50%, -50%)";d.minWidth="100%";d.minHeight="100%";d.width="auto";d.height="auto";if(m.thumbnailurl.includes("youtube")||m.thumbnailurl.includes("ytimg"))m.thumbnailurl=m.thumbnailurl.replace("/default.jpg","/maxresdefault.jpg");d.src=m.thumbnailurl;g.style.top="50%";e=document.getElementById("dot-"+
b);null!=e&&e.appendChild(d)}"undefined"!=typeof m.videourl&&null!=m.videourl&&0<m.videourl.length&&(d=document.createElement("img"),d.style.position="absolute",d.style.top="50%",d.style.left="50%",d.style.transform="translate(-50%, -50%)",d.width="25%",d.height="25%",d.src="/static/icons/play-64.png",e=document.getElementById("dot-"+b),null!=e&&e.appendChild(d));k=extractURLFromText(m.text);if(null!=k&&0<k.length&&4<m.text.length/k.length)d=document.createElement("div"),d.style.marginTop="5px",d.appendChild(document.createTextNode(cleanString(m.text))),
(e=g.querySelector(".pop-footer"))?g.insertBefore(d,e):g.appendChild(d),0==b&&setTimeout(function(){queryURLforpreview(k[0].text,b)},600);else if(d=document.createElement("div"),d.style.flexGrow=1,d.style.overflowY="auto",d.style.padding="8px",m.category){if("undefined"==typeof m.thumbnailurl||null==m.thumbnailurl){const a=document.createElement("ul");Object.entries(m).forEach(([b,c])=>{if(!["text","abbr","category"].includes(b)){const d=document.createElement("li");d.textContent=`${b.charAt(0).toUpperCase()+
b.slice(1)}: ${c}`;a.appendChild(d)}});d.appendChild(a);(e=g.querySelector(".pop-footer"))?g.insertBefore(d,e):g.appendChild(d)}displaysidepanel({id:b,text:cleanString(m.text),sent:l,views:a.hit,comments:a.comments})}else e=document.createElement("p"),e.style.marginTop="4px",e.appendChild(document.createTextNode(cleanString(m.text))),d.appendChild(e),(e=g.querySelector(".pop-footer"))?g.insertBefore(d,e):g.appendChild(d)}else null!=a.text&&0<a.text.length&&(isJSON(a.text)?g.appendChild(createStyledTextDiv(JSON.parse(JSON.parse(a.text)))):
(g.appendChild(document.createTextNode(a.text)),displaysidepanel({id:b,text:cleanString(a.text),sent:l,views:a.hit,comments:a.comments})));if(c&&"undefined"!=typeof a.crtime&&0<a.crtime){d=document.createElement("div");d.style.marginTop="auto";d.classList.add("pop-footer");d.style.padding="8px 12px";d.style.width="100%";e=document.createElement("hr");e.style.marginBottom="4px";d.appendChild(e);e=document.createElement("div");e.classList.add("row");e.style.display="flex";e.style.alignItems="center";
var n=document.createElement("div");n.classList.add("col-xs-8");n.classList.add("text-left");h=document.createElement("div");h.classList.add("col-xs-4");h.classList.add("text-right");e.appendChild(n);e.appendChild(h);null==a.giveout&&(a.giveout="");null!=a.comments&&(a.giveout+=" "+toApproximateWords(a.comments)+" comments");null!=a.hit&&(a.giveout+=" "+toApproximateWords(a.hit)+" views");var w=document.createElement("p");w.style.margin="0px";w.style.color="#f4f4f4";w.style.fontSize=12;if(600>screenWidth||
600>screenHeight)w.style.fontSize=8;w.style.overflow="hidden";w.appendChild(document.createTextNode(a.giveout));n.appendChild(w);n=document.createElement("p");n.style.color="#f4f4f4";n.style.margin="0px";n.style.fontSize=11;if(600>screenWidth||600>screenHeight)n.style.fontSize=8;n.classList.add("pull-right");n.appendChild(document.createTextNode(l));h.appendChild(n);d.appendChild(e);g.appendChild(d)}null!=k&&0<k.length&&!k[0].text.startsWith("https://newauth.io/")&&(c=!1);c||null!=f||g.addEventListener("click",
function(c){c.stopPropagation();console.log("popup click fired");c=100;null!=clickstarttime&&(c=new Date-clickstarttime,console.log("starttime "+clickstarttime+" "+c));if(100>=c){null!=document.getElementById("topic-app")?fadeoutelement("topic-app"):fadeoutelement("app-flk");null!=document.getElementById("dot-"+b)&&(document.getElementById("dot-"+b).style.backgroundColor="#a7a7a7");c=null;null!=m&&(c=m.text);if(null!=k&&0<k.length){if(k[0].text.startsWith("https://newauth.io/t")||canLoadInApp(k[0].text))getfullpost(topicname,
a.crtime,a.lastseq,c,a.ownerflake,a.convid,k[0].text);else{clearTimeout(appcalltimeoutid);appcalltimeoutid=null;c=document.querySelector("#displayloadingcontainer");console.log("loading div after url preview in createpopupdiv"+c);null!=c&&removediv(c);window.open(k[0].text,"_blank","noopener,noreferrer");return}addurlopenlinktopopup(m.text,g)}else getfullpost(topicname,a.crtime,a.lastseq,c,a.ownerflake,a.convid);c=document.createElement("div");c.setAttribute("id","post-comments");c.classList.add("panel-body");
c.classList.add("panel-word-wrap");c.classList.add("pre-scrollable");c.style.position="absolute";c.style.top="50px";c.style.right="5px";c.style.width="200px";c.style.maxHeight="60%";c.style.maxWidth="20%";c.style.overflowY="auto";c.style.overflowX="hidden";null!=document.getElementById("full-post-display")&&(600<window.innerWidth&&600<window.innerHeight&&document.getElementById("full-post-display").appendChild(c),null!=a.convid&&loadpostcommmentsontopicpage(a.convid,null,0,topicname))}else setTimeout(function(){clickstarttime=
null},1E3)});null!=k&&0<k.length&&(c=!0);c&&(null!=document.getElementById("dot-"+b)?document.getElementById("dot-"+b).appendChild(g):null!=document.getElementById("topic-app")?document.getElementById("topic-app").appendChild(g):document.getElementById("app-flk").appendChild(g),t);addcopylinktopopup(g);addPlayButtonAndVideo(document.getElementById("dot-"+b));return g}
function addcopylinktopopup(a){if(a)if(a.querySelector(".copy-icon"))console.log("Copy Icon Already exists for dot ");else{var b=document.createElement("span");b.className="copy-icon";if(!a.querySelector('.img-icon[src\x3d"/static/icons/copy-96.png"]')){var c=document.createElement("img");c.className="img-icon";c.src="/static/icons/copy-96.png";c.style.width="18px";c.style.height="18px";c.style.objectFit="contain";c.style.display="block";b.appendChild(c);c.title="Copy the dot"}Object.assign(b.style,
{margin:"2px",padding:"4px",color:"rgb(221, 221, 221)",cursor:"pointer",position:"absolute",width:"18px",height:"18px",fontSize:"18px",zIndex:"7",display:"none",alignItems:"center",justifyContent:"center",top:"10px",right:"10px"});a.querySelector(".open-icon")?(c=parseInt(a.querySelector(".open-icon").style.right||"10",10),console.log("right value of open icon "+c),b.style.right=`${c+24}px`):b.style.right="10px";b.addEventListener("click",()=>{alert("handle copy of dot.. ")});a.appendChild(b)}}
function addurlopenlinktopopup(a,b){let c=null;if(b.querySelector(".open-icon"))console.log("Open Icon Already exists for text "+a);else{var f=b.querySelector(".copy-icon"),d=extractURLFromText(a);null!=d&&0<d.length&&(c=document.createElement("span"),c.classList.add("open-icon"),b.querySelector('.img-icon[src\x3d"/static/icons/open-window-128.png"]')||(a=document.createElement("img"),a.className="img-icon",a.src="/static/icons/open-window-128.png",a.style.width="48",a.style.height="48",a.style.objectFit=
"contain",a.style.display="block",c.appendChild(a),a.title="Open in new window"),Object.assign(c.style,{margin:"2px",padding:"4px",color:"#ddd",cursor:"pointer",position:"absolute",width:"36px",height:"36px",fontSize:"18px",zIndex:"7",pointerEvents:"auto",display:"none",alignItems:"center",justifyContent:"center",top:"7px",right:"10px"}),c.addEventListener("click",function(a,b){return function(a){a.target.style.opacity=.7;d[0].text.startsWith("https://newauth.io/t")||canLoadInApp(d[0].text)?(c.title=
"Read full post",getfullpost(topicname,info.crtime,info.lastseq,txt,info.ownerflake,info.convid,d[0].text),setTimeout(function(){a.target.style.opacity=1},5E3)):window.open(d[0].text,"_blank","noopener,noreferrer")}}(event,d)));null!=c&&(c.style.top="10px",c.style.right="10px",f?(b.insertBefore(c,f),b=parseInt(f.style.right||"10",10),console.log("right value of copy icon "+b),c.style.right=`${b+24}px`):(b.appendChild(c),c.style.right="10px"))}}
function addPlayButtonAndVideo(a){var b=a.querySelector("img");if(b)var c=extractVideoId(b.src);c&&(b=document.createElement("div"),b.className="play-button",b.innerHTML='\n\t        \x3csvg height\x3d"100%" version\x3d"1.1" viewBox\x3d"0 0 68 48" width\x3d"100%"\x3e\n\t            \x3cpath class\x3d"ytp-large-play-button-bg" d\x3d"M66.52,7.74c-0.78-2.93-2.49-5.41-5.42-6.19C55.79,.13,34,0,34,0S12.21,.13,6.9,1.55 C3.97,2.33,2.27,4.81,1.48,7.74C0.06,13.05,0,24,0,24s0.06,10.95,1.48,16.26c0.78,2.93,2.49,5.41,5.42,6.19 C12.21,47.87,34,48,34,48s21.79-0.13,27.1-1.55c2.93-0.78,4.64-3.26,5.42-6.19C67.94,34.95,68,24,68,24S67.94,13.05,66.52,7.74z" fill\x3d"#f00"\x3e\x3c/path\x3e\n\t            \x3cpath d\x3d"M 45,24 27,14 27,34" fill\x3d"#fff"\x3e\x3c/path\x3e\n\t        \x3c/svg\x3e\n\t    ',
b.style.cssText="\n\t        position: absolute;\n\t        top: 25%;\n\t        left: 50%;\n\t        transform: translate(-50%, -50%);\n\t\t\twidth: min(68px, 10vw);\n\t\t    height: min(48px, 7vw);\n\t\t    min-width: 40px;\n\t\t    min-height: 28px;\n\t        cursor: pointer;\n\t\t\tdisplay: none;\n\t        z-index: 4;\n\t    ",a.appendChild(b),b.addEventListener("click",b=>playytvideo(a,c,b)))}
function playytvideo(a,b,c){c&&c.stopPropagation();c=a.querySelector("img");b||(b=extractVideoId(c.src));const f=document.createElement("iframe");f.src=`https://www.youtube.com/embed/${b}?rel=0&autoplay=1&mute=1&autohide=1&border=0&wmode=opaque&enablejsapi=1&modestbranding=1&showinfo=0&controls=1`;f.style.cssText="\n            position: absolute;\n            top: 0;\n            left: 0;\n            width: 100%;\n            height: 50%;\n            border: none;\n            z-index: 6;\n        ";
a.appendChild(f);const d=a.querySelector(".play-button");d.style.transition="opacity 0.5s ease-out";d.style.opacity="0";setTimeout(()=>{d.remove()},500);c.style.display="none"}function extractVideoId(a){return(a=a.match(/\/vi\/([^\/]+)\//))?a[1]:null}
function displaysidepanel(a){const b=Array.isArray(a)?a:[a];sidecontainer||(sidecontainer=document.createElement("div"),sidecontainer.id="object-list-sidecontainer",sidecontainer.style.cssText="\n            position: fixed;\n            right: 20px;\n            top: 50px;\n            bottom: 20px;\n            width: 250px;\n\t\t\topacity: 0.9;\n            overflow-y: auto;\n            background-color: #f0f0f0;\n            border-radius: 10px;\n            box-shadow: 0 0 10px rgba(0,0,0,0.1);\n            padding: 15px;\n            font-family: Arial, sans-serif;\n\t\t\tz-index: 12;\n        ",document.body.appendChild(sidecontainer),
a=document.createElement("style"),a.textContent="\n            #object-list-sidecontainer::-webkit-scrollbar {\n                width: 10px;\n            }\n            #object-list-sidecontainer::-webkit-scrollbar-track {\n                background: #f1f1f1;\n                border-radius: 10px;\n            }\n            #object-list-sidecontainer::-webkit-scrollbar-thumb {\n                background: #888;\n                border-radius: 10px;\n            }\n            #object-list-sidecontainer::-webkit-scrollbar-thumb:hover {\n                background: #555;\n            }\n        ",
document.head.appendChild(a));a=document.getElementById("summary-panel");a||(a=document.createElement("div"),a.id="summary-panel",a.style.cssText="\n\t\t\t\tbackground-color: #e0e0e0;\n\t            padding: 10px;\n\t            margin-bottom: 15px;\n\t            border-radius: 5px;\n\t            font-weight: bold;\n\t            position: fixed;\n\t            top: 0px;\n\t\t\t\twidth: 220px;\n\t            z-index: 4;\n\t        ",sidecontainer.prepend(a));b.forEach(a=>{totalViews+=a.views||0;
totalComments+=a.comments||0;totalRecords+=1});var c=toApproximateWords(totalRecords),f=toApproximateWords(totalViews);let d=toApproximateWords(totalComments);a.innerHTML=`
		  <div id="record-header" style="display: flex; justify-content: space-between; cursor: pointer;">
		    <span>Records: ${c}</span>
		  </div>
		  <div style="display: flex; justify-content: space-between;">
		    <span>Views: ${f}</span>
		    <span>Comments: ${d}</span>
		  </div>
		`;c=sortvalues;let e=document.createElement("div");e.id="sliding-panel";e.style.cssText="\n\t\t  display: none;\n\t\t  margin-top: 10px;\n\t\t  padding: 10px;\n\t\t  border-top: 1px solid #ccc;\n\t\t  animation: slideDown 0.3s ease-out;\n\t\t  display: grid;\n\t\t  grid-template-columns: repeat(4, 1fr);\n\t\t  gap: 8px;\n\t\t";null!=c&&0<c.length&&c.forEach(a=>{const b=document.createElement("a");b.textContent=a;b.classList.add("link-item");b.addEventListener("click",c=>{c.stopPropagation();console.log("filtering "+
sortfield+":::"+a);b.classList.contains("active-filter")?(b.classList.remove("active-filter"),displaypostsasdots(posts,!1,sortfield+":::ALL")):(document.querySelectorAll(".link-item").forEach(a=>a.classList.remove("active-filter")),b.classList.add("active-filter"),displaypostsasdots(posts,!1,sortfield+":::"+a))});b.addEventListener("mouseenter",b=>{b.stopPropagation();console.log("filtering PREVIEW:::"+sortfield+":::"+a);displaypostsasdots(posts,!1,"PREVIEW:::"+sortfield+":::"+a)});b.addEventListener("mouseleave",
b=>{b.stopPropagation();console.log("removing filter PREVIEW:::"+sortfield+":::"+a);displaypostsasdots(posts,!1,"PREVIEW:::"+sortfield+":::ALL")});e.appendChild(b)});c=document.createElement("style");c.textContent="\n\t\t  .link-item {\n\t\t    display: block;\n\t\t    padding: 4px;\n\t\t    background: #f0f0f0;\n\t\t    text-align: center;\n\t\t    text-decoration: none;\n\t\t    border-radius: 4px;\n\t\t    color: #333;\n\t\t    transition: background 0.2s ease, color 0.2s ease;\n\t\t  }\n\n\t\t  .link-item:hover {\n\t\t    background: #e0e0ff;\n\t\t    color: #00008b;\n\t\t  }\n\n\t\t  .link-item:active {\n\t\t    background: #c0c0ff;\n\t\t    color: #000066;\n\t\t  }\n\t\t  .link-item.active-filter {\n\t\t    background: #ffdcdc;\n\t\t    color: #8b0000;\n\t\t    font-weight: bold;\n\t\t  }\n\t\t";
document.head.appendChild(c);a.appendChild(e);document.getElementById("record-header").addEventListener("click",()=>{e.style.display="none"===e.style.display?"grid":"none"});const h=sidecontainer.children;for(c=0;c<h.length;c++)f=h[c],f.style.transition="transform 0.5s ease",f.style.transform=`translateY(${60*b.length}px)`;b.forEach((a,b)=>{const c=document.createElement("div");c.id=`dot-sidepanel-${a.id}`;c.style.cssText="\n            background-color: #ffffff;\n            margin-bottom: 10px;\n            padding: 10px;\n            border-radius: 5px;\n            box-shadow: 0 2px 5px rgba(0,0,0,0.05);\n            transition: transform 0.2s ease, opacity 0.5s ease;\n            opacity: 0;\n\t\t\tz-index: 3;\n            transform: translateY(-20px);\n            position: relative;\n        ";
var d=document.createElement("span");d.textContent=a.text;c.appendChild(d);d=document.createElement("span");d.textContent=a.sent;d.style.cssText="\n            position: absolute;\n            bottom: 5px;\n            right: 5px;\n            font-size: 0.8em;\n            color: #888;\n        ";c.appendChild(d);c.addEventListener("mouseover",((a,b)=>()=>{a.style.transform="scale(1.02) translateY(0)";a.style.backgroundColor="#ffffcc";const c=document.getElementById("dot-"+b.id);c&&expandDot(c,c.getBoundingClientRect())})(c,
a));c.addEventListener("mouseout",((a,b)=>()=>{a.style.transform="scale(1) translateY(0)";a.style.backgroundColor="#ffffff";const c=document.getElementById("dot-"+b.id);c&&shrinkdot(c)})(c,a));sidecontainer.append(c);setTimeout(()=>{c.style.opacity=.9;c.style.transform="translateY(0)"},100*(b+1))});setTimeout(()=>{for(let a=b.length;a<h.length;a++)h[a].style.transition="none",h[a].style.transform="none"},500);(c=sidecontainer.querySelector('[id^\x3d"dot-sidepanel-"]'))&&a&&(c.style.marginTop=`${a.offsetHeight+
15}px`);addSidePanelToggle();updateToggleButtonStyle()}function toggleSidePanel(){const a=document.getElementById("object-list-sidecontainer"),b=document.getElementById("side-panel-toggle");a&&b&&("250px"===a.style.width?(a.style.width="0",a.style.padding="0",a.style.right="-20px",b.textContent="\x3c",b.style.right="0"):(a.style.width="250px",a.style.padding="15px",a.style.right="20px",b.textContent="\x3e"))}
function addSidePanelToggle(){const a=document.getElementById("object-list-sidecontainer");var b=document.getElementById("side-panel-toggle");a&&!b&&(b=document.createElement("button"),b.id="side-panel-toggle",b.textContent="\x3e",b.style.position="fixed",b.style.top="50%",b.style.right="0",b.style.transform="translateY(-50%)",b.style.zIndex="1000",b.style.padding="10px 5px",b.style.fontSize="18px",b.style.backgroundColor="#f0f0f0",b.style.border="none",b.style.borderLeft="1px solid #ccc",b.style.cursor=
"pointer",b.addEventListener("click",toggleSidePanel),a.style.transition="width 0.3s ease-in-out",a.style.overflow="hidden",document.body.appendChild(b),a.style.width="250px",a.style.padding="15px",a.style.right="20px",a.style.overflowY="auto")}
function updateToggleButtonStyle(){const a=document.getElementById("side-panel-toggle");a&&(a.style.borderRadius="20px 0 0 20px",a.style.boxShadow="0 2px 5px rgba(0, 0, 0, 0.2)",a.style.background="linear-gradient(to right, #f0f0f0, #e0e0e0)",a.style.color="#333",a.style.transition="all 0.3s ease",a.addEventListener("mouseover",()=>{a.style.background="linear-gradient(to right, #e0e0e0, #d0d0d0)";a.style.boxShadow="0 4px 8px rgba(0, 0, 0, 0.3)"}),a.addEventListener("mouseout",()=>{a.style.background=
"linear-gradient(to right, #f0f0f0, #e0e0e0)";a.style.boxShadow="0 2px 5px rgba(0, 0, 0, 0.2)"}))}
function highlightAndScroll(a){var b=document.getElementById("object-list-sidecontainer");const c=document.getElementById(`dot-sidepanel-${a}`);b&&c&&(Array.from(b.children).forEach(a=>{a.style.backgroundColor="#ffffff"}),c.style.backgroundColor="#ffffcc",a=b.getBoundingClientRect(),b=c.getBoundingClientRect(),(b.top<a.top||b.bottom>a.bottom)&&c.scrollIntoView({behavior:"smooth",block:"center"}),setTimeout(()=>{c.style.backgroundColor="#ffffff"},6E3))}
function createStyledTextDiv(a){var b=Object.keys(a);const c=document.createElement("div");c.classList.add("dot-text-container");var f=0;b.forEach(b=>{if(b=a[b]){const a=document.createElement("div");a.style.display="flex";a.style.alignItems="center";const d=document.createElement("span");d.classList.add("copy-icon");d.innerHTML="\ud83d\udccb";d.title="Copy to clipboard";d.style.cursor="pointer";d.addEventListener("click",function(a,b){return function(a){copytexttocbandhighlight(b,"Data copied",a);
a.target.style.opacity=.7;setTimeout(function(){a.target.style.opacity=1},5E3)}}(event,b));const g=document.createElement("p");g.textContent=b;g.title=b;switch(f){case 0:g.style.fontWeight="bold";g.style.fontSize="1.2em";g.style.margin=0;break;case 1:g.style.fontStyle="italic";g.style.fontSize="1em";g.style.margin=0;break;case 2:g.style.fontFamily="Arial, sans-serif";g.style.fontSize="0.9em";g.style.margin=0;break;default:g.style.fontSize="1em",g.style.margin=0}f++;a.appendChild(d);a.appendChild(g);
c.appendChild(a)}});c.style.border="1px solid #ccc";c.style.padding="5px";c.style.margin="5px";document.querySelector("style.dot-text-container")||(b=document.createElement("style"),b.textContent="\n            .dot-text-container p {\n                white-space: nowrap;\n                overflow: hidden;\n                text-overflow: ellipsis;\n                max-width: 80%; /* Adjust the maximum width */\n            }\n            .dot-text-container p:hover {\n                \n            }\n        ",
b.classList.add("dot-text-container"),document.head.appendChild(b));return c}function canLoadInApp(a){try{fetch(a).then(a=>!0).catch(a=>!1)}catch(b){}return!1}function toApproximateWords(a){const b=["","k","m","b","t"];let c=0;for(;1E3<=a&&c<b.length-1;)a/=1E3,c++;return Math.floor(a)+b[c]}
function createloadingdiv(){var a=document.createElement("div");a.classList.add("row");var b=document.createElement("div");b.classList.add("col-xs-12");a.setAttribute("id","displayloadingcontainer");var c=document.createElement("div");c.classList.add("loader");var f=document.createElement("h5");f.appendChild(document.createTextNode("Loading..."));c.appendChild(f);b.appendChild(c);a.appendChild(b);a.style.display="inline-block";a.style.position="absolute";a.style.top="10px";return a}
function extractimagefromfiles(a){var b=!1,c=!1,f=null,d=0;if(null==a)return f;f=document.createElement("div");a.forEach(function(a,c){0>a.type.indexOf("image")&&(b=!0)});b&&a.forEach(function(a,b){if(0<=a.type.indexOf("image")||0<=a.type.indexOf("video"))c=!0});if(b)if(c)f=document.createElement("div"),f.style.height="100%",a.forEach(function(a,b){if(0<=a.type.indexOf("image")||0<=a.type.indexOf("video"))b=document.createElement("img"),b.style.maxHeight="50%",b.classList.add("img-responsive"),b.classList.add("center-block"),
b.src=a.thumbnail,null!=document.getElementById("topic-main-image")&&(document.getElementById("topic-main-image").src=a.thumbnail),f.appendChild(b);if(0>a.type.indexOf("image")){b=document.createElement("div");b.setAttribute("id","obj-heading-"+d);b.style.top="0px";b.style.maxWidth="90%";b.style.width="90%";b.style.color="#323232";b.style.textAlign="center";b.style.backgroundColor="#d2d2d2";b.style.opacity="0.8";b.style.position="absolute";b.style.top="0px";b.style.margin="0 auto";b.style.display=
"block";b.appendChild(document.createTextNode(a.type.replace("application/","")));b=document.createElement("div");b.setAttribute("id","obj-filename-"+d);b.style.color="#323232";b.style.marginRight="5px";b.style.backgroundColor="#d2d2d2";b.style.opacity="1";b.style.minWidth="60%";b.style.overflow="hidden";document.createElement("img").src="/static/icons/file.png";var c=document.createElement("div");a=document.createTextNode(a.name.split(".")[1]);if("undefined"==typeof a||null==a||0==a.length)a=document.createTextNode("unknown");
c.appendChild(a);b.appendChild(c);f.appendChild(b);d++}});else{var e=document.createElement("div");e.style.height="100%";var h=document.createElement("div");h.setAttribute("id","obj-heading-"+d);h.style.top="0px";h.style.maxWidth="90%";h.style.width="90%";h.style.color="#323232";h.style.textAlign="center";h.style.backgroundColor="#d2d2d2";h.style.opacity="0.8";h.style.position="absolute";h.style.top="0px";h.style.margin="0 auto";h.style.display="block";h.appendChild(document.createTextNode(a[0].type.replace("application/",
"")));h=document.createElement("div");h.setAttribute("id","obj-filename-"+d);h.style.color="#323232";h.style.display="flex";h.style.flexDirection="column";h.style.alignItems="center";h.style.justifyContent="center";h.style.opacity="1";var g=document.createElement("img");g.style.width="64px";g.style.height="64px";500>window.innerWidth&&(g.style.width="40px",g.style.height="40px");g.style.zIndex="5";g.src="/static/icons/file.png";h.appendChild(g);g=document.createElement("div");g.style.width="100%";
g.style.zIndex="6";var k=document.createElement("p");k.style.fontSize="25px";500>window.innerWidth&&(k.style.fontSize="15px");k.style.textTransform="uppercase";a=document.createTextNode(a[0].name.split(".")[1]);if("undefined"==typeof a||null==a||0==a.length)a=document.createTextNode("unknown");k.appendChild(a);g.appendChild(k);h.appendChild(g);e.appendChild(h);return e}else f.style.padding="0px",f.style.position="relative",a.forEach(function(a,b){var c=document.createElement("img");c.style.top="0";
c.style.width="100%";c.style.objectFit="cover";c.src=a.thumbnail;null!=document.getElementById("topic-main-image")&&(document.getElementById("topic-main-image").src=a.thumbnail);0<parseInt(b)?c.style.display="none":(c.classList.add("img-responsive"),c.classList.add("center-block"));f.appendChild(c)});return f}
function extractURLFromText(a){for(var b=[],c=new RegExp(/\b(https?:\/\/)([\w\-~]+(\.[\w\-~]+)+|localhost)(:\d+)?(\/[\w\-~@:%]*)*(#[\w\-]*)?(\?[^\s]*)?\b/gi),f;null!==(f=c.exec(a));)b.push({text:f[0],type:"link"});return b}function removeloader(a){a=document.getElementById("dot-"+a);null!=a&&(a=a.querySelector("#displayloadingcontainer"),null!=a&&(a.querySelector("h5").innerHTML="Preview Load failed...",null!=a.querySelector(".loader")&&a.querySelector(".loader").classList.remove("loader")))}
function queryURLforpreview(a,b){var c=new Worker("/static/js/siteload-worker.js");c.onerror=function(a){console.log("in error handler of worker "+a.data);removeloader(b)};c.onmessage=function(c){if("siteread"==c.data.action)if(c.data.error)console.log("in error from data returned by worker "+c.data),removeloader(b);else{var d=JSON.parse(c.data.response),e=(new DOMParser).parseFromString(d.contents,"text/html");c=(new URL(a)).hostname;d={"finance.yahoo.com":"div.caas-body","www.bbc.com":"article",
"www.cnn.com":"div.article__content","www.nytimes.com":'section[name\x3d"articleBody"]',"www.theguardian.com":"div.article-body-viewer-selector","www.reuters.com":"div.article-body__content__17Yit"}[c];if(!d){const a=["article","main",".article-content",".post-content"];for(var f of a)if(e.querySelector(f)){d=f;break}}d||(e.body?d="body":(f=document.getElementById("dot-"+b),null!=f&&(f=f.querySelector("#displayloadingcontainer"),null!=f&&(f.querySelector("h5").innerHTML="Site data can not be read...",
null!=f.querySelector(".loader")&&f.querySelector(".loader").classList.remove("loader")))));(e=e.querySelector(d))?(f=e.querySelectorAll("p"),d="",f&&(d=Array.from(f).map(a=>a.textContent.trim()).filter(a=>0<a.length).join("\n\n")),d&&0!==d.length||(e=e.querySelectorAll("div"))&&0<e.length&&(d=Array.from(e).map(a=>a.textContent.trim()).filter(a=>0<a.length).join("\n\n")),e={},e.desc=d,e.domain=c,createurlpreviewdiv(e,b)):(removeloader(b),console.log("Article content not found. Selector: "+d))}else console.log("id "+
b+" "+a+" sitelad worker "+JSON.stringify(d)),null!=d&&0<d.length?(e=JSON.parse(d),createurlpreviewdiv(e,b)):removeloader(b)};c.postMessage({action:"siteread",url:a})}
function createurlpreviewdiv(a,b){var c=document.getElementById("dot-popup-"+b);if(null!=a&&null!=c&&null==c.querySelector(".url-preview")){b=document.createElement("div");b.classList.add("row");b.style.margin="2px";b.classList.add("url-preview");b.style.overflowY="scroll";b.style.boxSizing="border-box";b.style.flex="1 1 auto";var f=document.createElement("div");f.classList.add("col-xs-12");var d=document.createElement("div");d.classList.add("row");f.appendChild(d);var e=document.createElement("div");
e.classList.add("col-xs-12");d.appendChild(e);if("undefined"!=typeof a.image&&null!=a.image&&0<a.image.length)d=document.createElement("img"),d.src=a.image,d.style.maxWidth="100%",null!=c&&c.parentNode.appendChild(d,c.firstChild);else if("undefined"!=typeof a.title&&null!=a.title&&0<a.title.length)e.classList.add("first-line-bold"),e.appendChild(document.createTextNode(a.title));else{var h="https://www.google.com/s2/favicons?sz\x3d64\x26domain\x3d"+a.domain;fetch(h,{method:"HEAD"}).then(a=>{200===
a.status?(a=document.createElement("img"),a.src=h,a.style.maxWidth="100%",a.style.maxHeight="50%",null!=c&&c.parentNode.appendChild(a,c.firstChild)):console.log("Favicon not found or inaccessible: "+a.status)}).catch(a=>{console.log("Error fetching favicon: ",a)})}d=document.createElement("div");d.classList.add("row");e=document.createElement("div");e.classList.add("col-xs-12");d.appendChild(e);f.appendChild(d);0<a.desc.length&&(e.style.overflowY="auto",e.appendChild(document.createTextNode(a.desc)));
b.appendChild(f);a=document.createElement("br");b.appendChild(a);null!=c&&(a=c.parentNode.querySelector("#displayloadingcontainer"),console.log("loading div after url preview in createurlpreviewdiv"+a),null!=a&&removediv(a),c.insertBefore(b,c.firstChild))}}
function mindthegaps(a,b,c){var f="";f=a<window.innerHeight/2?f+"N":f+"S";f=b<window.innerWidth/2?f+"W":f+"E";f=document.querySelectorAll(".dot-ui-gap, .quad-"+f);for(var d=0;d<f.length;d++){var e=f[d].getBoundingClientRect(),h=e.top,g=e.left;e=e.bottom-h;if(b<g+e&&b+c>g&&a<h+e&&c+a>h)return console.log("Collision detected"),!0}return!1}
function playall(a){a.stopPropagation();a.target.onclick=null;a.target.src="/static/icons/pause-120.png";a.target.onclick=function(a){return stopplay(a)};document.getElementsByClassName("dot-popup");for(var b=0;b<posts.length;b++)playtimeoutids[b]=setTimeout(function(b){return function(){var c=postlocationmap[b].x,d=postlocationmap[b].y;null!=posts[b].data?showpostdatainpopup(posts[b],b,null,!1,c,d,!1):retrievepostsummaryandshowinpopup(posts[b],b,null,!1,c,d,!1);playidx=b;b==posts.length-1&&(a.target.src=
"/static/icons/play-64.png")}}(b),2E3*b);return!1}function stopplay(a){a.stopPropagation();a.target.onclick=null;a.target.src="/static/icons/play-64.png";a.target.onclick=function(a){return playall(a)};for(a=playidx;a<playtimeoutids.length;a++)clearTimeout(playtimeoutids[a]);playtimeoutids=[];playidx=0;return!1}
function dragElement(a){function b(a){null==clickstarttime&&(clickstarttime=new Date);500>window.innerWidth?(h=a.clientX,g=a.clientY,document.ontouchend=f,document.ontouchmove=c):(a=a||window.event,a.preventDefault(),a.stopPropagation(),h=a.clientX,g=a.clientY,document.onmouseup=f,document.onmousemove=c);return!1}function c(b){500>window.innerWidth?(b=b.targetTouches[0],b.pageX>=window.innerWidth-25||25>=b.pageX?(a.classList.remove("expand-open"),removediv(a)):(a.style.left=b.pageX+"px",a.style.top=
b.pageY+"px")):(b=b||window.event,b.preventDefault(),d=h-b.clientX,e=g-b.clientY,h=b.clientX,g=b.clientY,a.style.top=a.offsetTop-e+"px",a.style.left=a.offsetLeft-d+"px")}function f(b){b.stopPropagation();b.stopImmediatePropagation();document.onmouseup=null;document.onmousemove=null;document.ontouchend=null;document.ontouchmove=null;a.setAttribute("data-dragged",!0);"undefined"!=typeof b.target.id&&(b=b.target.id.split("-")[2],console.log("will stop the close of "+b+" "+closepopuptimeoutmap[b]),null!=
closepopuptimeoutmap[b]&&clearTimeout(closepopuptimeoutmap[b]));return!1}a.style.cursor="move";var d=0,e=0,h=0,g=0;a.onmousedown=b;a.ontouchstart=b}
function posttotopicmodal(a){a.stopPropagation();null!=splitschemas&&0<splitschemas.length?(document.getElementById("topic-post-data-input-holder").innerHTML="",1<splitschemas.length?(document.getElementById("create-sub-topic-select").style.visibility="hidden",a=topiccurrentdepth==splitschemas.length-1,document.getElementById("topic-post-data-input-holder").appendChild(generateformbasedonschema(splitschemas[topiccurrentdepth],a))):document.getElementById("topic-post-data-input-holder").appendChild(generateformbasedonschema(splitschemas[0],
!0))):topiccurrentdepth>=topicmaxdepth?document.getElementById("create-sub-topic-select").style.visibility="hidden":document.getElementById("create-sub-topic-select").style.visibility="visible";$("#topic-post-modal").modal("show");return!1}
function generateformbasedonschema(a,b){let c=document.createElement("div");c.className="col-xs-12";let f=0;var d=document.createElement("input");d.type="hidden";d.id="post-tags-input";c.appendChild(d);for(const b in a)if(a.hasOwnProperty(b)){d=document.createElement("div");d.className="row";const e=document.createElement("div");e.className="col-xs-12";const g=document.createElement("input");g.type="text";g.name=b;g.id=0<f?"post-json-data-"+b:"post-text-input-2";g.placeholder=b;"numeric"==a[b].type&&
g.addEventListener("input",function(a,b){return function(a){if("numeric"==b)var c=a.target.value;isNaN(c)?a.target.style.borderColor="red":a.target.style.borderColor="lightgray"}}(event,a[b].type));e.appendChild(g);d.appendChild(e);c.appendChild(d);c.appendChild(document.createElement("br"));f++}a=document.createElement("button");a.id="subtopicbtn-2";a.classList.add("btn");a.classList.add("btn-primary");a.classList.add("btn-sm");"undefined"==typeof b||0==b?a.addEventListener("click",function(a){a=
document.getElementById("post-text-input-2").value;createsubtopic(a)}):a.addEventListener("click",function(a){a=collectjsoninput();postcontentdirecttotopic(JSON.stringify(a))});a.textContent="Create";c.appendChild(a);return c}
function collectjsoninput(){const a={};var b=document.querySelectorAll('[id^\x3d"post-json-data-"]');let c=document.getElementById("post-text-input-2");null==c&&(c=document.getElementById("post-text-input"));a.text=c.value;b.forEach(b=>{const c=b.id.replace("post-json-data-","");a[c]=b.value});b=JSON.stringify(a);console.log("jsonData "+b);return b}function posttoflakemodal(a){a.stopPropagation();$("#flake-post-modal").modal("show");return!1}
function savecontentlocally(a,b){if("undefined"!==typeof Storage){null===localStorage.getItem("CONTENT::"+a)&&localStorage.setItem("CONTENT::"+a,JSON.stringify({items:[]}));if(null!=b){const c=JSON.parse(localStorage.getItem("CONTENT::"+a));c.items.push(b);localStorage.setItem("CONTENT::"+a,JSON.stringify(c))}console.log("Topic data updated for "+a)}else console.warn("Local storage not supported")}
function removecontentlocally(a,b){if("undefined"!==typeof Storage){if(null!==localStorage.getItem("CONTENT::"+a)){if("undefined"!=typeof b&&0<b){var c=JSON.parse(localStorage.getItem("CONTENT::"+a)),f=c.items;const d=f.findIndex(a=>a.crTime===b);-1!==d&&f.splice(d,1);c.items=f;localStorage.setItem("CONTENT::"+a,JSON.stringify(c))}console.log("Topic data removed for crtime "+b)}}else console.warn("Local storage not supported")}
function postcontentdirecttotopic(a,b){null!=document.getElementById("topic-post-status")&&(document.getElementById("topic-post-status").innerHTML="");null!=document.getElementById("topic-post-button")&&(document.getElementById("topic-post-button").disabled=!0);null==postcontenthome&&(postcontenthome={files:[]});var c="";c=null!=document.getElementById("post-text-input")&&null!=document.getElementById("post-text-input").value&&0<document.getElementById("post-text-input").value.length?document.getElementById("post-text-input").value:
a;a="";a=null!=document.getElementById("post-tags-input")&&0<document.getElementById("post-tags-input").value.length?document.getElementById("post-tags-input").value:b;b=null;null!=document.getElementById("sub-topic-desc-text-input")&&(b=document.getElementById("sub-topic-desc-text-input").value);if(null==a||0==a.length)a="[]";if(null!=topicstorage&&0<=topicstorage.indexOf("client")){var f=collectjsoninput(),d={topic:topicname,text:c,data:JSON.parse(f),tags:JSON.parse(a),summary:b,expires:document.getElementById("postexpirysettingsselect").value};
d=1E3<d.length?sjcl.hash.sha256.hash(JSON.stringify(d).substring(0,1E3)):sjcl.hash.sha256.hash(JSON.stringify(d));d=sjcl.codec.hex.fromBits(d);var e=parseInt(d.substring(d.length-12,d.length),16);e=e.toString().substring(0,4)+","+e.toString().substring(4,8)+","+e.toString().substring(8,12);d={topic:topicname,text:c,crTime:Date.now(),data:JSON.parse(f),tags:JSON.parse(a),datahash:d,summary:b,location:e,expires:document.getElementById("postexpirysettingsselect").value};savecontentlocally(topicname,
d);null==posts&&(posts=[]);$("#topic-post-modal").modal("hide");null!=document.getElementById("topic-post-button")&&(document.getElementById("topic-post-button").disabled=!1);JSON.parse("["+JSON.stringify(d)+"]");loadsubtopic(topicname,null)}else{postcontenthome.text=c;console.log("postcontenthome.text "+postcontenthome.text);if(0==postcontenthome.text.length&&(!postcontenthome.files||0==postcontenthome.files.length))return console.log("nothing to post"),document.getElementById("topic-post-status").appendChild(document.createTextNode("Nothing to post.")),
!1;var h=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");h.onreadystatechange=function(){console.log("xhr.readyState xhr.status"+h.readyState+" "+h.status);if(4==h.readyState)if(200==h.status){var a=JSON.parse("["+h.responseText+"]");document.getElementById("topic-post-status").innerHTML="Post successful";setTimeout(function(){null==posts&&(posts=[]);$("#topic-post-modal").modal("hide");null!=document.getElementById("topic-post-button")&&(document.getElementById("topic-post-button").disabled=
!1);null!=document.getElementById("post-tags-input")&&(document.getElementById("post-tags-input").value="");null!=document.getElementById("post-text-input")&&(document.getElementById("post-text-input").value="");null!=document.getElementById("sub-topic-text-input")&&(document.getElementById("sub-topic-text-input").value="");null!=document.getElementById("sub-topic-desc-text-input")&&(document.getElementById("sub-topic-desc-text-input").value="");a[0].crtime=a[0].crTime;console.log("crtime before displaying new post "+
a[0].crtime);displaypostsasdots(a,!0)},400)}else document.getElementById("topic-post-status").innerHTML="Post failed. Please try again later."};h.open("POST","/newauth/api/postcontenttotopic",!1);h.withCredentials=!0;c=JSON.stringify({text:postcontenthome.text,files:postcontenthome.files,closelooptopic:"closelooptopic"==topictype});d=1E3<c.length?sjcl.hash.sha256.hash(c.substring(0,1E3)):sjcl.hash.sha256.hash(c);d=sjcl.codec.hex.fromBits(d);e=parseInt(d.substring(d.length-12,d.length),16);e=e.toString().substring(0,
4)+","+e.toString().substring(4,8)+","+e.toString().substring(8,12);c=new FormData;for(f=0;f<postcontenthome.files.length;f++)c.append("attachments",fileattachments[f]),postcontenthome.files[f].content=null;c.append("postdata",new Blob([JSON.stringify({topic:topicname,text:postcontenthome.text,files:postcontenthome.files,crTime:Date.now(),expires:document.getElementById("postexpirysettingsselect").value,closelooptopic:"closelooptopic"==topictype,datahash:d,location:e,tags:JSON.parse(a),summary:b,
giveout:""})],{type:"application/json"}));h.send(c)}}
function createsubtopic(a){var b="";b=null!=document.getElementById("sub-topic-text-input")&&0<document.getElementById("sub-topic-text-input").value.length?document.getElementById("sub-topic-text-input").value:a;a="";null!=document.getElementById("sub-topic-desc-text-input")&&0<document.getElementById("sub-topic-desc-text-input").length&&(a=document.getElementById("sub-topic-desc-text-input").value);if(3<b.length){var c=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");
c.onreadystatechange=function(){if(4==c.readyState)if(200==c.status){if(c.responseText){var a=c.responseText;null!=a&&0<a.length&&($("#topic-post-modal").modal("hide"),enabledisableelemswithid("subtopicbtn",!1),postcontentdirecttotopic(b,JSON.stringify(["folder"])))}}else document.getElementById("sub-topic-status").innerText=c.responseText,enabledisableelemswithid("subtopicbtn",!1),document.getElementById("post-text-input").value="",document.getElementById("post-tags-input").value="",document.getElementById("sub-topic-text-input").style.border=
"1px solid red"};c.open("POST","/newauth/api/createtopic",!0);c.withCredentials=!0;c.setRequestHeader("Content-Type","application/json");a=JSON.stringify({topic:topicname+"/"+b,crTime:Date.now(),display:a});null!=topicstorage&&0<=topicstorage.indexOf("client")?(collectjsoninput(),savecontentlocally(topicname+"/"+b,null),postcontentdirecttotopic(b,JSON.stringify(["folder"])),null!=document.getElementById("sub-topic-text-input")&&(document.getElementById("sub-topic-text-input").value=""),null!=document.getElementById("sub-topic-desc-text-input")&&
(document.getElementById("sub-topic-desc-text-input").value="")):(c.send(a),enabledisableelemswithid("subtopicbtn",!0))}else document.getElementById("sub-topic-text-input").style.border="1px solid red",document.getElementById("sub-topic-text-input").value="",setTimeout(function(){document.getElementById("sub-topic-text-input").style.border="none"},2E3)}function enabledisableelemswithid(a,b){document.querySelectorAll('[id^\x3d"'+a+'"]').forEach(a=>{a.disabled=b})}
function postcontentdirecttoflake(a){document.getElementById("flake-post-status").innerHTML="";null==postcontenthome&&(postcontenthome={files:[]});var b=document.getElementById("post-text-input").value;postcontenthome.text=b;if(0==postcontenthome.text.length&&(!postcontenthome.files||0==postcontenthome.files.length))return console.log("nothing to post"),document.getElementById("flake-post-status").appendChild(document.createTextNode("Nothing to post.")),!1;var c=window.XMLHttpRequest?new XMLHttpRequest:
new ActiveXObject("Microsoft.XMLHTTP");c.onreadystatechange=function(){if(4==c.readyState&&200==c.status){var a=JSON.parse("["+c.responseText+"]");$("#flake-post-modal").modal("hide");setTimeout(function(){null==posts&&(posts=[]);displaypostsasdots(a,!0)},400)}};c.open("POST","/newauth/api/postcontenttoflake",!1);c.withCredentials=!0;c.setRequestHeader("Content-Type","application/json");b=JSON.stringify({text:postcontenthome.text,files:postcontenthome.files});b=1E3<b.length?sjcl.hash.sha256.hash(b.substring(0,
1E3)):sjcl.hash.sha256.hash(b);b=sjcl.codec.hex.fromBits(b);var f=parseInt(b.substring(b.length-12,b.length),16);f=f.toString().substring(0,4)+","+f.toString().substring(4,8)+","+f.toString().substring(8,12);c.send(JSON.stringify({flake:a,text:postcontenthome.text,files:postcontenthome.files,datahash:b,location:f,giveout:""}))}
function getfullpost(a,b,c,f,d,e,h){var g=new XMLHttpRequest,k=document.getElementById("post-seq-"+c),l=null;null!=k&&(k=k.querySelector('div[name\x3d"post-tags"]'),null!=k&&(l=k.innerText));c+="";0<=c.indexOf("-")&&(c=c.split("-")[0]);k="";0==c||null==d?(k="/newauth/api/getfullpostbytopicandtime/"+a+"/"+b,c=-1):k="/newauth/api/getpostfullimage/"+d+"/"+c;"undefined"!=typeof h&&0<h.length&&(k=h);g.open("GET",k,!1);g.setRequestHeader("Content-Type","application/json");g.onreadystatechange=function(){if(4==
g.readyState&&200==g.status){var a=g.responseText;null!=a&&0<a.length&&(addposttoalreadyseen(b),loadfulluserpost(JSON.parse(a),f,l,e,d,c))}};g.send(null)}
function increasesiteusage(a){if(null!=a&&0!=a.length&&"undefined"!==typeof Storage){var b=localStorage.getItem("SITEUSAGE");"undefined"==b||null==b||"null"==b||0==b.length?(b={},b[a]=1):(b=JSON.parse(b),b[a]=b[a]?b[a]+1:1);console.log("site "+a+" added to usage");console.log("Setting SITEUSAGE in local storage");localStorage.setItem("SITEUSAGE",JSON.stringify(b))}}
function getsiteusage(a){if(null==a||0==a.length)return 0;if("undefined"!==typeof Storage){var b=localStorage.getItem("SITEUSAGE");if("undefined"!=b&&null!=b&&"null"!=b&&0!=b.length&&(b=JSON.parse(b),b[a]))return b[a]}}
function addposttoalreadyseen(a){if(null!=a&&0!=a.length&&"undefined"!==typeof Storage){var b=localStorage.getItem("TOPICVIEWS");"undefined"==b||null==b||"null"==b||0==b.length?(b={},b[topicname]=[],b[topicname].push(a)):(b=JSON.parse(b),b[topicname]||(b[topicname]=[]),b[topicname].includes(a)||b[topicname].push(a));console.log("post "+a+" added to already seen");console.log("Setting TOPICVIEWS in local storage");localStorage.setItem("TOPICVIEWS",JSON.stringify(b))}}
function addposttodeleted(a){if(null!=a&&0!=a.length&&"undefined"!==typeof Storage){var b=localStorage.getItem("TOPICDELETES");"undefined"==b||null==b||"null"==b||0==b.length?(b={},b[topicname]=[],b[topicname].push(a)):(b=JSON.parse(b),b[topicname]||(b[topicname]=[]),b[topicname].includes(a)||b[topicname].push(a));console.log("post "+a+" added to deleted");console.log("Setting TOPICDELETES in local storage");localStorage.setItem("TOPICDELETES",JSON.stringify(b));isowner&&(console.log("isowner "+isowner+
" removing post from database also"),removepostfromtopic(topicname,a));null!=topicstorage&&0<=topicstorage.indexOf("client")&&(console.log("removing post locally"),removecontentlocally(topicname,a))}}
function addposttosaved(a,b,c){if(null!=c&&0!=c.length){var f=new XMLHttpRequest;c="/newauth/api/savepost/"+topicname+"/"+c;f.onreadystatechange=function(){4==f.readyState&&200==f.status&&(b.style.transform="translate3d(0px, 0px, 0)",displaybuttonbehavior(a,"Saved"))};f.open("GET",c,!0);f.withCredentials=!0;f.setRequestHeader("Content-Type","application/json");f.send(null)}}
function removepostfromalreadyseen(a){if(null!=a&&0!=a.length&&"undefined"!==typeof Storage){var b=localStorage.getItem("TOPICVIEWS");null!=b&&"null"!=b&&0<b.length&&(b=JSON.parse(b),b[topicname]&&b.includes(a)&&(b[topicname]=b[topicname].splice(b.indexOf(a),1),localStorage.setItem("TOPICVIEWS",JSON.stringify(b)),console.log("post "+a+" removed from already seen")))}}
function removepostfromtopic(a,b){if(null!=b&&0!=b.length){var c=new XMLHttpRequest;c.open("POST","/newauth/api/removepostfromtopic",!1);c.setRequestHeader("Content-Type","application/json");c.onreadystatechange=function(){};var f=JSON.stringify({topic:a,crTime:b});c.send(f);alert("removing this post "+f);null!=topicstorage&&0<=topicstorage.indexOf("client")&&removecontentlocally(a,b)}}
function checkifalreadyseen(a){var b=!1;if(null==a||0==a.length)return b;if("undefined"!==typeof Storage){var c=localStorage.getItem("TOPICVIEWS");"undefined"!=c&&null!=c&&"null"!=c&&0<c.length&&(c=JSON.parse(c),c[topicname]&&c[topicname].includes(a)&&(b=!0))}return b}
function checkifdeleted(a){var b=!1;if(null==a||0==a.length)return b;if("undefined"!==typeof Storage){var c=localStorage.getItem("TOPICDELETES");"undefined"!=c&&null!=c&&"null"!=c&&0<c.length&&(c=JSON.parse(c),c[topicname]&&c[topicname].includes(a)&&(b=!0))}return b}
function attachedfilechangeeventhandlerfortopic(){var a="attachedfiles";if(500>window.innerWidth||500>window.innerHeight)a="attachedfilesxs";a=document.getElementById(a);null!=a&&(debugappui&&console.log("attaching eventlistener for change on attachedfiles"),a.addEventListener("change",function(a){displaypreviewfortopic(a);debugappui&&console.log("changed again")},!1))}
function displaypreviewfortopic(a,b){var c=a.target.files,f="fileprogress";if(500>window.innerWidth||500>window.innerHeight)f="fileprogressxs";document.getElementById(f).style.display="block";null==postcontenthome&&(postcontenthome={files:[]});postcontenthome.files||(postcontenthome.files=[]);debugappui&&console.log("onchange event fired for attachedfiles");for(var d=0;d<c.length;d++){fileattachments.push(c[d]);var e=new FileReader;e.onloadstart=()=>document.getElementById("contentpostbtn").disabled=
!0;e.onloadend=()=>{document.getElementById("contentpostbtn").disabled=!1};e.onload=function(a){return function(b){document.getElementById(f).value=100;processloadedattachedfilefortopic(b,a)}}(c[d]);e.onprogress=function(a){return function(a){a=100*a.loaded/a.total;document.getElementById(f).value=a}}(c[d]);e.readAsDataURL(c[d])}b&&b(a.target.imgcount,postcontenthome.files)}
function displayallpostdescription(a,b){a.stopPropagation();for(var c=0;c<posts.length;c++)showpostdescription(a,c,b);return!1}
function showpostdescription(a,b,c){var f=function(a){displayallpostdescription(a,!0)},d=function(a){displayallpostdescription(a)},e=document.getElementById("dot-desc-"+b);if(null!=e||"undefined"!=typeof c&&1==c)null!=e&&(e.style.opacity="0.3",removediv(e),null!=a&&(a.target.onclick=null,a.target.onclick=d));else if("undefined"==typeof c||0==c||null==e)if(c=document.getElementById("dot-"+b),null!=c){null!=a&&(a.target.onclick=null,a.target.onclick=f);a=document.createElement("div");a.style.textAlign=
"center";a.style.borderRadius="4px";a.style.display="flex";a.style.alignItems="center";a.style.justifyContent="center";f="";if("undefined"!=typeof posts[b].tags&&null!=posts[b].tags)for(d=0;d<posts[b].tags.length;d++)0>posts[b].tags[d].indexOf("flake:")&&0>posts[b].tags[d].indexOf("ip:")&&0>posts[b].tags[d].indexOf("name:")&&0>posts[b].tags[d].indexOf("folder")&&0>posts[b].tags[d].indexOf("jwt:")&&(f+=posts[b].tags[d],0<f.length&&d<posts[b].tags.length-1&&(f+=" "));else f=null!=posts[b].data?posts[b].data.text:
posts[b].text;0!=f.length||"undefined"==typeof posts[b].summary||null==posts[b].summary||isBase64JSON(posts[b].summary)||(f=posts[b].summary);d=document.createElement("p");d.style.fontSize="1.4em";d.appendChild(document.createTextNode(f));a.appendChild(d);a.setAttribute("id","dot-desc-"+b);a.classList.add("dot-desc");a.style.backgroundColor="#989898";a.style.position="absolute";a.style.pointerEvents="none";parseFloat(c.style.left.split("%")[0])*parseInt(window.innerWidth)/100<parseInt(window.innerWidth)-
100?a.style.left="5px":a.style.right="5px";a.style.top=window.scrollY+c.getBoundingClientRect().top+parseInt(c.style.height)+"px";a.style.maxWidth=3*parseInt(c.style.width)+"px";a.style.lineHeight="1.8em";a.style.height="auto";a.style.whiteSpace="normal";a.style.maxHeight="3.6em";a.style.overflow="hidden";a.style.left=window.scrollX+c.getBoundingClientRect().left-10+"px";a.style.color="white";a.style.paddingLeft="2px";a.style.zIndex=10;document.body.appendChild(a);attachtransitionstyles(a,1);a.style.setProperty("opacity",
.9,"important")}}
function showpostcomment(a,b){if(null!=a.crTime&&0!=a.crTime&&0<a.newcomment.length)if(removepostfromalreadyseen(a.crTime),null!=document.getElementById("conv-data-"+a.convid)){if(600>window.innerWidth||600>window.innerHeight)b=document.getElementById("conv-data-"+a.convid),document.getElementById("post-comments-mobile").appendChild(b);addconversationmessagetopanel(document.getElementById("conv-data-"+a.convid),a.newcomment,0,a.crTime,a.giveout,!1)}else{b=-2;var c=document.getElementsByClassName("dot-cmt");if(null!=
c)for(var f=0;f<c.length;f++)removediv(c[f]);null!=a.crTime&&(b=crtimetoidxmap[a.crTime]);c=document.getElementById("dot-"+b);null!=posts[b].datahash&&(f="000000000000000000000000000000000000000000000",f=parseInt(posts[b].datahash.substring(posts[b].datahash.length-12,posts[b].datahash.length),16),c.style.backgroundColor="#"+f.toString().substring(0,6));c=document.createElement("div");c.classList.add("marquee");c.setAttribute("id","dot-cmt-"+b);c.classList.add("dot-cmt");c.style.backgroundColor="#efefef";
c.style.position="absolute";c.style.boxShadow="2px 3px 2px #afafaf";c.style.borderTop="1px solid #afafaf";c.style.paddingTop="2px";b=document.getElementById("dot-"+b);.9>b.style.opacity&&(b.style.opacity=.9);c.style.bottom="2px";c.style.width="240px";c.style.left="50%";c.style.transform="translateX(-50%)";c.style.lineHeight="1.2em";c.style.whiteSpace="nowrap";c.style.overflow="hidden";c.style.fontColor="#121212";c.style.zIndex=10;f=document.createElement("span");f.appendChild(document.createTextNode(a.giveout));
var d=document.createElement("div");d.classList.add("marquee-text-drop");50>a.newcomment.length?d.appendChild(document.createTextNode(a.newcomment)):d.appendChild(document.createTextNode(a.newcomment.substring(0,50)));setTimeout(function(){d.classList.remove("marquee-text");d.innerHTML="";d.appendChild(document.createTextNode(a.newcomment))},7E3);c.appendChild(f);c.appendChild(d);f=document.getElementById("topic-app");null==f&&(f=document.getElementById("app-flk"));f.appendChild(c);makelementpulsate(b,
20);attachtransitionstyles(c,2);c.style.opacity=.9}else console.log("No crtime in response, can not locate the post to attach comment to.")}
function processloadedattachedfilefortopic(a,b){imageExists(a.target.result,function(c){var f=document.getElementById("attached-file-preview");if(500>window.innerWidth||500>window.innerHeight)f=document.getElementById("attached-file-preview-xs");if(c){c=document.createElement("img");c.src=window.URL.createObjectURL(b);var d=window.screen.availWidth,e=window.screen.availHeight;800<d&&(d=800);600<e&&(e=600);d=getresizedimage(c,b.type,d,e);e=document.createElement("IMG");e.classList.add("fade-in");e.style.objectFit=
"cover";e.style.top="0px";e.style.left="0px";500>window.innerWidth||500>window.innerHeight?(e.width="50",e.height="50"):(e.width="64",e.height="64",e.style.padding="5px",f.innerHTML="");e.src=d;f.style.backgroundColor="#ffffff";f.appendChild(e);postcontenthome.files.push({name:b.name,size:b.size,type:b.type,content:a.target.result,thumbnail:getresizedimage(c,b.type,300,300)})}else videoExists(a.target.result,function(c){c?document.getElementById("topic-post-status").innerHTML='\x3cdiv style\x3d"color:red"\x3eVideo uploads not enabled\x3c/div\x3e':
(console.log("No image or video "),f.style.backgroundColor="#989898",f.innerHTML="\x3ch5\x3e"+b.type+" File\x3c/h5\x3e",postcontenthome.files.push({name:b.name,size:b.size,type:b.type,content:a.target.result}))});1<postcontenthome.files.length&&(c=document.createElement("div"),c.classList.add("fade-in"),c.style.width="64",c.style.height="64",c.style.opacity="0.6",c.style.overflow="none",d=document.createElement("h4"),d.style.background="#515151",d.classList.add("text-center"),d.style.width="100%",
d.appendChild(document.createTextNode("+"+(postcontenthome.files.length-1))),c.appendChild(d),f.appendChild(c))})}function closeSSEConnection(){null!=topiceventsource&&(topiceventsource.close(),topiceventsource=null,console.log("SSE connection stopped -- was started in topic page."))}
function jointopic(){null==topiceventsource?(openSSEConnection(),console.log("created new SSE connection from topic page "+topiceventsource.url)):topiceventsource.url.endsWith(topicname)?console.log("SSE connection existed from topic page "+topiceventsource.url):(closeSSEConnection(),openSSEConnection(),console.log("created new SSE connection from topic page "+topiceventsource.url))}
function openSSEConnection(){"undefined"!==typeof EventSource?(topiceventsource=new EventSource("/newauth/api/monitorTopic/"+topicname),topiceventsource.addEventListener("message",function(a){a=JSON.parse("["+a.data+"]");var b=new Date(posts[0].crtime),c=new Date(a[0].crTime);if(0<parseInt(a[0].comments)&&null==a[0].summary)showpostcomment(a[0],!0);else if("undefined"==typeof posts[0].crtime||c>b)a[0].crtime=a[0].crTime,displaypostsasdots(a,!0)})):alert("This browser does not support the technology required to monitor the topic in realtime. You can refresh the page periodically to see the latest posts.")}
function displayflakeconfstartmodal(a){$("#flake-conf-start-modal").modal("show")}
function increasePrivacy(a){a.stopPropagation();var b=new XMLHttpRequest;b.onreadystatechange=function(){if(4==b.readyState&&200==b.status){var c=b.responseText;document.getElementById("identity-display").innerText=c.split(":")[1];null!=document.getElementById("header-identity-display")&&(document.getElementById("header-identity-display").innerText=c.split(":")[1]);"F"==c.split(":")[0]?(document.getElementById("inc-privacy-button").src="/static/icons/user-dark-gray.png",document.getElementById("inc-privacy-button").title=
"Already set at maximum privacy",document.getElementById("inc-privacy-button").onclick=function(a){displaybuttonbehavior(a,"Already set at maximum privacy")}):(document.getElementById("red-privacy-button").src="/static/icons/user.png",document.getElementById("red-privacy-button").title="Less Privacy",document.getElementById("red-privacy-button").onclick=function(a){reducePrivacy(a)});"A"==c.split(":")[0]&&displaybuttonbehavior(a,"Giving out Alias now");"F"==c.split(":")[0]&&displaybuttonbehavior(a,
"Giving out flake now")}4==b.readyState&&400==b.status&&displaybuttonbehavior(a,b.responseText)};b.open("POST","/newauth/api/increaseprivacyforflake",!0);b.withCredentials=!0;b.setRequestHeader("Content-Type","application/json");b.send(null)}
function reducePrivacy(a){a.stopPropagation();var b=new XMLHttpRequest;b.onreadystatechange=function(){if(4==b.readyState&&200==b.status){var c=b.responseText;document.getElementById("identity-display").innerText=c.split(":")[1];null!=document.getElementById("header-identity-display")&&(document.getElementById("header-identity-display").innerText=c.split(":")[1]);"N"==c.split(":")[0]?(document.getElementById("red-privacy-button").src="/static/icons/user-gray.png",document.getElementById("red-privacy-button").title=
"Already giving out full name",document.getElementById("red-privacy-button").onclick=function(a){displaybuttonbehavior(a,"Already giving out full name")}):(document.getElementById("inc-privacy-button").src="/static/icons/user-dark.png",document.getElementById("inc-privacy-button").title="More Privacy",document.getElementById("inc-privacy-button").onclick=function(a){increasePrivacy(a)});"A"==c.split(":")[0]&&displaybuttonbehavior(a,"Giving out Alias now");"N"==c.split(":")[0]&&displaybuttonbehavior(a,
"Giving out full name now")}4==b.readyState&&400==b.status&&displaybuttonbehavior(a,b.responseText)};b.open("POST","/newauth/api/reduceprivacyforflake",!0);b.withCredentials=!0;b.setRequestHeader("Content-Type","application/json");b.send(null)}
function loadvaultinflakepage(){document.getElementById("flake-main-image-2").src="/static/icons/vault-256.png";document.getElementById("flake-main-image-2").style.opacity=.2;document.getElementById("displayloadingcontainer").style.display="block";if(null!=originaldata&&0<originaldata.length)displayvaultdataasdots(originaldata);else{let a=new XMLHttpRequest;a.open("POST","/secure/getuserdata",!0);a.withCredentials=!0;a.setRequestHeader("Content-Type","application/json");a.onreadystatechange=function(){if(4==
a.readyState&&200==a.status)if(null!=a.responseText&&0<a.responseText.length){var b=JSON.parse(a.responseText);originaldata="ERROR";try{originaldata=sjcl.decrypt(vaultkey,b.data),displayvaultdataasdots(originaldata)}catch(c){console.log("Exception while decrypt vault data "+c),null!=document.getElementById("newauth-notification")&&(document.getElementById("newauth-notification").innerHTML="",document.getElementById("newauth-notification").innerHTML="Invalid Vault key. Please try again"),setTimeout(function(){createVaultKeyInputOnForeGroundDiv(b.data)},
1500)}rndsalt=b.salt;rnditer=b.iterations;rndseq=b.sequence;rndcrdate=b.createdate}else console.log("ERROR")};a.send(JSON.stringify({sequence:1}))}}
function displayvaultdataasdots(a){removediv(document.getElementById("vaultkeyinputholder"));var b=document.getElementById("vault-search-input").value,c=JSON.parse(a);a=[];for(var f=0;f<c.length;f++){var d=a.find(a=>a.name===c[f].siteUrl);null!=d?d.description.push(c[f].siteuser+":#:#:"+c[f].sitepwd):(d={name:c[f].siteUrl,description:[c[f].siteuser+":#:#:"+c[f].sitepwd],text:c[f].siteuser,relevance:getsiteusage(c[f].siteUrl)},null!=b&&0<b.length?(0<=c[f].siteUrl.toLowerCase().indexOf(b.toLowerCase())||
0<=c[f].siteuser.toLowerCase().indexOf(b.toLowerCase())||0<=c[f].sitepwd.toLowerCase().indexOf(b.toLowerCase()))&&a.push(d):a.push(d))}if(null!=b&&0<b.length&&(b=document.getElementsByClassName("dot-vault"),null!=b&&0<b.length))for(f=0;f<b.length;f++)b.length>=a.length?b[f].style.display="none":removediv(b[f]);renderdataasdots(a)}
function renderdataasdots(a,b,c){function f(a){if("undefined"===typeof a.relevance||null==a.relevance||""==a.relevance)a.relevance=1;return a.relevance}function d(a,b){for(var c,d=c=0;d<a.length;d++)a[b]>a[d]&&c++;return parseInt(100*c/(a.length-1))}document.getElementById("displayloadingcontainer").style.display="none";if(null!=a&&0!=a.length){posts=a;b=Math.sqrt(parseInt(window.innerWidth*window.innerHeight)/Math.max(20,posts.length));startsize=parseInt(b)/9;maxdotsize=parseInt(b)/4;b=document.getElementById("topic-app");
null==b&&(b=document.getElementById("app-flk"));for(c=0;c<a.length;c++){var e=document.querySelector('[data-name\x3d"'+a[c].name+'"]');if(null!=e&&e.getAttribute("data-name")===a[c].name)e.style.display="block",e.style.opacity=1;else{e=document.createElement("div");e.setAttribute("id","dot-"+c);e.setAttribute("data-name",a[c].name);e.classList.add("dot-vault");e.style.width=Math.min(2*startsize,maxdotsize);var h=d(a.map(f),c);80<=h&&(e.style.width=maxdotsize);50>=h&&(e.style.width=startsize);e.style.opacity=
"0.1";e.style.transform="scale(1.2)";attachtransitionstyles(e,1);h=1E3<a[c].name.length?sjcl.hash.sha256.hash(a[c].name.substring(0,1E3)):sjcl.hash.sha256.hash(a[c].name);var g=sjcl.codec.hex.fromBits(h);e.style.backgroundColor="#"+g.substring(0,6);e.style.boxShadow="0px 0px 2px #"+g.substring(0,6);h="000000000000000000000000000000000000000000000";null!=g&&(h=parseInt(g.substring(g.length-15,g.length),16));g=parseFloat(h.toString().substring(0,2)+"."+h.toString().substring(2,5));h=parseFloat(h.toString().substring(5,
7)+"."+h.toString().substring(7,10));h=parseInt(window.innerHeight*h/100);g=parseInt(window.innerWidth*g/100);for(var k=0;mindthegaps(h,g,maxdotsize);){if(5<k){console.log("Done shifting this dot "+h+":"+g+" "+a[c].name);break}h=h<window.innerHeight/2&&h>50+startsize?h-startsize:h+startsize;g=g<window.innerWidth/2&&0<g?g-startsize:g+startsize;k++}10>g&&(g+=10);g>window.innerWidth-maxdotsize-10&&(g-=3*maxdotsize);60>h&&(h+=60);h>window.innerHeight-maxdotsize-10&&(h-=maxdotsize+10);2>=c&&console.log("randleft "+
g+" randtop "+h);k="";k=h<window.innerHeight/2?k+"N":k+"S";k=g<window.innerWidth/2?k+"W":k+"E";e.classList.add("quad-"+k);e.style.top=100*h/parseInt(window.innerHeight)+"%";e.style.left=100*g/parseInt(window.innerWidth)+"%";e.style.height=e.style.width;e.style.position="absolute";e.style.borderRadius="50%";e.style.zIndex="2";e.style.transform=window.getComputedStyle(e).getPropertyValue("transform");e.style.transform="scale(1)";h=document.createElement("div");g="";if("undefined"!=typeof a[c].tags&&
null!=a[c].tags)for(k=0;k<a[c].tags.length;k++)0>a[c].tags[k].indexOf("flake:")&&0>a[c].tags[k].indexOf("ip:")&&0>a[c].tags[k].indexOf("name:")&&0>a[c].tags[k].indexOf("jwt:")&&(g+=a[c].tags[k]),k<a[c].tags.length-1&&(g+=" ");else try{var l=a[c].name;l.trim().startsWith("http")||(l="http://"+l.trim());let b=(new URL(l)).hostname.split(".");for(k=0;k<b.length;k++)"com de org net us co edu gov biz za info cc ca cn fr ch au in jp be it nl uk mx no ru br se es at dk eu il io".split(" ").includes(b[k].toLowerCase())||
(g=b[k]+" "+g);e.style.backgroundColor="#fefefe";var m=document.createElement("img");m.setAttribute("height",e.style.height);m.setAttribute("width",e.style.width);m.setAttribute("alt",g);m.style.objectFit="cover";m.style.borderRadius="50%";var n=new Image;n.onload=function(a){return function(){a.src=16<this.naturalHeight?this.src:"/static/icons/blankfavicon.ico"}}(m);n.src="https://www.google.com/s2/favicons?sz\x3d64\x26domain\x3d"+l;e.appendChild(m)}catch(w){console.log("error creating url from "+
a[c].name+" : "+w),g=a[c].name}h.appendChild(document.createTextNode(g));h.setAttribute("id","dot-desc-"+c);h.classList.add("dot-desc");h.style.borderRadius="3px";h.style.position="absolute";h.style.backgroundColor="#eaeaea";h.style.pointerEvents="none";g=parseFloat(e.style.left.split("%")[0]);k=parseFloat(e.style.top.split("%")[0]);g*parseInt(window.innerWidth)/100>parseInt(window.innerWidth)/2&&(h.style.right="5px",h.style.textAlign="right");k*parseInt(window.innerHeight)/100>parseInt(window.innerHeight)/
2&&(h.style.bottom="5px");h.style.width="100px";h.style.lineHeight="1.8em";h.style.whiteSpace="nowrap";h.style.overflow="hidden";h.style.color="#262626";h.style.fontSize="1.2em";h.style.paddingLeft="2px";h.style.zIndex=10;e.appendChild(h);attachtransitionstyles(h,1);h.style.setProperty("opacity",.9,"important");b.appendChild(e);setTimeout(function(a){return function(){let b=document.getElementById("dot-"+a);null!=b&&(b.style.opacity=1)}}(c),300);setTimeout(function(a){return function(){let b=document.getElementById("dot-desc-"+
a);null!=b&&(b.style.display="none")}}(c),3E3);e.addEventListener("mouseenter",function(a,b){return function(a){a=document.getElementById("dot-desc-"+b);null!=a&&(a.style.display="block",a.style.opacity=.9)}}(event,c),!1);e.addEventListener("mouseleave",function(a,b){return function(a){a=document.getElementById("dot-desc-"+b);null!=a&&(a.style.display="none")}}(event,c),!1);e.addEventListener("click",launchvltpopupfunction(c,event),!1)}}setvaultpagebehaviour();0>parseInt(remaintime)&&(remaintime=
60);setTimeout(function(){for(var a=document.getElementsByClassName("dot-popup-vault"),b=0;b<a.length;b++)removediv(a[b]);a=document.getElementsByClassName("dot-vault");for(b=0;b<a.length;b++)posts=null,a[b].addEventListener("click",function(a,b){return function(a){displaybuttonbehavior(a,"Vault content expired, please login again.")}}(event,b),!1)},1E3*parseInt(remaintime))}}
function getcolorandlocationbasedondata(a,b){function c(a){if(null==h){h={};for(var b=0;b<e.length;b++){var c=d(e[b].trim());null!=c&&(h[e[b].trim()]=c)}}return f(a)}function f(a){a=a.replace("#","");var b=d(a),c=-1,f;Object.keys(h).forEach((a,d)=>{d=h[a];d=Math.pow(b.r-d.r,2)+Math.pow(b.g-d.g,2)+Math.pow(b.b-d.b,2);if(0>c||d<c)0<c&&(f="#"+a),c=d});return f}function d(a){return(a=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(a))?{r:parseInt(a[1],16),g:parseInt(a[2],16),b:parseInt(a[3],16)}:null}
var e=" F7F6CF ; B6D8F2 ; F4CFDF ; 5784BA ; 9AC8EB ; CCD4BF ; E7CBA9 ; EEBAB2 ; F5F3E7 ; F5E2E4 ; F5BFD2 ; E5DB9C ; D0BCAC ; BEB4C5 ; E6A57E ; 218B82 ; 9AD9DB ; E5DBD9 ; 98D4BB ; EB96AA ; C6C9D0 ; C54B6C ; E5B3BB ; C47482 ; D5E4C3 ; F9968B ; F27348 ; 26474E ; 76CDCD ; 2CCED2 ; B8E0F6 ; A4CCE3 ; 37667E ; DEC4D6 ; 7B92AA ; DDF2F4 ; 84A6D6 ; 4382BB ; E4CEE0 ; A15D98 ; DC828F ; F7CE76 ; E8D6CF ; 8C7386 ; 9C9359 ; F4C815 ; F9CAD7 ; A57283 ; C1D5DE ; DEEDE6 ; E9BBB5 ; E7CBA9 ; AAD9CD ; E8D595 ; 8DA47E ; CAE7E3 ; B2B2B2 ; EEB8C5 ; DCDBD9 ; FEC7BC ; FBECDB ; F3CBBD ; 90CDC3 ; AF8C72 ; 938F43 ; B8A390 ; E6D1D2 ; DAD5D6 ; B2B5B9 ; 8FA2A6 ; 8EA4C8 ; C3B8AA ; DEDCE4 ; DB93A5 ; C7CDC5 ; 698396 ; A9C8C0 ; DBBC8E ; AE8A8C ; 7C98AB ; C2D9E1 ; D29F8C ; D9D3D2 ; 81B1CC ; FFD9CF ; C6AC85 ; ; D9C2BD ; A2C4C6 ; 82B2B8 ; 874741 ; CA9C95 ; 40393E ; E5E4E5 ; 897C87 ; 46302B ; 76504E ; D3CCCA ; A37E7E ; 86736C ; ; AD192A ; E4B78F ; F1E8EA ; D88D96 ; EAB1B9 ; F38C10 ; A7763B ; CCD7D8 ; 4C482E ; D2B6BA ; BE3F12 ; 7DB0CD ; C0B5AB ; 79553F ; 91BA96 ; A65111 ; DDAA00 ; 7C5D3D ; 85AAAA ; 173F4E ; D82315 ; 2F1710 ; 425164 ; DABB96 ; 899FB6 ; DBB657 ; 86553F ; C8C2D0 ; E45C54 ; 90A375 ; F9BB9D ; FFDA43 ; 756382 ; E2C274 ; 9CA8B5 ; FFE75D ; D24970 ; 32657C ; 669BB7 ; CF8145 ; 753516 ; AF6F33 ; 9DB4BA ; 210E0D ; E2D2C1 ; CA8459 ; DDB396 ; DDDFE3 ; 422523 ; 954D34 ; 843619 ; B87730 ; 1B2625 ; DAD0CE ; 748991 ; 64A532 ; B09647 ; 450309 ; DEE2E3 ; 7B5536 ; 446C04 ; F8DF96 ; 977D77 ; 301F1A ; 5E301F ; 8E3229 ; AEBB35 ; 2F1D16 ; D0BDAA ; A37537 ; FF415B ; BC7F37 ; 352C20 ; EAE8E8 ; 64AA71 ; F64900 ; CB8A2D ; 262416 ; DDDDDE ; 90B274 ; B08D7E ; 6C74A4 ; BBB9BC ; 5E2424 ; 95BB9A ; 652F20 ; 74C85D ; 2D3538 ; 57818A ; D54C2E ; D09150 ; DEBD9B ; 3C2320 ; 955132 ; EBEBEF ; B08138 ; 784928 ; 382918 ; DDD4D3 ; AE8A75 ; F08E88 ; 422D09 ; 468F5E ; AC7C36 ; E3E2DF ; E1A624 ; 317AC1 ; 384454 ; D4D3DC ; AD956B ; F38C10 ; A7763B ; CCD7D8 ; 4C482E ; D2B6BA ; C5853D ; 99372E ; DAD4D9 ; 391C19 ; B27E83 ; 4F3B2B ; 7C6619 ; B8B5AD ; BE0309 ; 93C1D5 ".split(";"),
h;var g=1E3<a.length?sjcl.hash.sha256.hash(a.substring(0,1E3)):sjcl.hash.sha256.hash(a);g=sjcl.codec.hex.fromBits(g);a="000000000000000000000000000000000000000000000";var k="1";null!=g&&(a=BigInt("0x"+g));"undefined"!=typeof b&&0<b.length?(g=1E3<b.length?sjcl.hash.sha256.hash(b.substring(0,1E3)):sjcl.hash.sha256.hash(b),g=sjcl.codec.hex.fromBits(g),null!=g&&(k=BigInt("0x"+g)),g=a*k):g=a;b=parseFloat(g.toString(10).substring(0,2)+"."+g.toString(10).substring(2,5));a=parseFloat(g.toString(10).substring(5,
7)+"."+g.toString(10).substring(7,10));k="";10<g.toString(10).length&&(k=parseFloat(g.toString(10).substring(10,12)+"."+g.toString(10).substring(12,15)));g="#"+g.toString(16).substring(0,6);var l=c(g);return{xpc:b,ypc:a,zpc:k,origcol:g,col:l,boxShadow:"0px 0px 2px "+l,getpastelcolor:c}}
function createVaultPopup(a,b){increasesiteusage(a.name);var c=document.createElement("div");c.setAttribute("id","dot-popup-vlt-"+b);c.classList.add("dot-popup-vault");c.style.width="25vw";c.style.backgroundColor="rgba(256, 256, 256, 0.8)";c.style.zIndex=5;c.style.display="none";c.style.lineHeight="";c.style.position="absolute";c.style.padding="5px";c.style.boxShadow="3px 5px 4px #aeaeae";var f=document.createElement("div");f.classList.add("row");var d=document.createElement("div");d.classList.add("col-xs-12");
f.appendChild(d);for(var e=0;e<a.description.length;e++){let c=document.createElement("div");c.classList.add("row");let f=document.createElement("div");f.classList.add("col-xs-6");let l=a.description[e].split(":#:#:");f.innerHTML=JSON.stringify(l[0]);f.title="Click to launch site in separate Tab";f.addEventListener("click",function(a,b){return function(a){loadExtUrl(b)}}(event,a.name));let m=document.createElement("div");m.classList.add("col-xs-3");var h=document.createElement("IMG");h.src="/static/icons/copy.png";
h.height="14";h.title="Copy Password";h.addEventListener("click",function(c,d){return function(c){copytexttocbandhighlight(d,"Password copied",c);c.target.src="/static/icons/copied.png";let f=document.getElementById("dot-"+b);null!=f&&1==a.description.length&&(f.style.display="none");setTimeout(function(){c.target.src="/static/icons/copy.png"},6E4)}}(event,l[1]));m.appendChild(h);h=document.createElement("div");h.classList.add("col-xs-3");let n=document.createElement("IMG");n.src="/static/icons/eye-close-up.png";
n.height="14";n.title="Show Password";n.addEventListener("click",function(a,b){return function(a){displaybuttonbehavior(a,b)}}(event,l[1]));h.appendChild(n);c.appendChild(f);c.appendChild(m);c.appendChild(h);d.appendChild(c)}c.appendChild(f);f=document.getElementById("dot-"+b);null!=f&&(d=parseFloat(f.style.left.split("%")[0])*parseInt(window.innerWidth)/100,e=parseFloat(f.style.top.split("%")[0])*parseInt(window.innerHeight)/100,d>window.innerWidth/2&&(c.style.right="5px"),e>window.innerHeight/2&&
(c.style.bottom="5px"),c.style.display="block",f.appendChild(c));document.addEventListener("click",function(a){a.stopPropagation();a=document.getElementsByClassName("dot-popup-vault");for(var b=0;b<a.length;b++)"none"!=a[b].style.display&&(a[b].style.display="none")})}
function setvaultpagebehaviour(){document.getElementById("post-button").title="Add credential to vault";document.getElementById("vault-button").onclick=null;document.getElementById("vault-button").title="";document.getElementById("red-privacy-button").src="/static/icons/search-40.png";document.getElementById("red-privacy-button").onclick=null;document.getElementById("red-privacy-button").title="Search vault";document.getElementById("red-privacy-button").addEventListener("click",function(a){a.stopPropagation();
document.getElementById("vault-search-input").style.zIndex=10;document.getElementById("vault-search-input").style.visibility="visible";a=function(){document.getElementById("vault-search-input").style.visibility="hidden"};document.body.removeEventListener("click",a);document.body.addEventListener("click",a)});document.getElementById("vault-search-input").addEventListener("input",function(a){stopDefaultBackspaceBehaviour(a);null!=searchtimeoutid&&clearTimeout(searchtimeoutid);searchtimeoutid=setTimeout(function(a){displayvaultdataasdots(originaldata)},
200)});document.getElementById("vault-search-input").addEventListener("click",function(a){a.stopPropagation()});document.getElementById("post-button").onclick=null;document.getElementById("post-button").removeEventListener("click",addpostfunction);document.getElementById("post-button").addEventListener("click",function(){createAddInputOnForeGroundDiv()})}
function createVaultKeyInputOnForeGroundDiv(a,b){console.log("will show vault key input. clearing splash timeout");document.getElementById("displayloadingcontainer").style.display="none";b=document.getElementById("app-flk");var c=document.createElement("div");c.setAttribute("id","vaultkeyinputholder");c.style.position="fixed";c.style.zIndex="5000";c.style.left="50%";c.style.top="50%";c.style.width="50%";c.style.height="50%";c.style.backgroundColor="#dbdbdb";c.style.boxShadow="2px 3px 1px #cecece";
c.style.opacity=.9;c.style.transform="translate(-50%, -50%)";var f=document.createElement("span");f.style.position="fixed";f.style.left="50%";f.style.top="50%";f.style.width="400px";f.style.transform="translate(-50%, -50%)";b.style.backgroundColor="#c2c2c2";var d=document.createElement("input");d.type="password";d.id="newauthvaultkey";d.style.height="35px";d.style.margin="2px";d.style.border="0px";d.style.width="250px";600>window.innerWidth&&(d.style.width="130px");d.style.padding="5px";d.style.fontSize=
"16px";d.style.color="#494949";d.style.position="fixed";d.style.left="50%";d.style.top="50%";d.style.transform="translate(-50%, -50%)";d.style.backgroundColor="#ffffff";d.placeholder="Vault Key";d.autocomplete="off";d.addEventListener("input",function(){document.getElementById("newauth-notification").innerHTML="";5<document.getElementById("newauthvaultkey").value.length?document.getElementById("newauthvksubmitbtn").style.visibility="visible":document.getElementById("newauthvksubmitbtn").style.visibility=
"hidden"});var e=document.createElement("input");e.type="button";e.id="newauthvksubmitbtn";e.value="Enter";e.style.visibility="hidden";e.style.display="inline-block";e.style.height="35px";e.style.margin="2px";e.style.float="right";e.style.padding="5px";e.style.color="#efefef";e.style.backgroundColor="#3498db";var h=document.createElement("div");h.style.position="fixed";h.id="newauth-notification";h.style.left="50%";h.style.top="80%";h.style.transform="translate(-50%)";h.innerHTML="Please enter your vault key.";
null==document.getElementById("newauthvaultkey")&&(e.addEventListener("click",function(){vaultkey=document.getElementById("newauthvaultkey").value;try{originaldata=sjcl.decrypt(vaultkey,a),displayvaultdataasdots(originaldata)}catch(g){null!=document.getElementById("newauth-notification")&&(document.getElementById("newauthvaultkey").value="",document.getElementById("newauthvaultkey").borderColor="red",document.getElementById("newauth-notification").innerHTML="",document.getElementById("newauth-notification").innerHTML=
"Invalid Vault key. Please try again")}}),d.addEventListener("keydown",function(b){if(13===b.keyCode||9===b.keyCode){vaultkey=document.getElementById("newauthvaultkey").value;try{originaldata=sjcl.decrypt(vaultkey,a),displayvaultdataasdots(originaldata)}catch(k){null!=document.getElementById("newauth-notification")&&(document.getElementById("newauthvaultkey").value="",document.getElementById("newauthvaultkey").borderColor="red",document.getElementById("newauth-notification").innerHTML="",document.getElementById("newauth-notification").innerHTML=
"Invalid Vault key. Please try again")}}}),f.appendChild(d),f.appendChild(e),c.appendChild(f),c.appendChild(h),b.appendChild(c))}
function createAddInputOnForeGroundDiv(){var a=[{name:"siteUrl",description:"Site URL or name"},{name:"siteuser",description:"User name or public key"},{name:"sitepwd",description:"Password or private key",type:"password"},{name:"sitedesc",description:"Details about this entry (optional)"},{name:"sitename",description:"Name to use for this entry (optional)"}],b=document.getElementById("app-flk"),c=document.createElement("div");c.setAttribute("id","vaultaddinputholder");c.style.position="fixed";c.style.zIndex=
"5000";c.style.left="50%";c.style.top="50%";if(600>window.innerWidth||600>window.innerHeight)c.style.width="90%";c.style.width="50%";c.style.height="50%";c.style.backgroundColor="#dbdbdb";c.style.boxShadow="2px 3px 1px #cecece";c.style.transform="translate(-50%, -50%)";var f=document.createElement("h4");f.style.position="fixed";f.style.left="50%";f.style.transform="translate(-50%)";f.appendChild(document.createTextNode("Add Credential to vault"));c.appendChild(f);f=document.createElement("span");
f.innerHTML='\x3cimg width\x3d"16" height\x3d"16" src\x3d"/static/icons/cross-sign.png"/\x3e';f.style.float="right";f.style.padding="8px";f.style.opacity=.5;f.style.top="0px";f.style.display="inline-block";f.style.cursor="default";f.addEventListener("mouseover",function(a){a.target.style.opacity=.8});f.addEventListener("mouseout",function(a){a.target.style.opacity=.5});f.addEventListener("click",function(a){a.stopPropagation();a.preventDefault();$("#vaultaddinputholder").fadeOut(500);removediv(document.getElementById("vaultaddinputholder"))});
c.appendChild(f);f=document.createElement("div");f.style.position="fixed";f.id="newauth-notification";f.style.display="none";f.style.left="50%";f.style.top="80%";f.style.transform="translate(-50%)";f.innerHTML="Please check your input.";var d=document.createElement("div");d.classList.add("container");d.style.position="fixed";d.style.left="50%";d.style.top="50%";d.style.width="60%";if(600>window.innerWidth||600>window.innerHeight)d.style.width="90%";d.style.transform="translate(-50%, -50%)";for(var e=
0;e<a.length;e++){var h=document.createElement("div");h.classList.add("row");var g=document.createElement("div");g.classList.add("col-xs-12");var k=document.createElement("input");k.classList.add("form-control");k.classList.add("input-md");k.setAttribute("type","undefined"===typeof a[e].type||null==a[e].type?"text":a[e].type);k.setAttribute("id",a[e].name);k.setAttribute("placeholder",a[e].description);k.setAttribute("width","50%");g.appendChild(k);h.appendChild(g);d.appendChild(h)}h=document.createElement("div");
h.classList.add("row");g=document.createElement("div");g.classList.add("col-xs-12");g.classList.add("text-center");e=document.createElement("input");e.setAttribute("id","vlt-add-button");e.classList.add("btn");e.style.marginTop="15px";e.classList.add("btn-primary");e.classList.add("btn-md");e.type="button";e.value="Submit";e.addEventListener("click",function(b){addnewcredentialtovault(a)},!1);g.appendChild(e);h.appendChild(g);d.appendChild(h);c.appendChild(d);c.appendChild(f);b.appendChild(c)}
function addnewcredentialtovault(a){for(var b="{",c=0;c<a.length;c++){var f=document.getElementById(a[c].name).value;null!=f&&0<f.length&&(b+='"'+a[c].name+'": "'+f+'"',b+=",")}b=(b+"}").replace(",}","}");var d=JSON.parse(originaldata);d.push(JSON.parse(b));a=encryptdatawithstretchedkey(JSON.stringify(d),vaultkey,rndsalt,rnditer);var e=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");e.open("POST","/secure/adduserdata",!1);e.withCredentials=!0;e.setRequestHeader("Content-Type",
"application/json");e.onreadystatechange=function(){if(4==e.readyState&&200==e.status){$("#vaultaddinputholder").fadeOut(500);removediv(document.getElementById("vaultaddinputholder"));var a=document.getElementsByClassName("dot-vault");if(null!=a&&0<a.length)for(var b=0;b<a.length;b++)removediv(a[b]);displayvaultdataasdots(JSON.stringify(d))}};e.send(JSON.stringify({group:"sites",salt:rndsalt,iterations:rnditer,data:a,sequence:rndseq,createdate:rndcrdate}))}
function populatetopicowner(a){var b=new XMLHttpRequest;b.onreadystatechange=function(){if(4==b.readyState&&200==b.status){var a=b.responseText;document.getElementById("topic-admin").innerText="This page created by: "+a}};b.open("GET","/newauth/api/gettopicowner/"+a,!0);b.withCredentials=!0;b.setRequestHeader("Content-Type","application/json");b.send(null)}
function rotatetopicdemoimage(a){var b=a.getAttribute("data-img-index");if("1"==b){a.setAttribute("data-img-index","100");var c=document.getElementById("dot-img-spinner-label").innerHTML;c=c.replace("15","100");document.getElementById("dot-img-spinner-label").innerHTML=c;document.getElementById("dot-img-spinner").src="/static/icons/d-ui-100-1.png"}"100"==b&&(a.setAttribute("data-img-index","500"),c=document.getElementById("dot-img-spinner-label").innerHTML,c=c.replace("100","500"),document.getElementById("dot-img-spinner-label").innerHTML=
c,document.getElementById("dot-img-spinner").src="/static/icons/d-ui-500-1.png");"500"==b&&(a.setAttribute("data-img-index","1"),c=document.getElementById("dot-img-spinner-label").innerHTML,c=c.replace("500","15"),document.getElementById("dot-img-spinner-label").innerHTML=c,document.getElementById("dot-img-spinner").src="/static/icons/d-ui-1.png");return!1}
function displaytopicnewmemberpopup(){var a=document.getElementById("topic-welcome-overlay");if(null==a){a=document.createElement("div");a.setAttribute("id","topic-welcome-overlay");document.body.appendChild(a);var b=document.createElement("div");b.classList.add("container");b.classList.add("v-center");var c=document.createElement("div");c.classList.add("row");var f=document.createElement("div");f.classList.add("col-md-8");f.classList.add("col-md-offset-2");var d=document.createElement("div");d.classList.add("panel");
d.classList.add("panel-default");d.setAttribute("id","createuser-overlay-content");var e=document.createElement("h3");e.appendChild(document.createTextNode(""));e.style.color="#737373";e.style.fontWeight="900";d.appendChild(e);e=document.createElement("span");e.innerHTML='\x3cimg width\x3d"16" height\x3d"16" src\x3d"/static/icons/cross-sign.png"/\x3e';e.style.float="right";e.style.padding="8px";e.style.opacity=.5;e.style.top="0px";e.style.display="inline-block";e.style.cursor="default";e.addEventListener("mouseover",
function(a){a.target.style.opacity=.8});e.addEventListener("mouseout",function(a){a.target.style.opacity=.5});e.addEventListener("click",function(a){a.stopPropagation();a.preventDefault();$("#topic-welcome-overlay").fadeOut(500);removediv(document.getElementById("topic-welcome-overlay"))});f.appendChild(e);e=document.createElement("p");e.classList.add("lead");e.setAttribute("id","createuser-flake-text-header");e.appendChild(document.createTextNode(topicname+" page on Newauth"));e.style.color="#737373";
e.style.fontWeight="700";d.appendChild(e);e=document.createElement("div");e.classList.add("row");var h=document.createElement("div");h.classList.add("col-sm-8");h.classList.add("col-sm-offset-2");var g=document.createElement("p");g.classList.add("text-muted");g.setAttribute("id","createuser-flake-text");g.appendChild(document.createTextNode("Welcome to the "+topicname+" dots page. Dots UI is a unique way to interact with people and ideas. There is no need to install any app or create a Newauth account to use its basic features."));
g.style.color="#878787";g.style.paddingLeft="8px";g.style.paddingRight="8px";g.style.fontWeight="600";var k=document.createElement("p");k.classList.add("text-muted");k.setAttribute("id","createuser-flake-text");k.appendChild(document.createTextNode("Enter your name or an alias to start."));k.style.color="#878787";k.style.fontWeight="500";h.appendChild(g);h.appendChild(k);e.appendChild(h);d.appendChild(e);e=document.createElement("div");e.classList.add("row");e.classList.add("text-center");document.createElement("div").setAttribute("id",
"cu-flake-can");d.appendChild(e);e=document.createElement("div");e.classList.add("panel-body");e.classList.add("panel-word-wrap");h=document.createElement("div");h.classList.add("row");g=document.createElement("div");g.classList.add("col-md-8");g.classList.add("col-xs-9");g.classList.add("col-md-offset-2");g.setAttribute("id","create-flk-input-holder");h.appendChild(g);e.appendChild(h);k=document.createElement("input");k.setAttribute("type","text");k.setAttribute("id","topic-user-name-input");k.setAttribute("placeholder",
"Name or Alias");k.setAttribute("autofocus","true");k.classList.add("form-control");k.classList.add("input-md");k.addEventListener("click",function(a){a.stopPropagation()});k.addEventListener("input",function(a){a.stopPropagation();2<document.getElementById("topic-user-name-input").value.length?"none"==document.getElementById("flk-send-button").style.display&&(document.getElementById("flk-send-button").style.display="block"):document.getElementById("flk-send-button").style.display="none"},!1);k.style.color=
"#646464";var l=document.createElement("input");l.setAttribute("id","flk-send-button");l.classList.add("btn");l.classList.add("btn-primary");l.classList.add("btn-md");l.conversationID="";l.changestarttime="";l.type="button";l.value="Join";l.addEventListener("click",function(a){addnametotopicmembers(a)},!1);var m=document.createElement("div");m.classList.add("col-sm-2");m.classList.add("col-xs-3");h.appendChild(m);g.appendChild(k);m.appendChild(l);e.appendChild(h);d.appendChild(e);f.appendChild(d);
c.appendChild(f);b.appendChild(c);a.appendChild(b);$("#topic-user-name-input").focus()}settimeoutid=setTimeout(function(){$("#topic-welcome-overlay").fadeIn("slow")},300)}function displayjointimeclock(a){a=1E3*parseInt(a);document.getElementById("jointimeleftdisplay").innerHTML=converttimediffmstocalendar(a)+" left to join";document.getElementById("jointimeleftdisplay").style.display="block"}
function addnametotopicmembers(a){a.stopPropagation();var b=document.getElementById("topic-user-name-input").value,c=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");c.onreadystatechange=function(){if(4==c.readyState&&200==c.status){$("#topic-welcome-overlay").fadeOut(500);removediv(document.getElementById("topic-welcome-overlay"));posts[0].text=b;posts[0].tags=[b,"joined"];if("undefined"!=typeof posts[0].data){var a=JSON.parse(posts[0].data);null!=a&&"undefined"!=typeof a.text&&
(a.text=b+" joined",a.tags[0]=b,posts[0].data=JSON.stringify(a))}null!=document.getElementById("dot-popup-0")?document.getElementById("dot-popup-text-0").innerHTML=b+" joined":(a=document.getElementById("dot-0"),null!=a&&showpostdatainpopup(posts[0],0,null,!1,a.style.left,a.style.top))}};c.open("POST","/newauth/api/addnameoftopicmember",!1);c.withCredentials=!0;c.setRequestHeader("Content-Type","application/json");c.send(JSON.stringify({topic:topicname,giveout:b,crTime:posts[0].crtime}))}
function displayRadialText(a,b){function c(a){360<a&&(a-=360);var b,c=Math.PI/180*a;a<=A&&(b=(h-r)/Math.cos(c));a>A&&a<=180-A&&(b=Math.abs((g-65)/Math.sin(c)));a>180-A&&a<=180+A&&(b=Math.abs((h-r)/Math.cos(c)));a>180+A&&a<=360-A&&(b=Math.abs((g-r)/Math.sin(c)));a>360-A&&360>=a&&(b=Math.abs((h-r)/Math.cos(c)));return b}function f(a){document.getElementsByClassName("dot");var b=r;console.log("realdotsz "+b);for(var d=0,f=0,e=w;e<=F;e+=1.618*b){var g=[];g.push("processing radius "+e);for(var h=Math.ceil(180/
Math.PI*Math.atan(1.8*b/e))+1,k=a;k<a+360;k+=1.1*h){var m=e+1.8*b,n=k,p=k+1.1*h;360<n&&(n-=360);if(360<p)break;c(n);c(p);var u=c((n+p)/2);(e+m)/2<u?(l.push(parseInt(n)+":"+parseInt(p)+"::"+parseInt(e)+":"+parseInt(m)),m=parseInt(e),q[m]="undefined"!=typeof q[m]?q[m]+1:1,d++):f++}g.push("processed ")}console.log("no of cells "+d+" skipped "+f)}function d(a,b){var c=document.getElementsByClassName("dot");setTimeout(function(){c[a].classList.contains("centerdot")||(c[a].style.backgroundColor=b)},500)}
function e(a){var b=document.getElementsByClassName("dot");setTimeout(function(){b[a].classList.contains("centerdot")||b[a].classList.remove("shake")},1E3)}var h=window.innerWidth/2,g=window.innerHeight/2,k=[],l=[],m=2*a.length;new Set;new Map;var n=180;n=parseInt(1.2/3.6*Math.min(window.innerHeight,window.innerWidth));var w=n/2+.06*n;console.log("Computed centerdot size "+n+" minradiius "+w);var q={},p=0,B=new Set,u=0;20>a.length&&(u=20);20<=a.length&&50>a.length&&(u=50);50<=a.length&&(u=parseInt(a.length+
50));var r=parseInt(Math.sqrt((window.innerWidth*window.innerHeight-Math.pow(2*w,2))/u)/3.2);console.log("max dot size [theoretical] "+r);r>n/8&&(r=parseInt(n/8));console.log("max dot size [practical] "+r);var A=parseInt(180*Math.atan((g-2*r)/(h-2*r))/Math.PI);console.log("max diagonal at degree "+A);var F=parseInt((h-2*r)/Math.cos(Math.atan((g-2*r)/(h-2*r))));console.log("max diagonal "+F);u=document.createElement("div");u.innerHTML="center";u.style.color="white";u.style.fontSize="9px";u.style.position=
"absolute";u.style.left=h-n/2+"px";u.style.top=g-n/2+"px";u.style.maxWidth=n+"px";u.style.width=n+"px";u.id="100000";u.style.backgroundColor="#565656";u.style.zIndex=m-x;u.classList.add("dot");u.classList.add("centerdot");b&&document.body.appendChild(u);for(var x=0;x<a.length;x++){let E;if("undefined"!=typeof a[x].data&&null!=a[x].data&&0<a[x].data.length)try{var H=JSON.parse(a[x].data);a[x].data=H}catch(G){console.error(" Exception caught while parsing JSON:",info.data),console.error(" Error details:",
G)}null!=a[x].category?E=a[x].category:null!=a[x].data?E=null!=a[x].data.category?a[x].data.category:JSON.stringify(a[x].data):null!=a[x].summary?E=a[x].summary:null!=a[x].text&&(E=a[x].text);u=E;n=document.createElement("div");n.style.color="white";n.style.fontSize="9px";u="undefined"!=typeof a[x].datahash&&null!=a[x].datahash&&0<a[x].datahash.length?hashCodeSHA(a[x].datahash,!0):"undefined"!=typeof u?hashCodeSHA(u):hashCodeSHA(Math.floor(1E16*Math.random()).toString());var v=u.num,y=v%360;p=Math.PI/
180*y;var C=r/2;p=Math.sqrt(Math.pow(h-C,2)+Math.pow(g-C,2));C=[];p=c(y);0==Object.keys(l).length&&(f(0),console.log("safelocations size "+Object.keys(l).length+" dots per radius "+JSON.stringify(q)));p=parseInt(Object.keys(l).length/2);0<p%2&&p++;var z=v%parseInt(Object.keys(l).length/3),D=0;6<v%10&&(z+=parseInt(p/2));for(z>=Object.keys(l).length&&(z=Object.keys(l).length-2);B.has(z);){console.log(x+" conflict with locidx ");if(5<D)break;z=l.length-D;D++}0>z&&(z=l.length-1);"undefined"!=typeof l[z]?
(y=l[z].split("::")[0],v=l[z].split("::")[1],p=parseInt(y.split(":")[1]),parseInt(y.split(":")[1])<parseInt(y.split(":")[0])&&(p+=360),y=(parseInt(y.split(":")[0])+p)/2,360<y&&(y-=360),parseInt(v.split(":")[1]),parseInt(v.split(":")[0]),radius=(parseInt(v.split(":")[1])+parseInt(v.split(":")[0]))/2,v=Math.pow(10,z/l.length),z<q[Object.keys(q)[0]]?(y-=v,radius-=v):radius+v<c(y+v)?(y+=v,radius+=v):radius+v/2<c(y+v)&&(y+=v/2,radius+=v/2)):(console.log("locidx "+z+" is  undefined .. safelocations size "+
Object.keys(l).length),p=v%360,0<p&&90>=p&&(y=A),90<p&&180>=p&&(y=180-A),180<p&&270>=p&&(y=180+A),270<p&&360>=p&&(y=360-A),p=c(y),radius=parseInt(Math.max(w,v%p)),radius<1.3*w&&(radius+v%(3*r)<p?radius+=v%(3*r):radius+v%(2*r)<p?radius+=v%(2*r):radius+v%r<p&&(radius+=v%r)),console.log(x+" hardcoded location angle "+y+" rad "+radius));p=Math.PI/180*y;v=l.slice(0,z);D=l.slice(z+1);l=v.concat(D);v=parseInt(h+radius*Math.cos(p));p=parseInt(g-radius*Math.sin(p));n.style.position="absolute";n.style.left=
parseInt(v-r/2)+"px";n.style.top=parseInt(p-r/2)+"px";n.id=x;n.style.maxWidth=r+"px";n.style.backgroundColor="#565656";n.style.zIndex=m-x;n.classList.add("dot");C.push("locidx angle radius -- "+z+" ::"+parseInt(y)+":"+parseInt(radius));n.title=n.id+JSON.stringify(C);C=getpastelcolor("#"+u.hex.substring(0,6));"undefined"!=typeof b&&b&&(document.body.appendChild(n),document.getElementById("elemcount").innerHTML=a.length,x==a.length-1&&document.addEventListener("click",function(){for(var a=document.getElementsByClassName("dot"),
b=0;b<a.length;b++)a[b].classList.contains("centerdot")||(a[b].classList.add("shake"),e(b))}),d(x,C));k.push({left:parseInt(v-r/2)+"px",top:parseInt(p-r/2)+"px",width:r+"px",dotmaxsize:r,pcolor:C,color:"#"+u.hex.substring(0,6)})}l=[];console.log("safe positions map cleared. new size "+l.length);return k}function hashCode(a){for(var b=0,c=0;c<a.length;c++)b=(b<<5)-b+a.charCodeAt(c),b&=b;return b}
function hashCodeSHA(a,b){var c;if("undefined"==typeof b||0==b)a=1E3<a.length?sjcl.hash.sha256.hash(a.substring(0,1E3)):sjcl.hash.sha256.hash(a),a=sjcl.codec.hex.fromBits(a);null!=a&&(c=parseInt(a.substring(a.length-10,a.length),16));return{hex:a,num:c}}var rgbmap;function getpastelcolor(a){null==rgbmap&&creatergbmapofpastels();return findclosestrgbfrommap(a)}
function creatergbmapofpastels(){rgbmap={};for(var a=" F7F6CF ; B6D8F2 ; F4CFDF ; 5784BA ; 9AC8EB ; CCD4BF ; E7CBA9 ; EEBAB2 ; F5F3E7 ; F5E2E4 ; F5BFD2 ; E5DB9C ; D0BCAC ; BEB4C5 ; E6A57E ; 218B82 ; 9AD9DB ; E5DBD9 ; 98D4BB ; EB96AA ; C6C9D0 ; C54B6C ; E5B3BB ; C47482 ; D5E4C3 ; F9968B ; F27348 ; 26474E ; 76CDCD ; 2CCED2 ; B8E0F6 ; A4CCE3 ; 37667E ; DEC4D6 ; 7B92AA ; DDF2F4 ; 84A6D6 ; 4382BB ; E4CEE0 ; A15D98 ; DC828F ; F7CE76 ; E8D6CF ; 8C7386 ; 9C9359 ; F4C815 ; F9CAD7 ; A57283 ; C1D5DE ; DEEDE6 ; E9BBB5 ; E7CBA9 ; AAD9CD ; E8D595 ; 8DA47E ; CAE7E3 ; B2B2B2 ; EEB8C5 ; DCDBD9 ; FEC7BC ; FBECDB ; F3CBBD ; 90CDC3 ; AF8C72 ; 938F43 ; B8A390 ; E6D1D2 ; DAD5D6 ; B2B5B9 ; 8FA2A6 ; 8EA4C8 ; C3B8AA ; DEDCE4 ; DB93A5 ; C7CDC5 ; 698396 ; A9C8C0 ; DBBC8E ; AE8A8C ; 7C98AB ; C2D9E1 ; D29F8C ; D9D3D2 ; 81B1CC ; FFD9CF ; C6AC85 ; D9C2BD ; A2C4C6 ; 82B2B8 ; 874741 ; CA9C95 ; 40393E ; E5E4E5 ; 897C87 ; 46302B ; 76504E ; D3CCCA ; A37E7E ; 86736C ; AD192A ; E4B78F ; F1E8EA ; D88D96 ; EAB1B9 ; F38C10 ; A7763B ; CCD7D8 ; 4C482E ; D2B6BA ; BE3F12 ; 7DB0CD ; C0B5AB ; 79553F ; 91BA96 ; A65111 ; DDAA00 ; 7C5D3D ; 85AAAA ; 173F4E ; D82315 ; 2F1710 ; 425164 ; DABB96 ; 899FB6 ; DBB657 ; 86553F ; C8C2D0 ; E45C54 ; 90A375 ; F9BB9D ; FFDA43 ; 756382 ; E2C274 ; 9CA8B5 ; FFE75D ; D24970 ; 32657C ; 669BB7 ; CF8145 ; 753516 ; AF6F33 ; 9DB4BA ; 210E0D ; E2D2C1 ; CA8459 ; DDB396 ; DDDFE3 ; 422523 ; 954D34 ; 843619 ; B87730 ; 1B2625 ; DAD0CE ; 748991 ; 64A532 ; B09647 ; 450309 ; DEE2E3 ; 7B5536 ; 446C04 ; F8DF96 ; 977D77 ; 301F1A ; 5E301F ; 8E3229 ; AEBB35 ; 2F1D16 ; D0BDAA ; A37537 ; FF415B ; BC7F37 ; 352C20 ; EAE8E8 ; 64AA71 ; F64900 ; CB8A2D ; 262416 ; DDDDDE ; 90B274 ; B08D7E ; 6C74A4 ; BBB9BC ; 5E2424 ; 95BB9A ; 652F20 ; 74C85D ; 2D3538 ; 57818A ; D54C2E ; D09150 ; DEBD9B ; 3C2320 ; 955132 ; EBEBEF ; B08138 ; 784928 ; 382918 ; DDD4D3 ; AE8A75 ; F08E88 ; 422D09 ; 468F5E ; AC7C36 ; E3E2DF ; E1A624 ; 317AC1 ; 384454 ; D4D3DC ; AD956B ; F38C10 ; A7763B ; CCD7D8 ; 4C482E ; D2B6BA ; C5853D ; 99372E ; DAD4D9 ; 391C19 ; B27E83 ; 4F3B2B ; 7C6619 ; B8B5AD ; BE0309 ; 93C1D5 ".split(";"),b=
0;b<a.length;b++){var c=hexToRgb1(a[b].trim());null!=c&&(rgbmap[a[b].trim()]=c)}}function findclosestrgbfrommap(a){a=a.replace("#","");var b=hexToRgb1(a),c=-1,f;Object.keys(rgbmap).forEach((a,e)=>{e=calculatedistance(b,rgbmap[a]);if(0>c||e<c)0<c&&(f="#"+a),c=e});return f}function calculatedistance(a,b){return Math.pow(a.r-b.r,2)+Math.pow(a.g-b.g,2)+Math.pow(a.b-b.b,2)}
function hexToRgb1(a){return(a=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(a))?{r:parseInt(a[1],16),g:parseInt(a[2],16),b:parseInt(a[3],16)}:null};